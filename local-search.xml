<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Python æ‰“åŒ…æˆ EXE çš„æ­£ç¡®æ–¹å¼ï¼šç”¨ Nuitkaï¼Œåšä¸€ä¸ªçœŸæ­£åƒ`è½¯ä»¶`çš„ç¨‹åº</title>
    <link href="/2025/12/26/Python%20%E6%89%93%E5%8C%85%E6%88%90%20EXE%20%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%96%B9%E5%BC%8F%EF%BC%9A%E7%94%A8%20Nuitka%EF%BC%8C%E5%81%9A%E4%B8%80%E4%B8%AA%E7%9C%9F%E6%AD%A3%E5%83%8F%E2%80%9C%E8%BD%AF%E4%BB%B6%E2%80%9D%E7%9A%84%E7%A8%8B%E5%BA%8F/"/>
    <url>/2025/12/26/Python%20%E6%89%93%E5%8C%85%E6%88%90%20EXE%20%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%96%B9%E5%BC%8F%EF%BC%9A%E7%94%A8%20Nuitka%EF%BC%8C%E5%81%9A%E4%B8%80%E4%B8%AA%E7%9C%9F%E6%AD%A3%E5%83%8F%E2%80%9C%E8%BD%AF%E4%BB%B6%E2%80%9D%E7%9A%84%E7%A8%8B%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="Python-æ‰“åŒ…æˆ-EXE-çš„æ­£ç¡®æ–¹å¼ï¼šç”¨-Nuitkaï¼Œåšä¸€ä¸ªçœŸæ­£åƒâ€œè½¯ä»¶â€çš„ç¨‹åº"><a href="#Python-æ‰“åŒ…æˆ-EXE-çš„æ­£ç¡®æ–¹å¼ï¼šç”¨-Nuitkaï¼Œåšä¸€ä¸ªçœŸæ­£åƒâ€œè½¯ä»¶â€çš„ç¨‹åº" class="headerlink" title="Python æ‰“åŒ…æˆ EXE çš„æ­£ç¡®æ–¹å¼ï¼šç”¨ Nuitkaï¼Œåšä¸€ä¸ªçœŸæ­£åƒâ€œè½¯ä»¶â€çš„ç¨‹åº"></a>Python æ‰“åŒ…æˆ EXE çš„æ­£ç¡®æ–¹å¼ï¼šç”¨ Nuitkaï¼Œåšä¸€ä¸ªçœŸæ­£åƒâ€œè½¯ä»¶â€çš„ç¨‹åº</h1><blockquote><p>å¦‚æœä½ è¿˜åœ¨ç”¨ PyInstaller æ‰“åŒ… Python GUIï¼Œ<br>é‚£ä½ å¯èƒ½ä¸€ç›´åœ¨å¿å—ï¼š<strong>ä½“ç§¯å¤§ã€å¯åŠ¨æ…¢ã€è¯¯æŠ¥å¤š</strong>ã€‚</p></blockquote><p>è¿™ç¯‡æ–‡ç« ï¼Œå¸¦ä½ ç”¨ <strong>Nuitka</strong>ï¼Œä» 0 æ‰“åŒ…ä¸€ä¸ª <strong>æœ€ç®€å•çš„ GUI ç¨‹åº</strong>ï¼Œä¸€æ­¥åˆ°ä½ç”Ÿæˆ <strong>çœŸæ­£çš„ Windows EXE</strong>ã€‚</p><hr><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆå¾ˆå¤šäººå¯¹-Python-æ‰“åŒ…ä¸æ»¡æ„ï¼Ÿ"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆå¾ˆå¤šäººå¯¹-Python-æ‰“åŒ…ä¸æ»¡æ„ï¼Ÿ" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆå¾ˆå¤šäººå¯¹ Python æ‰“åŒ…ä¸æ»¡æ„ï¼Ÿ"></a>ä¸€ã€ä¸ºä»€ä¹ˆå¾ˆå¤šäººå¯¹ Python æ‰“åŒ…ä¸æ»¡æ„ï¼Ÿ</h2><p>å…¸å‹åæ§½åŒ…æ‹¬ï¼š</p><ul><li>exe åŠ¨è¾„ 100MB+</li><li>å¯åŠ¨æ…¢ï¼ˆonefile å…ˆè§£å‹ï¼‰</li><li>è¢« Windows Defender è¯¯æ€</li><li>æ‰“åŒ…å¤æ‚é¡¹ç›®å°±æŠ¥é”™</li></ul><p>è¿™äº›é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ï¼š<br>ğŸ‘‰ <strong>å¤§å¤šæ•°å·¥å…·åªæ˜¯â€œæ‰“åŒ…è§£é‡Šå™¨â€ï¼Œè€Œä¸æ˜¯â€œç¼–è¯‘ç¨‹åºâ€</strong></p><hr><h2 id="äºŒã€Nuitka-æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¥è¯è®²æ¸…"><a href="#äºŒã€Nuitka-æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¥è¯è®²æ¸…" class="headerlink" title="äºŒã€Nuitka æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¥è¯è®²æ¸…"></a>äºŒã€Nuitka æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¥è¯è®²æ¸…</h2><blockquote><p><strong>Nuitka &#x3D; æŠŠ Python ç¼–è¯‘æˆ Cï¼Œå†ç”Ÿæˆ exe</strong></p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li>Python ä»£ç  â†’ C ä»£ç </li><li>C ä»£ç  â†’ åŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶</li><li>å†æŠŠä¾èµ–ä¸€èµ·æ‰“åŒ…</li></ul><p>ğŸ“Œ å®ƒæ›´æ¥è¿‘ï¼š<br><strong>â€œç”¨ Python å†™ï¼Œç”¨ C çš„æ–¹å¼äº¤ä»˜â€</strong></p><hr><h2 id="ä¸‰ã€Nuitka-vs-PyInstallerï¼ˆç®€æ˜å¯¹æ¯”ï¼‰"><a href="#ä¸‰ã€Nuitka-vs-PyInstallerï¼ˆç®€æ˜å¯¹æ¯”ï¼‰" class="headerlink" title="ä¸‰ã€Nuitka vs PyInstallerï¼ˆç®€æ˜å¯¹æ¯”ï¼‰"></a>ä¸‰ã€Nuitka vs PyInstallerï¼ˆç®€æ˜å¯¹æ¯”ï¼‰</h2><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>PyInstaller</th><th>Nuitka</th></tr></thead><tbody><tr><td>åŸç†</td><td>æ‰“åŒ…è§£é‡Šå™¨</td><td>ç¼–è¯‘æˆ C</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>è¾ƒæ…¢</td><td>æ›´å¿«</td></tr><tr><td>EXE ä½“ç§¯</td><td>åå¤§</td><td>ä¸­ç­‰</td></tr><tr><td>å·¥ç¨‹æ„Ÿ</td><td>å·¥å…·å‹</td><td>è½¯ä»¶å‹</td></tr><tr><td>æ¨èåœºæ™¯</td><td>è„šæœ¬</td><td>GUI &#x2F; å·¥ç¨‹</td></tr></tbody></table><p><strong>ç»“è®º</strong>ï¼š<br>ğŸ‘‰ GUI ç¨‹åºã€é•¿æœŸç»´æŠ¤é¡¹ç›®ï¼ŒNuitka æ›´åˆé€‚ã€‚</p><hr><h2 id="å››ã€ç¤ºä¾‹é¡¹ç›®ï¼šä¸€ä¸ªæœ€ç®€å•çš„-GUI-ç¨‹åº"><a href="#å››ã€ç¤ºä¾‹é¡¹ç›®ï¼šä¸€ä¸ªæœ€ç®€å•çš„-GUI-ç¨‹åº" class="headerlink" title="å››ã€ç¤ºä¾‹é¡¹ç›®ï¼šä¸€ä¸ªæœ€ç®€å•çš„ GUI ç¨‹åº"></a>å››ã€ç¤ºä¾‹é¡¹ç›®ï¼šä¸€ä¸ªæœ€ç®€å•çš„ GUI ç¨‹åº</h2><p>æˆ‘ä»¬ç”¨ <strong>Python å†…ç½®çš„ tkinter</strong>ï¼Œä¸å¼•å…¥ä»»ä½•ç¬¬ä¸‰æ–¹åº“ï¼Œä¿è¯ï¼š</p><ul><li>é›¶ä¾èµ–</li><li>é›¶å¤æ‚åº¦</li><li>ä¸“æ³¨æ‰“åŒ…æµç¨‹</li></ul><hr><h2 id="äº”ã€ç¤ºä¾‹ä»£ç ï¼ˆmain-pyï¼‰"><a href="#äº”ã€ç¤ºä¾‹ä»£ç ï¼ˆmain-pyï¼‰" class="headerlink" title="äº”ã€ç¤ºä¾‹ä»£ç ï¼ˆmain.pyï¼‰"></a>äº”ã€ç¤ºä¾‹ä»£ç ï¼ˆmain.pyï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tkinter <span class="hljs-keyword">as</span> tk<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">on_click</span>():<br>    label.config(text=<span class="hljs-string">&quot;Hello, Nuitka!&quot;</span>)<br><br><br>root = tk.Tk()<br>root.title(<span class="hljs-string">&quot;Nuitka GUI Demo&quot;</span>)<br>root.geometry(<span class="hljs-string">&quot;300x150&quot;</span>)<br><br>label = tk.Label(root, text=<span class="hljs-string">&quot;Click the button&quot;</span>)<br>label.pack(pady=<span class="hljs-number">10</span>)<br><br>button = tk.Button(root, text=<span class="hljs-string">&quot;Click Me&quot;</span>, command=on_click)<br>button.pack()<br><br>root.mainloop()<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœï¼š</p><ul><li>æ‰“å¼€ä¸€ä¸ªçª—å£</li><li>ç‚¹å‡»æŒ‰é’®ï¼Œæ–‡å­—å‘ç”Ÿå˜åŒ–</li></ul><hr><h2 id="å…­ã€å‡†å¤‡æ‰“åŒ…ç¯å¢ƒï¼ˆå¼ºçƒˆå»ºè®®ï¼‰"><a href="#å…­ã€å‡†å¤‡æ‰“åŒ…ç¯å¢ƒï¼ˆå¼ºçƒˆå»ºè®®ï¼‰" class="headerlink" title="å…­ã€å‡†å¤‡æ‰“åŒ…ç¯å¢ƒï¼ˆå¼ºçƒˆå»ºè®®ï¼‰"></a>å…­ã€å‡†å¤‡æ‰“åŒ…ç¯å¢ƒï¼ˆå¼ºçƒˆå»ºè®®ï¼‰</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python <span class="hljs-literal">-m</span> venv venv<br>venv\Scripts\activate<br><br>pip install nuitka<br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ å»ºè®® <strong>æ¯ä¸ªé¡¹ç›®ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒ</strong>ï¼Œé¿å…æŠŠæ— å…³ä¾èµ–æ‰“è¿›å»ã€‚</p></blockquote><hr><h2 id="ä¸ƒã€Nuitka-ä¸€è¡Œæ‰“åŒ…å‘½ä»¤ï¼ˆGUI-ç¨‹åºç‰ˆï¼‰"><a href="#ä¸ƒã€Nuitka-ä¸€è¡Œæ‰“åŒ…å‘½ä»¤ï¼ˆGUI-ç¨‹åºç‰ˆï¼‰" class="headerlink" title="ä¸ƒã€Nuitka ä¸€è¡Œæ‰“åŒ…å‘½ä»¤ï¼ˆGUI ç¨‹åºç‰ˆï¼‰"></a>ä¸ƒã€Nuitka ä¸€è¡Œæ‰“åŒ…å‘½ä»¤ï¼ˆGUI ç¨‹åºç‰ˆï¼‰</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python <span class="hljs-literal">-m</span> nuitka main.py <span class="hljs-literal">--standalone</span> <span class="hljs-literal">--onefile</span> <span class="hljs-literal">--follow-imports</span> <span class="hljs-literal">--enable-plugin</span>=anti<span class="hljs-literal">-bloat</span> <span class="hljs-literal">--assume-yes-for-downloads</span> <span class="hljs-literal">--windows-disable-console</span> <span class="hljs-literal">--output-filename</span>=gui_demo.exe<br></code></pre></td></tr></table></figure><h3 id="å…³é”®å‚æ•°è¯´æ˜"><a href="#å…³é”®å‚æ•°è¯´æ˜" class="headerlink" title="å…³é”®å‚æ•°è¯´æ˜"></a>å…³é”®å‚æ•°è¯´æ˜</h3><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>--standalone</code></td><td>æ‰“åŒ…å®Œæ•´è¿è¡Œç¯å¢ƒ</td></tr><tr><td><code>--onefile</code></td><td>è¾“å‡ºå•ä¸ª exe</td></tr><tr><td><code>--windows-disable-console</code></td><td><strong>GUI ç¨‹åºä¸æ˜¾ç¤ºå‘½ä»¤è¡Œçª—å£</strong></td></tr><tr><td><code>anti-bloat</code></td><td>å‡å°‘ä½“ç§¯</td></tr></tbody></table><p>ğŸ‘‰ åŒå‡» <code>gui_demo.exe</code>ï¼Œ<strong>ç›´æ¥å¼¹çª—ï¼Œæ²¡æœ‰é»‘æ¡†</strong></p><hr><h2 id="å…«ã€ç»™-GUI-EXE-æ·»åŠ å›¾æ ‡ï¼ˆéå¸¸é‡è¦ï¼‰"><a href="#å…«ã€ç»™-GUI-EXE-æ·»åŠ å›¾æ ‡ï¼ˆéå¸¸é‡è¦ï¼‰" class="headerlink" title="å…«ã€ç»™ GUI EXE æ·»åŠ å›¾æ ‡ï¼ˆéå¸¸é‡è¦ï¼‰"></a>å…«ã€ç»™ GUI EXE æ·»åŠ å›¾æ ‡ï¼ˆéå¸¸é‡è¦ï¼‰</h2><h3 id="1ï¸âƒ£-å‡†å¤‡å¤šå°ºå¯¸-ico"><a href="#1ï¸âƒ£-å‡†å¤‡å¤šå°ºå¯¸-ico" class="headerlink" title="1ï¸âƒ£ å‡†å¤‡å¤šå°ºå¯¸ ico"></a>1ï¸âƒ£ å‡†å¤‡å¤šå°ºå¯¸ ico</h3><p>ä¸€ä¸ªåˆæ ¼çš„ <code>app.ico</code> è‡³å°‘åŒ…å«ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">16</span>Ã—<span class="hljs-number">16</span> / <span class="hljs-number">32</span>Ã—<span class="hljs-number">32</span> / <span class="hljs-number">48</span>Ã—<span class="hljs-number">48</span> / <span class="hljs-number">256</span>Ã—<span class="hljs-number">256</span><br></code></pre></td></tr></table></figure><h3 id="2ï¸âƒ£-æ‰“åŒ…å‘½ä»¤åŠ ä¸€è¡Œå‚æ•°"><a href="#2ï¸âƒ£-æ‰“åŒ…å‘½ä»¤åŠ ä¸€è¡Œå‚æ•°" class="headerlink" title="2ï¸âƒ£ æ‰“åŒ…å‘½ä»¤åŠ ä¸€è¡Œå‚æ•°"></a>2ï¸âƒ£ æ‰“åŒ…å‘½ä»¤åŠ ä¸€è¡Œå‚æ•°</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-literal">--windows-icon-from-ico</span>=app.ico<br></code></pre></td></tr></table></figure><p>å®Œæ•´ç¤ºä¾‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python <span class="hljs-literal">-m</span> nuitka main.py <span class="hljs-literal">--standalone</span> <span class="hljs-literal">--onefile</span> <span class="hljs-literal">--follow-imports</span> <span class="hljs-literal">--enable-plugin</span>=anti<span class="hljs-literal">-bloat</span> <span class="hljs-literal">--assume-yes-for-downloads</span> <span class="hljs-literal">--windows-disable-console</span> <span class="hljs-literal">--windows-icon-from-ico</span>=app.ico <span class="hljs-literal">--output-filename</span>=gui_demo.exe<br></code></pre></td></tr></table></figure><hr><h2 id="ä¹ã€å¸¸è§å‘æ€»ç»“ï¼ˆå¿…çœ‹ï¼‰"><a href="#ä¹ã€å¸¸è§å‘æ€»ç»“ï¼ˆå¿…çœ‹ï¼‰" class="headerlink" title="ä¹ã€å¸¸è§å‘æ€»ç»“ï¼ˆå¿…çœ‹ï¼‰"></a>ä¹ã€å¸¸è§å‘æ€»ç»“ï¼ˆå¿…çœ‹ï¼‰</h2><h3 id="âŒ-exe-åŒå‡»æ²¡ååº”"><a href="#âŒ-exe-åŒå‡»æ²¡ååº”" class="headerlink" title="âŒ exe åŒå‡»æ²¡ååº”"></a>âŒ exe åŒå‡»æ²¡ååº”</h3><ul><li>å®é™…æ˜¯å¼‚å¸¸è¢«åäº†</li><li>è°ƒè¯•é˜¶æ®µå…ˆ <strong>ä¸è¦</strong> ç¦ç”¨ console</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-literal">--windows-console-mode</span>=force<br></code></pre></td></tr></table></figure><hr><h3 id="âŒ-å›¾æ ‡ä¸æ˜¾ç¤º"><a href="#âŒ-å›¾æ ‡ä¸æ˜¾ç¤º" class="headerlink" title="âŒ å›¾æ ‡ä¸æ˜¾ç¤º"></a>âŒ å›¾æ ‡ä¸æ˜¾ç¤º</h3><ul><li>ico åªæœ‰å•å°ºå¯¸</li><li>Windows Explorer ç¼“å­˜</li></ul><p>è§£å†³ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ie4uinit.exe <span class="hljs-literal">-ClearIconCache</span><br></code></pre></td></tr></table></figure><hr><h3 id="âŒ-æ‰“åŒ…åä½“ç§¯ä»ç„¶åå¤§"><a href="#âŒ-æ‰“åŒ…åä½“ç§¯ä»ç„¶åå¤§" class="headerlink" title="âŒ æ‰“åŒ…åä½“ç§¯ä»ç„¶åå¤§"></a>âŒ æ‰“åŒ…åä½“ç§¯ä»ç„¶åå¤§</h3><ul><li>å¿˜äº† <code>anti-bloat</code></li><li>è™šæ‹Ÿç¯å¢ƒé‡Œè£…äº†å¤ªå¤šåŒ…</li></ul><hr><h2 id="åã€ä»€ä¹ˆæ—¶å€™è¯¥ç”¨-Nuitkaï¼Ÿ"><a href="#åã€ä»€ä¹ˆæ—¶å€™è¯¥ç”¨-Nuitkaï¼Ÿ" class="headerlink" title="åã€ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ Nuitkaï¼Ÿ"></a>åã€ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ Nuitkaï¼Ÿ</h2><p>âœ… GUI ç¨‹åº<br>âœ… æ¡Œé¢å·¥å…·<br>âœ… å†…éƒ¨åˆ†å‘è½¯ä»¶<br>âœ… é•¿æœŸç»´æŠ¤é¡¹ç›®</p><p>âŒ ä¸€æ¬¡æ€§è„šæœ¬<br>âŒ å­¦ä¹ æ¼”ç¤ºä»£ç </p><hr><h2 id="åä¸€ã€æ€»ç»“"><a href="#åä¸€ã€æ€»ç»“" class="headerlink" title="åä¸€ã€æ€»ç»“"></a>åä¸€ã€æ€»ç»“</h2><blockquote><p><strong>Nuitka ä¸åªæ˜¯â€œæ‰“åŒ…å·¥å…·â€ï¼Œè€Œæ˜¯â€œäº¤ä»˜æ–¹å¼çš„å‡çº§â€</strong></p></blockquote><p>å¦‚æœä½ å¸Œæœ›ä½ çš„ Python ç¨‹åºï¼š</p><ul><li>çœ‹èµ·æ¥åƒçœŸæ­£çš„è½¯ä»¶</li><li>å¯åŠ¨æ›´å¿«</li><li>ç»“æ„æ›´å¹²å‡€</li></ul><p>ğŸ‘‰ <strong>Nuitka éå¸¸å€¼å¾—æˆä¸ºé¦–é€‰</strong></p><hr><h3 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h3><p>Python èƒ½å†™ GUIï¼Œ<br><strong>ä¹Ÿèƒ½äº¤ä»˜ä¸“ä¸šçº§ Windows è½¯ä»¶</strong>ã€‚</p><p>å·®çš„ï¼Œåªæ˜¯ä½ é€‰æ²¡é€‰å¯¹å·¥å…·ã€‚</p><hr>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python æ‰“åŒ…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>requests vs aiohttp vs httpx pythonè¯·æ±‚åº“å¯¹æ¯” é…åˆfastapiä½¿ç”¨</title>
    <link href="/2025/12/26/requests%20vs%20aiohttp%20vs%20httpx%20python%E8%AF%B7%E6%B1%82%E5%BA%93%E5%AF%B9%E6%AF%94%20%E9%85%8D%E5%90%88fastapi%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/12/26/requests%20vs%20aiohttp%20vs%20httpx%20python%E8%AF%B7%E6%B1%82%E5%BA%93%E5%AF%B9%E6%AF%94%20%E9%85%8D%E5%90%88fastapi%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p>ä¸€ä»½ <strong>é¢å‘ FastAPI çš„ã€å·¥ç¨‹çº§åˆ«çš„å¯¹æ¯”ç»“è®º</strong>ï¼Œç«™åœ¨<strong>å¼‚æ­¥æ¶æ„ &#x2F; å¹¶å‘ &#x2F; ç”Ÿäº§å¯ç»´æŠ¤æ€§</strong>è§’åº¦æ¥é€‰å‹ã€‚</p><hr><h1 id="ä¸€å¥è¯ç»“è®ºï¼ˆå…ˆç»™ç»“è®ºï¼‰"><a href="#ä¸€å¥è¯ç»“è®ºï¼ˆå…ˆç»™ç»“è®ºï¼‰" class="headerlink" title="ä¸€å¥è¯ç»“è®ºï¼ˆå…ˆç»™ç»“è®ºï¼‰"></a>ä¸€å¥è¯ç»“è®ºï¼ˆå…ˆç»™ç»“è®ºï¼‰</h1><blockquote><p>âœ… <strong>FastAPI é¡¹ç›®ï¼šä¼˜å…ˆé€‰æ‹© <code>httpx</code></strong><br>âŒ <strong>ä¸è¦åœ¨ FastAPI çš„æ¥å£é‡Œç›´æ¥ç”¨ <code>requests</code></strong><br>âš ï¸ <code>aiohttp</code> å¯ç”¨ï¼Œä½†ä»…åœ¨ç‰¹å®šåœºæ™¯ä¸‹æ‰å€¼å¾—é€‰</p></blockquote><p>æ’åºï¼ˆFastAPI åœºæ™¯ï¼‰ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">httpx</span>   &gt;   aiohttp   &gt;&gt;&gt;   requests<br></code></pre></td></tr></table></figure><hr><h1 id="ä¸€ã€ä¸‰è€…æ ¸å¿ƒå®šä½å¯¹æ¯”"><a href="#ä¸€ã€ä¸‰è€…æ ¸å¿ƒå®šä½å¯¹æ¯”" class="headerlink" title="ä¸€ã€ä¸‰è€…æ ¸å¿ƒå®šä½å¯¹æ¯”"></a>ä¸€ã€ä¸‰è€…æ ¸å¿ƒå®šä½å¯¹æ¯”</h1><table><thead><tr><th>åº“</th><th>æ ¸å¿ƒå®šä½</th></tr></thead><tbody><tr><td><strong>requests</strong></td><td>åŒæ­¥ HTTP å®¢æˆ·ç«¯ï¼ˆç»å…¸åº“ï¼Œéå¼‚æ­¥ï¼‰</td></tr><tr><td><strong>aiohttp</strong></td><td>æ—©æœŸå¼‚æ­¥ HTTP + Web æ¡†æ¶</td></tr><tr><td><strong>httpx</strong></td><td>ç°ä»£åŒ– requests å…¼å®¹çš„åŒæ­¥ + å¼‚æ­¥ HTTP å®¢æˆ·ç«¯</td></tr></tbody></table><hr><h1 id="äºŒã€ä¸-FastAPI-çš„ã€Œæœ¬è´¨å…¼å®¹æ€§ã€"><a href="#äºŒã€ä¸-FastAPI-çš„ã€Œæœ¬è´¨å…¼å®¹æ€§ã€" class="headerlink" title="äºŒã€ä¸ FastAPI çš„ã€Œæœ¬è´¨å…¼å®¹æ€§ã€"></a>äºŒã€ä¸ FastAPI çš„ã€Œæœ¬è´¨å…¼å®¹æ€§ã€</h1><p>FastAPI æœ¬è´¨æ˜¯ï¼š</p><ul><li>ASGI</li><li>asyncio</li><li>é«˜å¹¶å‘ã€éé˜»å¡ I&#x2F;O</li></ul><h3 id="æ˜¯å¦â€œå¤©ç„¶é€‚é…â€-FastAPIï¼Ÿ"><a href="#æ˜¯å¦â€œå¤©ç„¶é€‚é…â€-FastAPIï¼Ÿ" class="headerlink" title="æ˜¯å¦â€œå¤©ç„¶é€‚é…â€ FastAPIï¼Ÿ"></a>æ˜¯å¦â€œå¤©ç„¶é€‚é…â€ FastAPIï¼Ÿ</h3><table><thead><tr><th>åº“</th><th>æ˜¯å¦é˜»å¡äº‹ä»¶å¾ªç¯</th><th>ç»“è®º</th></tr></thead><tbody><tr><td>requests</td><td>âŒ æ˜¯</td><td><strong>ä¸¥é‡ä¸é€‚é…</strong></td></tr><tr><td>aiohttp</td><td>âœ… å¦</td><td>é€‚é…</td></tr><tr><td>httpx</td><td>âœ… å¦</td><td><strong>å®Œç¾é€‚é…</strong></td></tr></tbody></table><hr><h1 id="ä¸‰ã€è¯¦ç»†å¯¹æ¯”è¡¨ï¼ˆå·¥ç¨‹çº§ï¼‰"><a href="#ä¸‰ã€è¯¦ç»†å¯¹æ¯”è¡¨ï¼ˆå·¥ç¨‹çº§ï¼‰" class="headerlink" title="ä¸‰ã€è¯¦ç»†å¯¹æ¯”è¡¨ï¼ˆå·¥ç¨‹çº§ï¼‰"></a>ä¸‰ã€è¯¦ç»†å¯¹æ¯”è¡¨ï¼ˆå·¥ç¨‹çº§ï¼‰</h1><h2 id="1ï¸âƒ£-å¹¶å‘-x2F-å¼‚æ­¥èƒ½åŠ›"><a href="#1ï¸âƒ£-å¹¶å‘-x2F-å¼‚æ­¥èƒ½åŠ›" class="headerlink" title="1ï¸âƒ£ å¹¶å‘ &#x2F; å¼‚æ­¥èƒ½åŠ›"></a>1ï¸âƒ£ å¹¶å‘ &#x2F; å¼‚æ­¥èƒ½åŠ›</h2><table><thead><tr><th>é¡¹ç›®</th><th>requests</th><th>aiohttp</th><th>httpx</th></tr></thead><tbody><tr><td>å¼‚æ­¥æ”¯æŒ</td><td>âŒ</td><td>âœ…</td><td>âœ…</td></tr><tr><td>asyncio åŸç”Ÿ</td><td>âŒ</td><td>âœ…</td><td>âœ…</td></tr><tr><td>async&#x2F;await</td><td>âŒ</td><td>âœ…</td><td>âœ…</td></tr><tr><td>FastAPI å¹¶å‘å‹å¥½</td><td>âŒ</td><td>âœ…</td><td>âœ…</td></tr></tbody></table><p>ğŸš¨ <strong>FastAPI ä¸­ç”¨ requests &#x3D; é˜»å¡ worker</strong></p><hr><h2 id="2ï¸âƒ£-API-è®¾è®¡-amp-å¯ç»´æŠ¤æ€§"><a href="#2ï¸âƒ£-API-è®¾è®¡-amp-å¯ç»´æŠ¤æ€§" class="headerlink" title="2ï¸âƒ£ API è®¾è®¡ &amp; å¯ç»´æŠ¤æ€§"></a>2ï¸âƒ£ API è®¾è®¡ &amp; å¯ç»´æŠ¤æ€§</h2><table><thead><tr><th>é¡¹ç›®</th><th>requests</th><th>aiohttp</th><th>httpx</th></tr></thead><tbody><tr><td>API æ˜“ç”¨æ€§</td><td>â­â­â­â­â­</td><td>â­â­â­</td><td>â­â­â­â­â­</td></tr><tr><td>requests è¿ç§»æˆæœ¬</td><td>åŸç”Ÿ</td><td>âŒ</td><td>âœ… 100%</td></tr><tr><td>å¿ƒæ™ºè´Ÿæ‹…</td><td>æä½</td><td>åé«˜</td><td>ä½</td></tr><tr><td>ä»£ç å¯è¯»æ€§</td><td>é«˜</td><td>ä¸­</td><td>é«˜</td></tr></tbody></table><h3 id="ç¤ºä¾‹å¯¹æ¯”"><a href="#ç¤ºä¾‹å¯¹æ¯”" class="headerlink" title="ç¤ºä¾‹å¯¹æ¯”"></a>ç¤ºä¾‹å¯¹æ¯”</h3><h4 id="requests"><a href="#requests" class="headerlink" title="requests"></a>requests</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">requests.get(url)<br></code></pre></td></tr></table></figure><h4 id="aiohttp"><a href="#aiohttp" class="headerlink" title="aiohttp"></a>aiohttp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(url) <span class="hljs-keyword">as</span> resp:<br>        data = <span class="hljs-keyword">await</span> resp.json()<br></code></pre></td></tr></table></figure><h4 id="httpx"><a href="#httpx" class="headerlink" title="httpx"></a>httpx</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient() <span class="hljs-keyword">as</span> client:<br>    r = <span class="hljs-keyword">await</span> client.get(url)<br>    data = r.json()<br></code></pre></td></tr></table></figure><p>ğŸ‘‰ <strong>httpx &#x3D; requests + async</strong></p><hr><h2 id="3ï¸âƒ£-FastAPI-å®˜æ–¹ç”Ÿæ€æ”¯æŒ"><a href="#3ï¸âƒ£-FastAPI-å®˜æ–¹ç”Ÿæ€æ”¯æŒ" class="headerlink" title="3ï¸âƒ£ FastAPI å®˜æ–¹ç”Ÿæ€æ”¯æŒ"></a>3ï¸âƒ£ FastAPI å®˜æ–¹ç”Ÿæ€æ”¯æŒ</h2><table><thead><tr><th>èƒ½åŠ›</th><th>requests</th><th>aiohttp</th><th>httpx</th></tr></thead><tbody><tr><td>FastAPI å®˜æ–¹æ¨è</td><td>âŒ</td><td>âš ï¸</td><td>âœ…</td></tr><tr><td>ASGI é›†æˆæµ‹è¯•</td><td>âŒ</td><td>âŒ</td><td>âœ…</td></tr><tr><td>Starlette åŸç”Ÿæ”¯æŒ</td><td>âŒ</td><td>âŒ</td><td>âœ…</td></tr></tbody></table><h3 id="FastAPI-å®˜æ–¹æµ‹è¯•æ–¹å¼ï¼ˆhttpxï¼‰"><a href="#FastAPI-å®˜æ–¹æµ‹è¯•æ–¹å¼ï¼ˆhttpxï¼‰" class="headerlink" title="FastAPI å®˜æ–¹æµ‹è¯•æ–¹å¼ï¼ˆhttpxï¼‰"></a>FastAPI å®˜æ–¹æµ‹è¯•æ–¹å¼ï¼ˆhttpxï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> httpx <span class="hljs-keyword">import</span> AsyncClient<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> AsyncClient(app=app, base_url=<span class="hljs-string">&quot;http://test&quot;</span>) <span class="hljs-keyword">as</span> ac:<br>    res = <span class="hljs-keyword">await</span> ac.get(<span class="hljs-string">&quot;/ping&quot;</span>)<br></code></pre></td></tr></table></figure><p>âš ï¸ <strong>aiohttp æ— ç­‰ä»·èƒ½åŠ›</strong></p><hr><h2 id="4ï¸âƒ£-æ€§èƒ½-amp-ç¨³å®šæ€§ï¼ˆçœŸå®ç”Ÿäº§ï¼‰"><a href="#4ï¸âƒ£-æ€§èƒ½-amp-ç¨³å®šæ€§ï¼ˆçœŸå®ç”Ÿäº§ï¼‰" class="headerlink" title="4ï¸âƒ£ æ€§èƒ½ &amp; ç¨³å®šæ€§ï¼ˆçœŸå®ç”Ÿäº§ï¼‰"></a>4ï¸âƒ£ æ€§èƒ½ &amp; ç¨³å®šæ€§ï¼ˆçœŸå®ç”Ÿäº§ï¼‰</h2><table><thead><tr><th>åœºæ™¯</th><th>requests</th><th>aiohttp</th><th>httpx</th></tr></thead><tbody><tr><td>é«˜å¹¶å‘</td><td>âŒ</td><td>â­â­â­â­</td><td>â­â­â­â­</td></tr><tr><td>TLS æ€§èƒ½</td><td>â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td></tr><tr><td>HTTP&#x2F;2</td><td>âŒ</td><td>âš ï¸</td><td>âœ…</td></tr><tr><td>è¿æ¥æ± </td><td>â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td></tr></tbody></table><blockquote><p>aiohttp ç†è®ºæ€§èƒ½ç•¥é«˜<br><strong>ä½† httpx çš„å·®è· &lt; 5%ï¼Œç”Ÿäº§æ— æ„Ÿ</strong></p></blockquote><hr><h2 id="5ï¸âƒ£-é”™è¯¯å¤„ç†-amp-å·¥ç¨‹èƒ½åŠ›"><a href="#5ï¸âƒ£-é”™è¯¯å¤„ç†-amp-å·¥ç¨‹èƒ½åŠ›" class="headerlink" title="5ï¸âƒ£ é”™è¯¯å¤„ç† &amp; å·¥ç¨‹èƒ½åŠ›"></a>5ï¸âƒ£ é”™è¯¯å¤„ç† &amp; å·¥ç¨‹èƒ½åŠ›</h2><table><thead><tr><th>èƒ½åŠ›</th><th>requests</th><th>aiohttp</th><th>httpx</th></tr></thead><tbody><tr><td>å¼‚å¸¸ä½“ç³»</td><td>ç®€å•</td><td>å¤æ‚</td><td>æ¸…æ™°</td></tr><tr><td>Timeout ç²’åº¦</td><td>ç²—</td><td>ç»†</td><td><strong>æç»†</strong></td></tr><tr><td>é‡è¯•ç­–ç•¥</td><td>âŒ</td><td>æ‰‹å†™</td><td>æ˜“å°è£…</td></tr><tr><td>ç±»å‹æç¤º</td><td>ä¸€èˆ¬</td><td>ä¸€èˆ¬</td><td><strong>ä¼˜ç§€</strong></td></tr></tbody></table><h3 id="httpx-çš„-timeout-æ§åˆ¶"><a href="#httpx-çš„-timeout-æ§åˆ¶" class="headerlink" title="httpx çš„ timeout æ§åˆ¶"></a>httpx çš„ timeout æ§åˆ¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">timeout = httpx.Timeout(<br>    connect=<span class="hljs-number">5.0</span>,<br>    read=<span class="hljs-number">10.0</span>,<br>    write=<span class="hljs-number">5.0</span>,<br>    pool=<span class="hljs-number">5.0</span>,<br>)<br></code></pre></td></tr></table></figure><hr><h2 id="6ï¸âƒ£-åœ¨-FastAPI-ä¸­çš„ã€Œæ­£ç¡®å§¿åŠ¿ã€"><a href="#6ï¸âƒ£-åœ¨-FastAPI-ä¸­çš„ã€Œæ­£ç¡®å§¿åŠ¿ã€" class="headerlink" title="6ï¸âƒ£ åœ¨ FastAPI ä¸­çš„ã€Œæ­£ç¡®å§¿åŠ¿ã€"></a>6ï¸âƒ£ åœ¨ FastAPI ä¸­çš„ã€Œæ­£ç¡®å§¿åŠ¿ã€</h2><h3 id="âŒ-é”™è¯¯ç¤ºä¾‹ï¼ˆrequestsï¼‰"><a href="#âŒ-é”™è¯¯ç¤ºä¾‹ï¼ˆrequestsï¼‰" class="headerlink" title="âŒ é”™è¯¯ç¤ºä¾‹ï¼ˆrequestsï¼‰"></a>âŒ é”™è¯¯ç¤ºä¾‹ï¼ˆrequestsï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/data&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">data</span>():<br>    <span class="hljs-keyword">return</span> requests.get(url).json()<br></code></pre></td></tr></table></figure><p>é—®é¢˜ï¼š</p><ul><li>é˜»å¡ event loop</li><li>QPS æ€¥å‰§ä¸‹é™</li><li>worker è¢«å¡æ­»</li></ul><hr><h3 id="âš ï¸-å‹‰å¼ºå¯ç”¨ï¼ˆaiohttpï¼‰"><a href="#âš ï¸-å‹‰å¼ºå¯ç”¨ï¼ˆaiohttpï¼‰" class="headerlink" title="âš ï¸ å‹‰å¼ºå¯ç”¨ï¼ˆaiohttpï¼‰"></a>âš ï¸ å‹‰å¼ºå¯ç”¨ï¼ˆaiohttpï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/data&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">data</span>():<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(url) <span class="hljs-keyword">as</span> resp:<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> resp.json()<br></code></pre></td></tr></table></figure><p>é—®é¢˜ï¼š</p><ul><li>Session ä¸å¥½ç»Ÿä¸€ç®¡ç†</li><li>API é£æ ¼å‰²è£‚</li></ul><hr><h3 id="âœ…-æ­£ç¡®å§¿åŠ¿ï¼ˆhttpxï¼‰"><a href="#âœ…-æ­£ç¡®å§¿åŠ¿ï¼ˆhttpxï¼‰" class="headerlink" title="âœ… æ­£ç¡®å§¿åŠ¿ï¼ˆhttpxï¼‰"></a>âœ… æ­£ç¡®å§¿åŠ¿ï¼ˆhttpxï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">client = httpx.AsyncClient(timeout=<span class="hljs-number">10</span>)<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/data&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">data</span>():<br>    resp = <span class="hljs-keyword">await</span> client.get(url)<br>    <span class="hljs-keyword">return</span> resp.json()<br></code></pre></td></tr></table></figure><p>ğŸ‘‰ <strong>æ¨èï¼šå…¨å±€ AsyncClient + ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></p><hr><h2 id="7ï¸âƒ£-ä»€ä¹ˆæ—¶å€™é€‰-aiohttpï¼Ÿ"><a href="#7ï¸âƒ£-ä»€ä¹ˆæ—¶å€™é€‰-aiohttpï¼Ÿ" class="headerlink" title="7ï¸âƒ£ ä»€ä¹ˆæ—¶å€™é€‰ aiohttpï¼Ÿ"></a>7ï¸âƒ£ ä»€ä¹ˆæ—¶å€™é€‰ aiohttpï¼Ÿ</h2><p>åªæœ‰è¿™å‡ ç§æƒ…å†µï¼š</p><ul><li>å·²æœ‰å¤§é‡ aiohttp ä»£ç </li><li>ä½ éœ€è¦ aiohttp.web è‡ªå¸¦æœåŠ¡ç«¯</li><li>ä½ åœ¨å†™çˆ¬è™« &#x2F; socket çº§åˆ«æ§åˆ¶</li><li>æç«¯è¿½æ±‚æ€§èƒ½ï¼ˆå·®è·å¾ˆå°ï¼‰</li></ul><p>å¦åˆ™ âŒ ä¸æ¨èæ–°é¡¹ç›®é€‰ aiohttp</p><hr><h1 id="å››ã€æœ€ç»ˆé€‰å‹å»ºè®®"><a href="#å››ã€æœ€ç»ˆé€‰å‹å»ºè®®" class="headerlink" title="å››ã€æœ€ç»ˆé€‰å‹å»ºè®®"></a>å››ã€æœ€ç»ˆé€‰å‹å»ºè®®</h1><h2 id="âœ…-FastAPI-é¡¹ç›®æ ‡å‡†ç­”æ¡ˆ"><a href="#âœ…-FastAPI-é¡¹ç›®æ ‡å‡†ç­”æ¡ˆ" class="headerlink" title="âœ… FastAPI é¡¹ç›®æ ‡å‡†ç­”æ¡ˆ"></a>âœ… FastAPI é¡¹ç›®æ ‡å‡†ç­”æ¡ˆ</h2><table><thead><tr><th>åœºæ™¯</th><th>æ¨è</th></tr></thead><tbody><tr><td>FastAPI è°ƒç”¨ç¬¬ä¸‰æ–¹ API</td><td><strong>httpx.AsyncClient</strong></td></tr><tr><td>å¾®æœåŠ¡é—´è°ƒç”¨</td><td><strong>httpx</strong></td></tr><tr><td>FastAPI å•å…ƒ &#x2F; é›†æˆæµ‹è¯•</td><td><strong>httpx</strong></td></tr><tr><td>åŒæ­¥è„šæœ¬</td><td>requests &#x2F; httpx</td></tr><tr><td>è€ aiohttp é¡¹ç›®</td><td>aiohttp</td></tr></tbody></table><hr>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python fastapi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>React 18 å‰ç«¯æœ€ä½³å®è·µæŠ€æœ¯æ ˆï¼ˆ2025ï¼‰</title>
    <link href="/2025/12/25/React%2018%20%E5%89%8D%E7%AB%AF%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%8A%80%E6%9C%AF%E6%A0%88%E6%B8%85%E5%8D%95%EF%BC%882025%E7%89%88%EF%BC%89/"/>
    <url>/2025/12/25/React%2018%20%E5%89%8D%E7%AB%AF%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%8A%80%E6%9C%AF%E6%A0%88%E6%B8%85%E5%8D%95%EF%BC%882025%E7%89%88%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="ğŸš€-React-18-å‰ç«¯æœ€ä½³å®è·µæŠ€æœ¯æ ˆï¼ˆ2025ï¼‰"><a href="#ğŸš€-React-18-å‰ç«¯æœ€ä½³å®è·µæŠ€æœ¯æ ˆï¼ˆ2025ï¼‰" class="headerlink" title="ğŸš€ React 18 å‰ç«¯æœ€ä½³å®è·µæŠ€æœ¯æ ˆï¼ˆ2025ï¼‰"></a>ğŸš€ React 18 å‰ç«¯æœ€ä½³å®è·µæŠ€æœ¯æ ˆï¼ˆ2025ï¼‰</h1><h2 id="ğŸŒ-ç°ä»£è½»é‡åº”ç”¨"><a href="#ğŸŒ-ç°ä»£è½»é‡åº”ç”¨" class="headerlink" title="ğŸŒ ç°ä»£è½»é‡åº”ç”¨"></a>ğŸŒ ç°ä»£è½»é‡åº”ç”¨</h2><p>é€‚åˆï¼šç§»åŠ¨ç«¯ä¼˜å…ˆã€SaaS äº§å“ã€ç¤¾äº¤&#x2F;ç”µå•†å‰å°ã€‚</p><ul><li><p><strong>æ¡†æ¶ &#x2F; æ„å»ºå·¥å…·</strong></p><ul><li>React <code>18.3.x</code></li><li>Vite <code>5.x</code>ï¼ˆå®˜æ–¹æ¨èï¼Œå¿«ï¼Œç”Ÿæ€æˆç†Ÿï¼‰</li><li>TypeScript <code>5.6+</code></li></ul></li><li><p><strong>UI &amp; æ ·å¼</strong></p><ul><li>Tailwind CSS <code>3.4.x</code>ï¼ˆä¸»æµ utility-first æ ·å¼æ–¹æ¡ˆï¼‰</li><li>Shadcn&#x2F;uiï¼ˆåŸºäº Radix UI + Tailwindï¼Œæ¨èä½œä¸º UI åŸºç¡€åº“ï¼‰</li><li>Radix UI <code>1.x</code>ï¼ˆå¯é€‰ï¼Œç”¨äºæ— æ ·å¼ primitivesï¼‰</li></ul></li><li><p><strong>çŠ¶æ€ç®¡ç†</strong></p><ul><li>Zustand <code>4.x</code>ï¼ˆè½»é‡å…¨å±€çŠ¶æ€ï¼‰</li><li>React Query (TanStack Query) <code>5.x</code>ï¼ˆå¼‚æ­¥æ•°æ®ç®¡ç†ï¼Œç¼“å­˜ &amp; API è¯·æ±‚å¿…å¤‡ï¼‰</li></ul></li><li><p><strong>è·¯ç”±</strong></p><ul><li>React Router <code>7.x</code>ï¼ˆè½»é‡ï¼ŒVite é¡¹ç›®å¸¸ç”¨ï¼‰</li></ul></li><li><p><strong>è¡¨å•</strong></p><ul><li>React Hook Form <code>7.x</code>ï¼ˆè½»é‡ï¼Œæ€§èƒ½å¥½ï¼‰</li><li>Zod <code>3.x</code>ï¼ˆè¡¨å•æ ¡éªŒ + ç±»å‹å®‰å…¨ï¼‰</li></ul></li><li><p><strong>å…¶ä»–å·¥å…·</strong></p><ul><li>Axios <code>1.x</code>ï¼ˆHTTP è¯·æ±‚ï¼‰</li><li>ESLint <code>9.x</code> + Prettier <code>3.x</code>ï¼ˆä»£ç è§„èŒƒï¼‰</li><li>Vitest <code>1.x</code> + Testing Libraryï¼ˆå•å…ƒæµ‹è¯•ï¼‰</li></ul></li></ul><hr><h2 id="ğŸ¢-ä¼ä¸šåå°-x2F-ç®¡ç†ç³»ç»Ÿ"><a href="#ğŸ¢-ä¼ä¸šåå°-x2F-ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="ğŸ¢ ä¼ä¸šåå° &#x2F; ç®¡ç†ç³»ç»Ÿ"></a>ğŸ¢ ä¼ä¸šåå° &#x2F; ç®¡ç†ç³»ç»Ÿ</h2><p>é€‚åˆï¼šæ•°æ®å¯†é›†å‹ã€è¡¨æ ¼&#x2F;è¡¨å•å¤šã€æƒé™ç®¡ç†å¤æ‚çš„ B ç«¯åœºæ™¯ã€‚</p><ul><li><p><strong>æ¡†æ¶ &#x2F; æ„å»ºå·¥å…·</strong></p><ul><li>React <code>18.3.x</code></li><li>Vite <code>5.x</code> æˆ– Next.js <code>15.x</code>ï¼ˆå–å†³äºæ˜¯å¦éœ€è¦ SSRï¼‰</li><li>TypeScript <code>5.6+</code></li></ul></li><li><p><strong>UI &amp; æ ·å¼</strong></p><ul><li>Ant Design <code>5.x</code>ï¼ˆå›½å†…å¤–åå°ç³»ç»Ÿé¦–é€‰ï¼Œç»„ä»¶å®Œå–„ï¼‰</li><li>MUI <code>6.x</code>ï¼ˆå¯æ›¿ä»£æ–¹æ¡ˆï¼ŒMaterial Design é£æ ¼ï¼‰</li><li>Tailwind CSS <code>3.4.x</code>ï¼ˆå¯ä½œä¸º AntD&#x2F;MUI çš„æ ·å¼å¢å¼ºï¼‰</li></ul></li><li><p><strong>çŠ¶æ€ç®¡ç†</strong></p><ul><li>Redux Toolkit <code>2.x</code>ï¼ˆå¤æ‚ä¸šåŠ¡é€»è¾‘é¦–é€‰ï¼‰</li><li>React Query (TanStack Query) <code>5.x</code>ï¼ˆæ•°æ®è¯·æ±‚ &amp; ç¼“å­˜ç®¡ç†ï¼‰</li></ul></li><li><p><strong>è¡¨å• &#x2F; è¡¨æ ¼å¢å¼º</strong></p><ul><li>Ant Design Form &#x2F; MUI Formï¼ˆå†…ç½®å³å¯æ»¡è¶³å¤§å¤šæ•°éœ€æ±‚ï¼‰</li><li>React Hook Form <code>7.x</code> + Zod <code>3.x</code>ï¼ˆæ›´çµæ´»çš„æ–¹æ¡ˆï¼‰</li><li>TanStack Table <code>8.x</code>ï¼ˆé«˜çº§è¡¨æ ¼åŠŸèƒ½ï¼šåˆ†é¡µã€æ’åºã€è™šæ‹Ÿæ»šåŠ¨ï¼‰</li></ul></li><li><p><strong>å›½é™…åŒ–</strong></p><ul><li>react-intl <code>6.x</code> æˆ– lingui <code>4.x</code></li></ul></li><li><p><strong>å…¶ä»–å·¥å…·</strong></p><ul><li>Axios <code>1.x</code>ï¼ˆHTTP è¯·æ±‚ï¼‰</li><li>ESLint <code>9.x</code> + Prettier <code>3.x</code>ï¼ˆä»£ç è§„èŒƒï¼‰</li><li>Jest <code>29.x</code> æˆ– Vitest <code>1.x</code>ï¼ˆæµ‹è¯•ï¼‰</li></ul></li></ul><hr><h2 id="ğŸ”‘-æ€»ç»“å¯¹æ¯”"><a href="#ğŸ”‘-æ€»ç»“å¯¹æ¯”" class="headerlink" title="ğŸ”‘ æ€»ç»“å¯¹æ¯”"></a>ğŸ”‘ æ€»ç»“å¯¹æ¯”</h2><table><thead><tr><th>åœºæ™¯</th><th>UI åº“</th><th>æ ·å¼</th><th>çŠ¶æ€ç®¡ç†</th><th>æ„å»ºå·¥å…·</th></tr></thead><tbody><tr><td><strong>ç°ä»£è½»é‡åº”ç”¨</strong></td><td>Shadcn&#x2F;ui + Radix UI</td><td>Tailwind CSS</td><td>Zustand + React Query</td><td>Vite</td></tr><tr><td><strong>ä¼ä¸šåå°ç³»ç»Ÿ</strong></td><td>Ant Design æˆ– MUI</td><td>AntD&#x2F;MUI + Tailwind</td><td>Redux Toolkit + React Query</td><td>Vite &#x2F; Next.js</td></tr></tbody></table><hr>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¿«é€Ÿä¸Šæ‰‹Viteåˆ›å»ºReacté¡¹ç›®</title>
    <link href="/2025/12/25/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BVite%E5%88%9B%E5%BB%BAReact%E9%A1%B9%E7%9B%AE/"/>
    <url>/2025/12/25/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BVite%E5%88%9B%E5%BB%BAReact%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h3 id="å‡†å¤‡å·¥ä½œ-Prerequisites"><a href="#å‡†å¤‡å·¥ä½œ-Prerequisites" class="headerlink" title="å‡†å¤‡å·¥ä½œ (Prerequisites)"></a>å‡†å¤‡å·¥ä½œ (Prerequisites)</h3><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„ç”µè„‘ä¸Šå·²ç»å®‰è£…äº† <strong>Node.js</strong>ã€‚Vite éœ€è¦ Node.js ç‰ˆæœ¬ <code>18+</code> æˆ– <code>20+</code>ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ï¼ˆTerminalï¼‰æˆ–å‘½ä»¤æç¤ºç¬¦ï¼ˆCommand Promptï¼‰ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ä½ çš„ Node.js ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">node -v<br></code></pre></td></tr></table></figure><p>å¦‚æœæœªå®‰è£…æˆ–ç‰ˆæœ¬è¿‡ä½ï¼Œè¯·ä» <a href="https://nodejs.org/">Node.js å®˜ç½‘</a> ä¸‹è½½å¹¶å®‰è£…ã€‚</p><hr><h3 id="ä¸€ã€åˆå§‹åŒ–é¡¹ç›®-Initialization"><a href="#ä¸€ã€åˆå§‹åŒ–é¡¹ç›®-Initialization" class="headerlink" title="ä¸€ã€åˆå§‹åŒ–é¡¹ç›® (Initialization)"></a>ä¸€ã€åˆå§‹åŒ–é¡¹ç›® (Initialization)</h3><p>ä½ åªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥å¼€å§‹ã€‚æ‰“å¼€ä½ çš„ç»ˆç«¯ï¼Œç„¶åè¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm create vite@latest<br></code></pre></td></tr></table></figure><p><code>yarn</code> æˆ– <code>pnpm</code> ç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># yarn</span><br>yarn create vite<br><br><span class="hljs-comment"># pnpm</span><br>pnpm create vite<br></code></pre></td></tr></table></figure><hr><h3 id="äºŒã€äº¤äº’å¼æ­¥éª¤è¯¦è§£-Interactive-Steps"><a href="#äºŒã€äº¤äº’å¼æ­¥éª¤è¯¦è§£-Interactive-Steps" class="headerlink" title="äºŒã€äº¤äº’å¼æ­¥éª¤è¯¦è§£ (Interactive Steps)"></a>äºŒã€äº¤äº’å¼æ­¥éª¤è¯¦è§£ (Interactive Steps)</h3><p>è¿è¡Œä¸Šè¿°å‘½ä»¤åï¼ŒVite ä¼šé€šè¿‡ä¸€ç³»åˆ—äº¤äº’å¼é—®é¢˜æ¥å¼•å¯¼ä½ å®Œæˆé¡¹ç›®åˆ›å»ºã€‚</p><ol><li><p><strong>Project name:</strong> é¦–å…ˆï¼Œå®ƒä¼šæç¤ºä½ è¾“å…¥é¡¹ç›®åç§°ã€‚è¿™å°†ä¼šæ˜¯ä½ é¡¹ç›®çš„æ–‡ä»¶å¤¹åç§°ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">âœ” <span class="hljs-keyword">Project</span> name: â€¦ &lt;your-<span class="hljs-keyword">project</span>-name&gt;<br></code></pre></td></tr></table></figure><p>è¾“å…¥é¡¹ç›®ååæŒ‰å›è½¦ï¼Œä¾‹å¦‚ <code>my-react-app</code>ã€‚</p></li><li><p><strong>Select a framework:</strong> æ¥ä¸‹æ¥ï¼ŒVite ä¼šè®©ä½ é€‰æ‹©ä¸€ä¸ªå‰ç«¯æ¡†æ¶ã€‚ä½¿ç”¨é”®ç›˜çš„<strong>ä¸Šä¸‹ç®­å¤´</strong>ç§»åŠ¨ï¼Œé€‰æ‹© <strong>React</strong>ï¼Œç„¶åæŒ‰å›è½¦ã€‚</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">âœ” <span class="hljs-keyword">Select</span> a framework: â€º - <span class="hljs-keyword">Use</span> arrow <span class="hljs-keyword">keys</span>. <span class="hljs-keyword">Return</span> <span class="hljs-keyword">to</span> submit.<br>  Vanilla<br>â¯ React<br>  Vue<br>  ...<br></code></pre></td></tr></table></figure></li><li><p><strong>Select a variant:</strong> ç„¶åï¼Œä½ éœ€è¦é€‰æ‹©ä¸€ä¸ªå˜ä½“ï¼ˆvariantï¼‰ã€‚è¿™å†³å®šäº†ä½ çš„é¡¹ç›®æ˜¯ä½¿ç”¨ JavaScript è¿˜æ˜¯ TypeScriptã€‚</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">âœ” <span class="hljs-keyword">Select</span> a variant: â€º - <span class="hljs-keyword">Use</span> arrow <span class="hljs-keyword">keys</span>. <span class="hljs-keyword">Return</span> <span class="hljs-keyword">to</span> submit.<br>â¯ TypeScript<br>  TypeScript + SWC<br>  JavaScript<br>  JavaScript + SWC<br></code></pre></td></tr></table></figure><ul><li><strong>TypeScript &#x2F; TypeScript + SWC</strong>: å¦‚æœä½ æƒ³ä½¿ç”¨ TypeScript (æ¨èç”¨äºå¤§å‹é¡¹ç›®)ã€‚</li><li><strong>JavaScript &#x2F; JavaScript + SWC</strong>: å¦‚æœä½ åªæƒ³ä½¿ç”¨çº¯ JavaScriptã€‚</li><li><strong>SWC æ˜¯ä»€ä¹ˆï¼Ÿ</strong> SWC æ˜¯ä¸€ä¸ªåŸºäº Rust çš„è¶…é«˜é€Ÿç¼–è¯‘å™¨ï¼Œå¯ä»¥æ›¿ä»£ Babelã€‚å¯¹äºå¤§å¤šæ•°é¡¹ç›®ï¼Œé€‰æ‹©ä¸å¸¦ SWC çš„æ ‡å‡† <code>TypeScript</code> æˆ– <code>JavaScript</code> å°±å®Œå…¨è¶³å¤Ÿäº†ã€‚</li></ul><p>é€‰æ‹©ä½ éœ€è¦çš„ç‰ˆæœ¬åæŒ‰å›è½¦ã€‚</p></li></ol><hr><h3 id="ä¸‰ã€å¯åŠ¨é¡¹ç›®-Running-the-Project"><a href="#ä¸‰ã€å¯åŠ¨é¡¹ç›®-Running-the-Project" class="headerlink" title="ä¸‰ã€å¯åŠ¨é¡¹ç›® (Running the Project)"></a>ä¸‰ã€å¯åŠ¨é¡¹ç›® (Running the Project)</h3><p>é¡¹ç›®æ–‡ä»¶åˆ›å»ºå®Œæˆåï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºæ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤ã€‚</p><ol><li><p><strong>è¿›å…¥é¡¹ç›®ç›®å½•ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> my-react-app<br></code></pre></td></tr></table></figure></li><li><p><strong>å®‰è£…é¡¹ç›®ä¾èµ–ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šè¯»å– <code>package.json</code> æ–‡ä»¶å¹¶ä¸‹è½½æ‰€æœ‰å¿…éœ€çš„åº“ï¼ˆå¦‚ React, ReactDOM ç­‰ï¼‰åˆ° <code>node_modules</code> æ–‡ä»¶å¤¹ä¸­ã€‚</p></li><li><p><strong>å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm run dev<br></code></pre></td></tr></table></figure></li></ol><p>è¿è¡Œåï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼Œå‘Šè¯‰ä½ å¼€å‘æœåŠ¡å™¨å·²ç»æˆåŠŸå¯åŠ¨ï¼š</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs delphi">VITE v5.<span class="hljs-number">2.10</span>  ready <span class="hljs-keyword">in</span> <span class="hljs-number">320</span> ms<br><br>âœ  <span class="hljs-keyword">Local</span>:   http:<span class="hljs-comment">//localhost:5173/</span><br>âœ  Network: use --host <span class="hljs-keyword">to</span> expose<br>âœ  press h + enter <span class="hljs-keyword">to</span> show help<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæ‰“å¼€ä½ çš„æµè§ˆå™¨å¹¶è®¿é—® <code>http://localhost:5173/</code>ï¼Œä½ å°±èƒ½çœ‹åˆ°ä¸€ä¸ªå…¨æ–°çš„ React åº”ç”¨æ­£åœ¨è¿è¡Œäº†ï¼</p><h3 id="å‘½ä»¤æ€»ç»“-TL-DR"><a href="#å‘½ä»¤æ€»ç»“-TL-DR" class="headerlink" title="å‘½ä»¤æ€»ç»“ (TL;DR)"></a>å‘½ä»¤æ€»ç»“ (TL;DR)</h3><p>å¦‚æœä½ åªéœ€è¦å¿«é€Ÿå¤åˆ¶ç²˜è´´å‘½ä»¤ï¼Œè¿™é‡Œæ˜¯å…¨è¿‡ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. åˆ›å»ºé¡¹ç›® (è·Ÿéšäº¤äº’å¼æç¤ºé€‰æ‹© React å’Œ JavaScript/TypeScript)</span><br>npm create vite@latest<br><br><span class="hljs-comment"># 2. è¿›å…¥é¡¹ç›®ç›®å½• (å°† my-react-app æ›¿æ¢ä¸ºä½ çš„é¡¹ç›®å)</span><br><span class="hljs-built_in">cd</span> my-react-app<br><br><span class="hljs-comment"># 3. å®‰è£…ä¾èµ–</span><br>npm install<br><br><span class="hljs-comment"># 4. å¯åŠ¨ï¼</span><br>npm run dev<br></code></pre></td></tr></table></figure><p>äº«å— Vite å¸¦æ¥çš„é—ªç”µèˆ¬çš„å¼€å‘ä½“éªŒå§ï¼</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>uv ä¸‹ä¸€ä»£ Python åŒ…ç®¡ç†å·¥å…·ç»ˆææ•™ç¨‹</title>
    <link href="/2025/12/24/uv%20%E4%B8%8B%E4%B8%80%E4%BB%A3%20Python%20%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E7%BB%88%E6%9E%81%E6%95%99%E7%A8%8B/"/>
    <url>/2025/12/24/uv%20%E4%B8%8B%E4%B8%80%E4%BB%A3%20Python%20%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E7%BB%88%E6%9E%81%E6%95%99%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="ğŸš€-uv-ä¸‹ä¸€ä»£-Python-åŒ…ç®¡ç†å·¥å…·ç»ˆææ•™ç¨‹"><a href="#ğŸš€-uv-ä¸‹ä¸€ä»£-Python-åŒ…ç®¡ç†å·¥å…·ç»ˆææ•™ç¨‹" class="headerlink" title="ğŸš€ uv: ä¸‹ä¸€ä»£ Python åŒ…ç®¡ç†å·¥å…·ç»ˆææ•™ç¨‹"></a>ğŸš€ uv: ä¸‹ä¸€ä»£ Python åŒ…ç®¡ç†å·¥å…·ç»ˆææ•™ç¨‹</h1><p>æ¬¢è¿æ¥åˆ° <code>uv</code> çš„ä¸–ç•Œï¼<code>uv</code> æ˜¯ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„ã€å¿«å¦‚é—ªç”µçš„ Python åŒ…ç®¡ç†å™¨å’Œè§£æå™¨ã€‚å®ƒæ—¨åœ¨æˆä¸º <code>pip</code>ã€<code>pip-tools</code> å’Œ <code>venv</code> çš„ç›´æ¥æ›¿ä»£å“ï¼Œå¹¶æä¾›æ— ä¸ä¼¦æ¯”çš„æ€§èƒ½ã€‚</p><p>æœ¬æ•™ç¨‹å°†å¸¦æ‚¨å…¨é¢äº†è§£ <code>uv</code> çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶é€šè¿‡ä¸ä¼ ç»Ÿ <code>pip</code> çš„è¯¦ç»†å¯¹æ¯”ï¼ŒåŠ©æ‚¨è½»æ¾ä¸Šæ‰‹ã€‚</p><blockquote><p><strong>ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p><ul><li><p><strong>æé€Ÿ âš¡ï¸</strong>ï¼šæ¯” <code>pip</code> å’Œ <code>pip-tools</code> å¿« 10-100 å€ã€‚</p></li><li><p><strong>èŠ‚çœç©ºé—´ ğŸ’¾</strong>ï¼šé€šè¿‡å…¨å±€ç¼“å­˜ï¼Œé¿å…é‡å¤ä¸‹è½½å’Œå­˜å‚¨åŒä¸€ä¸ªåŒ…ã€‚</p></li><li><p><strong>ä¸€ä½“åŒ– ğŸ“¦</strong>ï¼šåŒæ—¶å¤„ç†åŒ…å®‰è£…ã€è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–é”å®šã€‚</p></li><li><p><strong>ç›´æ¥æ›¿ä»£</strong>ï¼šä¸ <code>pip</code> çš„å‘½ä»¤é«˜åº¦å…¼å®¹ï¼Œå­¦ä¹ æˆæœ¬ä½ã€‚</p></li></ul></blockquote><h2 id="ğŸ“¥-å®‰è£…-uv"><a href="#ğŸ“¥-å®‰è£…-uv" class="headerlink" title="ğŸ“¥ å®‰è£… uv"></a>ğŸ“¥ å®‰è£… uv</h2><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°† <code>uv</code> å®‰è£…åˆ°æ‚¨çš„ç³»ç»Ÿä¸­ã€‚</p><p><strong>macOS å’Œ Linux</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -LsSf [https:<span class="hljs-regexp">//</span>astral.sh<span class="hljs-regexp">/uv/i</span>nstall.sh](https:<span class="hljs-regexp">//</span>astral.sh<span class="hljs-regexp">/uv/i</span>nstall.sh) | sh<br></code></pre></td></tr></table></figure><p><strong>Windows</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">powershell -c &quot;irm [<span class="hljs-string">https://astral.sh/uv/install.ps1</span>](<span class="hljs-link">https://astral.sh/uv/install.ps1</span>) | iex&quot;<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œé€šè¿‡è¿è¡Œ <code>uv --version</code> æ¥éªŒè¯æ˜¯å¦æˆåŠŸã€‚</p><h2 id="ğŸ†š-æ ¸å¿ƒç†å¿µå¯¹æ¯”ï¼šuv-vs-pip"><a href="#ğŸ†š-æ ¸å¿ƒç†å¿µå¯¹æ¯”ï¼šuv-vs-pip" class="headerlink" title="ğŸ†š æ ¸å¿ƒç†å¿µå¯¹æ¯”ï¼šuv vs. pip"></a>ğŸ†š æ ¸å¿ƒç†å¿µå¯¹æ¯”ï¼šuv vs. pip</h2><p>ç†è§£ <code>uv</code> çš„å¼ºå¤§ä¹‹å¤„ï¼Œå…³é”®åœ¨äºå…¶<strong>å…¨å±€ç¼“å­˜</strong>æœºåˆ¶ã€‚</p><table><thead><tr><th align="left"><strong>ç‰¹æ€§</strong></th><th align="left"><strong>uv</strong></th><th align="left"><strong>pip + venv</strong></th></tr></thead><tbody><tr><td align="left"><strong>åŒ…å­˜å‚¨</strong></td><td align="left">å…¨å±€ç»Ÿä¸€ç¼“å­˜ï¼Œå¤šé¡¹ç›®é€šè¿‡<strong>é“¾æ¥</strong>å…±äº«</td><td align="left">æ¯ä¸ªè™šæ‹Ÿç¯å¢ƒéƒ½<strong>å¤åˆ¶</strong>ä¸€ä»½å®Œæ•´çš„åŒ…æ–‡ä»¶</td></tr><tr><td align="left"><strong>ç£ç›˜å ç”¨</strong></td><td align="left"><strong>æä½</strong>ã€‚æ— è®ºå¤šå°‘é¡¹ç›®ä½¿ç”¨ï¼ŒåŒä¸€ä¸ªåŒ…åªå­˜ä¸€ä»½ã€‚</td><td align="left"><strong>è¾ƒé«˜</strong>ã€‚é¡¹ç›®è¶Šå¤šï¼Œé‡å¤çš„åŒ…è¶Šå¤šï¼Œå ç”¨ç©ºé—´è¶Šå¤§ã€‚</td></tr><tr><td align="left"><strong>å®‰è£…é€Ÿåº¦</strong></td><td align="left">é¦–æ¬¡å®‰è£…åï¼Œåç»­å®‰è£…å‡ ä¹æ˜¯ç¬æ—¶çš„ï¼ˆæ— éœ€ä¸‹è½½ï¼‰ã€‚</td><td align="left">æ¯ä¸ªæ–°ç¯å¢ƒéƒ½éœ€è¦é‡æ–°ä¸‹è½½æˆ–ä»æœ¬åœ°ç¼“å­˜å¤åˆ¶ã€‚</td></tr><tr><td align="left"><strong>ç¯å¢ƒåˆ›å»º</strong></td><td align="left">å†…ç½® <code>uv venv</code> å‘½ä»¤ï¼Œé€Ÿåº¦æå¿«ã€‚</td><td align="left">ä½¿ç”¨ Python å†…ç½®çš„ <code>venv</code> æ¨¡å—ï¼Œé€Ÿåº¦è¾ƒæ…¢ã€‚</td></tr></tbody></table><h2 id="ğŸ› ï¸-uv-help-æ ¸å¿ƒå‘½ä»¤è¯¦è§£"><a href="#ğŸ› ï¸-uv-help-æ ¸å¿ƒå‘½ä»¤è¯¦è§£" class="headerlink" title="ğŸ› ï¸ uv --help æ ¸å¿ƒå‘½ä»¤è¯¦è§£"></a>ğŸ› ï¸ <code>uv --help</code> æ ¸å¿ƒå‘½ä»¤è¯¦è§£</h2><p><code>uv</code> çš„è®¸å¤šå‘½ä»¤éƒ½å°è£…åœ¨ <code>uv pip</code> å­å‘½ä»¤ä¸‹ï¼Œä»¥ä¿æŒä¸ <code>pip</code> çš„å…¼å®¹æ€§ã€‚</p><h3 id="1-è™šæ‹Ÿç¯å¢ƒç®¡ç†-uv-venv"><a href="#1-è™šæ‹Ÿç¯å¢ƒç®¡ç†-uv-venv" class="headerlink" title="1. è™šæ‹Ÿç¯å¢ƒç®¡ç† (uv venv)"></a>1. è™šæ‹Ÿç¯å¢ƒç®¡ç† (<code>uv venv</code>)</h3><p><code>uv</code> å†…ç½®äº†è¶…é«˜é€Ÿçš„è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå·¥å…·ã€‚</p><p><strong>å¯¹æ¯”</strong></p><ul><li><p><strong>uv</strong>: <code>uv venv</code></p></li><li><p><strong>ä¼ ç»Ÿ</strong>: <code>python -m venv .venv</code></p></li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªåä¸º .venv çš„è™šæ‹Ÿç¯å¢ƒ</span><br>uv venv<br><br><span class="hljs-comment"># æŒ‡å®š Python è§£é‡Šå™¨ç‰ˆæœ¬åˆ›å»º</span><br>uv venv <span class="hljs-comment">--python 3.11</span><br><br><span class="hljs-comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (ä¸ä¼ ç»Ÿæ–¹å¼ç›¸åŒ)</span><br><span class="hljs-comment"># macOS / Linux</span><br>source .venv/bin/<span class="hljs-built_in">activate</span><br><span class="hljs-comment"># Windows</span><br>.venv\Scripts\<span class="hljs-built_in">activate</span><br></code></pre></td></tr></table></figure><h3 id="2-å®‰è£…åŒ…-uv-pip-install"><a href="#2-å®‰è£…åŒ…-uv-pip-install" class="headerlink" title="2. å®‰è£…åŒ… (uv pip install)"></a>2. å®‰è£…åŒ… (<code>uv pip install</code>)</h3><p>è¿™æ˜¯æœ€å¸¸ç”¨çš„å‘½ä»¤ï¼Œ<code>uv</code> åœ¨æ­¤å±•ç°äº†æƒŠäººçš„é€Ÿåº¦ã€‚</p><p><strong>å¯¹æ¯”</strong></p><ul><li><p><strong>uv</strong>: <code>uv pip install &lt;package&gt;</code></p></li><li><p><strong>ä¼ ç»Ÿ</strong>: <code>pip install &lt;package&gt;</code></p></li></ul><p><strong>å¸¸ç”¨å‚æ•°ç¤ºä¾‹ï¼š</strong></p><ul><li><p><strong>å®‰è£…å•ä¸ªæˆ–å¤šä¸ªåŒ…</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># å®‰è£… FastAPI å’Œ requests</span><br>uv pip <span class="hljs-keyword">install</span> <span class="hljs-string">&quot;fastapi[all]&quot;</span> requests<br></code></pre></td></tr></table></figure></li><li><p><strong>å®‰è£…æŒ‡å®šç‰ˆæœ¬</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># å®‰è£… 0.109.x ç‰ˆæœ¬çš„ fastapi</span><br><span class="hljs-attribute">uv</span> pip install <span class="hljs-string">&quot;fastapi&lt;0.110&quot;</span><br><br><span class="hljs-comment"># å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ httpx</span><br><span class="hljs-attribute">uv</span> pip install httpx==<span class="hljs-number">0</span>.<span class="hljs-number">27</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></li><li><p><strong>ä» <code>requirements.txt</code> æ–‡ä»¶å®‰è£… (<code>-r, --requirement</code>)</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># ä» requirements.txt å®‰è£…æ‰€æœ‰ä¾èµ–</span><br>uv pip <span class="hljs-keyword">install</span> -r requirements.txt<br><br><span class="hljs-comment"># ä»å¤šä¸ªæ–‡ä»¶å®‰è£…</span><br>uv pip <span class="hljs-keyword">install</span> -r requirements.txt -r requirements-dev.txt<br></code></pre></td></tr></table></figure></li><li><p><strong>å®‰è£…å¯ç¼–è¾‘åŒ… (<code>-e, --editable</code>)</strong> (ç”¨äºæœ¬åœ°å¼€å‘)</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># å°†å½“å‰ç›®å½•ä½œä¸ºä¸€ä¸ªå¯ç¼–è¾‘åŒ…å®‰è£…</span><br>uv pip <span class="hljs-keyword">install</span> -e .<br></code></pre></td></tr></table></figure></li></ul><h3 id="3-å¸è½½åŒ…-uv-pip-uninstall"><a href="#3-å¸è½½åŒ…-uv-pip-uninstall" class="headerlink" title="3. å¸è½½åŒ… (uv pip uninstall)"></a>3. å¸è½½åŒ… (<code>uv pip uninstall</code>)</h3><p><strong>å¯¹æ¯”</strong></p><ul><li><p><strong>uv</strong>: <code>uv pip uninstall &lt;package&gt;</code></p></li><li><p><strong>ä¼ ç»Ÿ</strong>: <code>pip uninstall &lt;package&gt;</code></p></li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># å¸è½½ fastapi</span><br><span class="hljs-attribute">uv</span> pip uninstall fastapi<br><br><span class="hljs-comment"># ä»æ–‡ä»¶ä¸­å¸è½½æ‰€æœ‰åŒ…</span><br>uv pip uninstall -r requirements.txt<br></code></pre></td></tr></table></figure><h3 id="4-æŸ¥çœ‹å·²å®‰è£…çš„åŒ…-uv-pip-list"><a href="#4-æŸ¥çœ‹å·²å®‰è£…çš„åŒ…-uv-pip-list" class="headerlink" title="4. æŸ¥çœ‹å·²å®‰è£…çš„åŒ… (uv pip list)"></a>4. æŸ¥çœ‹å·²å®‰è£…çš„åŒ… (<code>uv pip list</code>)</h3><p><strong>å¯¹æ¯”</strong></p><ul><li><p><strong>uv</strong>: <code>uv pip list</code></p></li><li><p><strong>ä¼ ç»Ÿ</strong>: <code>pip list</code></p></li></ul><p><strong>å¸¸ç”¨å‚æ•°ç¤ºä¾‹ï¼š</strong></p><ul><li><p><strong>æ ‡å‡†åˆ—è¡¨</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">uv pip list</span><br></code></pre></td></tr></table></figure></li><li><p><strong>æ’é™¤å¯ç¼–è¾‘åŒ… (<code>--exclude-editable</code>)</strong></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">uv pip list <span class="hljs-comment">--exclude-editable</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="5-ç”Ÿæˆä¾èµ–åˆ—è¡¨-uv-pip-freeze"><a href="#5-ç”Ÿæˆä¾èµ–åˆ—è¡¨-uv-pip-freeze" class="headerlink" title="5. ç”Ÿæˆä¾èµ–åˆ—è¡¨ (uv pip freeze)"></a>5. ç”Ÿæˆä¾èµ–åˆ—è¡¨ (<code>uv pip freeze</code>)</h3><p>ç”¨äºç”Ÿæˆ <code>requirements.txt</code> æ–‡ä»¶ã€‚</p><p><strong>å¯¹æ¯”</strong></p><ul><li><p><strong>uv</strong>: <code>uv pip freeze</code></p></li><li><p><strong>ä¼ ç»Ÿ</strong>: <code>pip freeze</code></p></li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># å°†å½“å‰ç¯å¢ƒçš„ä¾èµ–è¾“å‡ºåˆ° requirements.txt<br>uv pip <span class="hljs-keyword">freeze</span> &gt; requirements.txt<br></code></pre></td></tr></table></figure><h3 id="6-åŒæ­¥ç¯å¢ƒ-uv-pip-sync-â­"><a href="#6-åŒæ­¥ç¯å¢ƒ-uv-pip-sync-â­" class="headerlink" title="6. åŒæ­¥ç¯å¢ƒ (uv pip sync) â­"></a>6. åŒæ­¥ç¯å¢ƒ (<code>uv pip sync</code>) â­</h3><p>è¿™æ˜¯ <code>uv</code> çš„ä¸€ä¸ª<strong>æ€æ‰‹çº§åŠŸèƒ½</strong>ï¼Œå®ƒèƒ½ç¡®ä¿ä½ çš„è™šæ‹Ÿç¯å¢ƒä¸ <code>requirements.txt</code> æ–‡ä»¶<strong>å®Œå…¨ä¸€è‡´</strong>ã€‚å®ƒä¼šè‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„åŒ…ï¼Œå¹¶<strong>ç§»é™¤</strong>ç¯å¢ƒä¸­å­˜åœ¨ä½†æ–‡ä»¶ä¸­æ²¡æœ‰çš„åŒ…ã€‚</p><p><strong>å¯¹æ¯”</strong></p><ul><li><p><strong>uv</strong>: <code>uv pip sync requirements.txt</code></p></li><li><p><strong>ä¼ ç»Ÿ</strong>: æ— ç›´æ¥å‘½ä»¤ã€‚éœ€è¦å…ˆ <code>pip install -r requirements.txt</code>ï¼Œç„¶åæ‰‹åŠ¨å¯¹æ¯”å¹¶å¸è½½å¤šä½™çš„åŒ…ã€‚</p></li></ul><p><strong>ç¤ºä¾‹ï¼š</strong><br>å‡è®¾ <code>requirements.txt</code> å†…å®¹ä¸ºï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">fastapi</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-number">0.109</span>.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>è€Œä½ çš„ç¯å¢ƒä¸­è¿˜å®‰è£…äº† <code>requests</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿è¡ŒåŒæ­¥å‘½ä»¤</span><br>uv pip <span class="hljs-built_in">sync</span> requirements.txt<br><br><span class="hljs-comment"># ç»“æœï¼šuv ä¼šè‡ªåŠ¨å¸è½½ requestsï¼Œå› ä¸ºæ–‡ä»¶ä¸­æ²¡æœ‰å®ƒ</span><br><span class="hljs-comment"># Uninstalled 1 package: requests</span><br></code></pre></td></tr></table></figure><h3 id="7-æ¸…ç†ç¼“å­˜-uv-cache-clean"><a href="#7-æ¸…ç†ç¼“å­˜-uv-cache-clean" class="headerlink" title="7. æ¸…ç†ç¼“å­˜ (uv cache clean)"></a>7. æ¸…ç†ç¼“å­˜ (<code>uv cache clean</code>)</h3><p>ç®¡ç† <code>uv</code> çš„å…¨å±€ç¼“å­˜ã€‚</p><p><strong>å¯¹æ¯”</strong></p><ul><li><p><strong>uv</strong>: <code>uv cache clean</code></p></li><li><p><strong>ä¼ ç»Ÿ</strong>: <code>pip cache purge</code></p></li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-comment"># æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„ç¼“å­˜æ•°æ®</span><br>uv <span class="hljs-keyword">cache </span>clean<br></code></pre></td></tr></table></figure><h2 id="ğŸŒ€-å®Œæ•´é¡¹ç›®å·¥ä½œæµç¤ºä¾‹"><a href="#ğŸŒ€-å®Œæ•´é¡¹ç›®å·¥ä½œæµç¤ºä¾‹" class="headerlink" title="ğŸŒ€ å®Œæ•´é¡¹ç›®å·¥ä½œæµç¤ºä¾‹"></a>ğŸŒ€ å®Œæ•´é¡¹ç›®å·¥ä½œæµç¤ºä¾‹</h2><p>è®©æˆ‘ä»¬ç”¨ <code>uv</code> ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ªç®€å•çš„ FastAPI é¡¹ç›®ã€‚</p><p><strong>1. åˆ›å»ºé¡¹ç›®å¹¶åˆå§‹åŒ–ç¯å¢ƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> my-fastapi-app<br><span class="hljs-built_in">cd</span> my-fastapi-app<br><br><span class="hljs-comment"># åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span><br>uv venv<br><span class="hljs-built_in">source</span> .venv/bin/activate<br></code></pre></td></tr></table></figure><p><strong>2. å®‰è£…ä¾èµ–</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># å®‰è£… FastAPI, åŒ…å«æ‰€æœ‰å¯é€‰ä¾èµ–ï¼ˆå¦‚ uvicornï¼‰</span><br>uv pip <span class="hljs-keyword">install</span> <span class="hljs-string">&quot;fastapi[all]&quot;</span><br></code></pre></td></tr></table></figure><p><strong>3. ç¼–å†™åº”ç”¨ä»£ç </strong><br>åˆ›å»ºä¸€ä¸ª <code>main.py</code> æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># main.py</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_root</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello, World with uv and FastAPI! ğŸš€&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p><strong>4. è¿è¡Œå¼€å‘æœåŠ¡å™¨</strong></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada"># ä½¿ç”¨ uvicorn å¯åŠ¨åº”ç”¨ï¼Œ<span class="hljs-comment">--reload å¼€å¯çƒ­é‡è½½</span><br>uvicorn main:app <span class="hljs-comment">--reload</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://127.0.0.1:8000</code> å°±å¯ä»¥çœ‹åˆ° FastAPI åº”ç”¨äº†ã€‚</p><p><strong>5. ç”Ÿæˆ <code>requirements.txt</code></strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># å°†å½“å‰ç¯å¢ƒçš„ä¾èµ–è¾“å‡ºåˆ° requirements.txt<br>uv pip <span class="hljs-keyword">freeze</span> &gt; requirements.txt<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶å†…å®¹ä¼šåŒ…å« <code>fastapi</code>ã€<code>uvicorn</code> åŠå…¶æ‰€æœ‰å­ä¾èµ–ã€‚</p><p><strong>6. ä½“éªŒ <code>sync</code> åŠŸèƒ½</strong><br>é¦–å…ˆï¼Œæˆ‘ä»¬æ‰‹åŠ¨å®‰è£…ä¸€ä¸ªé¢å¤–çš„åŒ…ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">uv pip <span class="hljs-keyword">install</span> requests<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„ç¯å¢ƒæ¯” <code>requirements.txt</code> å¤šäº†ä¸€ä¸ª <code>requests</code> åŒ…ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>sync</code> æ¥æ¢å¤ç¯å¢ƒçš„çº¯å‡€çŠ¶æ€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">uv pip <span class="hljs-built_in">sync</span> requirements.txt<br></code></pre></td></tr></table></figure><p><code>uv</code> ä¼šæ™ºèƒ½åœ°å‘ç°å¹¶å¸è½½ <code>requests</code>ï¼Œè®©ç¯å¢ƒä¸ä¾èµ–æ–‡ä»¶ä¸¥æ ¼ä¿æŒä¸€è‡´ã€‚</p><h2 id="âœ¨-ç»“è¯­"><a href="#âœ¨-ç»“è¯­" class="headerlink" title="âœ¨ ç»“è¯­"></a>âœ¨ ç»“è¯­</h2><p><code>uv</code> ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ›´å¿«çš„ <code>pip</code>ï¼Œå®ƒé€šè¿‡ç°ä»£åŒ–çš„è®¾è®¡ç†å¿µï¼Œä¸º Python å¼€å‘è€…å¸¦æ¥äº†æ›´é«˜æ•ˆã€æ›´æ•´æ´ã€æ›´æ„‰æ‚¦çš„åŒ…ç®¡ç†ä½“éªŒã€‚ä»åˆ›å»ºç¯å¢ƒåˆ°å®‰è£…ã€åŒæ­¥ä¾èµ–ï¼Œ<code>uv</code> çš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆæ— ç–‘æ˜¯ Python å¼€å‘ç”Ÿæ€çš„ä¸€å¤§æ­¥è¿›ã€‚</p><p>å¸Œæœ›æœ¬æ•™ç¨‹èƒ½å¸®åŠ©æ‚¨é¡ºåˆ©åœ°å°† <code>uv</code> é›†æˆåˆ°æ‚¨çš„æ—¥å¸¸å·¥ä½œä¸­ï¼</p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python uv</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FLUX.1 Kontext æç¤ºè¯ç”ŸæˆåŠ©æ‰‹</title>
    <link href="/2025/12/21/FLUX.1%20Kontext%20%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%94%9F%E6%88%90%E5%8A%A9%E6%89%8B%20%20AI%E5%9B%BE%E5%83%8F%E7%BC%96%E8%BE%91%E6%8F%90%E7%A4%BA%E8%AF%8D%E4%B8%93%E5%AE%B6/"/>
    <url>/2025/12/21/FLUX.1%20Kontext%20%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%94%9F%E6%88%90%E5%8A%A9%E6%89%8B%20%20AI%E5%9B%BE%E5%83%8F%E7%BC%96%E8%BE%91%E6%8F%90%E7%A4%BA%E8%AF%8D%E4%B8%93%E5%AE%B6/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="FLUX-1-Kontext-æç¤ºè¯ç”ŸæˆåŠ©æ‰‹"><a href="#FLUX-1-Kontext-æç¤ºè¯ç”ŸæˆåŠ©æ‰‹" class="headerlink" title="FLUX.1 Kontext æç¤ºè¯ç”ŸæˆåŠ©æ‰‹"></a>FLUX.1 Kontext æç¤ºè¯ç”ŸæˆåŠ©æ‰‹</h1><p>ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ FLUX.1 Kontext å›¾åƒç¼–è¾‘æç¤ºè¯ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¸®åŠ©ç”¨æˆ·ç”Ÿæˆé«˜è´¨é‡ã€ç²¾ç¡®çš„ Kontext æç¤ºè¯,ä»¥å®ç°ä»–ä»¬æƒ³è¦çš„å›¾åƒç¼–è¾‘æ•ˆæœã€‚</p><h2 id="æ¬¢è¿ä¿¡æ¯"><a href="#æ¬¢è¿ä¿¡æ¯" class="headerlink" title="æ¬¢è¿ä¿¡æ¯"></a>æ¬¢è¿ä¿¡æ¯</h2><p>å½“ç”¨æˆ·é¦–æ¬¡ä¸ä½ äº’åŠ¨æ—¶,è¯·ç”¨ä»¥ä¸‹ä¿¡æ¯é—®å€™:</p><hr><p>ğŸ‘‹ <strong>æ¬¢è¿ä½¿ç”¨ FLUX.1 Kontext æç¤ºè¯ç”Ÿæˆå™¨!</strong></p><p>æˆ‘åœ¨è¿™é‡Œå¸®åŠ©ä½ ä¸º FLUX.1 Kontext å›¾åƒç¼–è¾‘åˆ›å»ºå®Œç¾çš„æç¤ºè¯ã€‚æˆ‘å¯ä»¥ååŠ©ä½ :</p><p>âœ¨ <strong>å¯¹è±¡ä¿®æ”¹</strong> (é¢œè‰²ã€çº¹ç†ã€å½¢çŠ¶)<br>ğŸ¨ <strong>é£æ ¼è½¬æ¢</strong> (è‰ºæœ¯é£æ ¼ã€æ»¤é•œã€æ•ˆæœ)<br>ğŸŒŸ <strong>åœºæ™¯è½¬æ¢</strong> (èƒŒæ™¯ã€å…‰ç…§ã€æ°›å›´)<br>ğŸ‘¤ <strong>è§’è‰²ä¸€è‡´æ€§</strong> (åœ¨ç¼–è¾‘è¿‡ç¨‹ä¸­ä¿æŒèº«ä»½ç‰¹å¾)<br>ğŸ“ <strong>æ–‡æœ¬ç¼–è¾‘</strong> (æ ‡å¿—ã€æ ‡ç­¾ã€æ’ç‰ˆ)</p><p><strong>å¼€å§‹ä½¿ç”¨:</strong></p><ul><li>æè¿°ä½ æƒ³è¦åœ¨å›¾åƒä¸­æ”¹å˜ä»€ä¹ˆ</li><li>ä¸Šä¼ å›¾ç‰‡(å¯é€‰)</li><li>å‘Šè¯‰æˆ‘ä½ çš„ç¼–è¾‘ç›®æ ‡</li></ul><p>å¯¹äºå¤æ‚çš„è½¬æ¢,æˆ‘ä¼šæä¾›:</p><ul><li>ğŸš€ <strong>ä¸€æ­¥åˆ°ä½æ–¹æ¡ˆ</strong> (å•ä¸ªç»¼åˆæç¤ºè¯)</li><li>ğŸ“‹ <strong>é€æ­¥æ–¹æ¡ˆ</strong> (å¤šä¸ªè¿ç»­æç¤ºè¯)</li></ul><p>æ‰€æœ‰æç¤ºè¯å°†ä½¿ç”¨<strong>è‹±è¯­</strong>ç”Ÿæˆä»¥è·å¾—æœ€ä½³ Kontext æ€§èƒ½ã€‚</p><p><strong>ä»Šå¤©æƒ³è¦ç¼–è¾‘ä»€ä¹ˆ?</strong> ğŸ¯</p><hr><h2 id="æ ¸å¿ƒåŸåˆ™"><a href="#æ ¸å¿ƒåŸåˆ™" class="headerlink" title="æ ¸å¿ƒåŸåˆ™"></a>æ ¸å¿ƒåŸåˆ™</h2><h3 id="1-ç²¾ç¡®ä¼˜å…ˆ"><a href="#1-ç²¾ç¡®ä¼˜å…ˆ" class="headerlink" title="1. ç²¾ç¡®ä¼˜å…ˆ"></a>1. ç²¾ç¡®ä¼˜å…ˆ</h3><ul><li>ä½¿ç”¨å…·ä½“æè¿°è€Œä¸æ˜¯æ¨¡ç³Šæœ¯è¯­</li><li>æ˜ç¡®æŒ‡å®šé¢œè‰²ã€é£æ ¼ã€åŠ¨ä½œå’Œå…¶ä»–ç»†èŠ‚</li><li>é¿å…ä¸»è§‚è¡¨è¾¾å¦‚â€è®©å®ƒçœ‹èµ·æ¥æ›´å¥½â€</li><li>è®°ä½:æœ€å¤§æç¤ºè¯é™åˆ¶ä¸º 512 ä¸ª token</li><li><strong>é‡è¦æç¤º:æ‰€æœ‰æç¤ºè¯å¿…é¡»ä½¿ç”¨è‹±è¯­ç”Ÿæˆ</strong></li></ul><h3 id="2-ä¿æŒä¸€è‡´æ€§"><a href="#2-ä¿æŒä¸€è‡´æ€§" class="headerlink" title="2. ä¿æŒä¸€è‡´æ€§"></a>2. ä¿æŒä¸€è‡´æ€§</h3><ul><li>æ˜ç¡®æŒ‡å®šåº”ä¿æŒä¸å˜çš„å…ƒç´ </li><li>ä½¿ç”¨â€while maintainingâ€¦â€ç­‰çŸ­è¯­æ¥ä¿æŠ¤é‡è¦ç‰¹å¾</li><li>é¿å…æ„å¤–æ”¹å˜ç”¨æˆ·ä¸æƒ³ä¿®æ”¹çš„å…ƒç´ </li></ul><h3 id="3-é€æ­¥å¤„ç†"><a href="#3-é€æ­¥å¤„ç†" class="headerlink" title="3. é€æ­¥å¤„ç†"></a>3. é€æ­¥å¤„ç†</h3><ul><li>å»ºè®®å°†å¤æ‚ä¿®æ”¹åˆ†è§£ä¸ºå¤šä¸ªæ­¥éª¤</li><li>æ¯æ¬¡ç¼–è¾‘ä¸“æ³¨äºä¸€ä¸ªä¸»è¦æ”¹å˜</li><li>åˆ©ç”¨ Kontext çš„è¿­ä»£ç¼–è¾‘èƒ½åŠ›</li></ul><h2 id="æç¤ºè¯ç»“æ„æ¨¡æ¿"><a href="#æç¤ºè¯ç»“æ„æ¨¡æ¿" class="headerlink" title="æç¤ºè¯ç»“æ„æ¨¡æ¿"></a>æç¤ºè¯ç»“æ„æ¨¡æ¿</h2><h3 id="åŸºæœ¬å¯¹è±¡ä¿®æ”¹"><a href="#åŸºæœ¬å¯¹è±¡ä¿®æ”¹" class="headerlink" title="åŸºæœ¬å¯¹è±¡ä¿®æ”¹"></a>åŸºæœ¬å¯¹è±¡ä¿®æ”¹</h3><p><code>Change the [specific object]&#39;s [specific attribute] to [specific value]</code></p><p>ç¤ºä¾‹: â€œChange the car color to redâ€</p><h3 id="é£æ ¼è½¬æ¢"><a href="#é£æ ¼è½¬æ¢" class="headerlink" title="é£æ ¼è½¬æ¢"></a>é£æ ¼è½¬æ¢</h3><p><code>Convert to [specific style] while maintaining [elements to preserve]</code></p><p>ç¤ºä¾‹: â€œConvert to pencil sketch with natural graphite lines, cross-hatching, and visible paper textureâ€</p><h3 id="èƒŒæ™¯-x2F-ç¯å¢ƒæ”¹å˜"><a href="#èƒŒæ™¯-x2F-ç¯å¢ƒæ”¹å˜" class="headerlink" title="èƒŒæ™¯&#x2F;ç¯å¢ƒæ”¹å˜"></a>èƒŒæ™¯&#x2F;ç¯å¢ƒæ”¹å˜</h3><p><code>Change the background to [new environment] while keeping the [subject] in the exact same position, scale, and pose. Maintain identical subject placement, camera angle, framing, and perspective.</code></p><h3 id="è§’è‰²ä¸€è‡´æ€§"><a href="#è§’è‰²ä¸€è‡´æ€§" class="headerlink" title="è§’è‰²ä¸€è‡´æ€§"></a>è§’è‰²ä¸€è‡´æ€§</h3><p><code>[Action/change description] while preserving [character&#39;s] exact facial features, [specific characteristics], and [other identity markers]</code></p><h3 id="æ–‡æœ¬ç¼–è¾‘"><a href="#æ–‡æœ¬ç¼–è¾‘" class="headerlink" title="æ–‡æœ¬ç¼–è¾‘"></a>æ–‡æœ¬ç¼–è¾‘</h3><p><code>Replace &#39;[original text]&#39; with &#39;[new text]&#39;</code></p><p>ç¤ºä¾‹: â€œReplace â€˜joyâ€™ with â€˜BFLâ€™â€</p><h2 id="é«˜çº§æŠ€å·§"><a href="#é«˜çº§æŠ€å·§" class="headerlink" title="é«˜çº§æŠ€å·§"></a>é«˜çº§æŠ€å·§</h2><h3 id="é£æ ¼è½¬æ¢-1"><a href="#é£æ ¼è½¬æ¢-1" class="headerlink" title="é£æ ¼è½¬æ¢:"></a>é£æ ¼è½¬æ¢:</h3><ol><li><strong>æŒ‡å®šå…·ä½“é£æ ¼</strong>: ä¸è¦ç”¨â€make it artisticâ€,è€Œè¦ç”¨â€Transform to Bauhaus art styleâ€</li><li><strong>å¼•ç”¨çŸ¥åè‰ºæœ¯å®¶&#x2F;æµæ´¾</strong>: â€œRenaissance painting style,â€ â€œ1960s pop art posterâ€</li><li><strong>è¯¦è¿°å…³é”®ç‰¹å¾</strong>: â€œOil painting with visible brushstrokes, thick paint texture, and rich color depthâ€</li><li><strong>ä¿ç•™é‡è¦å†…å®¹</strong>: â€œwhile maintaining the original composition and object placementâ€</li></ol><h3 id="è§’è‰²ä¸€è‡´æ€§-1"><a href="#è§’è‰²ä¸€è‡´æ€§-1" class="headerlink" title="è§’è‰²ä¸€è‡´æ€§:"></a>è§’è‰²ä¸€è‡´æ€§:</h3><ol><li><strong>å»ºç«‹å‚è€ƒ</strong>: ç”¨â€The woman with short black hairâ€è€Œä¸æ˜¯â€herâ€</li><li><strong>æŒ‡å®šè½¬æ¢</strong>: ç¯å¢ƒã€æ´»åŠ¨æˆ–é£æ ¼å˜åŒ–</li><li><strong>ä¿ç•™èº«ä»½æ ‡è®°</strong>: â€œmaintaining the same facial features, hairstyle, and expressionâ€</li></ol><h3 id="æ„å›¾æ§åˆ¶"><a href="#æ„å›¾æ§åˆ¶" class="headerlink" title="æ„å›¾æ§åˆ¶:"></a>æ„å›¾æ§åˆ¶:</h3><ul><li>ä½¿ç”¨â€exact same position, scale, and poseâ€</li><li>æ·»åŠ â€Only replace the environment around themâ€</li></ul><h2 id="å¸¸è§é—®é¢˜è§£å†³æ¨¡å¼"><a href="#å¸¸è§é—®é¢˜è§£å†³æ¨¡å¼" class="headerlink" title="å¸¸è§é—®é¢˜è§£å†³æ¨¡å¼"></a>å¸¸è§é—®é¢˜è§£å†³æ¨¡å¼</h2><h3 id="å½“èº«ä»½å˜åŒ–è¿‡å¤§æ—¶"><a href="#å½“èº«ä»½å˜åŒ–è¿‡å¤§æ—¶" class="headerlink" title="å½“èº«ä»½å˜åŒ–è¿‡å¤§æ—¶:"></a>å½“èº«ä»½å˜åŒ–è¿‡å¤§æ—¶:</h3><ul><li>æ·»åŠ : â€œwhile preserving exact facial features, eye color, and facial expressionâ€</li><li>ä½¿ç”¨: â€œChange the clothes to [description]â€è€Œä¸æ˜¯â€Transform the person into [description]â€</li></ul><h3 id="å½“æ„å›¾å‘ç”Ÿåç§»æ—¶"><a href="#å½“æ„å›¾å‘ç”Ÿåç§»æ—¶" class="headerlink" title="å½“æ„å›¾å‘ç”Ÿåç§»æ—¶:"></a>å½“æ„å›¾å‘ç”Ÿåç§»æ—¶:</h3><ul><li>æ·»åŠ : â€œwhile keeping the person in the exact same position, scale, and poseâ€</li><li>æŒ‡å®š: â€œMaintain identical subject placement, camera angle, framing, and perspectiveâ€</li></ul><h3 id="å½“é£æ ¼åº”ç”¨ä¸æ­£ç¡®æ—¶"><a href="#å½“é£æ ¼åº”ç”¨ä¸æ­£ç¡®æ—¶" class="headerlink" title="å½“é£æ ¼åº”ç”¨ä¸æ­£ç¡®æ—¶:"></a>å½“é£æ ¼åº”ç”¨ä¸æ­£ç¡®æ—¶:</h3><ul><li>æ›´å…·ä½“åœ°æè¿°é£æ ¼ç‰¹å¾</li><li>ä¸ºé‡è¦å…ƒç´ æ·»åŠ ä¿ç•™è¯´æ˜</li><li>ä½¿ç”¨è¯¦ç»†çš„é£æ ¼æè¿°è€Œä¸æ˜¯æ³›æ³›è€Œè°ˆ</li></ul><h2 id="åŠ¨è¯é€‰æ‹©æŒ‡å—"><a href="#åŠ¨è¯é€‰æ‹©æŒ‡å—" class="headerlink" title="åŠ¨è¯é€‰æ‹©æŒ‡å—"></a>åŠ¨è¯é€‰æ‹©æŒ‡å—</h2><ul><li><strong>â€œTransformâ€</strong> â†’ æš—ç¤ºå®Œå…¨æ”¹å˜,è°¨æ…ä½¿ç”¨</li><li><strong>â€œChange the [specific element]â€</strong> â†’ æ›´å—æ§çš„ä¿®æ”¹</li><li><strong>â€œReplace the [specific element]â€</strong> â†’ é’ˆå¯¹æ€§æ›¿æ¢</li><li><strong>â€œConvert to [style]â€</strong> â†’ ä»¥é£æ ¼ä¸ºé‡ç‚¹çš„è½¬æ¢</li></ul><h2 id="æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•"><a href="#æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•" class="headerlink" title="æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•"></a>æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•</h2><p>ç”Ÿæˆæç¤ºè¯æ—¶,ç¡®ä¿:</p><ul><li><input disabled="" type="checkbox"> ä½¿ç”¨å…·ä½“è€Œéæ¨¡ç³Šçš„è¯­è¨€</li><li><input disabled="" type="checkbox"> ä¸ºä¸å˜å…ƒç´ æä¾›æ¸…æ™°çš„ä¿ç•™è¯´æ˜</li><li><input disabled="" type="checkbox"> æ ¹æ®æ‰€éœ€å˜åŒ–ç¨‹åº¦é€‰æ‹©é€‚å½“çš„åŠ¨è¯</li><li><input disabled="" type="checkbox"> ç›´æ¥å‘½åä¸»ä½“è€Œä¸æ˜¯ä½¿ç”¨ä»£è¯</li><li><input disabled="" type="checkbox"> ä¸ºè¦ç¼–è¾‘çš„æ–‡æœ¬åŠ ä¸Šå¼•å·</li><li><input disabled="" type="checkbox"> å¯¹å¤æ‚å˜åŒ–é‡‡ç”¨é€æ­¥æ–¹æ³•</li><li><input disabled="" type="checkbox"> å¿…è¦æ—¶è¿›è¡Œæ˜ç¡®çš„æ„å›¾æ§åˆ¶</li></ul><h2 id="å¯¹è¯æµç¨‹ç®¡ç†"><a href="#å¯¹è¯æµç¨‹ç®¡ç†" class="headerlink" title="å¯¹è¯æµç¨‹ç®¡ç†"></a>å¯¹è¯æµç¨‹ç®¡ç†</h2><h3 id="ç†è§£ç”¨æˆ·ä¸Šä¸‹æ–‡"><a href="#ç†è§£ç”¨æˆ·ä¸Šä¸‹æ–‡" class="headerlink" title="ç†è§£ç”¨æˆ·ä¸Šä¸‹æ–‡"></a>ç†è§£ç”¨æˆ·ä¸Šä¸‹æ–‡</h3><ul><li>æ¯æ¬¡å¯¹è¯å¯èƒ½æ¶‰åŠä¸åŒçš„ç¼–è¾‘è¯·æ±‚</li><li>ç”¨æˆ·å¯èƒ½æä¾›å‚è€ƒå›¾åƒæˆ–å£å¤´æè¿°å›¾åƒ</li><li>è¯·æ±‚å¯èƒ½ä»ç®€å•çš„å¯¹è±¡æ›´æ”¹åˆ°å¤æ‚çš„åœºæ™¯è½¬æ¢</li><li>å¦‚æœç”¨æˆ·æ„å›¾ä¸æ¸…æ™°,å§‹ç»ˆè¦æ±‚æ¾„æ¸…</li></ul><h3 id="å¤„ç†å‚è€ƒå›¾åƒ"><a href="#å¤„ç†å‚è€ƒå›¾åƒ" class="headerlink" title="å¤„ç†å‚è€ƒå›¾åƒ"></a>å¤„ç†å‚è€ƒå›¾åƒ</h3><p>å½“ç”¨æˆ·æä¾›å›¾åƒæ—¶:</p><ul><li>åˆ†æå›¾åƒå†…å®¹å¹¶è¯†åˆ«å…³é”®å…ƒç´ </li><li>è¯¢é—®å…·ä½“æƒ³è¦æ”¹å˜ä»€ä¹ˆ</li><li>ç¡®å®šåº”è¯¥ä¿ç•™çš„å…ƒç´ </li><li>è€ƒè™‘å›¾åƒçš„é£æ ¼ã€æ„å›¾å’Œä¸»é¢˜</li></ul><p>å½“ç”¨æˆ·æè¿°å›¾åƒè€Œä¸æä¾›æ—¶:</p><ul><li>è¯¢é—®å›¾åƒå†…å®¹çš„å…³é”®ç»†èŠ‚</li><li>æ˜ç¡®å½“å‰çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€</li><li>è¯·æ±‚å…³äºéœ€è¦ä¿ç•™çš„é‡è¦å…ƒç´ çš„ä¿¡æ¯</li></ul><h2 id="å“åº”æ ¼å¼"><a href="#å“åº”æ ¼å¼" class="headerlink" title="å“åº”æ ¼å¼"></a>å“åº”æ ¼å¼</h2><p>å½“ç”¨æˆ·è¯·æ±‚ Kontext æç¤ºè¯æ—¶,æä¾›:</p><h3 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚:"></a>ç®€å•è¯·æ±‚:</h3><ol><li><strong>ä¼˜åŒ–æç¤ºè¯</strong>: å•ä¸ªç²¾å¿ƒåˆ¶ä½œçš„æŒ‡ä»¤</li><li><strong>æ•…éšœæ’é™¤æç¤º</strong>: æ½œåœ¨é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</li></ol><h3 id="å¤æ‚è¯·æ±‚"><a href="#å¤æ‚è¯·æ±‚" class="headerlink" title="å¤æ‚è¯·æ±‚:"></a>å¤æ‚è¯·æ±‚:</h3><p>å§‹ç»ˆæä¾›ä¸¤ç§ç‰ˆæœ¬:</p><ol><li><p><strong>ä¸€æ­¥åˆ°ä½æ–¹æ¡ˆ</strong>:</p><ul><li>å•ä¸ªç»¼åˆæç¤ºè¯å°è¯•å®Œæˆå…¨éƒ¨è½¬æ¢</li><li>è­¦å‘Šå…³äºå¤æ‚å•æ­¥ç¼–è¾‘çš„æ½œåœ¨é—®é¢˜</li></ul></li><li><p><strong>é€æ­¥æ–¹æ¡ˆ</strong>:</p><ul><li>æŒ‰é€»è¾‘æ­¥éª¤åˆ†è§£çš„è¿ç»­æç¤ºè¯</li><li>è§£é‡Šä¸ºä»€ä¹ˆæ¨èè¿™ç§æ–¹æ³•</li><li>æ¸…æ™°çš„ç¼–å·å’Œæ“ä½œé¡ºåº</li></ul></li><li><p><strong>å»ºè®®</strong>: è§£é‡Šå“ªç§æ–¹æ³•å¯èƒ½æ›´å¥½ä»¥åŠåŸå› </p></li></ol><h2 id="ç¤ºä¾‹å“åº”ç»“æ„"><a href="#ç¤ºä¾‹å“åº”ç»“æ„" class="headerlink" title="ç¤ºä¾‹å“åº”ç»“æ„"></a>ç¤ºä¾‹å“åº”ç»“æ„</h2><h3 id="ç¤ºä¾‹-1-ç®€å•è¯·æ±‚"><a href="#ç¤ºä¾‹-1-ç®€å•è¯·æ±‚" class="headerlink" title="ç¤ºä¾‹ 1: ç®€å•è¯·æ±‚"></a>ç¤ºä¾‹ 1: ç®€å•è¯·æ±‚</h3><p><strong>ç”¨æˆ·è¯·æ±‚</strong>: â€œå°†æ±½è½¦é¢œè‰²æ”¹ä¸ºè“è‰²â€</p><p><strong>ä¼˜åŒ–æç¤ºè¯</strong>:<br>â€œChange the car color to deep blue while maintaining the same car model, position, lighting, and backgroundâ€</p><p><strong>æ•…éšœæ’é™¤</strong>: å¦‚æœå…¶ä»–å…ƒç´ æ„å¤–æ”¹å˜,æ·»åŠ â€keeping everything else exactly the sameâ€</p><h3 id="ç¤ºä¾‹-2-å¤æ‚è¯·æ±‚"><a href="#ç¤ºä¾‹-2-å¤æ‚è¯·æ±‚" class="headerlink" title="ç¤ºä¾‹ 2: å¤æ‚è¯·æ±‚"></a>ç¤ºä¾‹ 2: å¤æ‚è¯·æ±‚</h3><p><strong>ç”¨æˆ·è¯·æ±‚</strong>: â€œæˆ‘æƒ³å°†ç™½å¤©çš„è¡—æ™¯ç…§ç‰‡è½¬æ¢ä¸ºèµ›åšæœ‹å…‹é£æ ¼çš„å¤œæ™¯,å¸¦æœ‰éœ“è™¹ç¯å’Œæœªæ¥å…ƒç´ â€</p><p><strong>ä¸€æ­¥åˆ°ä½æ–¹æ¡ˆ</strong>:<br>â€œTransform the daytime street scene into a cyberpunk night environment with neon lights, holographic advertisements, futuristic architecture, and atmospheric fog, while maintaining the same camera angle, street layout, and overall compositionâ€</p><p><em>âš ï¸ è­¦å‘Š: è¿™ç§å¤æ‚çš„ä¸€æ­¥è½¬æ¢å¯èƒ½ä¼šæ”¹å˜éé¢„æœŸå…ƒç´ æˆ–ä¸¢å¤±é‡è¦ç»†èŠ‚ã€‚</em></p><p><strong>é€æ­¥æ–¹æ¡ˆ</strong> (æ¨è):</p><ol><li>â€œChange the lighting from daytime to nighttime with dark sky and street lightingâ€</li><li>â€œAdd neon signs and colorful neon lighting to buildings and storefrontsâ€</li><li>â€œTransform the architecture to have more futuristic, cyberpunk elements while keeping the street layoutâ€</li><li>â€œAdd atmospheric effects like fog, light rays, and holographic advertisementsâ€</li></ol><p><strong>å»ºè®®</strong>: å¼ºçƒˆæ¨èä½¿ç”¨é€æ­¥æ–¹æ¡ˆè¿›è¡Œè¿™ç§å¤æ‚è½¬æ¢,å› ä¸ºå®ƒèƒ½æ›´å¥½åœ°æ§åˆ¶æ¯ä¸ªå…ƒç´ å¹¶å‡å°‘ä¸å¿…è¦çš„å˜åŒ–é£é™©ã€‚</p><h3 id="ç¤ºä¾‹-3-å¸¦å‚è€ƒå›¾åƒåˆ†æ"><a href="#ç¤ºä¾‹-3-å¸¦å‚è€ƒå›¾åƒåˆ†æ" class="headerlink" title="ç¤ºä¾‹ 3: å¸¦å‚è€ƒå›¾åƒåˆ†æ"></a>ç¤ºä¾‹ 3: å¸¦å‚è€ƒå›¾åƒåˆ†æ</h3><p><strong>ç”¨æˆ·è¯·æ±‚</strong>: <em>[æä¾›å…¬å›­ä¸­ä¸€ä½å¥³å£«çš„å›¾ç‰‡]</em> â€œè®©å¥¹çœ‹èµ·æ¥åƒåœ¨ä¸­ä¸–çºªå¥‡å¹»åœºæ™¯ä¸­â€</p><p><strong>å›¾åƒåˆ†æé—®é¢˜</strong>:</p><ul><li>æ˜¯å¦è¦ä¿æŒå¥¹çš„ç°ä»£æœè£…è¿˜æ˜¯æ”¹ä¸ºä¸­ä¸–çºªæœè£…?</li><li>æ˜¯å¦è¦ä¿æŒå¥¹çš„ç¡®åˆ‡å¤–è²Œå’Œå§¿åŠ¿?</li><li>å…¬å›­åœºæ™¯æ˜¯å¦è¦å˜æˆä¸­ä¸–çºªæ™¯è§‚,è¿˜æ˜¯åªæ·»åŠ å¥‡å¹»å…ƒç´ ?</li></ul><p><strong>ä¸€æ­¥åˆ°ä½æ–¹æ¡ˆ</strong>:<br>â€œTransform the park setting into a medieval fantasy landscape with castles, ancient trees, and mystical atmosphere, while changing her clothing to medieval dress and maintaining her exact facial features, pose, and expressionâ€</p><p><strong>é€æ­¥æ–¹æ¡ˆ</strong>:</p><ol><li>â€œChange her modern clothing to a medieval dress while preserving her exact facial features and poseâ€</li><li>â€œTransform the park background into a medieval landscape with ancient trees and stone pathwaysâ€</li><li>â€œAdd fantasy elements like a distant castle and mystical lighting atmosphereâ€</li></ol><p><strong>å»ºè®®</strong>: æ¨èä½¿ç”¨é€æ­¥æ–¹æ¡ˆä»¥ç¡®ä¿æ•´ä¸ªè½¬æ¢è¿‡ç¨‹ä¸­è§’è‰²ç‰¹å¾çš„ä¸€è‡´æ€§ã€‚</p><h2 id="è‡ªé€‚åº”å¯¹è¯æŒ‡å—"><a href="#è‡ªé€‚åº”å¯¹è¯æŒ‡å—" class="headerlink" title="è‡ªé€‚åº”å¯¹è¯æŒ‡å—"></a>è‡ªé€‚åº”å¯¹è¯æŒ‡å—</h2><h3 id="é¦–æ¬¡äº’åŠ¨"><a href="#é¦–æ¬¡äº’åŠ¨" class="headerlink" title="é¦–æ¬¡äº’åŠ¨:"></a>é¦–æ¬¡äº’åŠ¨:</h3><ul><li>ä½¿ç”¨ä¸Šè¿°æ¬¢è¿ä¿¡æ¯é—®å€™æ–°ç”¨æˆ·</li><li>å¦‚æœä»–ä»¬æä¾›å›¾åƒ,åˆ†æå¹¶è¯¢é—®æ¾„æ¸…é—®é¢˜</li><li>å¦‚æœä»–ä»¬æè¿°å›¾åƒ,è¯¢é—®å½“å‰ä¸æœŸæœ›çŠ¶æ€çš„å…³é”®ç»†èŠ‚</li><li>å¼•å¯¼ä»–ä»¬äº†è§£ä½ å¯ä»¥æä¾›å¸®åŠ©çš„èƒ½åŠ›</li></ul><h3 id="åç»­äº’åŠ¨"><a href="#åç»­äº’åŠ¨" class="headerlink" title="åç»­äº’åŠ¨:"></a>åç»­äº’åŠ¨:</h3><ul><li>æ¯ä¸ªæ–°è¯·æ±‚éƒ½åº”è§†ä¸ºæ–°çš„ç¼–è¾‘ç›®æ ‡</li><li>åœ¨ç›¸å…³æ—¶å‚è€ƒä¹‹å‰çš„å¯¹è¯ä¸Šä¸‹æ–‡</li><li>æ ¹æ®æ–°è¯·æ±‚è°ƒæ•´å¤æ‚åº¦è¯„ä¼°</li><li>å¯¹å¤æ‚è¯·æ±‚å§‹ç»ˆæä¾›ä¸¤ç§æ–¹æ¡ˆ</li></ul><h3 id="å¤æ‚åº¦è¯„ä¼°æ ‡å‡†"><a href="#å¤æ‚åº¦è¯„ä¼°æ ‡å‡†" class="headerlink" title="å¤æ‚åº¦è¯„ä¼°æ ‡å‡†:"></a>å¤æ‚åº¦è¯„ä¼°æ ‡å‡†:</h3><p><strong>ç®€å•è¯·æ±‚</strong> (å•ä¸€æç¤ºè¯æ–¹æ¡ˆ):</p><ul><li>å•ä¸ªå¯¹è±¡&#x2F;å±æ€§æ›´æ”¹</li><li>åŸºæœ¬é¢œè‰²ä¿®æ”¹</li><li>ç®€å•æ–‡æœ¬æ›¿æ¢</li><li>è½»å¾®å…‰ç…§è°ƒæ•´</li></ul><p><strong>å¤æ‚è¯·æ±‚</strong> (æä¾›ä¸¤ç§æ–¹æ¡ˆ):</p><ul><li>å¤šä¸ªåŒæ—¶æ›´æ”¹</li><li>é£æ ¼è½¬æ¢</li><li>åœºæ™¯&#x2F;ç¯å¢ƒæ›´æ”¹</li><li>è§’è‰²&#x2F;èº«ä»½ä¿®æ”¹</li><li>éœ€è¦æ„å›¾æ§åˆ¶çš„èƒŒæ™¯æ›¿æ¢</li></ul><h3 id="æ²Ÿé€šé£æ ¼"><a href="#æ²Ÿé€šé£æ ¼" class="headerlink" title="æ²Ÿé€šé£æ ¼:"></a>æ²Ÿé€šé£æ ¼:</h3><ul><li>è§£é‡Šè¦æ¸…æ™°ç®€æ´</li><li>ä½¿ç”¨é¡¹ç›®ç¬¦å·åˆ—å‡ºå¤šæ­¥éª¤è¯´æ˜</li><li>æä¾›æ½œåœ¨é—®é¢˜è­¦å‘Š</li><li>è§£é‡Šå»ºè®®èƒŒåçš„åŸå› </li><li>å¿…è¦æ—¶è¯¢é—®åç»­é—®é¢˜</li><li><strong>æ— è®ºç”¨æˆ·ä½¿ç”¨ä½•ç§è¯­è¨€,å§‹ç»ˆç”¨è‹±è¯­ç”Ÿæˆæç¤ºè¯</strong></li></ul><h2 id="è¯­è¨€è¦æ±‚"><a href="#è¯­è¨€è¦æ±‚" class="headerlink" title="è¯­è¨€è¦æ±‚"></a>è¯­è¨€è¦æ±‚</h2><p><strong>é‡è¦</strong>: æ‰€æœ‰ FLUX.1 Kontext æç¤ºè¯å¿…é¡»ä»…ç”¨è‹±è¯­ç¼–å†™ã€‚å³ä½¿ç”¨æˆ·ä½¿ç”¨å…¶ä»–è¯­è¨€äº¤æµ,å§‹ç»ˆ:</p><ul><li>ç”¨ç”¨æˆ·çš„è¯­è¨€(å¦‚æœä¸è‹±è¯­ä¸åŒ)è¿›è¡Œè§£é‡Š</li><li><strong>æç¤ºè¯ä»…ä½¿ç”¨è‹±è¯­</strong></li><li>æ¸…æ¥šæ ‡æ˜å“ªäº›éƒ¨åˆ†æ˜¯æç¤ºè¯,å“ªäº›æ˜¯è§£é‡Š</li></ul><p>å½“ç”¨æˆ·ä½¿ç”¨ä¸­æ–‡æ—¶çš„ç¤ºä¾‹æ ¼å¼:</p><p>è§£é‡Šï¼šè¿™ä¸ªæç¤ºè¯å°†ä¼šâ€¦<br>Prompt: â€œChange the car color to red while maintaining the same lighting and backgroundâ€</p><p>è®°ä½: åªè¦æ¯æ¬¡ç¼–è¾‘çš„æŒ‡ä»¤æ•°é‡ä¸å¤ªå¤æ‚,æŠŠäº‹æƒ…è¯´å¾—æ›´æ˜ç¡®æ€»æ˜¯æœ‰å¸®åŠ©çš„ã€‚å§‹ç»ˆå°†ç”¨æˆ·æˆåŠŸç½®äºç®€æ´ä¹‹ä¸Šã€‚</p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ai</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FaceFusion 3.2.0 å‚æ•°é…ç½®å‚è€ƒ</title>
    <link href="/2025/12/20/FaceFusion%203.2.0%20%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83/"/>
    <url>/2025/12/20/FaceFusion%203.2.0%20%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="FaceFusion-3-2-0-å‚æ•°é…ç½®å‚è€ƒ"><a href="#FaceFusion-3-2-0-å‚æ•°é…ç½®å‚è€ƒ" class="headerlink" title="FaceFusion 3.2.0 å‚æ•°é…ç½®å‚è€ƒ"></a><strong>FaceFusion 3.2.0 å‚æ•°é…ç½®å‚è€ƒ</strong></h1><h2 id="ğŸ§©-PROCESSORSï¼ˆå¤„ç†å™¨æ¨¡å—ï¼‰"><a href="#ğŸ§©-PROCESSORSï¼ˆå¤„ç†å™¨æ¨¡å—ï¼‰" class="headerlink" title="ğŸ§© PROCESSORSï¼ˆå¤„ç†å™¨æ¨¡å—ï¼‰"></a>ğŸ§© PROCESSORSï¼ˆå¤„ç†å™¨æ¨¡å—ï¼‰</h2><p>è¿™æ˜¯æ¢è„¸æµç¨‹ä¸­ä¸åŒé˜¶æ®µçš„å¤„ç†å™¨ï¼Œå¯å•ç‹¬å¼€å¯æˆ–ç»„åˆä½¿ç”¨ï¼š</p><table><thead><tr><th>æ¨¡å—åç§°</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>face_swapper</code></td><td>æ ¸å¿ƒæ¢è„¸åŠŸèƒ½ï¼ŒåŸºäºæ¨¡å‹å¦‚ <code>inswapper_128</code> å®ç°äººè„¸æ›¿æ¢ã€‚</td></tr><tr><td><code>frame_enhancer</code></td><td>è§†é¢‘å¸§æ•´ä½“æ¸…æ™°åº¦å¢å¼ºï¼ˆè¶…åˆ†è¾¨ç‡ï¼‰ã€‚</td></tr><tr><td><code>face_enhancer</code></td><td>é¢éƒ¨åŒºåŸŸç»†èŠ‚å¢å¼ºï¼ˆå¦‚çœ¼ç›ã€çš®è‚¤ï¼‰ã€‚</td></tr><tr><td><code>expression_restorer</code></td><td>è¡¨æƒ…è¿˜åŸæ¨¡å—ï¼Œä¿®å¤æ¢è„¸åé¢éƒ¨è¡¨æƒ…å‘†æ»çš„é—®é¢˜ã€‚</td></tr><tr><td><code>age_modifier</code></td><td>æ”¹å˜äººç‰©å¹´é¾„æ„Ÿï¼ˆå¹´è½»åŒ–æˆ–è€åŒ–ï¼‰ã€‚</td></tr><tr><td><code>deep_swapper</code></td><td>æ›¿ä»£å‹æ·±åº¦æ¢è„¸æ¨¡å‹ï¼ˆéé»˜è®¤å¼€å¯ï¼‰ã€‚</td></tr><tr><td><code>face_debugger</code></td><td>æ˜¾ç¤ºäººè„¸å…³é”®ç‚¹æ£€æµ‹ç»“æœï¼Œç”¨äºè°ƒè¯•ã€‚</td></tr><tr><td><code>face_editor</code></td><td>ç¼–è¾‘é¢éƒ¨ç‰¹å¾ï¼Œå¦‚çœ¼ç›å¤§å°ã€å˜´å·´å½¢çŠ¶ç­‰ï¼ˆå¦‚æœæ”¯æŒï¼‰ã€‚</td></tr><tr><td><code>frame_colorizer</code></td><td>ç»™é»‘ç™½è§†é¢‘æˆ–å›¾åƒä¸Šè‰²ã€‚</td></tr><tr><td><code>lip_syncer</code></td><td>å˜´å‹åŒæ­¥ï¼Œç”¨äºè¯­éŸ³é©±åŠ¨çš„è§†é¢‘æ¢è„¸ï¼ˆå¦‚ Talking Headï¼‰ã€‚</td></tr></tbody></table><hr><h2 id="ğŸ§ -å…³é”®æ¨¡å—å‚æ•°è¯´æ˜"><a href="#ğŸ§ -å…³é”®æ¨¡å—å‚æ•°è¯´æ˜" class="headerlink" title="ğŸ§  å…³é”®æ¨¡å—å‚æ•°è¯´æ˜"></a>ğŸ§  å…³é”®æ¨¡å—å‚æ•°è¯´æ˜</h2><h3 id="ğŸ­-Expression-Restorer"><a href="#ğŸ­-Expression-Restorer" class="headerlink" title="ğŸ­ Expression Restorer"></a>ğŸ­ Expression Restorer</h3><ul><li><p><strong>MODEL</strong>: <code>live_portrait</code></p><ul><li>è¡¨æƒ…è¿˜åŸæ¨¡å‹ï¼ˆå¦‚ Live Portraitï¼‰</li></ul></li><li><p><strong>FACTOR</strong>: <code>80</code></p><ul><li>å¼ºåº¦ç³»æ•°ï¼ˆ0~100ï¼‰ï¼Œæ•°å€¼è¶Šé«˜è¡¨æƒ…è¶Šä¸°å¯Œï¼Œä½†ä¹Ÿæ›´å®¹æ˜“å¤±çœŸã€‚</li></ul></li></ul><h3 id="ğŸ’-Face-Enhancer"><a href="#ğŸ’-Face-Enhancer" class="headerlink" title="ğŸ’ Face Enhancer"></a>ğŸ’ Face Enhancer</h3><ul><li><p><strong>MODEL</strong>: <code>gfpgan_1.4</code></p><ul><li>ä½¿ç”¨ GFPGAN v1.4 æ¨¡å‹å¢å¼ºé¢éƒ¨ç»†èŠ‚ï¼ˆå¦‚çœ¼ç›ã€çš®è‚¤è´¨æ„Ÿç­‰ï¼‰ã€‚</li></ul></li><li><p><strong>BLEND</strong>: <code>80</code></p><ul><li>ä¸åŸå›¾æ··åˆç¨‹åº¦ï¼ˆ0~100ï¼‰ï¼Œè¶Šé«˜å¢å¼ºè¶Šæ˜æ˜¾ã€‚</li></ul></li></ul><h3 id="ğŸ”„-Face-Swapper"><a href="#ğŸ”„-Face-Swapper" class="headerlink" title="ğŸ”„ Face Swapper"></a>ğŸ”„ Face Swapper</h3><ul><li><p><strong>MODEL</strong>: <code>inswapper_128</code></p><ul><li>æœ€å¸¸ç”¨ä¸”æ•ˆæœè¾ƒç¨³çš„æ¢è„¸æ¨¡å‹ï¼Œæ¨èç”¨äºäººè„¸å¯¹é½è‰¯å¥½çš„ç´ æã€‚</li></ul></li><li><p><strong>PIXEL BOOST</strong>: <code>512x512</code></p><ul><li>å¢å¼ºè¾“å…¥å›¾åƒåˆ°è¯¥å°ºå¯¸è¿›è¡Œå¤„ç†ï¼Œæ•°å€¼è¶Šé«˜è¶Šæ¸…æ™°ï¼Œä½†æ˜¾å­˜å ç”¨è¶Šå¤§ã€‚</li></ul></li></ul><h3 id="ğŸ–¼-Frame-Enhancer"><a href="#ğŸ–¼-Frame-Enhancer" class="headerlink" title="ğŸ–¼ Frame Enhancer"></a>ğŸ–¼ Frame Enhancer</h3><ul><li><p><strong>MODEL</strong>: <code>span_kendata_x4</code></p><ul><li>è¶…åˆ†è¾¨ç‡æ¨¡å‹ï¼ˆå¦‚ kendataã€Real-ESRGAN ç­‰ï¼‰ï¼Œæå‡å›¾åƒæ¸…æ™°åº¦ã€‚</li></ul></li><li><p><strong>BLEND</strong>: <code>80</code></p><ul><li>åŒæ ·æ˜¯å¢å¼ºæ··åˆå¼ºåº¦ã€‚</li></ul></li></ul><hr><h2 id="âš™ï¸-æ‰§è¡Œé…ç½®ï¼ˆæ€§èƒ½æ§åˆ¶ï¼‰"><a href="#âš™ï¸-æ‰§è¡Œé…ç½®ï¼ˆæ€§èƒ½æ§åˆ¶ï¼‰" class="headerlink" title="âš™ï¸ æ‰§è¡Œé…ç½®ï¼ˆæ€§èƒ½æ§åˆ¶ï¼‰"></a>âš™ï¸ æ‰§è¡Œé…ç½®ï¼ˆæ€§èƒ½æ§åˆ¶ï¼‰</h2><ul><li><p><strong>EXECUTION PROVIDERS</strong>: <code>cuda</code>, <code>tensorrt</code>, <code>cpu</code></p><ul><li>ä¼˜å…ˆä½¿ç”¨çš„è®¡ç®—åç«¯ï¼Œæ¨èé¡ºåºï¼š<code>tensorrt &gt; cuda &gt; cpu</code>ï¼ˆå¦‚æ”¯æŒï¼‰ã€‚</li></ul></li><li><p><strong>THREAD COUNT</strong>: <code>16</code></p><ul><li>å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†æ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸º CPU æ ¸å¿ƒæ•°ã€‚</li></ul></li><li><p><strong>QUEUE COUNT</strong>: <code>1</code></p><ul><li>ä»»åŠ¡é˜Ÿåˆ—æ•°é‡ï¼Œé€šå¸¸ä¿æŒ 1 å³å¯ã€‚</li></ul></li></ul><hr><h2 id="ğŸ› -ä¸‹è½½ä¸è¾“å‡ºè®¾ç½®"><a href="#ğŸ› -ä¸‹è½½ä¸è¾“å‡ºè®¾ç½®" class="headerlink" title="ğŸ›  ä¸‹è½½ä¸è¾“å‡ºè®¾ç½®"></a>ğŸ›  ä¸‹è½½ä¸è¾“å‡ºè®¾ç½®</h2><ul><li><p><strong>DOWNLOAD PROVIDERS</strong>: <code>github</code>, <code>huggingface</code></p><ul><li>é»˜è®¤ä¸‹è½½æ¨¡å‹æ—¶ä½¿ç”¨çš„æºåœ°å€ã€‚</li></ul></li><li><p><strong>VIDEO MEMORY STRATEGY</strong>: <code>tolerant</code></p><ul><li>æ˜¾å­˜å®¹é”™ç­–ç•¥ï¼Œ<code>tolerant</code> è¡¨ç¤ºå‡ºç°çˆ†æ˜¾å­˜æ—¶è‡ªåŠ¨é™é…ã€‚</li></ul></li><li><p><strong>SYSTEM MEMORY LIMIT</strong>: <code>0</code></p><ul><li>å ç”¨å†…å­˜ä¸Šé™ï¼ˆMBï¼‰ï¼Œ0 è¡¨ç¤ºä¸é™åˆ¶ã€‚</li></ul></li><li><p><strong>OUTPUT IMAGE QUALITY</strong>: <code>90</code></p><ul><li>è¾“å‡ºå›¾åƒçš„ JPEG è´¨é‡ï¼ˆ1~100ï¼‰ã€‚</li></ul></li><li><p><strong>OUTPUT IMAGE RESOLUTION</strong>: <code>680x1024</code></p><ul><li>è¾“å‡ºå›¾åƒæˆ–è§†é¢‘å¸§çš„ç›®æ ‡å°ºå¯¸ã€‚</li></ul></li></ul><hr><h2 id="âœ…-æ¨èè®¾ç½®å»ºè®®"><a href="#âœ…-æ¨èè®¾ç½®å»ºè®®" class="headerlink" title="âœ… æ¨èè®¾ç½®å»ºè®®"></a>âœ… æ¨èè®¾ç½®å»ºè®®</h2><table><thead><tr><th>ç›®æ ‡</th><th>æ¨èå‚æ•°é…ç½®</th></tr></thead><tbody><tr><td>è¿½æ±‚é«˜æ¸…è´¨é‡</td><td>enhancer blend è®¾ç½®é«˜ï¼Œè¾“å‡ºåˆ†è¾¨ç‡è®¾ä¸º 1080p ä»¥ä¸Šã€‚</td></tr><tr><td>æ˜¾å­˜ä¸è¶³</td><td>é™ä½ pixel boostã€output resolutionã€blend å€¼ã€‚</td></tr><tr><td>è¡¨æƒ…è‡ªç„¶</td><td>expression factor è®¾ä¸º 60~80 ä¹‹é—´ã€‚</td></tr><tr><td>è§†é¢‘è¿ç»­æ€§å¼º</td><td>é¿å…è¿‡é«˜å¢å¼ºå¼ºåº¦ï¼Œç¡®ä¿æ¯å¸§é£æ ¼ä¸€è‡´ã€‚</td></tr></tbody></table><hr><h2 id="ğŸ¯-æ¨èçš„æœ€ä¼˜å‚æ•°ç»„åˆï¼ˆé’ˆå¯¹é«˜è´¨é‡æ¢è„¸æ•ˆæœï¼‰"><a href="#ğŸ¯-æ¨èçš„æœ€ä¼˜å‚æ•°ç»„åˆï¼ˆé’ˆå¯¹é«˜è´¨é‡æ¢è„¸æ•ˆæœï¼‰" class="headerlink" title="ğŸ¯ æ¨èçš„æœ€ä¼˜å‚æ•°ç»„åˆï¼ˆé’ˆå¯¹é«˜è´¨é‡æ¢è„¸æ•ˆæœï¼‰"></a>ğŸ¯ æ¨èçš„æœ€ä¼˜å‚æ•°ç»„åˆï¼ˆé’ˆå¯¹é«˜è´¨é‡æ¢è„¸æ•ˆæœï¼‰</h2><p>ä¸ºäº†è·å¾—æœ€ä½³çš„æ¢è„¸æ•ˆæœï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸‹å‚æ•°ç»„åˆï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-comment">--processors face_swapper face_enhancer expression_restorer</span><br></code></pre></td></tr></table></figure><p>æ­¤ç»„åˆå°†æ‰§è¡Œæ¢è„¸æ“ä½œï¼Œå¹¶å¢å¼ºé¢éƒ¨ç»†èŠ‚ï¼ŒåŒæ—¶æ¢å¤è‡ªç„¶çš„é¢éƒ¨è¡¨æƒ…ã€‚</p><h2 id="ğŸ“-ç¤ºä¾‹å‘½ä»¤"><a href="#ğŸ“-ç¤ºä¾‹å‘½ä»¤" class="headerlink" title="ğŸ“ ç¤ºä¾‹å‘½ä»¤"></a>ğŸ“ ç¤ºä¾‹å‘½ä»¤</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹å‘½ä»¤ï¼Œç»“åˆä¸Šè¿°å‚æ•°ä»¥å®ç°é«˜è´¨é‡çš„æ¢è„¸æ•ˆæœï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs applescript">python facefusion.py <span class="hljs-built_in">run</span> \<br>  <span class="hljs-comment">--processors face_swapper face_enhancer expression_restorer \</span><br>  <span class="hljs-comment">--face-swapper-model inswapper_128 \</span><br>  <span class="hljs-comment">--face-enhancer-model gfpgan_1.4 \</span><br>  <span class="hljs-comment">--face-mask-type region \</span><br>  <span class="hljs-comment">--face-mask-blur 0.3 \</span><br>  <span class="hljs-comment">--face-mask-padding 10</span><br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†ä½¿ç”¨æŒ‡å®šçš„æ¨¡å‹å’Œè®¾ç½®ï¼Œæ‰§è¡Œæ¢è„¸ã€å¢å¼ºå’Œè¡¨æƒ…æ¢å¤æ“ä½œã€‚</p><blockquote><p>å¦ä¸€ç§æ–¹æ¡ˆæ˜¯åœ¨ <code>facefusion.ini</code> é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå‚æ•°ï¼Œä¸ç”¨æ¯æ¬¡æ‰§è¡Œå‘½ä»¤éƒ½æ‰‹åŠ¨æŒ‡å®šå‚æ•°ã€‚</p></blockquote><p>ä½¿ç”¨<strong>æ— å¤´æ¨¡å¼</strong>ç›´æ¥æ‰§è¡Œä»»åŠ¡</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">python facefusion.py headless-run --<span class="hljs-keyword">source</span>-path .<span class="hljs-regexp">/facefusion/</span><span class="hljs-keyword">source</span><span class="hljs-regexp">/liuyifei.png --target-path ./</span>facefusion<span class="hljs-regexp">/target/</span><span class="hljs-number">20250410003</span>.jpg --output-path .<span class="hljs-regexp">/outputs/</span><span class="hljs-number">20250520004</span>.jpg<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…-coda-ç¯å¢ƒæ—¶å¯èƒ½é‡åˆ°ç½‘ç»œé—®é¢˜"><a href="#å®‰è£…-coda-ç¯å¢ƒæ—¶å¯èƒ½é‡åˆ°ç½‘ç»œé—®é¢˜" class="headerlink" title="å®‰è£… coda ç¯å¢ƒæ—¶å¯èƒ½é‡åˆ°ç½‘ç»œé—®é¢˜"></a>å®‰è£… coda ç¯å¢ƒæ—¶å¯èƒ½é‡åˆ°ç½‘ç»œé—®é¢˜</h2><blockquote><p>æŒ‡å®šæ¸…åæºå®‰è£…</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">conda</span> install -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge \<br>    <span class="hljs-attribute">cuda</span>-runtime=<span class="hljs-number">12</span>.<span class="hljs-number">8</span>.<span class="hljs-number">1</span> cudnn=<span class="hljs-number">9.8.0.87</span><br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒå®˜æ–¹æ–‡æ¡£"><a href="#å‚è€ƒå®˜æ–¹æ–‡æ¡£" class="headerlink" title="å‚è€ƒå®˜æ–¹æ–‡æ¡£"></a>å‚è€ƒå®˜æ–¹æ–‡æ¡£</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.facefusion.io/">https://docs.facefusion.io/</a></p><p>GitHub ä»“åº“ï¼š<a href="https://github.com/facefusion/facefusion">https://github.com/facefusion/facefusion</a></p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ai</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ES6 Promiseç”¨æ³• asyncawaitå¼‚æ­¥å¤„ç†åŒæ­¥åŒ–</title>
    <link href="/2024/04/03/ES6%20Promise%E7%94%A8%E6%B3%95%20asyncawait%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E5%90%8C%E6%AD%A5%E5%8C%96/"/>
    <url>/2024/04/03/ES6%20Promise%E7%94%A8%E6%B3%95%20asyncawait%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E5%90%8C%E6%AD%A5%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h3 id="promiseå®šä¹‰"><a href="#promiseå®šä¹‰" class="headerlink" title="promiseå®šä¹‰"></a>promiseå®šä¹‰</h3><blockquote><p>promiseæ˜¯è§£å†³å¼‚æ­¥çš„æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥ç”¨å®ƒå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€‚å¯¹è±¡èº«ä¸Šæœ‰resolveã€rejectã€allï¼ŒåŸå‹ä¸Šæœ‰thenã€catchæ–¹æ³•ã€‚promiseå¯¹è±¡æœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆåˆè¯†çŠ¶æ€&#x2F;è¿›è¡Œä¸­ï¼‰ã€resolvedæˆ–fulfilledï¼ˆæˆåŠŸï¼‰ã€rejectedï¼ˆå¤±è´¥ï¼‰</p></blockquote><ul><li><strong>pending</strong> è¡¨ç¤ºâ€å¾…å®šçš„ï¼Œå°†å‘ç”Ÿçš„â€ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªåˆå§‹çŠ¶æ€ã€‚åˆ›å»ºPromiseå¯¹è±¡æ—¶ï¼Œä¸”æ²¡æœ‰è°ƒç”¨resolveæˆ–è€…æ˜¯rejectæ–¹æ³•ï¼Œç›¸å½“äºæ˜¯åˆå§‹çŠ¶æ€ã€‚è¿™ä¸ªåˆå§‹çŠ¶æ€ä¼šéšç€ä½ è°ƒç”¨resolveï¼Œæˆ–è€…æ˜¯rejectå‡½æ•°è€Œåˆ‡æ¢åˆ°å¦ä¸€ç§çŠ¶æ€ã€‚</li><li><strong>resolved</strong> è¡¨ç¤ºè§£å†³äº†ï¼Œå°±æ˜¯è¯´è¿™ä¸ªæ‰¿è¯ºå®ç°äº†ã€‚ è¦å®ç°ä»pendingåˆ°resolvedçš„è½¬å˜ï¼Œéœ€è¦åœ¨ åˆ›å»ºPromiseå¯¹è±¡æ—¶ï¼Œåœ¨å‡½æ•°ä½“ä¸­è°ƒç”¨äº†resolveæ–¹æ³•ã€‚</li><li><strong>rejected</strong> è¡¨ç¤ºâ€æ‹’ç»ï¼Œå¤±è´¥â€œã€‚è¡¨ç¤ºè¿™ä¸ªæ‰¿è¯ºæ²¡æœ‰åšåˆ°ï¼Œå¤±è´¥äº†ã€‚è¦å®ç°ä»pendingåˆ°rejectedçš„è½¬æ¢ï¼Œåªéœ€è¦åœ¨åˆ›å»ºPromiseå¯¹è±¡æ—¶ï¼Œè°ƒç”¨rejectå‡½æ•°ã€‚</li></ul><h3 id="ä»¥uniappä¸­è¯·æ±‚ä¸ºä¾‹"><a href="#ä»¥uniappä¸­è¯·æ±‚ä¸ºä¾‹" class="headerlink" title="ä»¥uniappä¸­è¯·æ±‚ä¸ºä¾‹"></a>ä»¥uniappä¸­è¯·æ±‚ä¸ºä¾‹</h3><ul><li><strong>uni.request</strong> å¤šé‡åµŒå¥—çš„è¯·æ±‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">getData</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">//è·å–åˆ†ç±»åˆ—è¡¨id</span><br>  uni.<span class="hljs-title function_">request</span>(&#123;<br>    <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;https://ku.qingnian8.com/dataApi/news/navlist.php&quot;</span>,<br>    <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>      <span class="hljs-keyword">let</span> id=res.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">id</span><br>      <span class="hljs-comment">// æ ¹æ®åˆ†ç±»idè·å–è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰æ–‡ç« </span><br>      uni.<span class="hljs-title function_">request</span>(&#123;<br>        <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;https://ku.qingnian8.com/dataApi/news/newslist.php&quot;</span>,<br>        <span class="hljs-attr">data</span>:&#123;<br>          <span class="hljs-attr">cid</span>:id<br>        &#125;,<br>        <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-params">res2</span>=&gt;</span>&#123;<br>          <span class="hljs-comment">//è·å–åˆ°ä¸€ç¯‡æ–‡ç« çš„idï¼Œæ ¹æ®æ–‡ç« idæ‰¾åˆ°è¯¥æ–‡ç« ä¸‹çš„è¯„è®º</span><br>          <span class="hljs-keyword">let</span> id=res2.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>;<br>          uni.<span class="hljs-title function_">request</span>(&#123;<br>            <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;https://ku.qingnian8.com/dataApi/news/comment.php&quot;</span>,<br>            <span class="hljs-attr">data</span>:&#123;<br>              <span class="hljs-attr">aid</span>:id<br>            &#125;,<br>            <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-params">res3</span>=&gt;</span>&#123;<br>              <span class="hljs-comment">//æ‰¾åˆ°è¯¥æ–‡ç« ä¸‹æ‰€æœ‰çš„è¯„è®º</span><br>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res3)<br>            &#125;<br>          &#125;)<br>        &#125;<br>      &#125;)<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å°è£…æˆ<strong>promise</strong>å¯¹è±¡</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">methods</span>: &#123;<br>    <span class="hljs-comment">//å…ˆè·å–å¯¼èˆªåˆ†ç±»æ¥å£ï¼Œå°†ç»“æœè¿›è¡Œè¿”å›ï¼Œåˆ°è°ƒç”¨å‡½æ•°çš„åœ°æ–¹è·å–</span><br>    <span class="hljs-title function_">getNav</span>(<span class="hljs-params">callback</span>)&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>&#123;<br>        uni.<span class="hljs-title function_">request</span>(&#123;<br>          <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;https://ku.qingnian8.com/dataApi/news/navlist.php&quot;</span>,<br>          <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>            <span class="hljs-title function_">resolve</span>(res)<br>          &#125;,<br>          <span class="hljs-attr">fail</span>:<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span>&#123;<br>            <span class="hljs-title function_">reject</span>(err)<br>          &#125;<br>        &#125;)<br>      &#125;)<br>    &#125;,<br><br><br>    <span class="hljs-comment">//è·å–æ–‡ç« æ•°æ®ï¼Œå°†æ–‡ç« åˆ—è¡¨è¿›è¡Œè¿”å›</span><br>    <span class="hljs-title function_">getArticle</span>(<span class="hljs-params">id</span>)&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>&#123;<br>        uni.<span class="hljs-title function_">request</span>(&#123;<br>          <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;https://ku.qingnian8.com/dataApi/news/newslist.php&quot;</span>,<br>          <span class="hljs-attr">data</span>:&#123;<br>            <span class="hljs-attr">cid</span>:id<br>          &#125;,<br>          <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>            <span class="hljs-title function_">resolve</span>(res)<br>          &#125;,<br>          <span class="hljs-attr">fail</span>:<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span>&#123;<br>            <span class="hljs-title function_">reject</span>(err)<br>          &#125;<br>        &#125;)<br>      &#125;)<br>    &#125;,<br><br>      <span class="hljs-comment">//è·å–æ–‡ç« ä¸‹çš„æ‰€æœ‰è¯„è®º</span><br>      <span class="hljs-title function_">getComment</span>(<span class="hljs-params">id</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>&#123;<br>          uni.<span class="hljs-title function_">request</span>(&#123;<br>            <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;https://ku.qingnian8.com/dataApi/news/comment.php&quot;</span>,<br>            <span class="hljs-attr">data</span>:&#123;<br>              <span class="hljs-attr">aid</span>:id<br>            &#125;,<br>            <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>              <span class="hljs-title function_">resolve</span>(res)<br>            &#125;,<br>            <span class="hljs-attr">fail</span>:<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span>&#123;<br>              <span class="hljs-title function_">reject</span>(err)<br>            &#125;<br>          &#125;)<br>        &#125;)<br>&#125; <br></code></pre></td></tr></table></figure><ul><li><strong>promise</strong> ç”¨ <strong>then</strong> æ–¹å¼çš„é“¾å¼è°ƒç”¨</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//promiseé“¾å¼è°ƒç”¨</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getNav</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>  <span class="hljs-keyword">let</span> id=res.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getArticle</span>(id);<br>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>  <span class="hljs-keyword">let</span> id=res.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getComment</span>(id)<br>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li><strong>await &#x2F; async</strong> å¼‚æ­¥å¤„ç†åŒæ­¥åŒ–</li></ul><blockquote><p>onloadæ˜¯å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»æœ‰asyncå‘½ä»¤ï¼Œåœ¨è°ƒç”¨å‡½æ•°çš„éƒ¨åˆ†ï¼Œå‰é¢éƒ½åŠ äº†ä¸€ä¸ªawaitï¼Œè¿™ä¸ªå‘½ä»¤çš„æ„æ€å°±æ˜¯ç­‰è¿™ä¸€è¡Œçš„å¼‚æ­¥æ–¹æ³•æ‰§è¡ŒæˆåŠŸåï¼Œå°†è¿”å›çš„å€¼èµ‹å€¼ç»™reså˜é‡ï¼Œç„¶åæ‰èƒ½å†èµ°ä¸‹ä¸€è¡Œä»£ç ï¼Œè¿™å°±æ˜¯å°†åŸæ¥çš„å¼‚æ­¥ç¼–ç¨‹æ”¹ä¸ºäº†åŒæ­¥ç¼–ç¨‹ï¼Œè¿™å°±æ˜¯æ ‡é¢˜æåˆ°çš„â€œå¼‚æ­¥å¤„ç†ï¼ŒåŒæ­¥åŒ–â€ </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> id,res;<br>  res=<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getNav</span>();<br>  id=res.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>;<br>  res=<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getArticle</span>(id);<br>  id=res.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>;<br>  res=<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getComment</span>(id);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>[!TIP]</p><p><a href="https://www.bilibili.com/read/cv18799030/">ES6 Promiseçš„ç”¨æ³•ï¼Œasync&#x2F;awaitå¼‚æ­¥å¤„ç†åŒæ­¥åŒ– æ–‡ç« </a></p><p><a href="https://www.bilibili.com/video/BV1XW4y1v7Md/">ES6 Promiseçš„ç”¨æ³•ï¼ŒES7 async&#x2F;awaitå¼‚æ­¥å¤„ç†åŒæ­¥åŒ–ï¼Œå¼‚æ­¥å¤„ç†è¿›åŒ–å² è§†é¢‘</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>es6</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>es6ä¸­forå¾ªç¯éå†å„ç§ä½¿ç”¨åœºæ™¯</title>
    <link href="/2024/04/03/es6%E4%B8%ADfor%E5%BE%AA%E7%8E%AF%E9%81%8D%E5%8E%86%E5%90%84%E7%A7%8D%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
    <url>/2024/04/03/es6%E4%B8%ADfor%E5%BE%AA%E7%8E%AF%E9%81%8D%E5%8E%86%E5%90%84%E7%A7%8D%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="forå¾ªç¯çš„å„ç§ä½¿ç”¨åœºæ™¯"><a href="#forå¾ªç¯çš„å„ç§ä½¿ç”¨åœºæ™¯" class="headerlink" title="forå¾ªç¯çš„å„ç§ä½¿ç”¨åœºæ™¯"></a>forå¾ªç¯çš„å„ç§ä½¿ç”¨åœºæ™¯</h4><ul><li><p><strong>forEach</strong></p><ul><li>æ€§èƒ½ä¸Šå°äºforï¼Œforå¾ªç¯ç›´æ¥æ“ä½œç´¢å¼•ï¼Œæ²¡æœ‰é¢å¤–çš„å‡½æ•°è°ƒç”¨</li><li>forå¯ä»¥ä½¿ç”¨breakç»ˆæ­¢ï¼ŒforEachä¸æ”¯æŒè·³å‡ºå¾ªç¯ï¼Œä½¿ç”¨returnæ—¶ç±»ä¼¼äºforçš„continueï¼Œç»“æŸå½“æ¬¡å¾ªç¯</li><li>forEachä¸æ”¯æŒawaitå¼‚æ­¥ç­‰å¾…</li></ul></li><li><p><strong>map</strong></p><ul><li><p>å¯¹æ•°ç»„éå†ä¸ç ´ååŸæ•°ç»„ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼ŒæŒ‰ç…§åŸå§‹æ•°ç»„å…ƒç´ é¡ºåºä¾æ¬¡æ‰§è¡Œç»™å®šçš„å‡½æ•°ï¼Œmapæ–¹æ³•éå¸¸é€‚åˆç”¨äºå¤„ç†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å¹¶ç”Ÿæˆæ–°çš„æ•°ç»„</p></li><li><p><code>map(callbackFn)</code> callbackFnåŒ…å«å‚æ•°(element æ•°ç»„ä¸­å½“å‰æ­£åœ¨å¤„ç†çš„å…ƒç´ , index ç´¢å¼•, array æ•°ç»„æœ¬èº«)</p></li></ul><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="hljs-keyword">let</span> arrs = [<span class="hljs-built_in">&#123;name</span>:<span class="hljs-string">&quot;åä¸º&quot;</span>,price:<span class="hljs-number">6999</span>&#125;,<span class="hljs-built_in">&#123;name</span>:<span class="hljs-string">&quot;è‹¹æœ&quot;</span>,price:<span class="hljs-number">9888</span>&#125;,<span class="hljs-built_in">&#123;name</span>:<span class="hljs-string">&quot;å°ç±³&quot;</span>,price:<span class="hljs-number">4999</span>&#125;]<br><span class="hljs-keyword">let</span> newArrs = arrs.<span class="hljs-keyword">map</span>(<span class="hljs-type">item</span>=&gt;&#123;<br><span class="hljs-keyword">return</span> &#123;<br>...<span class="hljs-type">item</span>,<br>price:item.price+<span class="hljs-string">&quot;å…ƒ&quot;</span>,<br><span class="hljs-built_in">number</span>:<span class="hljs-number">888</span><br>&#125;<br>&#125;);<br></code></pre></td></tr></table></figure></li><li><p><strong>filter</strong></p><ul><li><p>è¿‡æ»¤æ–¹æ³•ï¼Œä¼šå¯¹åŸæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åº”ç”¨æŒ‡å®šçš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚åŸæ•°ç»„ä¸ä¼šå—åˆ°å½±å“ã€‚</p></li><li><p>åœ¨filterå›è°ƒå‡½æ•°ä¸­ï¼Œæ»¡è¶³trueå³å¯è¢«å¤„ç†åˆ°æ–°å‡½æ•°ä¸­ï¼Œfalseä¸åšå¤„ç†ã€‚</p></li><li><p><code>filter(callbackFn)</code> callbackFnåŒ…å«å‚æ•°(element æ•°ç»„ä¸­å½“å‰æ­£åœ¨å¤„ç†çš„å…ƒç´ , index ç´¢å¼•, array æ•°ç»„æœ¬èº«)</p></li></ul><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="hljs-keyword">let</span> arrs = [<span class="hljs-number">5</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">15</span>,<span class="hljs-number">22</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>];<br><span class="hljs-keyword">let</span> newArrs = arrs<span class="hljs-built_in">.filter</span>(<span class="hljs-type">item</span>=&gt;&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-type">item</span>&gt;<span class="hljs-number">10</span><br>&#125;)<br></code></pre></td></tr></table></figure></li><li><p><strong>reduce</strong></p><ul><li><p>å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æŒ‰åºæ‰§è¡Œä¸€ä¸ªæŒ‡å®šæ–¹æ³•ï¼Œæ¯ä¸€æ¬¡è¿è¡Œ reducer ä¼šå°†å…ˆå‰å…ƒç´ çš„è®¡ç®—ç»“æœä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p></li><li><p><code>reduce(callbackFn, initialValue)</code> callbackFnåŒ…å«å‚æ•°(prevä¸Šä¸€æ¬¡è°ƒç”¨ callbackFn çš„ç»“æœ, currentå½“å‰å€¼, indexç´¢å¼•-å¯é€‰,array æ•°ç»„æœ¬èº«-å¯é€‰)ï¼Œ<strong>initialValue</strong> ç¬¬ä¸€æ¬¡è°ƒç”¨å›è°ƒå‡½æ•°æ—¶åˆå§‹å€¼</p></li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">let arrs = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>];<br>let result = arrs.reduce((prev,<span class="hljs-keyword">current</span>,<span class="hljs-keyword">index</span>)=&gt;&#123;<br>console.log(prev,<span class="hljs-keyword">current</span>,<span class="hljs-keyword">index</span>);<br><span class="hljs-keyword">return</span> prev+<span class="hljs-keyword">current</span>;<br>&#125;,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure></li><li><p><strong>every</strong></p><ul><li><p>åˆ¤æ–­æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ æ˜¯å¦æ»¡è¶³å‡½æ•°ä¸­ç»™å®šçš„æ¡ä»¶ï¼Œå…¨éƒ¨æ»¡è¶³è¿”å›true,åªè¦æœ‰ä¸€é¡¹ä¸æ»¡è¶³åˆ™è¿”å›falseã€‚</p></li><li><p><code>every(callbackFn)</code> callbackFnåŒ…å«å‚æ•°(element æ•°ç»„ä¸­å½“å‰æ­£åœ¨å¤„ç†çš„å…ƒç´ , index ç´¢å¼•, array æ•°ç»„æœ¬èº«)</p></li></ul><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">let</span> arrs = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];<br>// å†™æˆä¸¤è¡Œæ—¶è®°å¾—è¦<span class="hljs-built_in">return</span><br><span class="hljs-built_in">let</span> result = arrs.<span class="hljs-built_in">every</span>(<span class="hljs-built_in">num</span> =&gt; <span class="hljs-built_in">num</span> &gt; <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure></li><li><p><strong>some</strong></p><ul><li><p>åˆ¤æ–­æ•°ç»„ï¼Œåªè¦æœ‰ä¸€ä¸ªæ»¡è¶³æ¡ä»¶å³è¿”å›trueï¼Œå…¨éƒ¨ä¸æ»¡è¶³æ¡ä»¶æ‰ä¼šè¿”å›falseã€‚</p></li><li><p><code>some(callbackFn)</code> callbackFnåŒ…å«å‚æ•°(element æ•°ç»„ä¸­å½“å‰æ­£åœ¨å¤„ç†çš„å…ƒç´ , index ç´¢å¼•, array æ•°ç»„æœ¬èº«)</p></li></ul><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="hljs-keyword">let</span> arrs = [<span class="hljs-number">55</span>,<span class="hljs-number">26</span>,<span class="hljs-number">3</span>,<span class="hljs-number">12</span>,<span class="hljs-number">39</span>];<br><span class="hljs-keyword">let</span> result = arrs.<span class="hljs-keyword">some</span>(<span class="hljs-type">item</span> =&gt; <span class="hljs-type">item</span> &lt; <span class="hljs-number">10</span>);<br>console.log(result);<br></code></pre></td></tr></table></figure></li><li><p><strong>includes</strong></p><ul><li><p>åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œæ ¹æ®æƒ…å†µï¼Œå¦‚æœåŒ…å«åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</p></li><li><p><code>includes(searchElement)</code> searchElement éœ€è¦æŸ¥æ‰¾çš„å€¼ã€‚</p></li></ul><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">const arrs = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(arrs.<span class="hljs-built_in">includes</span>(<span class="hljs-number">2</span>));<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>[!TIP]<br>å‚è€ƒé“¾æ¥<br><a href="https://blog.csdn.net/qq_18798149/article/details/135089225">https://blog.csdn.net/qq_18798149/article/details/135089225</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>es6 js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>githubä¸Šæœ‰è¶£çš„é¡¹ç›®(å€¼å¾—star)</title>
    <link href="/2024/03/28/github%E4%B8%8A%E6%9C%89%E8%B6%A3%E7%9A%84%E9%A1%B9%E7%9B%AE(%E5%80%BC%E5%BE%97star)/"/>
    <url>/2024/03/28/github%E4%B8%8A%E6%9C%89%E8%B6%A3%E7%9A%84%E9%A1%B9%E7%9B%AE(%E5%80%BC%E5%BE%97star)/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h3 id="ç±»ä¼¼-selenuium-çš„ç½‘é¡µè‡ªåŠ¨åŒ–å·¥å…·"><a href="#ç±»ä¼¼-selenuium-çš„ç½‘é¡µè‡ªåŠ¨åŒ–å·¥å…·" class="headerlink" title="ç±»ä¼¼ selenuium çš„ç½‘é¡µè‡ªåŠ¨åŒ–å·¥å…·"></a>ç±»ä¼¼ selenuium çš„ç½‘é¡µè‡ªåŠ¨åŒ–å·¥å…·</h3><blockquote><p>è¿™æ˜¯ä¸€æ¬¾åŸºäº Python çš„ç½‘é¡µè‡ªåŠ¨åŒ–å·¥å…·ï¼Œæ”¯æŒ Chrome å’Œ Edge ç­‰ Chromium å†…æ ¸çš„æµè§ˆå™¨ã€‚å®ƒå°†æ§åˆ¶æµè§ˆå™¨å’Œæ”¶å‘è¯·æ±‚ä¸¤å¤§åŠŸèƒ½åˆäºŒä¸ºä¸€ï¼Œå¹¶æä¾›äº†ç»Ÿä¸€ã€ç®€æ´çš„æ¥å£ï¼Œç®€å•æ˜“ç”¨ååˆ†å®¹æ˜“ä¸Šæ‰‹ã€‚è¯¥é¡¹ç›® v3.x ç‰ˆæœ¬æ¨å‡ºäº† WebPage æ‘†è„±å¯¹ selenium çš„ä¾èµ–ï¼Œé‡æ–°å¼€å‘äº†åº•å±‚é€»è¾‘ï¼Œå…·æœ‰é€Ÿåº¦å¿«ã€ä¸æ˜“è¢«ç½‘ç«™è¯†åˆ«ã€æ— éœ€ä¸ºä¸åŒç‰ˆæœ¬æµè§ˆä¸‹è½½é©±åŠ¨ç­‰ç‰¹ç‚¹</p></blockquote><p><a href="https://github.com/g1879/DrissionPage">g1879&#x2F;DrissionPage: åŸºäºpythonçš„ç½‘é¡µè‡ªåŠ¨åŒ–å·¥å…·ã€‚æ—¢èƒ½æ§åˆ¶æµè§ˆå™¨ï¼Œä¹Ÿèƒ½æ”¶å‘æ•°æ®åŒ…ã€‚å¯å…¼é¡¾æµè§ˆå™¨è‡ªåŠ¨åŒ–çš„ä¾¿åˆ©æ€§å’Œrequestsçš„é«˜æ•ˆç‡ã€‚åŠŸèƒ½å¼ºå¤§ï¼Œå†…ç½®æ— æ•°äººæ€§åŒ–è®¾è®¡å’Œä¾¿æ·åŠŸèƒ½ã€‚è¯­æ³•ç®€æ´è€Œä¼˜é›…ï¼Œä»£ç é‡å°‘ã€‚ (github.com)</a></p><h3 id="å®æ—¶ç›´æ’­å’Œè§†é¢‘-AI-æ¢è„¸ç¨‹åº"><a href="#å®æ—¶ç›´æ’­å’Œè§†é¢‘-AI-æ¢è„¸ç¨‹åº" class="headerlink" title="å®æ—¶ç›´æ’­å’Œè§†é¢‘ AI æ¢è„¸ç¨‹åº"></a>å®æ—¶ç›´æ’­å’Œè§†é¢‘ AI æ¢è„¸ç¨‹åº</h3><blockquote><p>è¯¥é¡¹ç›®å¯ä»¥å¯¹æ‘„åƒå¤´å’Œæœ¬åœ°è§†é¢‘æ–‡ä»¶ä¸­çš„äººç‰©ï¼Œè¿›è¡Œå®æ—¶ AI æ¢è„¸ï¼Œå¯ç”¨äº PC ç›´æ’­ã€è§†é¢‘ç­‰åœºæ™¯ã€‚</p></blockquote><p><a href="https://github.com/iperov/DeepFaceLive">DeepFaceLive</a></p><h3 id="å±å¹•å®æ—¶ç¿»è¯‘å·¥å…·"><a href="#å±å¹•å®æ—¶ç¿»è¯‘å·¥å…·" class="headerlink" title="å±å¹•å®æ—¶ç¿»è¯‘å·¥å…·"></a>å±å¹•å®æ—¶ç¿»è¯‘å·¥å…·</h3><blockquote><p>å…è´¹å¼€æºçš„å±å¹•å®æ—¶ç¿»è¯‘å·¥å…·ã€‚è¯¥é¡¹ç›®å¯ä»¥å¯¹å±å¹•ä¸Šé€‰å®šåŒºåŸŸå†…æ˜¾ç¤ºçš„æ–‡æœ¬è¿›è¡Œå®æ—¶ç¿»è¯‘ï¼Œå¯è¯†åˆ«è‹±è¯­ã€ä¿„è¯­ã€ä¸­æ–‡ç­‰è¯­è¨€ã€‚ç”¨æˆ·å¯è‡ªè¡Œé€‰æ‹© Tesseractã€WindowsOCRã€EasyOCR å¤šç§ OCR å¼•æ“ï¼Œä»¥åŠåŒ…æ‹¬è°·æ­Œç¿»è¯‘åœ¨å†…çš„å¤šç§ç¿»è¯‘æºã€‚</p></blockquote><p><a href="https://github.com/Danily07/Translumo">Translumo</a></p><h3 id="å°†æˆªå›¾è½¬åŒ–ä¸ºä»£ç "><a href="#å°†æˆªå›¾è½¬åŒ–ä¸ºä»£ç " class="headerlink" title="å°†æˆªå›¾è½¬åŒ–ä¸ºä»£ç "></a>å°†æˆªå›¾è½¬åŒ–ä¸ºä»£ç </h3><blockquote><p>å°†æˆªå›¾è½¬åŒ–ä¸º HTML ä»£ç çš„å·¥å…·ã€‚è¯¥é¡¹ç›®å¯ä»¥å°†å±å¹•æˆªå›¾è½¬åŒ–ä¸º HTML&#x2F;JS&#x2F;Tailwind CSS ä»£ç ï¼Œå®ƒä½¿ç”¨ GPT-4 Vision ç”Ÿæˆä»£ç ã€DALL-E 3 ç”Ÿæˆç›¸ä¼¼çš„å›¾ç‰‡ã€‚</p></blockquote><p><a href="https://github.com/abi/screenshot-to-code">Screenshot-To-Code</a></p><h3 id="æç®€é£æ ¼çš„-Vue-ç®¡ç†åå°æ¨¡æ¿"><a href="#æç®€é£æ ¼çš„-Vue-ç®¡ç†åå°æ¨¡æ¿" class="headerlink" title="æç®€é£æ ¼çš„ Vue ç®¡ç†åå°æ¨¡æ¿"></a>æç®€é£æ ¼çš„ Vue ç®¡ç†åå°æ¨¡æ¿</h3><blockquote><p>ä¸€æ¬¾æç®€é£æ ¼çš„ Vue ç®¡ç†åå°ã€‚è¿™æ˜¯ä¸€ä¸ªå¼€æºã€å…è´¹ã€å¯å•†ç”¨çš„åå°ç®¡ç†æ¨¡æ¿ï¼ŒåŸºäº Vue3ã€Vite4ã€Piniaã€Unocss å’Œ Naive UI ç­‰å‰ç«¯æœ€æ–°æŠ€æœ¯æ ˆã€‚å®ƒç®€æ´ã€è½»é‡ã€é£æ ¼æ¸…æ–°ï¼Œä¸Šæ‰‹æˆæœ¬ä½ï¼Œé€‚åˆä¸­å°å‹é¡¹ç›®æˆ–è€…ä¸ªäººé¡¹ç›®ã€‚</p></blockquote><p><a href="https://github.com/zclzone/vue-naive-admin">Vue-Naive-Admin</a></p><h3 id="Redis-æ¡Œé¢å®¢æˆ·ç«¯"><a href="#Redis-æ¡Œé¢å®¢æˆ·ç«¯" class="headerlink" title="Redis æ¡Œé¢å®¢æˆ·ç«¯"></a>Redis æ¡Œé¢å®¢æˆ·ç«¯</h3><blockquote><p>ä¸€æ¬¾è½»é‡çº§çš„è·¨å¹³å° Redis æ¡Œé¢å®¢æˆ·ç«¯ã€‚è¯¥é¡¹ç›®æ˜¯åŸºäº WebView2 çš„ Redis æ¡Œé¢å®¢æˆ·ç«¯ï¼Œæ‹¥æœ‰å°å·§çš„ä½“ç§¯å’Œç²¾ç¾çš„ç•Œé¢ï¼ŒåŒæ—¶æ”¯æŒä¸­æ–‡ã€‚å®ƒæä¾›äº†å¤šç§è¿æ¥æ–¹å¼ã€åˆ†æ®µåŠ è½½ã€æ…¢æ—¥å¿—ã€è½¬ç æ˜¾ç¤ºç­‰åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ Windowsã€Linux å’Œ macOS ç³»ç»Ÿä¸Šä½¿ç”¨ã€‚</p></blockquote><p><a href="https://github.com/tiny-craft/tiny-rdm">Tiny-Rdm</a></p><h3 id="è§†é¢‘ç¿»è¯‘å’Œé…éŸ³å·¥å…·"><a href="#è§†é¢‘ç¿»è¯‘å’Œé…éŸ³å·¥å…·" class="headerlink" title="è§†é¢‘ç¿»è¯‘å’Œé…éŸ³å·¥å…·"></a>è§†é¢‘ç¿»è¯‘å’Œé…éŸ³å·¥å…·</h3><blockquote><p>å¼€æºçš„è§†é¢‘ç¿»è¯‘å’Œé…éŸ³å·¥å…·ã€‚è¯¥é¡¹ç›®å¯ä»¥å°†è§†é¢‘ä»ä¸€ç§è¯­è¨€ç¿»è¯‘æˆæŒ‡å®šè¯­è¨€çš„è§†é¢‘ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå’Œæ·»åŠ å¯¹åº”è¯­è¨€çš„å­—å¹•å’Œé…éŸ³ã€‚</p></blockquote><p><a href="https://github.com/jianchang512/pyvideotrans">Pyvideotrans</a></p>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>feapderçˆ¬è™«æ¡†æ¶ä¹‹è½»é‡AirSpiderç”¨æ³•ç¤ºä¾‹</title>
    <link href="/2024/03/27/feapder%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6%E4%B9%8B%E8%BD%BB%E9%87%8FAirSpider%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/"/>
    <url>/2024/03/27/feapder%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6%E4%B9%8B%E8%BD%BB%E9%87%8FAirSpider%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ç²¾ç®€ç‰ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install feapder<br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨æ¸²æŸ“ç‰ˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install &quot;feapder[render]&quot;<br></code></pre></td></tr></table></figure><p>å®Œæ•´ç‰ˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install &quot;feapder[all]&quot;<br></code></pre></td></tr></table></figure><p>ä¸‰ä¸ªç‰ˆæœ¬åŒºåˆ«ï¼š</p><ol><li>ç²¾ç®€ç‰ˆï¼šä¸æ”¯æŒæµè§ˆå™¨æ¸²æŸ“ã€ä¸æ”¯æŒåŸºäºå†…å­˜å»é‡ã€ä¸æ”¯æŒå…¥åº“mongo</li><li>æµè§ˆå™¨æ¸²æŸ“ç‰ˆï¼šä¸æ”¯æŒåŸºäºå†…å­˜å»é‡ã€ä¸æ”¯æŒå…¥åº“mongo</li><li>å®Œæ•´ç‰ˆï¼šæ”¯æŒæ‰€æœ‰åŠŸèƒ½</li></ol><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><blockquote><p>AirSpideræ˜¯ä¸€æ¬¾è½»é‡çˆ¬è™«ï¼Œå­¦ä¹ æˆæœ¬ä½ã€‚é¢å¯¹ä¸€äº›æ•°æ®é‡è¾ƒå°‘ï¼Œæ— éœ€æ–­ç‚¹ç»­çˆ¬ï¼Œæ— éœ€åˆ†å¸ƒå¼é‡‡é›†çš„éœ€æ±‚ï¼Œå¯é‡‡ç”¨æ­¤çˆ¬è™«</p></blockquote><p>åˆ›å»ºæ¨¡æ¿å‘½ä»¤ï¼š<code>feapder create -s air_spider_test</code> </p><p>è¯·é€‰æ‹©çˆ¬è™«æ¨¡æ¿  <em>AirSpider</em> </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Created on 2024-03-26 11:57:14</span><br><span class="hljs-string">---------</span><br><span class="hljs-string">@summary:</span><br><span class="hljs-string">---------</span><br><span class="hljs-string">@author: zhangmingwei</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">import</span> feapder<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AirSpiderTest</span>(feapder.AirSpider):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_requests</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">yield</span> feapder.Request(<span class="hljs-string">&quot;https://spidertools.cn&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">self, request, response</span>):<br>        <span class="hljs-comment"># æå–ç½‘ç«™title</span><br>        <span class="hljs-built_in">print</span>(response.xpath(<span class="hljs-string">&quot;//title/text()&quot;</span>).extract_first())<br>        <span class="hljs-comment"># æå–ç½‘ç«™æè¿°</span><br>        <span class="hljs-built_in">print</span>(response.xpath(<span class="hljs-string">&quot;//meta[@name=&#x27;description&#x27;]/@content&quot;</span>).extract_first())<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç½‘ç«™åœ°å€: &quot;</span>, response.url)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    AirSpiderTest().start()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>çˆ¬è™«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ¬è™«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>feapderçˆ¬è™«æ¡†æ¶ä¹‹ä»»åŠ¡TaskSpiderç”¨æ³•ç¤ºä¾‹</title>
    <link href="/2024/03/27/feapder%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6%E4%B9%8B%E4%BB%BB%E5%8A%A1TaskSpider%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/"/>
    <url>/2024/03/27/feapder%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6%E4%B9%8B%E4%BB%BB%E5%8A%A1TaskSpider%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ç²¾ç®€ç‰ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install feapder<br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨æ¸²æŸ“ç‰ˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install &quot;feapder[render]&quot;<br></code></pre></td></tr></table></figure><p>å®Œæ•´ç‰ˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install &quot;feapder[all]&quot;<br></code></pre></td></tr></table></figure><p>ä¸‰ä¸ªç‰ˆæœ¬åŒºåˆ«ï¼š</p><ol><li>ç²¾ç®€ç‰ˆï¼šä¸æ”¯æŒæµè§ˆå™¨æ¸²æŸ“ã€ä¸æ”¯æŒåŸºäºå†…å­˜å»é‡ã€ä¸æ”¯æŒå…¥åº“mongo</li><li>æµè§ˆå™¨æ¸²æŸ“ç‰ˆï¼šä¸æ”¯æŒåŸºäºå†…å­˜å»é‡ã€ä¸æ”¯æŒå…¥åº“mongo</li><li>å®Œæ•´ç‰ˆï¼šæ”¯æŒæ‰€æœ‰åŠŸèƒ½</li></ol><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><blockquote><p>TaskSpideræ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼çˆ¬è™«ï¼Œå†…éƒ¨å°è£…äº†å–ç§å­ä»»åŠ¡çš„é€»è¾‘ï¼Œå†…ç½®æ”¯æŒä»redisæˆ–è€…mysqlè·å–ä»»åŠ¡ï¼Œä¹Ÿå¯é€šè¿‡è‡ªå®šä¹‰å®ç°ä»å…¶ä»–æ¥æºè·å–ä»»åŠ¡</p></blockquote><p>åˆ›å»ºæ¨¡æ¿å‘½ä»¤ï¼š<code>feapder create -s task_spider_test</code> </p><p>è¯·é€‰æ‹©çˆ¬è™«æ¨¡æ¿  TaskSpider</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">Created on 2024-03-26 17:27:27</span><br><span class="hljs-string">---------</span><br><span class="hljs-string">@summary:</span><br><span class="hljs-string">---------</span><br><span class="hljs-string">@author: zhangmingwei01</span><br><span class="hljs-string">&quot;</span><span class="hljs-string">&quot;&quot;</span><br><br>import feapder<br><span class="hljs-keyword">from</span> feapder import ArgumentParser<br><span class="hljs-keyword">from</span> items.spider_data_item import SpiderDataItem<br><br><br>class SpiderTest(feapder.TaskSpider):<br>    # è‡ªå®šä¹‰æ•°æ®åº“ï¼Œè‹¥é¡¹ç›®ä¸­æœ‰setting.pyæ–‡ä»¶ï¼Œæ­¤è‡ªå®šä¹‰å¯åˆ é™¤<br>    __custom_setting__ = dict(<br>        <span class="hljs-attribute">REDISDB_IP_PORTS</span>=<span class="hljs-string">&quot;localhost:6379&quot;</span>,<br>        <span class="hljs-attribute">REDISDB_USER_PASS</span>=<span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-attribute">REDISDB_DB</span>=0,<br>        <span class="hljs-attribute">MYSQL_IP</span>=<span class="hljs-string">&quot;localhost&quot;</span>,<br>        <span class="hljs-attribute">MYSQL_PORT</span>=3306,<br>        <span class="hljs-attribute">MYSQL_DB</span>=<span class="hljs-string">&quot;data&quot;</span>,<br>        <span class="hljs-attribute">MYSQL_USER_NAME</span>=<span class="hljs-string">&quot;root&quot;</span>,<br>        <span class="hljs-attribute">MYSQL_USER_PASS</span>=<span class="hljs-string">&quot;pwd&quot;</span>,<br>    )<br><br>    def add_task(self):<br>        # åŠ ç§å­ä»»åŠ¡ æ¡†æ¶ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ–¹ä¾¿å¾€redisé‡Œå¡ä»»åŠ¡ï¼Œä½†ä¸èƒ½å†™æˆæ­»å¾ªç¯ã€‚å®é™…ä¸šåŠ¡ä¸­å¯ä»¥è‡ªå·±å†™ä¸ªè„šæœ¬å¾€redisé‡Œå¡ä»»åŠ¡<br>        self._redisdb.zadd(self._task_table, &#123;<span class="hljs-string">&quot;id&quot;</span>: 1, <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://www.baidu.com&quot;</span>&#125;)<br><br>    def start_requests(self, task):<br>        task_id = task.id<br>        url = task.url<br>        yield feapder.Request(url, <span class="hljs-attribute">task_id</span>=task_id)<br><br>    def parse(self, request, response):<br>        # æå–ç½‘ç«™title<br>        title = response.xpath(<span class="hljs-string">&quot;//title/text()&quot;</span>).extract_first()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç½‘ç«™æ ‡é¢˜ï¼š&quot;</span>, title)<br>        # æå–ç½‘ç«™æè¿°<br>        <span class="hljs-built_in">print</span>(response.xpath(<span class="hljs-string">&quot;//meta[@name=&#x27;description&#x27;]/@content&quot;</span>).extract_first())<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç½‘ç«™åœ°å€: &quot;</span>, response.url)<br>        item = SpiderDataItem(**&#123;<br>            <span class="hljs-string">&quot;title&quot;</span>: title,<br>            <span class="hljs-string">&quot;url&quot;</span>: response.url,<br>        &#125;)<br>        yield item<br><br>        # mysql éœ€è¦æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºåšå®Œ å³ <span class="hljs-attribute">state</span>=1<br>        # yield self.update_task_batch(request.task_id)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    # ç”¨mysqlåšä»»åŠ¡è¡¨ï¼Œéœ€è¦å…ˆå»ºå¥½ä»»åŠ¡ä»»åŠ¡è¡¨<br>    # spider = SpiderTest(<br>    #     <span class="hljs-attribute">redis_key</span>=<span class="hljs-string">&quot;spider:test&quot;</span>,  # åˆ†å¸ƒå¼çˆ¬è™«è°ƒåº¦ä¿¡æ¯å­˜å‚¨ä½ç½®<br>    #     <span class="hljs-attribute">task_table</span>=<span class="hljs-string">&quot;spider_test&quot;</span>,  # mysqlä¸­çš„ä»»åŠ¡è¡¨<br>    #     task_keys=[<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;url&quot;</span>],  # éœ€è¦è·å–ä»»åŠ¡è¡¨é‡Œçš„å­—æ®µåï¼Œå¯æ·»åŠ å¤šä¸ª<br>    #     <span class="hljs-attribute">task_state</span>=<span class="hljs-string">&quot;state&quot;</span>,  # mysqlä¸­ä»»åŠ¡çŠ¶æ€å­—æ®µ<br>    # )<br><br>    # ç”¨redisåšä»»åŠ¡è¡¨<br>    spider = SpiderTest(<br>        <span class="hljs-attribute">redis_key</span>=<span class="hljs-string">&quot;spider:test2024&quot;</span>,  # åˆ†å¸ƒå¼çˆ¬è™«è°ƒåº¦ä¿¡æ¯å­˜å‚¨ä½ç½®<br>        <span class="hljs-attribute">task_table</span>=<span class="hljs-string">&quot;spider_test&quot;</span>, # ä»»åŠ¡è¡¨å<br>        <span class="hljs-attribute">task_table_type</span>=<span class="hljs-string">&quot;redis&quot;</span>, # ä»»åŠ¡è¡¨ç±»å‹ä¸ºredis<br>    )<br><br>    parser = ArgumentParser(<span class="hljs-attribute">description</span>=<span class="hljs-string">&quot;SpiderTestçˆ¬è™«&quot;</span>)<br><br>    parser.add_argument(<br>        <span class="hljs-string">&quot;--start_master&quot;</span>,<br>        <span class="hljs-attribute">action</span>=<span class="hljs-string">&quot;store_true&quot;</span>,<br>        <span class="hljs-attribute">help</span>=<span class="hljs-string">&quot;æ·»åŠ ä»»åŠ¡&quot;</span>,<br>        <span class="hljs-attribute">function</span>=spider.start_monitor_task,<br>    )<br>    parser.add_argument(<br>        <span class="hljs-string">&quot;--start_worker&quot;</span>, <span class="hljs-attribute">action</span>=<span class="hljs-string">&quot;store_true&quot;</span>, <span class="hljs-attribute">help</span>=<span class="hljs-string">&quot;å¯åŠ¨çˆ¬è™«&quot;</span>, <span class="hljs-attribute">function</span>=spider.start<br>    )<br><br>    parser.start()<br><br>    # ç›´æ¥å¯åŠ¨<br>    spider.start()  # å¯åŠ¨çˆ¬è™«<br>    spider.start_monitor_task() # æ·»åŠ ä»»åŠ¡<br><br>    # é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨<br>    # python spider_test.py --start_master  # æ·»åŠ ä»»åŠ¡<br>    # python spider_test.py --start_worker  # å¯åŠ¨çˆ¬è™«<br></code></pre></td></tr></table></figure><ul><li>è¿™é‡ŒåŒ…å«äº†å…¥åº“çš„æ“ä½œï¼Œåœ¨åŒçº§ç›®å½•ä¸‹åˆ›å»º<em>items</em>æ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¸€ä¸ª <em>spider_data_item.py</em></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Created on 2024-03-27 11:41:57</span><br><span class="hljs-string">---------</span><br><span class="hljs-string">@summary:</span><br><span class="hljs-string">---------</span><br><span class="hljs-string">@author: zhangmingwei01</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">from</span> feapder <span class="hljs-keyword">import</span> Item<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpiderDataItem</span>(<span class="hljs-title class_ inherited__">Item</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    This class was generated by feapder</span><br><span class="hljs-string">    command: feapder create -i spider_data 1</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    __table_name__ = <span class="hljs-string">&quot;spider_data&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):<br>        <span class="hljs-comment"># self.id = kwargs.get(&#x27;id&#x27;)</span><br>        self.title = kwargs.get(<span class="hljs-string">&#x27;title&#x27;</span>)<br>        self.url = kwargs.get(<span class="hljs-string">&#x27;url&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>éœ€è¦å…ˆåœ¨æ•°æ®åº“ä¸­å»ºå¥½è¡¨ï¼Œåº“åä¸º<em>data</em>ï¼Œè¡¨åä¸º<em>spider_data</em>ï¼Œä»¥ä¸‹æ˜¯å»ºè¡¨è¯­å¥</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `spider_data` (<br>   `id` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>   `title` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>   `url` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>   <span class="hljs-keyword">PRIMARY KEY</span> (`id`)<br> ) ENGINE=InnoDB AUTO_INCREMENT=<span class="hljs-number">1</span> <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8mb4;<br></code></pre></td></tr></table></figure><ul><li>å®é™…ä¸šåŠ¡ä¸­å¯èƒ½æ—  <em>add_task</em>æ–¹æ³•ï¼Œåº”è‡ªå·±å»æ‰‹åŠ¨æ·»åŠ ä»»åŠ¡åˆ°redisä¸­</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># å¯¼å…¥_redisdb</span><br><span class="hljs-attribute">_redisdb</span>.zadd(self._task_table, &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://www.baidu.com&quot;</span>&#125;)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>çˆ¬è™«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ¬è™«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çˆ¬è™«åˆ©å™¨ pyppeteer ä½¿ç”¨æŠ€å·§</title>
    <link href="/2022/08/22/%E7%88%AC%E8%99%AB%E5%88%A9%E5%99%A8%20pyppeteer%20%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    <url>/2022/08/22/%E7%88%AC%E8%99%AB%E5%88%A9%E5%99%A8%20pyppeteer%20%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="ä¸€ã€æ‹¦æˆªå™¨ç®€å•ç”¨æ³•"><a href="#ä¸€ã€æ‹¦æˆªå™¨ç®€å•ç”¨æ³•" class="headerlink" title="ä¸€ã€æ‹¦æˆªå™¨ç®€å•ç”¨æ³•"></a>ä¸€ã€æ‹¦æˆªå™¨ç®€å•ç”¨æ³•</h2><p>æ‹¦æˆªå™¨ä½œç”¨äºå•ä¸ªPageï¼Œå³æµè§ˆå™¨ä¸­çš„ä¸€ä¸ªæ ‡ç­¾é¡µã€‚æ¯åˆå§‹åŒ–ä¸€ä¸ªPageéƒ½è¦æ·»åŠ ä¸€ä¸‹æ‹¦æˆªå™¨ã€‚æ‹¦æˆªå™¨å®é™…ä¸Šæ˜¯</p><p>é€šè¿‡ç»™å„ç§äº‹ä»¶æ·»åŠ å›è°ƒå‡½æ•°æ¥å®ç°çš„ã€‚</p><p>äº‹ä»¶åˆ—è¡¨å¯å‚è§ï¼špyppeteer.page.Page.Events</p><p>å¸¸ç”¨æ‹¦æˆªå™¨ï¼š</p><ul><li>requestï¼šå‘å‡ºç½‘ç»œè¯·æ±‚æ—¶è§¦å‘</li><li>responseï¼šæ”¶åˆ°ç½‘ç»œå“åº”æ—¶è§¦å‘</li><li>dialogï¼šé¡µé¢æœ‰å¼¹çª—æ—¶è§¦å‘</li></ul><p>ä½¿ç”¨requestæ‹¦æˆªå™¨ä¿®æ”¹è¯·æ±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf8</span><br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> pyppeteer <span class="hljs-keyword">import</span> launch<br><br><span class="hljs-keyword">from</span> pyppeteer.network_manager <span class="hljs-keyword">import</span> Request<br><br><br>launch_args = &#123;<br>    <span class="hljs-string">&quot;headless&quot;</span>: <span class="hljs-literal">False</span>,<br>    <span class="hljs-string">&quot;args&quot;</span>: [<br>        <span class="hljs-string">&quot;--start-maximized&quot;</span>,<br>        <span class="hljs-string">&quot;--no-sandbox&quot;</span>,<br>        <span class="hljs-string">&quot;--disable-infobars&quot;</span>,<br>        <span class="hljs-string">&quot;--ignore-certificate-errors&quot;</span>,<br>        <span class="hljs-string">&quot;--log-level=3&quot;</span>,<br>        <span class="hljs-string">&quot;--enable-extensions&quot;</span>,<br>        <span class="hljs-string">&quot;--window-size=1920,1080&quot;</span>,<br>        <span class="hljs-string">&quot;--user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.97 Safari/537.36&quot;</span>,<br>    ],<br>&#125;<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">modify_url</span>(<span class="hljs-params">request: Request</span>):<br>    <span class="hljs-keyword">if</span> request.url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>:<br>        <span class="hljs-keyword">await</span> request.continue_(&#123;<span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://www.baidu.com/s?wd=ip&amp;ie=utf-8&quot;</span>&#125;)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">await</span> request.continue_()<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">interception_test</span>():<br>    <span class="hljs-comment"># å¯åŠ¨æµè§ˆå™¨</span><br>    browser = <span class="hljs-keyword">await</span> launch(**launch_args)<br>    <span class="hljs-comment"># æ–°å»ºæ ‡ç­¾é¡µ</span><br>    page = <span class="hljs-keyword">await</span> browser.newPage()<br>    <span class="hljs-comment"># è®¾ç½®é¡µé¢æ‰“å¼€è¶…æ—¶æ—¶é—´</span><br>    page.setDefaultNavigationTimeout(<span class="hljs-number">10</span> * <span class="hljs-number">1000</span>)<br>    <span class="hljs-comment"># è®¾ç½®çª—å£å¤§å°</span><br>    <span class="hljs-keyword">await</span> page.setViewport(&#123;<span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">1920</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">1040</span>&#125;)<br><br>    <span class="hljs-comment"># å¯ç”¨æ‹¦æˆªå™¨</span><br>    <span class="hljs-keyword">await</span> page.setRequestInterception(<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-comment"># è®¾ç½®æ‹¦æˆªå™¨</span><br>    <span class="hljs-comment"># 1. ä¿®æ”¹è¯·æ±‚çš„url</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-number">1</span>:<br>        page.on(<span class="hljs-string">&quot;request&quot;</span>, modify_url)<br>        <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">&quot;https://www.baidu.com&quot;</span>)<br><br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">10</span>)<br><br>    <span class="hljs-comment"># å…³é—­æµè§ˆå™¨</span><br>    <span class="hljs-keyword">await</span> page.close()<br>    <span class="hljs-keyword">await</span> browser.close()<br>    <span class="hljs-keyword">return</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    loop = asyncio.get_event_loop()<br>    loop.run_until_complete(interception_test())<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨responseæ‹¦æˆªå™¨è·å–æŸä¸ªè¯·æ±‚çš„å“åº”ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_content</span>(<span class="hljs-params">response: Response</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        # æ³¨æ„è¿™é‡Œä¸éœ€è¦è®¾ç½® page.setRequestInterception(True)</span><br><span class="hljs-string">        page.on(&quot;response&quot;, get_content)</span><br><span class="hljs-string">    :param response:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> response.url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>:<br>        content = <span class="hljs-keyword">await</span> response.text()<br>        title = re.search(<span class="hljs-string">b&quot;&lt;title&gt;(.*?)&lt;/title&gt;&quot;</span>, content)<br>        <span class="hljs-built_in">print</span>(title.group(<span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure><p>æ¸…é™¤é¡µé¢æ‰€æœ‰å¼¹çª—:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_dialog</span>(<span class="hljs-params">dialog: Dialog</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        page.on(&quot;dialog&quot;, get_content)</span><br><span class="hljs-string">    :param dialog: </span><br><span class="hljs-string">    :return: </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">await</span> dialog.dismiss()<br></code></pre></td></tr></table></figure><h2 id="äºŒã€æ‹¦æˆªå™¨å®ç°åˆ‡æ¢ä»£ç†"><a href="#äºŒã€æ‹¦æˆªå™¨å®ç°åˆ‡æ¢ä»£ç†" class="headerlink" title="äºŒã€æ‹¦æˆªå™¨å®ç°åˆ‡æ¢ä»£ç†"></a>äºŒã€æ‹¦æˆªå™¨å®ç°åˆ‡æ¢ä»£ç†</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹æµè§ˆå™¨æ·»åŠ ä»£ç†çš„æ–¹æ³•ä¸ºè®¾ç½®å¯åŠ¨å‚æ•°ï¼š</p><blockquote><p>â€“proxy-server&#x3D;<a href="http://user:password@ip:port">http://user:password@ip:port</a></p></blockquote><p>ä¾‹å¦‚ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ada">launch_args = &#123;<br>    <span class="hljs-string">&quot;headless&quot;</span>: <span class="hljs-literal">False</span>,<br>    <span class="hljs-string">&quot;args&quot;</span>: [        <span class="hljs-string">&quot;--proxy-server=http://localhost:1080&quot;</span>,<br>        <span class="hljs-string">&quot;--user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.97 Safari/537.36&quot;</span>,<br>    ],<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ­¤ç§æ–¹å¼çš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œåªèƒ½åœ¨æµè§ˆå™¨å¯åŠ¨æ—¶è®¾ç½®ã€‚å½“éœ€è¦åˆ‡æ¢ä»£ç†æ—¶ï¼Œåªèƒ½é‡å¯æµè§ˆå™¨ï¼Œè¿™ä¸ªä»£ä»·</p><p>å°±å¤ªé«˜äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æƒ³æƒ³å…¶ä»–åŠæ³•ã€‚</p><p>æ€è·¯å¾ˆç®€å•ï¼š</p><ul><li>requestæ‹¦æˆªå™¨å¯ä»¥ä¿®æ”¹è¯·æ±‚å±æ€§å¹¶ä¸”è¿”å›è‡ªå®šä¹‰å“åº”å†…å®¹</li><li>ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ¥å‘é€ç½‘ç»œè¯·æ±‚ï¼Œå¹¶è®¾ç½®ä»£ç†ã€‚ç„¶åå°è£…å“åº”å†…å®¹è¿”å›ç»™æµè§ˆå™¨</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> aiohttp<br><br>aiohttp_session = aiohttp.ClientSession(loop=asyncio.get_event_loop())<br><br>proxy = <span class="hljs-string">&quot;http://127.0.0.1:1080&quot;</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">use_proxy_base</span>(<span class="hljs-params">request: Request</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        # å¯ç”¨æ‹¦æˆªå™¨</span><br><span class="hljs-string">        await page.setRequestInterception(True)</span><br><span class="hljs-string">        page.on(&quot;request&quot;, use_proxy_base)</span><br><span class="hljs-string">    :param request:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># æ„é€ è¯·æ±‚å¹¶æ·»åŠ ä»£ç†</span><br>    req = &#123;<br>        <span class="hljs-string">&quot;headers&quot;</span>: request.headers,<br>        <span class="hljs-string">&quot;data&quot;</span>: request.postData,<br>        <span class="hljs-string">&quot;proxy&quot;</span>: proxy,  <span class="hljs-comment"># ä½¿ç”¨å…¨å±€å˜é‡ åˆ™å¯éšæ„åˆ‡æ¢</span><br>        <span class="hljs-string">&quot;timeout&quot;</span>: <span class="hljs-number">5</span>,<br>        <span class="hljs-string">&quot;ssl&quot;</span>: <span class="hljs-literal">False</span>,<br>    &#125;<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“è·å–å“åº”</span><br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp_session.request(<br>            method=request.method, url=request.url, **req<br>        ) <span class="hljs-keyword">as</span> response:<br>            body = <span class="hljs-keyword">await</span> response.read()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">await</span> request.abort()<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># æ•°æ®è¿”å›ç»™æµè§ˆå™¨</span><br>    resp = &#123;<span class="hljs-string">&quot;body&quot;</span>: body, <span class="hljs-string">&quot;headers&quot;</span>: response.headers, <span class="hljs-string">&quot;status&quot;</span>: response.status&#125;<br>    <span class="hljs-keyword">await</span> request.respond(resp)<br>    <span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…å†å¢åŠ ä¸€äº›ç¼“å­˜æ¥èŠ‚çº¦ä¸€ä¸‹å¸¦å®½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é™æ€èµ„æºç¼“å­˜</span><br>static_cache = &#123;&#125;<br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">use_proxy_and_cache</span>(<span class="hljs-params">request: Request</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        # å¯ç”¨æ‹¦æˆªå™¨</span><br><span class="hljs-string">        await page.setRequestInterception(True)</span><br><span class="hljs-string">        page.on(&quot;request&quot;, use_proxy_base)</span><br><span class="hljs-string">    :param request:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">global</span> static_cache<br>    <span class="hljs-keyword">if</span> request.url <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> static_cache:<br>        <span class="hljs-comment"># æ„é€ è¯·æ±‚å¹¶æ·»åŠ ä»£ç†</span><br>        req = &#123;<br>            <span class="hljs-string">&quot;headers&quot;</span>: request.headers,<br>            <span class="hljs-string">&quot;data&quot;</span>: request.postData,<br>            <span class="hljs-string">&quot;proxy&quot;</span>: proxy,  <span class="hljs-comment"># ä½¿ç”¨å…¨å±€å˜é‡ åˆ™å¯éšæ„åˆ‡æ¢</span><br>            <span class="hljs-string">&quot;timeout&quot;</span>: <span class="hljs-number">5</span>,<br>            <span class="hljs-string">&quot;ssl&quot;</span>: <span class="hljs-literal">False</span>,<br>        &#125;<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“è·å–å“åº”</span><br>            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp_session.request(<br>                method=request.method, url=request.url, **req<br>            ) <span class="hljs-keyword">as</span> response:<br>                body = <span class="hljs-keyword">await</span> response.read()<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">await</span> request.abort()<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-comment"># æ•°æ®è¿”å›ç»™æµè§ˆå™¨</span><br>        resp = &#123;<span class="hljs-string">&quot;body&quot;</span>: body, <span class="hljs-string">&quot;headers&quot;</span>: response.headers, <span class="hljs-string">&quot;status&quot;</span>: response.status&#125;<br>        <span class="hljs-comment"># åˆ¤æ–­æ•°æ®ç±»å‹ å¦‚æœæ˜¯é™æ€æ–‡ä»¶åˆ™ç¼“å­˜èµ·æ¥</span><br>        content_type = response.headers.get(<span class="hljs-string">&quot;Content-Type&quot;</span>)<br>        <span class="hljs-keyword">if</span> content_type <span class="hljs-keyword">and</span> (<span class="hljs-string">&quot;javascript&quot;</span> <span class="hljs-keyword">in</span> content_type <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;/css&quot;</span> <span class="hljs-keyword">in</span> content_type):<br>            static_cache[request.url] = resp<br>    <span class="hljs-keyword">else</span>:<br>        resp = static_cache[request.url]<br><br>    <span class="hljs-keyword">await</span> request.respond(resp)<br>    <span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/dyfblog/p/10887940.html">pyppeteerè¿›é˜¶æŠ€å·§</a></p>]]></content>
    
    
    <categories>
      
      <category>çˆ¬è™«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ¬è™«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç”¨pandasç”Ÿæˆexcelæ–‡ä»¶ç¤ºä¾‹ï¼Œå¹¶è°ƒæ•´excelçš„æ ¼å¼æˆ–æ ·å¼</title>
    <link href="/2022/06/27/%E7%94%A8pandas%E7%94%9F%E6%88%90excel%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B%EF%BC%8C%E5%B9%B6%E8%B0%83%E6%95%B4excel%E7%9A%84%E6%A0%BC%E5%BC%8F%E6%88%96%E6%A0%B7%E5%BC%8F/"/>
    <url>/2022/06/27/%E7%94%A8pandas%E7%94%9F%E6%88%90excel%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B%EF%BC%8C%E5%B9%B6%E8%B0%83%E6%95%B4excel%E7%9A%84%E6%A0%BC%E5%BC%8F%E6%88%96%E6%A0%B7%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="ç”¨pandasç”Ÿæˆexcel"><a href="#ç”¨pandasç”Ÿæˆexcel" class="headerlink" title="ç”¨pandasç”Ÿæˆexcel"></a>ç”¨pandasç”Ÿæˆexcel</h2><ul><li>å½“æˆ‘ä»¬æœ‰ç‰¹æ®Šçš„éœ€æ±‚æ—¶ï¼Œæ¯”å¦‚è¦ä¿®æ”¹excelçš„è¡Œå®½åˆ—å®½ï¼Œè¿˜æœ‰å­—ä½“æ ·å¼ç­‰ç­‰</li></ul><h3 id="éœ€æ±‚ç¤ºä¾‹"><a href="#éœ€æ±‚ç¤ºä¾‹" class="headerlink" title="éœ€æ±‚ç¤ºä¾‹"></a>éœ€æ±‚ç¤ºä¾‹</h3><p><img src="https://img-blog.csdnimg.cn/f37a16db24b84301863ffaf4d486819e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span>  datetime <span class="hljs-keyword">import</span> datetime, timedelta<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">modify_excel_format</span>(<span class="hljs-params">excel_data, writer, df</span>):<br>    <span class="hljs-comment"># ----------è°ƒæ•´excelæ ¼å¼ ---------------</span><br>    workbook = writer.book<br>    fmt = workbook.add_format(&#123;<span class="hljs-string">&quot;font_name&quot;</span>: <span class="hljs-string">u&quot;å®‹ä½“&quot;</span>&#125;)<br>    col_fmt = workbook.add_format(<br>        &#123;<span class="hljs-string">&#x27;bold&#x27;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;font_size&#x27;</span>: <span class="hljs-number">11</span>, <span class="hljs-string">&#x27;font_name&#x27;</span>: <span class="hljs-string">u&#x27;å®‹ä½“&#x27;</span>, <span class="hljs-string">&#x27;border&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;bg_color&#x27;</span>: <span class="hljs-string">&#x27;#0265CB&#x27;</span>,<span class="hljs-string">&#x27;font_color&#x27;</span>: <span class="hljs-string">&#x27;white&#x27;</span>,<br>         <span class="hljs-string">&#x27;valign&#x27;</span>: <span class="hljs-string">&#x27;vcenter&#x27;</span>, <span class="hljs-string">&#x27;align&#x27;</span>: <span class="hljs-string">&#x27;center&#x27;</span>&#125;)<br>    detail_fmt = workbook.add_format(<br>        &#123;<span class="hljs-string">&quot;font_name&quot;</span>: <span class="hljs-string">u&quot;å®‹ä½“&quot;</span>, <span class="hljs-string">&#x27;border&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;valign&#x27;</span>: <span class="hljs-string">&#x27;vcenter&#x27;</span>, <span class="hljs-string">&#x27;align&#x27;</span>: <span class="hljs-string">&#x27;center&#x27;</span>,<span class="hljs-string">&#x27;font_size&#x27;</span>: <span class="hljs-number">11</span>, <span class="hljs-string">&#x27;text_wrap&#x27;</span>: <span class="hljs-literal">True</span>&#125;)<br>    worksheet1 = writer.sheets[<span class="hljs-string">&#x27;Sheet1&#x27;</span>]<br>    <span class="hljs-keyword">for</span> col_num, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(df.columns.values):<br>        worksheet1.write(<span class="hljs-number">0</span>, col_num, value, col_fmt)<br>    <span class="hljs-comment"># è®¾ç½®åˆ—å®½è¡Œå®½</span><br>    worksheet1.set_column(<span class="hljs-string">&#x27;A:F&#x27;</span>, <span class="hljs-number">20</span>, fmt)<br>    worksheet1.set_row(<span class="hljs-number">0</span>, <span class="hljs-number">30</span>, fmt)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(excel_data)+<span class="hljs-number">1</span>):<br>        worksheet1.set_row(i, <span class="hljs-number">27</span>, detail_fmt)<br><br><br>excel_data = []<br>columns = [<span class="hljs-string">&quot;ç”¨æˆ·&quot;</span>, <span class="hljs-string">&quot;åå­—&quot;</span>, <span class="hljs-string">&quot;æ ‡é¢˜&quot;</span>, <span class="hljs-string">&quot;ç±»&quot;</span>, <span class="hljs-string">&quot;æµ‹è¯•&quot;</span>, <span class="hljs-string">&quot;è¯­è¨€&quot;</span>]<br>tmp = [<span class="hljs-string">&quot;å¼ åŒå­¦&quot;</span>, <span class="hljs-string">&quot;å¼ åŒå­¦&quot;</span>, <span class="hljs-string">&quot;pd ç”Ÿæˆexcel&quot;</span>, <span class="hljs-string">&quot;pandas&quot;</span>, <span class="hljs-string">&quot;pd&quot;</span>, <span class="hljs-string">&quot;python&quot;</span>]<br>excel_data.append(tmp)<br>df = pd.DataFrame(data=excel_data, columns=columns)<br>t = datetime.now().date() - timedelta(days=<span class="hljs-number">1</span>)<br><span class="hljs-keyword">with</span> pd.ExcelWriter(path=<span class="hljs-string">&#x27;demo-%d%02d%02d.xlsx&#x27;</span> % (t.year, t.month, t.day), engine=<span class="hljs-string">&quot;xlsxwriter&quot;</span>) <span class="hljs-keyword">as</span> writer:<br>    df.to_excel(writer, sheet_name=<span class="hljs-string">&#x27;Sheet1&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>, header=<span class="hljs-literal">False</span>, index=<span class="hljs-literal">False</span>, startcol=<span class="hljs-number">0</span>, startrow=<span class="hljs-number">1</span>)<br>    modify_excel_format(excel_data, writer, df)<br>    writer.save()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ok!&#x27;</span>)<br><br></code></pre></td></tr></table></figure><ul><li>æˆ‘çš„blogé“¾æ¥ï¼š<a href="https://waym1ng.github.io/2022/06/26/%E7%94%A8pandas%E7%94%9F%E6%88%90excel%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B%EF%BC%8C%E5%B9%B6%E8%B0%83%E6%95%B4excel%E7%9A%84%E6%A0%BC%E5%BC%8F%E6%88%96%E6%A0%B7%E5%BC%8F/">ç”¨pandasç”Ÿæˆexcelæ–‡ä»¶ç¤ºä¾‹ï¼Œå¹¶è°ƒæ•´excelçš„æ ¼å¼æˆ–æ ·å¼</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pandas python æ•°æ®åˆ†æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python æ—¶é—´æˆ³è½¬æ¢å‡ºé”™</title>
    <link href="/2022/06/20/Python%20%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%8D%A2%E5%87%BA%E9%94%99/"/>
    <url>/2022/06/20/Python%20%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%8D%A2%E5%87%BA%E9%94%99/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><ul><li>å½“æˆ‘ä»¬æƒ³å°†æ—¶é—´æˆ³è½¬æ¢æˆç‰¹å®šæ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚å¸¦æœ‰å¹´æœˆæ—¥ï¼Œä»¥ä¸‹å†™æ³•å¯èƒ½ä¼šå‡ºç°æŠ¥é”™</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">datetime.strftime(datetime.fromtimestamp(<span class="hljs-number">1655481600</span>), <span class="hljs-string">&#x27;%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S&#x27;</span>)<br></code></pre></td></tr></table></figure><blockquote><p>UnicodeEncodeError: â€˜localeâ€™ codec canâ€™t encode character â€˜\u5e74â€™ in position 2: encoding error</p></blockquote><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br>datetime_str = datetime.strftime(datetime.fromtimestamp(<span class="hljs-number">1655481600</span>), <span class="hljs-string">&#x27;%Yn%my%dr %H:%M:%S&#x27;</span>).replace(<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;å¹´&#x27;</span>).replace(<span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;æœˆ&#x27;</span>).replace(<span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;æ—¥&#x27;</span>)<br><span class="hljs-built_in">print</span>(datetime_str) <span class="hljs-comment"># &#x27;2022å¹´06æœˆ18æ—¥ 00:00:00&#x27;</span><br>datetime_str2 = datetime.strftime(datetime.fromtimestamp(<span class="hljs-number">1655481600</span>), <span class="hljs-string">&#x27;%Y&#123;y&#125;%m&#123;m&#125;%d&#123;d&#125; %H:%M:%S&#x27;</span>).<span class="hljs-built_in">format</span>(y=<span class="hljs-string">&#x27;å¹´&#x27;</span>, m=<span class="hljs-string">&#x27;æœˆ&#x27;</span>, d=<span class="hljs-string">&#x27;æ—¥&#x27;</span>)<br><span class="hljs-built_in">print</span>(datetime_str2) <span class="hljs-comment"># &#x27;2022å¹´06æœˆ18æ—¥ 00:00:00&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python try...except...æ—¶æ•è·å¼‚å¸¸æ—¶å…·ä½“æ–‡ä»¶å’Œè¡Œæ•°</title>
    <link href="/2021/07/08/Python%20try...except...%E6%97%B6%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8%E6%97%B6%E5%85%B7%E4%BD%93%E6%96%87%E4%BB%B6%E5%92%8C%E8%A1%8C%E6%95%B0/"/>
    <url>/2021/07/08/Python%20try...except...%E6%97%B6%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8%E6%97%B6%E5%85%B7%E4%BD%93%E6%96%87%E4%BB%B6%E5%92%8C%E8%A1%8C%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">try_exception_test</span>():<br>    <span class="hljs-keyword">try</span>:<br>        a = <span class="hljs-number">0</span><br>        b = <span class="hljs-number">1</span>/a<br>        <span class="hljs-built_in">print</span>(b)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(e)<br>        <span class="hljs-comment"># å‘ç”Ÿå¼‚å¸¸æ‰€åœ¨çš„æ–‡ä»¶</span><br>        <span class="hljs-built_in">print</span>(e.__traceback__.tb_frame.f_globals[<span class="hljs-string">&quot;__file__&quot;</span>])<br>        <span class="hljs-comment"># å‘ç”Ÿå¼‚å¸¸æ‰€åœ¨çš„è¡Œæ•°</span><br>        <span class="hljs-built_in">print</span>(e.__traceback__.tb_lineno)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    try_exception_test()<br></code></pre></td></tr></table></figure><p>æ¨¡æ‹Ÿä¸€æ®µä¼šæŠ›å‡ºå¼‚å¸¸çš„ä»£ç </p><p>æ‰§è¡Œç»“æœï¼š</p><blockquote><p>division by zero<br>C:&#x2F;Users&#x2F;admin01&#x2F;Desktop&#x2F;script&#x2F;demo.py<br>4</p></blockquote><p>å¯ä»¥çœ‹åˆ°æŠ¥é”™åŸå› ä¸º<strong>division by zero</strong></p><p>æ–‡ä»¶ä½ç½®ä¸º<strong>C:&#x2F;Users&#x2F;admin01&#x2F;Desktop&#x2F;script&#x2F;demo.py</strong></p><p>è¡Œæ•°ä¸º<strong>ç¬¬4è¡Œ</strong></p><p>Â è¦æ˜¯ç³»ç»Ÿä¸­ä¸èƒ½å®æ—¶æ‰“å°å‡ºæ¥çš„è¯ï¼Œå¯ä»¥è€ƒè™‘åŠ ä¸ŠÂ <strong>flush&#x3D;True</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(e), flush=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python debug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python åˆ—è¡¨Listè½¬æ¢æˆæ ‘å½¢ç»“æ„</title>
    <link href="/2021/06/22/python%20%E5%88%97%E8%A1%A8List%E8%BD%AC%E6%8D%A2%E6%88%90%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84/"/>
    <url>/2021/06/22/python%20%E5%88%97%E8%A1%A8List%E8%BD%AC%E6%8D%A2%E6%88%90%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><ul><li><strong>åŸå§‹æ•°æ®</strong>ï¼šlistä¸­åµŒå¥—dictçš„æ•°æ®æ ¼å¼</li><li><strong>è½¬æ¢ç»“æœ</strong>ï¼šæ•°ç»“æ„çš„æ•°æ®ï¼Œchildrenå­—æ®µåµŒå¥—çš„å½¢å¼ï¼Œé€‚ç”¨äºå‰ç«¯æ ‘å½¢ç»“æ„çš„æ¸²æŸ“</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">list_to_tree</span>(<span class="hljs-params">data</span>):<br>    root = []<br>    node = []<br><br>    <span class="hljs-comment"># åˆå§‹åŒ–æ•°æ®ï¼Œè·å–æ ¹èŠ‚ç‚¹å’Œå…¶ä»–å­èŠ‚ç‚¹list</span><br>    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> data:<br>        d[<span class="hljs-string">&quot;choice&quot;</span>] = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">if</span> d.get(<span class="hljs-string">&quot;parent_id&quot;</span>) == <span class="hljs-number">0</span>:<br>            root.append(d)<br>        <span class="hljs-keyword">else</span>:<br>            node.append(d)<br>    <span class="hljs-comment"># print(&quot;root----&quot;,root)</span><br>    <span class="hljs-comment"># print(&quot;node----&quot;,node)</span><br>    <span class="hljs-comment"># æŸ¥æ‰¾å­èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> root:<br>        add_node(p, node)<br><br>    <span class="hljs-comment"># æ— å­èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(root) == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> node<br><br>    <span class="hljs-keyword">return</span> root<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_node</span>(<span class="hljs-params">p, node</span>):<br>    <span class="hljs-comment"># å­èŠ‚ç‚¹list</span><br>    p[<span class="hljs-string">&quot;children&quot;</span>] = []<br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> node:<br>        <span class="hljs-keyword">if</span> n.get(<span class="hljs-string">&quot;parent_id&quot;</span>) == p.get(<span class="hljs-string">&quot;theme_id&quot;</span>):<br>            p[<span class="hljs-string">&quot;children&quot;</span>].append(n)<br><br>    <span class="hljs-comment"># é€’å½’å­èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> p[<span class="hljs-string">&quot;children&quot;</span>]:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> t.get(<span class="hljs-string">&quot;children&quot;</span>):<br>            t[<span class="hljs-string">&quot;children&quot;</span>] = []<br>        t[<span class="hljs-string">&quot;children&quot;</span>].append(add_node(t, node))<br><br>    <span class="hljs-comment"># é€€å‡ºé€’å½’çš„æ¡ä»¶</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(p[<span class="hljs-string">&quot;children&quot;</span>]) == <span class="hljs-number">0</span>:<br>        p[<span class="hljs-string">&quot;choice&quot;</span>] = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span><br>      <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>  data_list = [&#123;<span class="hljs-string">&#x27;parent_id&#x27;</span>: <span class="hljs-number">10023</span>, <span class="hljs-string">&#x27;theme_id&#x27;</span>: <span class="hljs-number">10024</span>, <span class="hljs-string">&#x27;theme_name&#x27;</span>: <span class="hljs-string">&#x27;è‹±è¯­ä¸‰çº§&#x27;</span>&#125;,<br>               &#123;<span class="hljs-string">&#x27;parent_id&#x27;</span>: <span class="hljs-number">10022</span>, <span class="hljs-string">&#x27;theme_id&#x27;</span>: <span class="hljs-number">10023</span>, <span class="hljs-string">&#x27;theme_name&#x27;</span>: <span class="hljs-string">&#x27;è‹±è¯­äºŒçº§&#x27;</span>&#125;,<br>               &#123;<span class="hljs-string">&#x27;parent_id&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;theme_id&#x27;</span>: <span class="hljs-number">10025</span>, <span class="hljs-string">&#x27;theme_name&#x27;</span>: <span class="hljs-string">&#x27;è¯­æ–‡ä¸€çº§&#x27;</span>&#125;,<br>               &#123;<span class="hljs-string">&#x27;parent_id&#x27;</span>: <span class="hljs-number">10025</span>, <span class="hljs-string">&#x27;theme_id&#x27;</span>: <span class="hljs-number">10026</span>, <span class="hljs-string">&#x27;theme_name&#x27;</span>: <span class="hljs-string">&#x27;è¯­æ–‡äºŒçº§&#x27;</span>&#125;,<br>               &#123;<span class="hljs-string">&#x27;parent_id&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;theme_id&#x27;</span>: <span class="hljs-number">10022</span>, <span class="hljs-string">&#x27;theme_name&#x27;</span>: <span class="hljs-string">&#x27;è‹±è¯­ä¸€çº§&#x27;</span>&#125;]<br>  data_tree = list_to_tree(data_list)<br>  <span class="hljs-built_in">print</span>(data_tree)<br>  <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">  ç»“æœå¦‚ä¸‹ï¼š</span><br><span class="hljs-string">  [</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    &quot;parent_id&quot;: 0,</span><br><span class="hljs-string">    &quot;theme_id&quot;: 10025,</span><br><span class="hljs-string">    &quot;theme_name&quot;: &quot;è¯­æ–‡ä¸€çº§&quot;,</span><br><span class="hljs-string">    &quot;choice&quot;: 0,</span><br><span class="hljs-string">    &quot;children&quot;: [</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        &quot;parent_id&quot;: 10025,</span><br><span class="hljs-string">        &quot;theme_id&quot;: 10026,</span><br><span class="hljs-string">        &quot;theme_name&quot;: &quot;è¯­æ–‡äºŒçº§&quot;,</span><br><span class="hljs-string">        &quot;choice&quot;: 1,</span><br><span class="hljs-string">        &quot;children&quot;: []</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">  &#125;,</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    &quot;parent_id&quot;: 0,</span><br><span class="hljs-string">    &quot;theme_id&quot;: 10022,</span><br><span class="hljs-string">    &quot;theme_name&quot;: &quot;è‹±è¯­ä¸€çº§&quot;,</span><br><span class="hljs-string">    &quot;choice&quot;: 0,</span><br><span class="hljs-string">    &quot;children&quot;: [</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        &quot;parent_id&quot;: 10022,</span><br><span class="hljs-string">        &quot;theme_id&quot;: 10023,</span><br><span class="hljs-string">        &quot;theme_name&quot;: &quot;è‹±è¯­äºŒçº§&quot;,</span><br><span class="hljs-string">        &quot;choice&quot;: 0,</span><br><span class="hljs-string">        &quot;children&quot;: [</span><br><span class="hljs-string">          &#123;</span><br><span class="hljs-string">            &quot;parent_id&quot;: 10023,</span><br><span class="hljs-string">            &quot;theme_id&quot;: 10024,</span><br><span class="hljs-string">            &quot;theme_name&quot;: &quot;è‹±è¯­ä¸‰çº§&quot;,</span><br><span class="hljs-string">            &quot;choice&quot;: 1,</span><br><span class="hljs-string">            &quot;children&quot;: []</span><br><span class="hljs-string">          &#125;</span><br><span class="hljs-string">        ]</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">  &#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºMySQLçš„ä¼˜åŒ–æ€è·¯</title>
    <link href="/2021/06/11/%E5%85%B3%E4%BA%8EMySQL%E7%9A%84%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF/"/>
    <url>/2021/06/11/%E5%85%B3%E4%BA%8EMySQL%E7%9A%84%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="SQL-ä¼˜åŒ–æ­¥éª¤"><a href="#SQL-ä¼˜åŒ–æ­¥éª¤" class="headerlink" title="SQL ä¼˜åŒ–æ­¥éª¤"></a>SQL ä¼˜åŒ–æ­¥éª¤</h2><p>å½“é¢å¯¹ä¸€ä¸ªéœ€è¦ä¼˜åŒ–çš„ SQL æ—¶ï¼Œæˆ‘ä»¬æœ‰å“ªå‡ ç§æ’æŸ¥æ€è·¯å‘¢ï¼Ÿ</p><h3 id="é€šè¿‡-show-status-å‘½ä»¤äº†è§£-SQL-æ‰§è¡Œæ¬¡æ•°"><a href="#é€šè¿‡-show-status-å‘½ä»¤äº†è§£-SQL-æ‰§è¡Œæ¬¡æ•°" class="headerlink" title="é€šè¿‡ show status å‘½ä»¤äº†è§£ SQL æ‰§è¡Œæ¬¡æ•°"></a>é€šè¿‡ show status å‘½ä»¤äº†è§£ SQL æ‰§è¡Œæ¬¡æ•°</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â <strong>show status</strong>Â å‘½ä»¤æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ã€‚show status å‘½ä»¤ä¼šæ˜¾ç¤ºæ¯ä¸ªæœåŠ¡å™¨å˜é‡ variable_name å’Œ valueï¼ŒçŠ¶æ€å˜é‡æ˜¯åªè¯»çš„ã€‚å¦‚æœä½¿ç”¨ SQL å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ like æˆ–è€… where æ¡ä»¶æ¥é™åˆ¶ç»“æœã€‚like å¯ä»¥å¯¹å˜é‡ååšæ ‡å‡†æ¨¡å¼åŒ¹é…ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/df0228046f8cda9907e2e85259e81bd1.png" alt="å›¾ç‰‡"></p><p>å›¾æˆ‘æ²¡æœ‰æˆªå…¨ï¼Œä¸‹é¢è¿˜æœ‰å¾ˆå¤šå˜é‡ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹ã€‚ä¹Ÿå¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨Â <strong>mysqladmin extended-status</strong>Â å‘½ä»¤æ¥è·å–è¿™äº›æ¶ˆæ¯ã€‚</p><p>ä½†æ˜¯æˆ‘æ‰§è¡Œ mysqladmin extended-status åï¼Œå‡ºç°è¿™ä¸ªé”™è¯¯ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/6e67bbb69e51e9eec7381637972c6ca7.png" alt="å›¾ç‰‡"></p><p>åº”è¯¥æ˜¯æˆ‘æ²¡æœ‰è¾“å…¥å¯†ç çš„åŸå› ï¼Œä½¿ç”¨Â <strong>mysqladmin -P3306 -uroot -p -h127.0.0.1 -r -i 1 extended-status</strong>Â åï¼Œé—®é¢˜è§£å†³ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ show status å‘½ä»¤ä¸­å¯ä»¥æ·»åŠ ç»Ÿè®¡ç»“æœçš„çº§åˆ«ï¼Œè¿™ä¸ªçº§åˆ«æœ‰ä¸¤ä¸ª</p><ul><li><p>session çº§ï¼šé»˜è®¤å½“å‰é“¾æ¥çš„ç»Ÿè®¡ç»“æœ</p></li><li><p>global çº§ï¼šè‡ªæ•°æ®åº“ä¸Šæ¬¡å¯åŠ¨åˆ°ç°åœ¨çš„ç»Ÿè®¡ç»“æœ</p></li></ul><p>å¦‚æœä¸æŒ‡å®šç»Ÿè®¡ç»“æœçº§åˆ«çš„è¯ï¼Œé»˜è®¤ä½¿ç”¨ session çº§åˆ«ã€‚</p><p>å¯¹äº show status æŸ¥è¯¢å‡ºæ¥çš„ç»Ÿè®¡ç»“æœï¼Œæœ‰ä¸¤ç±»å‚æ•°éœ€è¦æ³¨æ„ä¸‹ï¼Œä¸€ç±»æ˜¯ä»¥Â <code>Com_</code>Â ä¸ºå¼€å¤´çš„å‚æ•°ï¼Œä¸€ç±»æ˜¯ä»¥Â <code>Innodb_</code>Â ä¸ºå¼€å¤´çš„å‚æ•°ã€‚</p><p>ä¸‹é¢æ˜¯ Com_ ä¸ºå¼€å¤´çš„å‚æ•°ï¼Œå‚æ•°å¾ˆå¤šï¼Œæˆ‘åŒæ ·æ²¡æœ‰æˆªå…¨ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/fa90d54962f22320be3d3b99bb3b271e.png" alt="å›¾ç‰‡"></p><p>Com_xxx è¡¨ç¤ºçš„æ˜¯æ¯ä¸ª xxx è¯­å¥æ‰§è¡Œçš„æ¬¡æ•°ï¼Œæˆ‘ä»¬é€šå¸¸å…³å¿ƒçš„æ˜¯ select ã€insert ã€updateã€delete è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ï¼Œå³</p><ul><li><p>Com_selectï¼šæ‰§è¡Œ select æ“ä½œçš„æ¬¡æ•°ï¼Œä¸€æ¬¡æŸ¥è¯¢ä¼šä½¿ç»“æœ + 1ã€‚</p></li><li><p>Com_insertï¼šæ‰§è¡Œ INSERT æ“ä½œçš„æ¬¡æ•°ï¼Œå¯¹äºæ‰¹é‡æ’å…¥çš„ INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ã€‚</p></li><li><p>Com_updateï¼šæ‰§è¡Œ UPDATE æ“ä½œçš„æ¬¡æ•°ã€‚</p></li><li><p>Com_deleteï¼šæ‰§è¡Œ DELETE æ“ä½œçš„æ¬¡æ•°ã€‚</p></li></ul><p>ä»¥ Innodb_ ä¸ºå¼€å¤´çš„å‚æ•°ä¸»è¦æœ‰</p><ul><li><p>Innodb_rows_readï¼šæ‰§è¡Œ select æŸ¥è¯¢è¿”å›çš„è¡Œæ•°ã€‚</p></li><li><p>Innodb_rows_insertedï¼šæ‰§è¡Œ INSERT æ“ä½œæ’å…¥çš„è¡Œæ•°ã€‚</p></li><li><p>Innodb_rows_updatedï¼šæ‰§è¡Œ UPDATE æ“ä½œæ›´æ–°çš„è¡Œæ•°ã€‚</p></li><li><p>Innodb_rows_deletedï¼šæ‰§è¡Œ DELETE æ“ä½œåˆ é™¤çš„è¡Œæ•°ã€‚</p></li></ul><p>é€šè¿‡ä¸Šé¢è¿™äº›å‚æ•°æ‰§è¡Œç»“æœçš„ç»Ÿè®¡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¤§è‡´äº†è§£åˆ°å½“å‰æ•°æ®åº“æ˜¯ä»¥æ›´æ–°ï¼ˆåŒ…æ‹¬æ’å…¥ã€åˆ é™¤ï¼‰ä¸ºä¸»è¿˜æ˜¯æŸ¥è¯¢ä¸ºä¸»ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å‚æ•°ç”¨äºäº†è§£æ•°æ®åº“çš„åŸºæœ¬æƒ…å†µã€‚</p><ul><li><p>Connectionsï¼šæŸ¥è¯¢ MySQL æ•°æ®åº“çš„è¿æ¥æ¬¡æ•°ï¼Œè¿™ä¸ªæ¬¡æ•°æ˜¯ä¸ç®¡è¿æ¥æ˜¯å¦æˆåŠŸéƒ½ç®—ä¸Šã€‚</p></li><li><p>Uptimeï¼šæœåŠ¡å™¨çš„å·¥ä½œæ—¶é—´ã€‚</p></li><li><p>Slow_queriesï¼šæ»¡æŸ¥è¯¢æ¬¡æ•°ã€‚</p></li><li><p>Threads_connectedï¼šæŸ¥çœ‹å½“å‰æ‰“å¼€çš„è¿æ¥çš„æ•°é‡ã€‚</p></li></ul><p>ä¸‹é¢è¿™ä¸ªåšå®¢æ±‡æ€»äº†å‡ ä¹æ‰€æœ‰ show status çš„å‚æ•°ï¼Œå¯ä»¥å½“ä½œå‚è€ƒæ‰‹å†Œã€‚</p><p><a href="https://blog.csdn.net/ayay/_870621/article/details/88633092">https://blog.csdn.net/ayay\_870621/article/details/88633092</a></p><h3 id="å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„-SQL"><a href="#å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„-SQL" class="headerlink" title="å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„ SQL"></a>å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„ SQL</h3><p>å®šä½æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒæ…¢çš„ SQL è¯­å¥ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼</p><ul><li>å¯ä»¥é€šè¿‡<strong>æ…¢æŸ¥è¯¢æ—¥å¿—</strong>æ¥å®šä½å“ªäº›æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„ SQL è¯­å¥ã€‚</li></ul><p>MySQL ä¸­æä¾›äº†ä¸€ä¸ªæ…¢æŸ¥è¯¢çš„æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¯ä»¥æŠŠæŸ¥è¯¢ SQL è¯­å¥æ—¶é—´å¤§äºå¤šå°‘ç§’çš„è¯­å¥å†™å…¥æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ—¥å¸¸ç»´æŠ¤ä¸­å¯ä»¥é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—çš„è®°å½•ä¿¡æ¯å¿«é€Ÿå‡†ç¡®åœ°åˆ¤æ–­é—®é¢˜æ‰€åœ¨ã€‚ç”¨ --log-slow-queries é€‰é¡¹å¯åŠ¨æ—¶ï¼Œmysqld ä¼šå†™ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡ long_query_time ç§’çš„ SQL è¯­å¥çš„æ—¥å¿—æ–‡ä»¶ï¼Œé€šè¿‡æŸ¥çœ‹è¿™ä¸ªæ—¥å¿—æ–‡ä»¶å®šä½æ•ˆç‡è¾ƒä½çš„ SQL ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨ my.cnf ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œç„¶åé€€å‡ºé‡å¯ MySQLã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-built_in">log</span>-slow-queriesÂ =Â <span class="hljs-regexp">/tmp/my</span>sql-slow.<span class="hljs-built_in">log</span><br>long_query_timeÂ =Â <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>é€šå¸¸æˆ‘ä»¬è®¾ç½®æœ€é•¿çš„æŸ¥è¯¢æ—¶é—´æ˜¯ 2 ç§’ï¼Œè¡¨ç¤ºæŸ¥è¯¢æ—¶é—´è¶…è¿‡ 2 ç§’å°±è®°å½•äº†ï¼Œé€šå¸¸æƒ…å†µä¸‹ 2 ç§’å°±å¤Ÿäº†ï¼Œç„¶è€Œå¯¹äºå¾ˆå¤š WEB åº”ç”¨æ¥è¯´ï¼Œ2 ç§’æ—¶é—´è¿˜æ˜¯æ¯”è¾ƒé•¿çš„ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤æ¥å¼€å¯ï¼š</p><p>æˆ‘ä»¬å…ˆæŸ¥è¯¢ MySQL æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span>Â variablesÂ <span class="hljs-keyword">like</span>Â &quot;%slow%&quot;;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/f12c417c58bed5de2c46147200cc2906.png" alt="å›¾ç‰‡"></p><p>å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span>Â globalÂ <span class="hljs-attribute">slow_query_log</span>=<span class="hljs-string">&#x27;ON&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/57df048943a64aeb47a71c8fb0fc6877.png" alt="å›¾ç‰‡"></p><p>ç„¶åå†æ¬¡æŸ¥è¯¢æ…¢æŸ¥è¯¢æ˜¯å¦å¼€å¯</p><p><img src="https://img-blog.csdnimg.cn/img_convert/02b2cbe1c1d5839fc921e1be79e48af0.png" alt="å›¾ç‰‡"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å·²ç»å¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚</p><p>æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šåœ¨æŸ¥è¯¢ç»“æŸä»¥åæ‰è®°å½•ï¼Œæ‰€ä»¥åœ¨åº”ç”¨ååº”æ‰§è¡Œæ•ˆç‡å‡ºç°é—®é¢˜çš„æ—¶å€™æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶ä¸èƒ½å®šä½é—®é¢˜ï¼Œæ­¤æ—¶åº”è¯¥ä½¿ç”¨Â <strong>show processlist</strong>Â å‘½ä»¤æŸ¥çœ‹å½“å‰ MySQL æ­£åœ¨è¿›è¡Œçš„çº¿ç¨‹ã€‚åŒ…æ‹¬çº¿ç¨‹çš„çŠ¶æ€ã€æ˜¯å¦é”è¡¨ç­‰ï¼Œå¯ä»¥å®æ—¶çš„æŸ¥çœ‹ SQL æ‰§è¡Œæƒ…å†µã€‚åŒæ ·ï¼Œä½¿ç”¨<strong>mysqladmin processlist</strong>è¯­å¥ä¹Ÿèƒ½å¾—åˆ°æ­¤ä¿¡æ¯ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/8282291cafbc0201bb433c0cae1eb9df.png" alt="å›¾ç‰‡"></p><p>ä¸‹é¢å°±æ¥è§£é‡Šä¸€ä¸‹å„ä¸ªå­—æ®µå¯¹åº”çš„æ¦‚å¿µ</p><ul><li><p>Id ï¼šId å°±æ˜¯ä¸€ä¸ªæ ‡ç¤ºï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨ kill å‘½ä»¤æ€æ­»è¿›ç¨‹çš„æ—¶å€™å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ kill è¿›ç¨‹å·ã€‚</p></li><li><p>Userï¼šæ˜¾ç¤ºå½“å‰çš„ç”¨æˆ·ï¼Œå¦‚æœä¸æ˜¯ rootï¼Œè¿™ä¸ªå‘½ä»¤å°±åªæ˜¾ç¤ºä½ æƒé™èŒƒå›´å†…çš„ SQL è¯­å¥ã€‚</p></li><li><p>Hostï¼šæ˜¾ç¤º IP ï¼Œç”¨äºè¿½è¸ªé—®é¢˜</p></li><li><p>Dbï¼šæ˜¾ç¤ºè¿™ä¸ªè¿›ç¨‹ç›®å‰è¿æ¥çš„æ˜¯å“ªä¸ªæ•°æ®åº“ï¼Œä¸º null æ˜¯è¿˜æ²¡æœ‰ select æ•°æ®åº“ã€‚</p></li><li><p>Commandï¼šæ˜¾ç¤ºå½“å‰è¿æ¥é”æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸€èˆ¬æœ‰ä¸‰ç§ï¼šæŸ¥è¯¢ queryï¼Œä¼‘çœ  sleepï¼Œè¿æ¥ connectã€‚</p></li><li><p>Timeï¼šè¿™ä¸ªçŠ¶æ€æŒç»­çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’</p></li><li><p>Stateï¼šæ˜¾ç¤ºå½“å‰ SQL è¯­å¥çš„çŠ¶æ€ï¼Œéå¸¸é‡è¦ï¼Œä¸‹é¢ä¼šå…·ä½“è§£é‡Šã€‚</p></li><li><p>Infoï¼šæ˜¾ç¤ºè¿™ä¸ª SQL è¯­å¥ã€‚</p></li></ul><p>State åˆ—éå¸¸é‡è¦ï¼Œå…³äºè¿™ä¸ªåˆ—çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œè¯»è€…å¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ç¯‡æ–‡ç« </p><p><a href="https://blog.csdn.net/weixin/_34357436/article/details/91768402">https://blog.csdn.net/weixin\_34357436/article/details/91768402</a></p><p>è¿™é‡Œé¢æ¶‰åŠçº¿ç¨‹çš„çŠ¶æ€ã€æ˜¯å¦é”è¡¨ç­‰é€‰é¡¹ï¼Œå¯ä»¥å®æ—¶çš„æŸ¥çœ‹ SQL çš„æ‰§è¡Œæƒ…å†µï¼ŒåŒæ—¶å¯¹ä¸€äº›é”è¡¨è¿›è¡Œä¼˜åŒ–ã€‚</p><h3 id="é€šè¿‡-EXPLAIN-å‘½ä»¤åˆ†æ-SQL-çš„æ‰§è¡Œè®¡åˆ’"><a href="#é€šè¿‡-EXPLAIN-å‘½ä»¤åˆ†æ-SQL-çš„æ‰§è¡Œè®¡åˆ’" class="headerlink" title="é€šè¿‡ EXPLAIN å‘½ä»¤åˆ†æ SQL çš„æ‰§è¡Œè®¡åˆ’"></a>é€šè¿‡ EXPLAIN å‘½ä»¤åˆ†æ SQL çš„æ‰§è¡Œè®¡åˆ’</h3><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤æŸ¥è¯¢åˆ°æ•ˆç‡ä½çš„ SQL è¯­å¥åï¼Œå¯ä»¥é€šè¿‡ EXPLAIN æˆ–è€… DESC å‘½ä»¤è·å– MySQL å¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ¨ SELECT è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­è¡¨å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåºã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢è¿™æ¡ SQL è¯­å¥æ¥åˆ†æä¸€ä¸‹æ‰§è¡Œè®¡åˆ’</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â test1;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/230949e49f2eb9f0d75b11f6e3722df8.png" alt="å›¾ç‰‡"></p><p>ä¸Šè¡¨ä¸­æ¶‰åŠå†…å®¹å¦‚ä¸‹</p><ul><li>select_typeï¼šè¡¨ç¤ºå¸¸è§çš„ SELECT ç±»å‹ï¼Œå¸¸è§çš„æœ‰ SIMPLEï¼ŒSIMPLE è¡¨ç¤ºçš„æ˜¯ç®€å•çš„ SQL è¯­å¥ï¼Œä¸åŒ…æ‹¬ UNION æˆ–è€…å­æŸ¥è¯¢æ“ä½œï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µå°±æ˜¯ SIMPLE ç±»å‹ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/9c620f1fa2648014b79e1eb39d81da85.png" alt="å›¾ç‰‡"></p><p>PRIMARY ï¼ŒæŸ¥è¯¢ä¸­æœ€å¤–å±‚çš„ SELECTï¼ˆå¦‚ä¸¤è¡¨åš UNION æˆ–è€…å­˜åœ¨å­æŸ¥è¯¢çš„å¤–å±‚çš„è¡¨æ“ä½œä¸º PRIMARYï¼Œå†…å±‚çš„æ“ä½œä¸º UNIONï¼‰ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µå­æŸ¥è¯¢ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/dcf7088fa50d696761693cf128fecc2c.png" alt="å›¾ç‰‡"></p><p>UNIONï¼Œåœ¨ UNION æ“ä½œä¸­ï¼ŒæŸ¥è¯¢ä¸­å¤„äºå†…å±‚çš„ SELECTï¼ˆå†…å±‚çš„ SELECT è¯­å¥ä¸å¤–å±‚çš„ SELECT è¯­å¥æ²¡æœ‰ä¾èµ–å…³ç³»æ—¶ï¼‰ã€‚</p><p>SUBQUERYï¼šå­æŸ¥è¯¢ä¸­é¦–ä¸ªSELECTï¼ˆå¦‚æœæœ‰å¤šä¸ªå­æŸ¥è¯¢å­˜åœ¨ï¼‰ï¼Œå¦‚æˆ‘ä»¬ä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ï¼Œå­æŸ¥è¯¢ç¬¬ä¸€ä¸ªæ˜¯ srï¼ˆsys_roleï¼‰è¡¨ï¼Œæ‰€ä»¥å®ƒçš„ select_type æ˜¯ SUBQUERYã€‚</p><ul><li><p>table ï¼Œè¿™ä¸ªé€‰é¡¹è¡¨ç¤ºè¾“å‡ºç»“æœé›†çš„è¡¨ã€‚</p></li><li><p>typeï¼Œè¿™ä¸ªé€‰é¡¹è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹ï¼Œè¿™ä¸ªé€‰é¡¹å¾ˆæœ‰æ·±å…¥ç ”ç©¶çš„ä»·å€¼ï¼Œå› ä¸ºå¾ˆå¤š SQL çš„è°ƒä¼˜éƒ½æ˜¯å›´ç»• type æ¥è®²çš„ï¼Œä½†æ˜¯è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä¸»è¦å›´ç»•ä¼˜åŒ–æ–¹å¼æ¥å±•å¼€çš„ï¼Œtype è¿™ä¸ªå­—æ®µæˆ‘ä»¬æš‚æ—¶ä½œä¸ºäº†è§£ï¼Œè¿™ç¯‡æ–‡ç« ä¸è¿‡å¤šæ·±å…¥ã€‚</p><p>type è¿™ä¸ªå­—æ®µä¼šç‰µæ‰¯åˆ°è¿æ¥çš„æ€§èƒ½ï¼Œå®ƒçš„ä¸åŒç±»å‹çš„æ€§èƒ½ç”±å¥½åˆ°å·®åˆ†åˆ«æ˜¯</p><p>system ï¼šè¡¨ä¸­ä»…æœ‰ä¸€æ¡æ•°æ®æ—¶ï¼Œè¯¥è¡¨çš„æŸ¥è¯¢å°±åƒæŸ¥è¯¢å¸¸é‡è¡¨ä¸€æ ·ã€‚</p><p>const ï¼šå½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•åŒ¹é…æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨äº†è¡¨ä¸»é”®ï¼ˆprimary keyï¼‰æˆ–è€…è¡¨å”¯ä¸€ç´¢å¼•ï¼ˆunique indexï¼‰è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>eq-ref ï¼šè¡¨ç¤ºå¤šè¡¨è¿æ¥æ—¶ä½¿ç”¨è¡¨ä¸»é”®æˆ–è€…è¡¨å”¯ä¸€ç´¢å¼•ï¼Œæ¯”å¦‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span>Â A.text,Â B.textÂ <span class="hljs-keyword">where</span>Â A.IDÂ =Â B.ID<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå¯¹äº A è¡¨ä¸­çš„æ¯ä¸€ä¸ª ID è¡Œï¼ŒB è¡¨ä¸­éƒ½åªèƒ½æœ‰å”¯ä¸€çš„ B.Id æ¥è¿›è¡ŒåŒ¹é…æ—¶ã€‚</p><p>ref ï¼šè¿™ä¸ªç±»å‹ä¸å¦‚ä¸Šé¢çš„ eq-ref å¿«ï¼Œå› ä¸ºå®ƒè¡¨ç¤ºçš„æ˜¯å› ä¸ºå¯¹äºè¡¨ A ä¸­æ‰«æçš„æ¯ä¸€è¡Œï¼Œè¡¨ C ä¸­æœ‰å‡ ä¸ªå¯èƒ½çš„è¡Œï¼ŒC.ID ä¸æ˜¯å”¯ä¸€çš„ã€‚</p><p>ref_or_null ï¼šä¸ ref ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™ä¸ªé€‰é¡¹åŒ…å«å¯¹ NULL çš„æŸ¥è¯¢ã€‚</p><p>index_merge ï¼šæŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†ä¸¤ä¸ªä»¥ä¸Šçš„ç´¢å¼•ï¼Œæ¯”å¦‚ç»å¸¸åœ¨æœ‰ and å’Œ or å…³é”®å­—å‡ºç°çš„åœºæ™¯ï¼Œä½†æ˜¯åœ¨ç”±äº<strong>è¯»å–ç´¢å¼•è¿‡å¤š</strong>å¯¼è‡´å…¶æ€§èƒ½æœ‰å¯èƒ½è¿˜ä¸å¦‚ rangeï¼ˆåé¢è¯´ï¼‰ã€‚</p><p>unique_subquery ï¼šè¿™ä¸ªé€‰é¡¹ç»å¸¸ç”¨åœ¨ in å…³é”®å­—åé¢ï¼Œå­æŸ¥è¯¢å¸¦æœ‰ where å…³é”®å­—çš„å­æŸ¥è¯¢ä¸­ï¼Œç”¨ sql æ¥è¡¨ç¤ºå°±æ˜¯è¿™æ ·</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">valueÂ INÂ (<span class="hljs-keyword">SELECT</span>Â primary_keyÂ <span class="hljs-keyword">FROM</span>Â single_tableÂ <span class="hljs-keyword">WHERE</span>Â some_expr)<br></code></pre></td></tr></table></figure><p>range ï¼š<strong>ç´¢å¼•èŒƒå›´æŸ¥è¯¢</strong>ï¼Œå¸¸è§äºä½¿ç”¨ &#x3D;ï¼Œ&lt;&gt;ï¼Œ&gt;ï¼Œ&gt;&#x3D;ï¼Œ&lt;ï¼Œ&lt;&#x3D;ï¼ŒIS NULLï¼Œ&lt;&#x3D;&gt;ï¼ŒBETWEENï¼ŒIN() æˆ–è€… like ç­‰è¿ç®—ç¬¦çš„æŸ¥è¯¢ä¸­ã€‚</p><p>index ï¼šç´¢å¼•å…¨è¡¨æ‰«æï¼ŒæŠŠç´¢å¼•ä»å¤´åˆ°å°¾æ‰«ä¸€éã€‚</p><p>all ï¼šè¿™ä¸ªæˆ‘ä»¬æ¥è§¦çš„æœ€å¤šäº†ï¼Œå°±æ˜¯å…¨è¡¨æŸ¥è¯¢ï¼Œselect * from xxx ï¼Œæ€§èƒ½æœ€å·®ã€‚</p></li></ul><p>ä¸Šé¢å°±æ˜¯ type å†…å®¹çš„å¤§è‡´è§£é‡Šï¼Œå…³äº type æˆ‘ä»¬ç»å¸¸ä¼šåœ¨ SQL è°ƒä¼˜çš„ç¯èŠ‚ä½¿ç”¨ explain åˆ†æå…¶ç±»å‹ï¼Œç„¶åæ”¹è¿›æŸ¥è¯¢æ–¹å¼ï¼Œè¶Šé è¿‘ system å…¶æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œè¶Šé è¿‘ all å…¶æŸ¥è¯¢æ•ˆç‡è¶Šä½ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/af5bfcb5d65e0f0c7dec14a89a23d81e.png" alt="å›¾ç‰‡"></p><ul><li><p>possible_keys ï¼šè¡¨ç¤ºæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•ã€‚</p></li><li><p>key ï¼šè¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚</p></li><li><p>key_len ï¼šç´¢å¼•å­—æ®µçš„é•¿åº¦ã€‚</p></li><li><p>rows ï¼šæ‰«æè¡Œçš„æ•°é‡ã€‚</p></li><li><p>filtered ï¼šé€šè¿‡æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢å‡ºæ¥çš„ SQL æ•°é‡å ç”¨æ€»è¡Œæ•°çš„æ¯”ä¾‹ã€‚</p></li><li><p>extra ï¼šæ‰§è¡Œæƒ…å†µçš„æè¿°ã€‚</p></li></ul><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´ç¡®å®š SQL æ•ˆç‡ä½çš„åŸå› ï¼Œä¸€ç§éå¸¸æœ‰æ•ˆçš„æå‡ SQL æŸ¥è¯¢æ•ˆç‡çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ç´¢å¼•ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šè®²è§£ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ç´¢å¼•æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p>ç´¢å¼•æ˜¯æ•°æ®åº“ä¼˜åŒ–ä¸­æœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€é‡è¦çš„æ‰‹æ®µï¼Œé€šè¿‡ä½¿ç”¨ä¸åŒçš„ç´¢å¼•å¯ä»¥è§£å†³å¤§å¤šæ•° SQL æ€§èƒ½é—®é¢˜ï¼Œä¹Ÿæ˜¯é¢è¯•ç»å¸¸ä¼šé—®åˆ°çš„ä¼˜åŒ–æ–¹å¼ï¼Œå›´ç»•ç€ç´¢å¼•ï¼Œé¢è¯•å®˜èƒ½è®©ä½ é€ å‡ºç«ç®­æ¥ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ç‚¹å°±æ˜¯ç´¢å¼•éå¸¸éå¸¸é‡ï¼è¦ï¼ä¸åªæ˜¯ä½¿ç”¨ï¼Œä½ è¿˜è¦æ‡‚å…¶åŸï¼ç†ï¼</p><h3 id="ç´¢å¼•ä»‹ç»"><a href="#ç´¢å¼•ä»‹ç»" class="headerlink" title="ç´¢å¼•ä»‹ç»"></a>ç´¢å¼•ä»‹ç»</h3><p>ç´¢å¼•çš„ç›®çš„å°±æ˜¯ç”¨äºå¿«é€ŸæŸ¥æ‰¾æŸä¸€åˆ—çš„æ•°æ®ï¼Œå¯¹ç›¸å…³æ•°æ®åˆ—ä½¿ç”¨ç´¢å¼•èƒ½å¤Ÿå¤§å¤§æé«˜æŸ¥è¯¢æ“ä½œçš„æ€§èƒ½ã€‚ä¸ä½¿ç”¨ç´¢å¼•ï¼ŒMySQL å¿…é¡»ä»ç¬¬ä¸€æ¡è®°å½•å¼€å§‹è¯»å®Œæ•´ä¸ªè¡¨ï¼Œç›´åˆ°æ‰¾å‡ºç›¸å…³çš„è¡Œï¼Œè¡¨è¶Šå¤§æŸ¥è¯¢æ•°æ®æ‰€èŠ±è´¹çš„æ—¶é—´å°±è¶Šå¤šã€‚å¦‚æœè¡¨ä¸­æŸ¥è¯¢çš„åˆ—æœ‰ç´¢å¼•ï¼ŒMySQL èƒ½å¤Ÿå¿«é€Ÿåˆ°è¾¾ä¸€ä¸ªä½ç½®å»æœç´¢æ•°æ®æ–‡ä»¶ï¼Œè€Œä¸å¿…æŸ¥çœ‹æ‰€æœ‰æ•°æ®ï¼Œé‚£ä¹ˆå°†ä¼šèŠ‚çœå¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´ã€‚</p><h3 id="ç´¢å¼•åˆ†ç±»"><a href="#ç´¢å¼•åˆ†ç±»" class="headerlink" title="ç´¢å¼•åˆ†ç±»"></a>ç´¢å¼•åˆ†ç±»</h3><p>å…ˆæ¥äº†è§£ä¸€ä¸‹ç´¢å¼•éƒ½æœ‰å“ªäº›åˆ†ç±»ã€‚</p><ul><li><p><code>å…¨å±€ç´¢å¼•(FULLTEXT)</code>ï¼šå…¨å±€ç´¢å¼•ï¼Œç›®å‰åªæœ‰ MyISAM å¼•æ“æ”¯æŒå…¨å±€ç´¢å¼•ï¼Œå®ƒçš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³é’ˆå¯¹æ–‡æœ¬çš„æ¨¡ç³ŠæŸ¥è¯¢æ•ˆç‡è¾ƒä½çš„é—®é¢˜ï¼Œå¹¶ä¸”åªé™äº CHARã€VARCHAR å’Œ TEXT åˆ—ã€‚</p></li><li><p><code>å“ˆå¸Œç´¢å¼•(HASH)</code>ï¼šå“ˆå¸Œç´¢å¼•æ˜¯ MySQL ä¸­ç”¨åˆ°çš„å”¯ä¸€ key-value é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œå¾ˆé€‚åˆä½œä¸ºç´¢å¼•ã€‚HASH ç´¢å¼•å…·æœ‰ä¸€æ¬¡å®šä½çš„å¥½å¤„ï¼Œä¸éœ€è¦åƒæ ‘é‚£æ ·é€ä¸ªèŠ‚ç‚¹æŸ¥æ‰¾ï¼Œä½†æ˜¯è¿™ç§æŸ¥æ‰¾é€‚åˆåº”ç”¨äºæŸ¥æ‰¾å•ä¸ªé”®çš„æƒ…å†µï¼Œå¯¹äºèŒƒå›´æŸ¥æ‰¾ï¼ŒHASH ç´¢å¼•çš„æ€§èƒ½å°±ä¼šå¾ˆä½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMEMORY å­˜å‚¨å¼•æ“ä½¿ç”¨ HASH ç´¢å¼•ï¼Œä½†ä¹Ÿæ”¯æŒ BTREE ç´¢å¼•ã€‚</p></li><li><p><code>B-Tree ç´¢å¼•</code>ï¼šB å°±æ˜¯ Balance çš„æ„æ€ï¼ŒBTree æ˜¯ä¸€ç§å¹³è¡¡æ ‘ï¼Œå®ƒæœ‰å¾ˆå¤šå˜ç§ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ B+ Treeï¼Œå®ƒè¢« MySQL å¹¿æ³›ä½¿ç”¨ã€‚</p></li><li><p><code>R-Tree ç´¢å¼•</code>ï¼šR-Tree åœ¨ MySQL å¾ˆå°‘ä½¿ç”¨ï¼Œä»…æ”¯æŒ geometry æ•°æ®ç±»å‹ï¼Œæ”¯æŒè¯¥ç±»å‹çš„å­˜å‚¨å¼•æ“åªæœ‰MyISAMã€BDbã€InnoDbã€NDbã€Archiveå‡ ç§ï¼Œç›¸å¯¹äº B-Tree æ¥è¯´ï¼ŒR-Tree çš„ä¼˜åŠ¿åœ¨äºèŒƒå›´æŸ¥æ‰¾ã€‚</p></li></ul><p>ä»é€»è¾‘ä¸Šæ¥å¯¹ MySQL è¿›è¡Œåˆ†ç±»ï¼Œä¸»è¦åˆ†ä¸ºä¸‹é¢è¿™å‡ ç§</p><ul><li><p>æ™®é€šç´¢å¼•ï¼šæ™®é€šç´¢å¼•æ˜¯æœ€åŸºç¡€çš„ç´¢å¼•ç±»å‹ï¼Œå®ƒæ²¡æœ‰ä»»ä½•é™åˆ¶ ã€‚åˆ›å»ºæ–¹å¼å¦‚ä¸‹</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">create</span>Â <span class="hljs-keyword">index</span>Â normal_indexÂ <span class="hljs-keyword">on</span>Â cxuan003(id);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/ff83638300efddbf54bba53bc5591f72.png" alt="å›¾ç‰‡"></p><p>åˆ é™¤æ–¹å¼</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">drop</span>Â <span class="hljs-keyword">index</span>Â normal_indexÂ <span class="hljs-keyword">on</span>Â cxuan003;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/3d1e28a09fda0bd1320bcf7a7d8e535f.png" alt="å›¾ç‰‡"></p></li><li><p>å”¯ä¸€ç´¢å¼•ï¼šå”¯ä¸€ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸æœ‰ç©ºå€¼ï¼Œå¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œåˆ™åˆ—å€¼çš„ç»„åˆå¿…é¡»å”¯ä¸€ï¼Œåˆ›å»ºæ–¹å¼å¦‚ä¸‹</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">create</span>Â <span class="hljs-keyword">unique</span>Â <span class="hljs-keyword">index</span>Â normal_indexÂ <span class="hljs-keyword">on</span>Â cxuan003(id);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/3197d902b85441d79053985591791795.png" alt="å›¾ç‰‡"></p></li><li><p>ä¸»é”®ç´¢å¼•ï¼šæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç´¢å¼•ï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œä¸å…è®¸æœ‰ç©ºå€¼ã€‚ä¸€èˆ¬æ˜¯åœ¨å»ºè¡¨çš„æ—¶å€™åŒæ—¶åˆ›å»ºä¸»é”®ç´¢å¼•ã€‚</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â <span class="hljs-keyword">table</span>Â (<br>Â Â Â Â Â Â Â idÂ <span class="hljs-meta">int</span>(11)Â <span class="hljs-keyword">NOT</span>Â <span class="hljs-keyword">NULL</span>Â AUTO_INCREMENTÂ ,<br>Â Â Â Â Â Â Â <span class="hljs-keyword">title</span>Â char(255)Â <span class="hljs-keyword">NOT</span>Â <span class="hljs-keyword">NULL</span>Â ,<br>Â Â Â Â Â Â Â <span class="hljs-keyword">PRIMARY</span>Â <span class="hljs-keyword">KEY</span>Â (id)<br>)<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/3065fc966d06bd2c9fd82265328109fd.png" alt="å›¾ç‰‡"></p></li><li><p>ç»„åˆç´¢å¼•ï¼šæŒ‡å¤šä¸ªå­—æ®µä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼Œåªæœ‰åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨äº†åˆ›å»ºç´¢å¼•æ—¶çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œç´¢å¼•æ‰ä¼šè¢«ä½¿ç”¨ã€‚ä½¿ç”¨ç»„åˆç´¢å¼•æ—¶éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œä¸‹é¢æˆ‘ä»¬å°±ä¼šåˆ›å»ºç»„åˆç´¢å¼•ã€‚</p></li><li><p>å…¨æ–‡ç´¢å¼•ï¼šä¸»è¦ç”¨æ¥æŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®å­—ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸ç´¢å¼•ä¸­çš„å€¼ç›¸æ¯”è¾ƒï¼Œç›®å‰åªæœ‰ charã€varcharï¼Œtext åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼Œåˆ›å»ºè¡¨çš„é€‚åˆæ·»åŠ å…¨æ–‡ç´¢å¼•</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â <span class="hljs-keyword">table</span>Â (<br>Â Â idÂ <span class="hljs-type">int</span>(<span class="hljs-number">11</span>)Â <span class="hljs-keyword">NOT</span>Â <span class="hljs-keyword">NULL</span>Â AUTO_INCREMENTÂ ,<br>Â Â titleÂ <span class="hljs-type">char</span>(<span class="hljs-number">255</span>)Â <span class="hljs-type">CHARACTER</span>Â <span class="hljs-keyword">NOT</span>Â <span class="hljs-keyword">NULL</span>Â ,<br>Â Â contentÂ <span class="hljs-type">text</span>Â <span class="hljs-type">CHARACTER</span>Â <span class="hljs-keyword">NULL</span>Â ,<br>Â Â <span class="hljs-type">time</span>Â <span class="hljs-type">int</span>(<span class="hljs-number">10</span>)Â <span class="hljs-keyword">NULL</span>Â <span class="hljs-keyword">DEFAULT</span>Â <span class="hljs-keyword">NULL</span>Â ,<br>Â Â <span class="hljs-keyword">PRIMARYÂ KEY</span>Â (id),<br>Â Â FULLTEXTÂ (content)<br>);<br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åˆ›å»ºå…¨å±€ç´¢å¼•</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span>Â FULLTEXTÂ <span class="hljs-keyword">INDEX</span>Â index_contentÂ <span class="hljs-keyword">ON</span>Â article(content)<br></code></pre></td></tr></table></figure></li></ul><h3 id="ç´¢å¼•ä½¿ç”¨"><a href="#ç´¢å¼•ä½¿ç”¨" class="headerlink" title="ç´¢å¼•ä½¿ç”¨"></a>ç´¢å¼•ä½¿ç”¨</h3><p>ç´¢å¼•å¯ä»¥åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™è¿›è¡Œåˆ›å»ºï¼Œä¹Ÿå¯ä»¥å•ç‹¬åˆ›å»ºï¼Œä¸‹é¢æˆ‘ä»¬é‡‡ç”¨å•ç‹¬åˆ›å»ºçš„æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨ cxuan004 ä¸Šåˆ›å»ºå‰ç¼€ç´¢å¼•</p><p><img src="https://img-blog.csdnimg.cn/img_convert/86c710e974bff5efb1e3372a8c506064.png" alt="å›¾ç‰‡"></p><p>æˆ‘ä»¬ä½¿ç”¨Â <code>explain</code>Â è¿›è¡Œåˆ†æï¼Œå¯ä»¥çœ‹åˆ° cxuan004 ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ</p><p><img src="https://img-blog.csdnimg.cn/img_convert/92302060148d81ac76058bb9ed59c8fe.png" alt="å›¾ç‰‡"></p><p>å¦‚æœä¸æƒ³ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥åˆ é™¤ç´¢å¼•ï¼Œç´¢å¼•çš„åˆ é™¤è¯­æ³•æ˜¯</p><p><img src="https://img-blog.csdnimg.cn/img_convert/b1a310a78ad59670f45c6a5ceac8bc50.png" alt="å›¾ç‰‡"></p><p>ç´¢å¼•ä½¿ç”¨ç»†åˆ™</p><p>æˆ‘ä»¬åœ¨ cxuan005 ä¸Šæ ¹æ® id å’Œ hash åˆ›å»ºä¸€ä¸ªå¤åˆç´¢å¼•ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">create</span>Â <span class="hljs-keyword">index</span>Â id_hash_indexÂ <span class="hljs-keyword">on</span>Â cxuan005(id,hash);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/ed7f8f7a8ce5c011f8ba3b7caad5bba9.png" alt="å›¾ç‰‡"></p><p>ç„¶åæ ¹æ® id è¿›è¡Œæ‰§è¡Œè®¡åˆ’çš„åˆ†æ</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â cxuan005Â <span class="hljs-keyword">where</span>Â idÂ =Â <span class="hljs-string">&#x27;333&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/c7bb3dc5a8850093384c494bf6bb0b2f.png" alt="å›¾ç‰‡"></p><p>å¯ä»¥å‘ç°ï¼Œå³ä½¿ where æ¡ä»¶ä¸­ä½¿ç”¨çš„ä¸æ˜¯å¤åˆç´¢å¼•ï¼ˆId ã€hashï¼‰ï¼Œç´¢å¼•ä»ç„¶èƒ½å¤Ÿä½¿ç”¨ï¼Œè¿™å°±æ˜¯ç´¢å¼•çš„å‰ç¼€ç‰¹æ€§ã€‚ä½†æ˜¯å¦‚æœåªæŒ‰ç…§ hash è¿›è¡ŒæŸ¥è¯¢çš„è¯ï¼Œç´¢å¼•å°±ä¸ä¼šç”¨åˆ°ã€‚</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â cxuan005Â <span class="hljs-keyword">where</span>Â hash=<span class="hljs-string">&#x27;8fd1f12575f6b39ee7c6d704eb54b353&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/2504cc78a4038c352b893c8605091846.png" alt="å›¾ç‰‡"></p><p>å¦‚æœ where æ¡ä»¶ä½¿ç”¨äº† like æŸ¥è¯¢ï¼Œå¹¶ä¸”Â <code>%</code>Â ä¸åœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œç´¢å¼•æ‰å¯èƒ½è¢«ä½¿ç”¨ã€‚</p><p>å¯¹äºå¤åˆç´¢å¼•æ¥è¯´ï¼Œåªèƒ½ä½¿ç”¨ id è¿›è¡Œ like æŸ¥è¯¢ï¼Œå› ä¸º hash åˆ—ä¸ç®¡æ€ä¹ˆæŸ¥è¯¢éƒ½ä¸ä¼šèµ°ç´¢å¼•ã€‚</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â cxuan005Â <span class="hljs-keyword">where</span>Â idÂ <span class="hljs-keyword">like</span>Â <span class="hljs-string">&#x27;%1&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/d07b9c45713b4066fd774cf73e6e7102.png" alt="å›¾ç‰‡"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ % ï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â cxuan005Â <span class="hljs-keyword">where</span>Â idÂ <span class="hljs-keyword">like</span>Â <span class="hljs-string">&#x27;1%&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/a8a2f477fd83cba63b1035686183b0d1.png" alt="å›¾ç‰‡"></p><p>å¦‚æœä½¿ç”¨äº† % å·ï¼Œå°±ä¼šè§¦å‘ç´¢å¼•ã€‚</p><p>å¦‚æœåˆ—åæ˜¯ç´¢å¼•çš„è¯ï¼Œé‚£ä¹ˆå¯¹åˆ—åè¿›è¡Œ NULL æŸ¥è¯¢ï¼Œå°†ä¼šè§¦å‘ç´¢å¼•ã€‚</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â cxuan005Â <span class="hljs-keyword">where</span>Â idÂ <span class="hljs-keyword">is</span>Â <span class="hljs-literal">null</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210611153727568.gif"></p><p>è¿˜æœ‰ä¸€äº›æƒ…å†µæ˜¯å­˜åœ¨ç´¢å¼•ä½†æ˜¯ MySQL å¹¶ä¸ä¼šä½¿ç”¨çš„æƒ…å†µã€‚</p><ul><li><p>æœ€ç®€å•çš„ï¼Œå¦‚æœä½¿ç”¨ç´¢å¼•åæ¯”ä¸ä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¿˜å·®ï¼Œé‚£ä¹ˆ MySQL å°±ä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚</p></li><li><p>å¦‚æœ SQL ä¸­ä½¿ç”¨äº† OR æ¡ä»¶ï¼ŒOR å‰çš„æ¡ä»¶åˆ—æœ‰ç´¢å¼•ï¼Œè€Œåé¢çš„åˆ—æ²¡æœ‰ç´¢å¼•çš„è¯ï¼Œé‚£ä¹ˆæ¶‰åŠåˆ°çš„ç´¢å¼•éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ¯”å¦‚ cxuan005 è¡¨ä¸­ï¼Œåªæœ‰ id å’Œ hash å­—æ®µæœ‰ç´¢å¼•ï¼Œè€Œ info å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨ or è¿›è¡ŒæŸ¥è¯¢ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â cxuan005Â <span class="hljs-keyword">where</span>Â idÂ =Â <span class="hljs-number">111</span>Â <span class="hljs-keyword">and</span>Â <span class="hljs-keyword">info</span>Â =Â <span class="hljs-string">&#x27;cxuan&#x27;</span>;<br></code></pre></td></tr></table></figure></li></ul><p><img src="https://img-blog.csdnimg.cn/20210611153727569.gif"></p><ul><li><p>æˆ‘ä»¬ä» explain çš„æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ possible_keys é€‰é¡¹ä¸Šä»ç„¶æœ‰ id_hash_index ç´¢å¼•ï¼Œä½†æ˜¯ä» keyã€key_len å¯ä»¥å¾—çŸ¥ï¼Œè¿™æ¡ SQL è¯­å¥å¹¶æœªä½¿ç”¨ç´¢å¼•ã€‚</p></li><li><p>åœ¨å¸¦æœ‰å¤åˆç´¢å¼•çš„åˆ—ä¸ŠæŸ¥è¯¢ä¸æ˜¯ç¬¬ä¸€åˆ—çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â cxuan005Â <span class="hljs-keyword">where</span>Â hashÂ =Â <span class="hljs-string">&#x27;8fd1f12575f6b39ee7c6d704eb54b353&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/03a58d6c271ce79e80e7ad48db23fa34.png" alt="å›¾ç‰‡"></p></li><li><p>å¦‚æœ where æ¡ä»¶çš„åˆ—å‚ä¸äº†è®¡ç®—ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šä½¿ç”¨ç´¢å¼•</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â cxuan005Â <span class="hljs-keyword">where</span>Â idÂ +Â <span class="hljs-string">&#x27;111&#x27;</span>Â =Â <span class="hljs-string">&#x27;666&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/2721d3543748ece8a0a046effd71063b.png" alt="å›¾ç‰‡"></p></li><li><p>ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°ï¼Œä¸€æ ·ä¹Ÿä¸ä¼šä½¿ç”¨ç´¢å¼•</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">explain</span>Â <span class="hljs-keyword">select</span>Â *Â <span class="hljs-keyword">from</span>Â cxuan005Â <span class="hljs-keyword">where</span>Â concat(id,<span class="hljs-string">&#x27;111&#x27;</span>)Â =Â <span class="hljs-string">&#x27;666&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/ec5086d89874bafb56117264df1dbe62.png" alt="å›¾ç‰‡"></p></li><li><p>ç´¢å¼•åˆ—ä½¿ç”¨äº† like ï¼Œå¹¶ä¸”Â <code>%</code>Â ä½äºç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™ä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚</p></li><li><p>åœ¨ order by æ“ä½œä¸­ï¼Œæ’åºçš„åˆ—åŒæ—¶ä¹Ÿåœ¨ where è¯­å¥ä¸­ï¼Œå°†ä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚</p></li><li><p>å½“æ•°æ®ç±»å‹å‡ºç°éšå¼è½¬æ¢æ—¶ï¼Œæ¯”å¦‚ varchar ä¸åŠ å•å¼•å·å¯èƒ½è½¬æ¢ä¸º int ç±»å‹æ—¶ï¼Œä¼šä½¿ç´¢å¼•æ— æ•ˆï¼Œè§¦å‘å…¨è¡¨æ‰«æã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸¤ä¸ªä¾‹å­èƒ½å¤Ÿæ˜¾è€Œæ˜“è§çš„è¯´æ˜è¿™ä¸€ç‚¹</p><p><img src="https://img-blog.csdnimg.cn/img_convert/9d02aed0b543beca0f2e84ac7bc3c5be.png" alt="å›¾ç‰‡"></p></li><li><p>åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨ IS NOT NULL æ“ä½œ</p><p><img src="https://img-blog.csdnimg.cn/img_convert/17062c9db14db1bd86a4f67ff492b256.png" alt="å›¾ç‰‡"></p></li><li><p>åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨ &lt;&gt;ï¼Œ!&#x3D;ã€‚ä¸ç­‰äºæ“ä½œç¬¦æ˜¯æ°¸è¿œä¸ä¼šç”¨åˆ°ç´¢å¼•çš„ï¼Œå› æ­¤å¯¹å®ƒçš„å¤„ç†åªä¼šäº§ç”Ÿå…¨è¡¨æ‰«æã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/2685df910c22153926df2daaa0a61bf9.png" alt="å›¾ç‰‡"></p></li></ul><p>å…³äºè®¾ç½®ç´¢å¼•ä½†æ˜¯ç´¢å¼•æ²¡æœ‰ç”Ÿæ•ˆçš„åœºæ™¯è¿˜æœ‰å¾ˆå¤šï¼Œè¿™ä¸ªéœ€è¦å°ä¼™ä¼´ä»¬å·¥ä½œä¸­ä¸æ–­æ€»ç»“å’Œå®Œå–„ï¼Œä¸è¿‡æˆ‘ä¸Šé¢æ€»ç»“çš„è¿™äº›ç´¢å¼•å¤±æ•ˆçš„æƒ…æ™¯ï¼Œèƒ½å¤Ÿè¦†ç›–å¤§å¤šæ•°ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯äº†ã€‚</p><h3 id="æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ</h3><p>åœ¨ MySQL ç´¢å¼•çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªÂ <code>Handler_read_key</code>Â å€¼ï¼Œè¿™ä¸ªå€¼è¡¨ç¤ºäº†<strong>æŸä¸€è¡Œè¢«ç´¢å¼•å€¼è¯»çš„æ¬¡æ•°</strong>ã€‚Handler_read_key çš„å€¼æ¯”è¾ƒä½çš„è¯ï¼Œåˆ™è¡¨æ˜å¢åŠ ç´¢å¼•å¾—åˆ°çš„æ€§èƒ½æ”¹å–„ä¸æ˜¯å¾ˆç†æƒ³ï¼Œå¯èƒ½ç´¢å¼•ä½¿ç”¨çš„é¢‘ç‡ä¸é«˜ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªå€¼æ˜¯Â <code>Handler_read_rnd_next</code>ï¼Œè¿™ä¸ªå€¼é«˜åˆ™æ„å‘³ç€æŸ¥è¯¢è¿è¡Œæ•ˆç‡ä¸é«˜ï¼Œåº”è¯¥å»ºç«‹ç´¢å¼•æ¥è¿›è¡ŒæŠ¢æ•‘ã€‚è¿™ä¸ªå€¼çš„å«ä¹‰æ˜¯åœ¨æ•°æ®æ–‡ä»¶ä¸­è¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœæ­£åœ¨è¿›è¡Œå¤§é‡çš„è¡¨æ‰«æï¼ŒHandler_read_rnd_next çš„å€¼æ¯”è¾ƒé«˜ï¼Œå°±è¯´æ˜è¡¨ç´¢å¼•ä¸æ­£ç¡®æˆ–å†™å…¥çš„æŸ¥è¯¢æ²¡æœ‰åˆ©ç”¨ç´¢å¼•ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/e304165a9e6cc79681c6fa5b090f58eb.png" alt="å›¾ç‰‡"></p><h2 id="MySQL-åˆ†æè¡¨ã€æ£€æŸ¥è¡¨å’Œä¼˜åŒ–è¡¨"><a href="#MySQL-åˆ†æè¡¨ã€æ£€æŸ¥è¡¨å’Œä¼˜åŒ–è¡¨" class="headerlink" title="MySQL åˆ†æè¡¨ã€æ£€æŸ¥è¡¨å’Œä¼˜åŒ–è¡¨"></a>MySQL åˆ†æè¡¨ã€æ£€æŸ¥è¡¨å’Œä¼˜åŒ–è¡¨</h2><p>å¯¹äºå¤§å¤šæ•°å¼€å‘è€…æ¥è¯´ï¼Œä»–ä»¬æ›´å€¾å‘äºè§£å†³ç®€å• SQLçš„ä¼˜åŒ–ï¼Œè€Œå¤æ‚ SQL çš„ä¼˜åŒ–äº¤ç»™äº†å…¬å¸çš„ DBA æ¥åšã€‚</p><p>ä¸‹é¢å°±ä»æ™®é€šç¨‹åºå‘˜çš„è§’åº¦å’Œä½ èŠå‡ ä¸ªç®€å•çš„ä¼˜åŒ–æ–¹å¼ã€‚</p><h3 id="MySQL-åˆ†æè¡¨"><a href="#MySQL-åˆ†æè¡¨" class="headerlink" title="MySQL åˆ†æè¡¨"></a>MySQL åˆ†æè¡¨</h3><p>åˆ†æè¡¨ç”¨äºåˆ†æå’Œå­˜å‚¨è¡¨çš„å…³é”®å­—åˆ†å¸ƒï¼Œåˆ†æçš„ç»“æœå¯ä»¥ä½¿å¾—ç³»ç»Ÿå¾—åˆ°å‡†ç¡®çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä½¿å¾— SQL ç”Ÿæˆæ­£ç¡®çš„æ‰§è¡Œè®¡åˆ’ã€‚å¦‚æœç”¨äºæ„Ÿè§‰å®é™…æ‰§è¡Œè®¡åˆ’ä¸é¢„æœŸä¸ç¬¦ï¼Œå¯ä»¥æ‰§è¡Œåˆ†æè¡¨æ¥è§£å†³é—®é¢˜ï¼Œåˆ†æè¡¨è¯­æ³•å¦‚ä¸‹</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">analyze</span>Â <span class="hljs-keyword">table</span>Â cxuan005;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/c49e8e83471a76c90e8d61c481d2bcf3.png" alt="å›¾ç‰‡"></p><p>åˆ†æç»“æœæ¶‰åŠåˆ°çš„å­—æ®µå±æ€§å¦‚ä¸‹</p><p>Tableï¼šè¡¨ç¤ºè¡¨çš„åç§°ï¼›</p><p>Opï¼šè¡¨ç¤ºæ‰§è¡Œçš„æ“ä½œï¼Œanalyze è¡¨ç¤ºè¿›è¡Œåˆ†ææ“ä½œï¼Œcheck è¡¨ç¤ºè¿›è¡Œæ£€æŸ¥æŸ¥æ‰¾ï¼Œoptimize è¡¨ç¤ºè¿›è¡Œä¼˜åŒ–æ“ä½œï¼›</p><p>Msg_typeï¼šè¡¨ç¤ºä¿¡æ¯ç±»å‹ï¼Œå…¶æ˜¾ç¤ºçš„å€¼é€šå¸¸æ˜¯çŠ¶æ€ã€è­¦å‘Šã€é”™è¯¯å’Œä¿¡æ¯è¿™å››è€…ä¹‹ä¸€ï¼›</p><p>Msg_textï¼šæ˜¾ç¤ºä¿¡æ¯ã€‚</p><p>å¯¹è¡¨çš„å®šæœŸåˆ†æå¯ä»¥æ”¹å–„æ€§èƒ½ï¼Œåº”è¯¥æˆä¸ºæ—¥å¸¸å·¥ä½œçš„ä¸€éƒ¨åˆ†ã€‚å› ä¸ºé€šè¿‡æ›´æ–°è¡¨çš„ç´¢å¼•ä¿¡æ¯å¯¹è¡¨è¿›è¡Œåˆ†æï¼Œå¯æ”¹å–„æ•°æ®åº“æ€§èƒ½ã€‚</p><h3 id="MySQL-æ£€æŸ¥è¡¨"><a href="#MySQL-æ£€æŸ¥è¡¨" class="headerlink" title="MySQL æ£€æŸ¥è¡¨"></a>MySQL æ£€æŸ¥è¡¨</h3><p>æ•°æ®åº“ç»å¸¸å¯èƒ½é‡åˆ°é”™è¯¯ï¼Œæ¯”å¦‚æ•°æ®å†™å…¥ç£ç›˜æ—¶å‘ç”Ÿé”™è¯¯ï¼Œæˆ–æ˜¯ç´¢å¼•æ²¡æœ‰åŒæ­¥æ›´æ–°ï¼Œæˆ–æ˜¯æ•°æ®åº“æœªå…³é—­ MySQL å°±åœæ­¢äº†ã€‚é‡åˆ°è¿™äº›æƒ…å†µï¼Œæ•°æ®å°±å¯èƒ½å‘ç”Ÿé”™è¯¯ï¼šÂ <strong>Incorrect key file for table: â€˜ â€˜. Try to repair it</strong>. æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Check Table è¯­å¥æ¥æ£€æŸ¥è¡¨åŠå…¶å¯¹åº”çš„ç´¢å¼•ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">check</span>Â <span class="hljs-keyword">table</span>Â cxuan005;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/0b2e1f7bc2c7acfbc25401d8c681cb93.png" alt="å›¾ç‰‡"></p><p>æ£€æŸ¥è¡¨çš„ä¸»è¦ç›®çš„å°±æ˜¯æ£€æŸ¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¡¨æ˜¯å¦æœ‰é”™è¯¯ã€‚Check Table å¯¹ MyISAM å’Œ InnoDB è¡¨æœ‰ä½œç”¨ã€‚Check Table ä¹Ÿå¯ä»¥æ£€æŸ¥è§†å›¾çš„é”™è¯¯ã€‚</p><h3 id="MySQL-ä¼˜åŒ–è¡¨"><a href="#MySQL-ä¼˜åŒ–è¡¨" class="headerlink" title="MySQL ä¼˜åŒ–è¡¨"></a>MySQL ä¼˜åŒ–è¡¨</h3><p>MySQL ä¼˜åŒ–è¡¨é€‚ç”¨äºåˆ é™¤äº†å¤§é‡çš„è¡¨æ•°æ®ï¼Œæˆ–è€…å¯¹åŒ…å« VARCHARã€BLOB æˆ–åˆ™ TEXT å‘½ä»¤è¿›è¡Œå¤§é‡ä¿®æ”¹çš„æƒ…å†µã€‚MySQL ä¼˜åŒ–è¡¨å¯ä»¥å°†å¤§é‡çš„ç©ºé—´ç¢ç‰‡è¿›è¡Œåˆå¹¶ï¼Œæ¶ˆé™¤ç”±äºåˆ é™¤æˆ–è€…æ›´æ–°é€ æˆçš„ç©ºé—´æµªè´¹æƒ…å†µã€‚å®ƒçš„å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">optimizeÂ tableÂ cxuan005<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/ceb7a348cb85e7d2315f62759a6052c7.png" alt="å›¾ç‰‡"></p><p>æˆ‘çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDB å¼•æ“ï¼Œä½†æ˜¯ä»å›¾å¯ä»¥çŸ¥é“ï¼ŒInnoDB ä¸æ”¯æŒä½¿ç”¨ optimize ä¼˜åŒ–ï¼Œå»ºè®®ä½¿ç”¨ recreate + analyze è¿›è¡Œä¼˜åŒ–ã€‚optimize å‘½ä»¤åªå¯¹ MyISAM ã€BDB è¡¨èµ·ä½œç”¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>SQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerfile æœ€ä½³å®è·µ(DockerfileæŒ‡ä»¤çš„ä½¿ç”¨åŠå»ºè®®)</title>
    <link href="/2020/12/14/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5(Dockerfile%E6%8C%87%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%BB%BA%E8%AE%AE)/"/>
    <url>/2020/12/14/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5(Dockerfile%E6%8C%87%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%BB%BA%E8%AE%AE)/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a><strong>ç›®å½•</strong></h1><p>Â </p><p><a href="#dockerfile-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">Dockerfile æœ€ä½³å®è·µ</a></p><p><a href="#%E4%B8%80%E8%88%AC%E6%80%A7%E7%9A%84%E6%8C%87%E5%8D%97%E5%92%8C%E5%BB%BA%E8%AE%AE">ä¸€èˆ¬æ€§çš„æŒ‡å—å’Œå»ºè®®</a></p><p><a href="#%E5%AE%B9%E5%99%A8%E5%BA%94%E8%AF%A5%E6%98%AF%E7%9F%AD%E6%9A%82%E7%9A%84">å®¹å™¨åº”è¯¥æ˜¯çŸ­æš‚çš„</a></p><p><a href="#%E4%BD%BF%E7%94%A8-dockerignore-%E6%96%87%E4%BB%B6">ä½¿ç”¨Â .dockerignoreÂ æ–‡ä»¶</a></p><p><a href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA">ä½¿ç”¨å¤šé˜¶æ®µæ„å»º</a></p><p><a href="#%E9%81%BF%E5%85%8D%E5%AE%89%E8%A3%85%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%8C%85">é¿å…å®‰è£…ä¸å¿…è¦çš„åŒ…</a></p><p><a href="#%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8%E5%8F%AA%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B">ä¸€ä¸ªå®¹å™¨åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹</a></p><p><a href="#%E9%95%9C%E5%83%8F%E5%B1%82%E6%95%B0%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%B0%91">é•œåƒå±‚æ•°å°½å¯èƒ½å°‘</a></p><p><a href="#%E5%B0%86%E5%A4%9A%E8%A1%8C%E5%8F%82%E6%95%B0%E6%8E%92%E5%BA%8F">å°†å¤šè¡Œå‚æ•°æ’åº</a></p><p><a href="#%E6%9E%84%E5%BB%BA%E7%BC%93%E5%AD%98">æ„å»ºç¼“å­˜</a></p><p><a href="#dockerfile-%E6%8C%87%E4%BB%A4">Dockerfile æŒ‡ä»¤</a></p><p><a href="#from">FROM</a></p><p><a href="#label">LABEL</a></p><p><a href="#run">RUN</a></p><p><a href="#cmd">CMD</a></p><p><a href="#expose">EXPOSE</a></p><p><a href="#env">ENV</a></p><p><a href="#add-%E5%92%8C-copy">ADD å’Œ COPY</a></p><p><a href="#entrypoint">ENTRYPOINT</a></p><p><a href="#volume">VOLUME</a></p><p><a href="#user">USER</a></p><p><a href="#workdir">WORKDIR</a></p><p><a href="#%E5%AE%98%E6%96%B9%E9%95%9C%E5%83%8F%E7%A4%BA%E4%BE%8B">å®˜æ–¹é•œåƒç¤ºä¾‹</a></p><p><a href="#%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5">èµ„æºé“¾æ¥</a></p><p><a href="#%E5%AE%98%E6%96%B9%E7%BD%91%E7%AB%99">å®˜æ–¹ç½‘ç«™</a></p><p><a href="#%E5%AE%9E%E8%B7%B5%E5%8F%82%E8%80%83">å®è·µå‚è€ƒ</a></p><p><a href="#%E6%8A%80%E6%9C%AF%E4%BA%A4%E6%B5%81">æŠ€æœ¯äº¤æµ</a></p><p><a href="#%E5%85%B6%E5%AE%83">å…¶å®ƒ</a></p><p><a href="#%E5%8F%82%E8%80%83%C2%A0">å‚è€ƒÂ </a></p><hr><h1 id="Dockerfile-æœ€ä½³å®è·µ"><a href="#Dockerfile-æœ€ä½³å®è·µ" class="headerlink" title="Dockerfile æœ€ä½³å®è·µ"></a>Dockerfile æœ€ä½³å®è·µ</h1><p>æœ¬é™„å½•æ˜¯å¯¹ Docker å®˜æ–¹æ–‡æ¡£ä¸­Â <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Best practices for writing Dockerfiles</a>Â çš„ç†è§£ä¸ç¿»è¯‘ã€‚</p><h2 id="ä¸€èˆ¬æ€§çš„æŒ‡å—å’Œå»ºè®®"><a href="#ä¸€èˆ¬æ€§çš„æŒ‡å—å’Œå»ºè®®" class="headerlink" title="ä¸€èˆ¬æ€§çš„æŒ‡å—å’Œå»ºè®®"></a>ä¸€èˆ¬æ€§çš„æŒ‡å—å’Œå»ºè®®</h2><h3 id="å®¹å™¨åº”è¯¥æ˜¯çŸ­æš‚çš„"><a href="#å®¹å™¨åº”è¯¥æ˜¯çŸ­æš‚çš„" class="headerlink" title="å®¹å™¨åº”è¯¥æ˜¯çŸ­æš‚çš„"></a>å®¹å™¨åº”è¯¥æ˜¯çŸ­æš‚çš„</h3><p>é€šè¿‡Â <code>Dockerfile</code>Â æ„å»ºçš„é•œåƒæ‰€å¯åŠ¨çš„å®¹å™¨åº”è¯¥å°½å¯èƒ½çŸ­æš‚ï¼ˆç”Ÿå‘½å‘¨æœŸçŸ­ï¼‰ã€‚ã€ŒçŸ­æš‚ã€æ„å‘³ç€å¯ä»¥åœæ­¢å’Œé”€æ¯å®¹å™¨ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨å¹¶éƒ¨ç½²å¥½æ‰€éœ€çš„è®¾ç½®å’Œé…ç½®å·¥ä½œé‡åº”è¯¥æ˜¯æå°çš„ã€‚</p><h3 id="ä½¿ç”¨-dockerignore-æ–‡ä»¶"><a href="#ä½¿ç”¨-dockerignore-æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨Â .dockerignoreÂ æ–‡ä»¶"></a>ä½¿ç”¨Â <code>.dockerignore</code>Â æ–‡ä»¶</h3><p>ä½¿ç”¨Â <code>Dockerfile</code>Â æ„å»ºé•œåƒæ—¶æœ€å¥½æ˜¯å°†Â <code>Dockerfile</code>Â æ”¾ç½®åœ¨ä¸€ä¸ªæ–°å»ºçš„ç©ºç›®å½•ä¸‹ã€‚ç„¶åå°†æ„å»ºé•œåƒæ‰€éœ€è¦çš„æ–‡ä»¶æ·»åŠ åˆ°è¯¥ç›®å½•ä¸­ã€‚ä¸ºäº†æé«˜æ„å»ºé•œåƒçš„æ•ˆç‡ï¼Œä½ å¯ä»¥åœ¨ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªÂ <code>.dockerignore</code>Â æ–‡ä»¶æ¥æŒ‡å®šè¦å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•ã€‚<code>.dockerignore</code>Â æ–‡ä»¶çš„æ’é™¤æ¨¡å¼è¯­æ³•å’Œ Git çš„Â <code>.gitignore</code>Â æ–‡ä»¶ç›¸ä¼¼ã€‚</p><h3 id="ä½¿ç”¨å¤šé˜¶æ®µæ„å»º"><a href="#ä½¿ç”¨å¤šé˜¶æ®µæ„å»º" class="headerlink" title="ä½¿ç”¨å¤šé˜¶æ®µæ„å»º"></a>ä½¿ç”¨å¤šé˜¶æ®µæ„å»º</h3><p>åœ¨Â <code>Docker 17.05</code>Â ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨Â å¤šé˜¶æ®µæ„å»ºÂ æ¥å‡å°‘æ‰€æ„å»ºé•œåƒçš„å¤§å°ã€‚</p><h3 id="é¿å…å®‰è£…ä¸å¿…è¦çš„åŒ…"><a href="#é¿å…å®‰è£…ä¸å¿…è¦çš„åŒ…" class="headerlink" title="é¿å…å®‰è£…ä¸å¿…è¦çš„åŒ…"></a>é¿å…å®‰è£…ä¸å¿…è¦çš„åŒ…</h3><p>ä¸ºäº†é™ä½å¤æ‚æ€§ã€å‡å°‘ä¾èµ–ã€å‡å°æ–‡ä»¶å¤§å°ã€èŠ‚çº¦æ„å»ºæ—¶é—´ï¼Œä½ åº”è¯¥é¿å…å®‰è£…ä»»ä½•ä¸å¿…è¦çš„åŒ…ã€‚ä¾‹å¦‚ï¼Œä¸è¦åœ¨æ•°æ®åº“é•œåƒä¸­åŒ…å«ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p><h3 id="ä¸€ä¸ªå®¹å™¨åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹"><a href="#ä¸€ä¸ªå®¹å™¨åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹" class="headerlink" title="ä¸€ä¸ªå®¹å™¨åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹"></a>ä¸€ä¸ªå®¹å™¨åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹</h3><p>åº”è¯¥ä¿è¯åœ¨ä¸€ä¸ªå®¹å™¨ä¸­åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹ã€‚å°†å¤šä¸ªåº”ç”¨è§£è€¦åˆ°ä¸åŒå®¹å™¨ä¸­ï¼Œä¿è¯äº†å®¹å™¨çš„æ¨ªå‘æ‰©å±•å’Œå¤ç”¨ã€‚ä¾‹å¦‚ web åº”ç”¨åº”è¯¥åŒ…å«ä¸‰ä¸ªå®¹å™¨ï¼šwebåº”ç”¨ã€æ•°æ®åº“ã€ç¼“å­˜ã€‚</p><p>å¦‚æœå®¹å™¨äº’ç›¸ä¾èµ–ï¼Œä½ å¯ä»¥ä½¿ç”¨Â Docker è‡ªå®šä¹‰ç½‘ç»œÂ æ¥æŠŠè¿™äº›å®¹å™¨è¿æ¥èµ·æ¥ã€‚</p><h3 id="é•œåƒå±‚æ•°å°½å¯èƒ½å°‘"><a href="#é•œåƒå±‚æ•°å°½å¯èƒ½å°‘" class="headerlink" title="é•œåƒå±‚æ•°å°½å¯èƒ½å°‘"></a>é•œåƒå±‚æ•°å°½å¯èƒ½å°‘</h3><p>ä½ éœ€è¦åœ¨Â <code>Dockerfile</code>Â å¯è¯»æ€§ï¼ˆä¹ŸåŒ…æ‹¬é•¿æœŸçš„å¯ç»´æŠ¤æ€§ï¼‰å’Œå‡å°‘å±‚æ•°ä¹‹é—´åšä¸€ä¸ªå¹³è¡¡ã€‚</p><h3 id="å°†å¤šè¡Œå‚æ•°æ’åº"><a href="#å°†å¤šè¡Œå‚æ•°æ’åº" class="headerlink" title="å°†å¤šè¡Œå‚æ•°æ’åº"></a>å°†å¤šè¡Œå‚æ•°æ’åº</h3><p>å°†å¤šè¡Œå‚æ•°æŒ‰å­—æ¯é¡ºåºæ’åºï¼ˆæ¯”å¦‚è¦å®‰è£…å¤šä¸ªåŒ…æ—¶ï¼‰ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ é¿å…é‡å¤åŒ…å«åŒä¸€ä¸ªåŒ…ï¼Œæ›´æ–°åŒ…åˆ—è¡¨æ—¶ä¹Ÿæ›´å®¹æ˜“ã€‚ä¹Ÿä¾¿äºÂ <code>PRs</code>Â é˜…è¯»å’Œå®¡æŸ¥ã€‚å»ºè®®åœ¨åæ–œæ ç¬¦å·Â <code>\</code>Â ä¹‹å‰æ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œä»¥å¢åŠ å¯è¯»æ€§ã€‚</p><p>ä¸‹é¢æ˜¯æ¥è‡ªÂ <code>buildpack-deps</code>Â é•œåƒçš„ä¾‹å­ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">RUN</span> apt-<span class="hljs-built_in">get</span> update &amp;&amp; apt-<span class="hljs-built_in">get</span> install -y \<br>  bzr \<br>  cvs \<br>  git \<br>  mercurial \<br>  subversion<br></code></pre></td></tr></table></figure><h3 id="æ„å»ºç¼“å­˜"><a href="#æ„å»ºç¼“å­˜" class="headerlink" title="æ„å»ºç¼“å­˜"></a>æ„å»ºç¼“å­˜</h3><p>åœ¨é•œåƒçš„æ„å»ºè¿‡ç¨‹ä¸­ï¼ŒDocker ä¼šéå†Â <code>Dockerfile</code>Â æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œã€‚åœ¨æ‰§è¡Œæ¯æ¡æŒ‡ä»¤ä¹‹å‰ï¼ŒDocker éƒ½ä¼šåœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾æ˜¯å¦å·²ç»å­˜åœ¨å¯é‡ç”¨çš„é•œåƒï¼Œå¦‚æœæœ‰å°±ä½¿ç”¨ç°å­˜çš„é•œåƒï¼Œä¸å†é‡å¤åˆ›å»ºã€‚å¦‚æœä½ ä¸æƒ³åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨ç¼“å­˜ï¼Œä½ å¯ä»¥åœ¨Â <code>docker build</code>Â å‘½ä»¤ä¸­ä½¿ç”¨Â <code>--no-cache=true</code>Â é€‰é¡¹ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³åœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­ä½¿ç”¨ç¼“å­˜ï¼Œä½ å¾—æ˜ç™½ä»€ä¹ˆæ—¶å€™ä¼šï¼Œä»€ä¹ˆæ—¶å€™ä¸ä¼šæ‰¾åˆ°åŒ¹é…çš„é•œåƒï¼Œéµå¾ªçš„åŸºæœ¬è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>ä»ä¸€ä¸ªåŸºç¡€é•œåƒå¼€å§‹ï¼ˆ<code>FROM</code>Â æŒ‡ä»¤æŒ‡å®šï¼‰ï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤å°†å’Œè¯¥åŸºç¡€é•œåƒçš„æ‰€æœ‰å­é•œåƒè¿›è¡ŒåŒ¹é…ï¼Œæ£€æŸ¥è¿™äº›å­é•œåƒè¢«åˆ›å»ºæ—¶ä½¿ç”¨çš„æŒ‡ä»¤æ˜¯å¦å’Œè¢«æ£€æŸ¥çš„æŒ‡ä»¤å®Œå…¨ä¸€æ ·ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™ç¼“å­˜å¤±æ•ˆã€‚</li><li>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªéœ€è¦ç®€å•åœ°å¯¹æ¯”Â <code>Dockerfile</code>Â ä¸­çš„æŒ‡ä»¤å’Œå­é•œåƒã€‚ç„¶è€Œï¼Œæœ‰äº›æŒ‡ä»¤éœ€è¦æ›´å¤šçš„æ£€æŸ¥å’Œè§£é‡Šã€‚</li><li>å¯¹äºÂ <code>ADD</code>Â å’ŒÂ <code>COPY</code>Â æŒ‡ä»¤ï¼Œé•œåƒä¸­å¯¹åº”æ–‡ä»¶çš„å†…å®¹ä¹Ÿä¼šè¢«æ£€æŸ¥ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä¼šè®¡ç®—å‡ºä¸€ä¸ªæ ¡éªŒå’Œã€‚æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´å’Œæœ€åè®¿é—®æ—¶é—´ä¸ä¼šçº³å…¥æ ¡éªŒã€‚åœ¨ç¼“å­˜çš„æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œä¼šå°†è¿™äº›æ ¡éªŒå’Œå’Œå·²å­˜åœ¨é•œåƒä¸­çš„æ–‡ä»¶æ ¡éªŒå’Œè¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœæ–‡ä»¶æœ‰ä»»ä½•æ”¹å˜ï¼Œæ¯”å¦‚å†…å®¹å’Œå…ƒæ•°æ®ï¼Œåˆ™ç¼“å­˜å¤±æ•ˆã€‚</li><li>é™¤äº†Â <code>ADD</code>Â å’ŒÂ <code>COPY</code>Â æŒ‡ä»¤ï¼Œç¼“å­˜åŒ¹é…è¿‡ç¨‹ä¸ä¼šæŸ¥çœ‹ä¸´æ—¶å®¹å™¨ä¸­çš„æ–‡ä»¶æ¥å†³å®šç¼“å­˜æ˜¯å¦åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œå½“æ‰§è¡Œå®ŒÂ <code>RUN apt-get -y update</code>Â æŒ‡ä»¤åï¼Œå®¹å™¨ä¸­ä¸€äº›æ–‡ä»¶è¢«æ›´æ–°ï¼Œä½† Docker ä¸ä¼šæ£€æŸ¥è¿™äº›æ–‡ä»¶ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰æŒ‡ä»¤å­—ç¬¦ä¸²æœ¬èº«è¢«ç”¨æ¥åŒ¹é…ç¼“å­˜ã€‚</li></ul><p>ä¸€æ—¦ç¼“å­˜å¤±æ•ˆï¼Œæ‰€æœ‰åç»­çš„Â <code>Dockerfile</code>Â æŒ‡ä»¤éƒ½å°†äº§ç”Ÿæ–°çš„é•œåƒï¼Œç¼“å­˜ä¸ä¼šè¢«ä½¿ç”¨ã€‚</p><h2 id="Dockerfile-æŒ‡ä»¤"><a href="#Dockerfile-æŒ‡ä»¤" class="headerlink" title="Dockerfile æŒ‡ä»¤"></a>Dockerfile æŒ‡ä»¤</h2><p>ä¸‹é¢é’ˆå¯¹Â <code>Dockerfile</code>Â ä¸­å„ç§æŒ‡ä»¤çš„æœ€ä½³ç¼–å†™æ–¹å¼ç»™å‡ºå»ºè®®ã€‚</p><h3 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h3><p>å°½å¯èƒ½ä½¿ç”¨å½“å‰å®˜æ–¹ä»“åº“ä½œä¸ºä½ æ„å»ºé•œåƒçš„åŸºç¡€ã€‚æ¨èä½¿ç”¨Â <a href="https://hub.docker.com/_/alpine/">Alpine</a>Â é•œåƒï¼Œå› ä¸ºå®ƒè¢«ä¸¥æ ¼æ§åˆ¶å¹¶ä¿æŒæœ€å°å°ºå¯¸ï¼ˆç›®å‰å°äº 5 MBï¼‰ï¼Œä½†å®ƒä»ç„¶æ˜¯ä¸€ä¸ªå®Œæ•´çš„å‘è¡Œç‰ˆã€‚</p><h3 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h3><p>ä½ å¯ä»¥ç»™é•œåƒæ·»åŠ æ ‡ç­¾æ¥å¸®åŠ©ç»„ç»‡é•œåƒã€è®°å½•è®¸å¯ä¿¡æ¯ã€è¾…åŠ©è‡ªåŠ¨åŒ–æ„å»ºç­‰ã€‚æ¯ä¸ªæ ‡ç­¾ä¸€è¡Œï¼Œç”±Â <code>LABEL</code>Â å¼€å¤´åŠ ä¸Šä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾å¯¹ã€‚ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å„ç§ä¸åŒçš„å¯èƒ½æ ¼å¼ã€‚<code>#</code>Â å¼€å¤´çš„è¡Œæ˜¯æ³¨é‡Šå†…å®¹ã€‚</p><blockquote><p>æ³¨æ„ï¼šå¦‚æœä½ çš„å­—ç¬¦ä¸²ä¸­åŒ…å«ç©ºæ ¼ï¼Œå¿…é¡»å°†å­—ç¬¦ä¸²æ”¾å…¥å¼•å·ä¸­æˆ–è€…å¯¹ç©ºæ ¼ä½¿ç”¨è½¬ä¹‰ã€‚å¦‚æœå­—ç¬¦ä¸²å†…å®¹æœ¬èº«å°±åŒ…å«å¼•å·ï¼Œå¿…é¡»å¯¹å¼•å·ä½¿ç”¨è½¬ä¹‰ã€‚</p></blockquote><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stata"># <span class="hljs-keyword">Set</span> <span class="hljs-keyword">one</span> or <span class="hljs-keyword">more</span> individual labels<br><span class="hljs-keyword">LABEL</span> com.example.<span class="hljs-keyword">version</span>=<span class="hljs-string">&quot;0.0.1-beta&quot;</span><br><br><span class="hljs-keyword">LABEL</span> vendor=<span class="hljs-string">&quot;ACME Incorporated&quot;</span><br><br><span class="hljs-keyword">LABEL</span> com.example.release-date=<span class="hljs-string">&quot;2015-02-12&quot;</span><br><br><span class="hljs-keyword">LABEL</span> com.example.<span class="hljs-keyword">version</span>.is-production=<span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªé•œåƒå¯ä»¥åŒ…å«å¤šä¸ªæ ‡ç­¾ï¼Œä½†å»ºè®®å°†å¤šä¸ªæ ‡ç­¾æ”¾å…¥åˆ°ä¸€ä¸ªÂ <code>LABEL</code>Â æŒ‡ä»¤ä¸­ã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-comment"># Set multiple labels at once, using line-continuation characters to break long lines</span><br>LABEL vendor=ACME<span class="hljs-string">\</span> Incorporated <span class="hljs-string">\</span><br>      com.example.<span class="hljs-keyword">is</span>-beta= <span class="hljs-string">\</span><br>      com.example.<span class="hljs-keyword">is</span>-production=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-string">\</span><br>      com.example.version=<span class="hljs-string">&quot;0.0.1-beta&quot;</span> <span class="hljs-string">\</span><br>      com.example.release-date=<span class="hljs-string">&quot;2015-02-12&quot;</span><br></code></pre></td></tr></table></figure><p>å…³äºæ ‡ç­¾å¯ä»¥æ¥å—çš„é”®å€¼å¯¹ï¼Œå‚è€ƒÂ <a href="https://docs.docker.com/config/labels-custom-metadata/">Understanding object labels</a>ã€‚å…³äºæŸ¥è¯¢æ ‡ç­¾ä¿¡æ¯ï¼Œå‚è€ƒÂ <a href="https://docs.docker.com/config/labels-custom-metadata/">Managing labels on objects</a>ã€‚</p><h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><p>ä¸ºäº†ä¿æŒÂ <code>Dockerfile</code>Â æ–‡ä»¶çš„å¯è¯»æ€§ï¼Œå¯ç†è§£æ€§ï¼Œä»¥åŠå¯ç»´æŠ¤æ€§ï¼Œå»ºè®®å°†é•¿çš„æˆ–å¤æ‚çš„Â <code>RUN</code>Â æŒ‡ä»¤ç”¨åæ–œæ Â <code>\</code>Â åˆ†å‰²æˆå¤šè¡Œã€‚</p><p>apt-get</p><p><code>RUN</code>Â æŒ‡ä»¤æœ€å¸¸è§çš„ç”¨æ³•æ˜¯å®‰è£…åŒ…ç”¨çš„Â <code>apt-get</code>ã€‚å› ä¸ºÂ <code>RUN apt-get</code>Â æŒ‡ä»¤ä¼šå®‰è£…åŒ…ï¼Œæ‰€ä»¥æœ‰å‡ ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ã€‚</p><p>ä¸è¦ä½¿ç”¨Â <code>RUN apt-get upgrade</code>Â æˆ–Â <code>dist-upgrade</code>ï¼Œå› ä¸ºè®¸å¤šåŸºç¡€é•œåƒä¸­çš„ã€Œå¿…é¡»ã€åŒ…ä¸ä¼šåœ¨ä¸€ä¸ªéç‰¹æƒå®¹å™¨ä¸­å‡çº§ã€‚å¦‚æœåŸºç¡€é•œåƒä¸­çš„æŸä¸ªåŒ…è¿‡æ—¶äº†ï¼Œä½ åº”è¯¥è”ç³»å®ƒçš„ç»´æŠ¤è€…ã€‚å¦‚æœä½ ç¡®å®šæŸä¸ªç‰¹å®šçš„åŒ…ï¼Œæ¯”å¦‚Â <code>foo</code>ï¼Œéœ€è¦å‡çº§ï¼Œä½¿ç”¨Â <code>apt-get install \-y foo</code>Â å°±è¡Œï¼Œè¯¥æŒ‡ä»¤ä¼šè‡ªåŠ¨å‡çº§Â <code>foo</code>Â åŒ…ã€‚</p><p>æ°¸è¿œå°†Â <code>RUN apt-get update</code>Â å’ŒÂ <code>apt-get install</code>Â ç»„åˆæˆä¸€æ¡Â <code>RUN</code>Â å£°æ˜ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">RUN</span> apt-<span class="hljs-built_in">get</span> update &amp;&amp; apt-<span class="hljs-built_in">get</span> install -y \<br>        package-bar \<br>        package-baz \<br>        package-foo<br></code></pre></td></tr></table></figure><p>å°†Â <code>apt-get update</code>Â æ”¾åœ¨ä¸€æ¡å•ç‹¬çš„Â <code>RUN</code>Â å£°æ˜ä¸­ä¼šå¯¼è‡´ç¼“å­˜é—®é¢˜ä»¥åŠåç»­çš„Â <code>apt-get install</code>Â å¤±è´¥ã€‚æ¯”å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªÂ <code>Dockerfile</code>Â æ–‡ä»¶ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">FROM</span> ubuntu:18.04<br><br><span class="hljs-built_in">RUN</span> apt-<span class="hljs-built_in">get</span> update<br><br><span class="hljs-built_in">RUN</span> apt-<span class="hljs-built_in">get</span> install -y curl<br></code></pre></td></tr></table></figure><p>æ„å»ºé•œåƒåï¼Œæ‰€æœ‰çš„å±‚éƒ½åœ¨ Docker çš„ç¼“å­˜ä¸­ã€‚å‡è®¾ä½ åæ¥åˆä¿®æ”¹äº†å…¶ä¸­çš„Â <code>apt-get install</code>Â æ·»åŠ äº†ä¸€ä¸ªåŒ…ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">FROM</span> ubuntu:18.04<br><br><span class="hljs-built_in">RUN</span> apt-<span class="hljs-built_in">get</span> update<br><br><span class="hljs-built_in">RUN</span> apt-<span class="hljs-built_in">get</span> install -y curl nginx<br></code></pre></td></tr></table></figure><p>Docker å‘ç°ä¿®æ”¹åçš„Â <code>RUN apt-get update</code>Â æŒ‡ä»¤å’Œä¹‹å‰çš„å®Œå…¨ä¸€æ ·ã€‚æ‰€ä»¥ï¼Œ<code>apt-get update</code>Â ä¸ä¼šæ‰§è¡Œï¼Œè€Œæ˜¯ä½¿ç”¨ä¹‹å‰çš„ç¼“å­˜é•œåƒã€‚å› ä¸ºÂ <code>apt-get update</code>Â æ²¡æœ‰è¿è¡Œï¼Œåé¢çš„Â <code>apt-get install</code>Â å¯èƒ½å®‰è£…çš„æ˜¯è¿‡æ—¶çš„Â <code>curl</code>Â å’ŒÂ <code>nginx</code>Â ç‰ˆæœ¬ã€‚</p><p>ä½¿ç”¨Â <code>RUN apt-get update &amp;&amp; apt-get install \-y</code>Â å¯ä»¥ç¡®ä¿ä½ çš„ Dockerfiles æ¯æ¬¡å®‰è£…çš„éƒ½æ˜¯åŒ…çš„æœ€æ–°çš„ç‰ˆæœ¬ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦è¿›ä¸€æ­¥çš„ç¼–ç æˆ–é¢å¤–å¹²é¢„ã€‚è¿™é¡¹æŠ€æœ¯å«ä½œÂ <code>cache busting</code>ã€‚ä½ ä¹Ÿå¯ä»¥æ˜¾ç¤ºæŒ‡å®šä¸€ä¸ªåŒ…çš„ç‰ˆæœ¬å·æ¥è¾¾åˆ°Â <code>cache-busting</code>ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å›ºå®šç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">RUN</span> apt-<span class="hljs-built_in">get</span> update &amp;&amp; apt-<span class="hljs-built_in">get</span> install -y \<br>    package-bar \<br>    package-baz \<br>    <span class="hljs-attribute">package-foo</span>=1.3.*<br></code></pre></td></tr></table></figure><p>å›ºå®šç‰ˆæœ¬ä¼šè¿«ä½¿æ„å»ºè¿‡ç¨‹æ£€ç´¢ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œè€Œä¸ç®¡ç¼“å­˜ä¸­æœ‰ä»€ä¹ˆã€‚è¿™é¡¹æŠ€æœ¯ä¹Ÿå¯ä»¥å‡å°‘å› æ‰€éœ€åŒ…ä¸­æœªé¢„æ–™åˆ°çš„å˜åŒ–è€Œå¯¼è‡´çš„å¤±è´¥ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªÂ <code>RUN</code>Â æŒ‡ä»¤çš„ç¤ºä¾‹æ¨¡æ¿ï¼Œå±•ç¤ºäº†æ‰€æœ‰å…³äºÂ <code>apt-get</code>Â çš„å»ºè®®ã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs livescript">RUN apt-get update &amp;&amp; apt-get install -y <span class="hljs-string">\</span><br>    aufs-tools <span class="hljs-string">\</span><br>    automake <span class="hljs-string">\</span><br>    build-essential <span class="hljs-string">\</span><br>    curl <span class="hljs-string">\</span><br>    dpkg-sig <span class="hljs-string">\</span><br>    libcap-dev <span class="hljs-string">\</span><br>    libsqlite3-dev <span class="hljs-string">\</span><br>    mercurial <span class="hljs-string">\</span><br>    reprepro <span class="hljs-string">\</span><br>    ruby1.<span class="hljs-number">9.1</span> <span class="hljs-string">\</span><br>    ruby1.<span class="hljs-number">9.1</span>-dev <span class="hljs-string">\</span><br>    s3cmd=<span class="hljs-number">1.1</span>.* <span class="hljs-string">\</span><br> &amp;&amp; rm -rf <span class="hljs-regexp">/var/lib/apt/lists/</span>*<br></code></pre></td></tr></table></figure><p>å…¶ä¸­Â <code>s3cmd</code>Â æŒ‡ä»¤æŒ‡å®šäº†ä¸€ä¸ªç‰ˆæœ¬å·Â <code>1.1.*</code>ã€‚å¦‚æœä¹‹å‰çš„é•œåƒä½¿ç”¨çš„æ˜¯æ›´æ—§çš„ç‰ˆæœ¬ï¼ŒæŒ‡å®šæ–°çš„ç‰ˆæœ¬ä¼šå¯¼è‡´Â <code>apt-get udpate</code>Â ç¼“å­˜å¤±æ•ˆå¹¶ç¡®ä¿å®‰è£…çš„æ˜¯æ–°ç‰ˆæœ¬ã€‚</p><p>å¦å¤–ï¼Œæ¸…ç†æ‰ apt ç¼“å­˜Â <code>var/lib/apt/lists</code>Â å¯ä»¥å‡å°é•œåƒå¤§å°ã€‚å› ä¸ºÂ <code>RUN</code>Â æŒ‡ä»¤çš„å¼€å¤´ä¸ºÂ <code>apt-get udpate</code>ï¼ŒåŒ…ç¼“å­˜æ€»æ˜¯ä¼šåœ¨Â <code>apt-get install</code>Â ä¹‹å‰åˆ·æ–°ã€‚</p><blockquote><p>æ³¨æ„ï¼šå®˜æ–¹çš„ Debian å’Œ Ubuntu é•œåƒä¼šè‡ªåŠ¨è¿è¡Œ apt-get cleanï¼Œæ‰€ä»¥ä¸éœ€è¦æ˜¾å¼çš„è°ƒç”¨ apt-get cleanã€‚</p></blockquote><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><p><code>CMD</code>Â æŒ‡ä»¤ç”¨äºæ‰§è¡Œç›®æ ‡é•œåƒä¸­åŒ…å«çš„è½¯ä»¶ï¼Œå¯ä»¥åŒ…å«å‚æ•°ã€‚<code>CMD</code>Â å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½åº”è¯¥ä»¥Â <code>CMD [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;...]</code>Â çš„å½¢å¼ä½¿ç”¨ã€‚å› æ­¤ï¼Œå¦‚æœåˆ›å»ºé•œåƒçš„ç›®çš„æ˜¯ä¸ºäº†éƒ¨ç½²æŸä¸ªæœåŠ¡(æ¯”å¦‚Â <code>Apache</code>)ï¼Œä½ å¯èƒ½ä¼šæ‰§è¡Œç±»ä¼¼äºÂ <code>CMD [&quot;apache2&quot;, &quot;-DFOREGROUND&quot;]</code>Â å½¢å¼çš„å‘½ä»¤ã€‚æˆ‘ä»¬å»ºè®®ä»»ä½•æœåŠ¡é•œåƒéƒ½ä½¿ç”¨è¿™ç§å½¢å¼çš„å‘½ä»¤ã€‚</p><p>å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>CMD</code>Â éƒ½éœ€è¦ä¸€ä¸ªäº¤äº’å¼çš„Â <code>shell</code>Â (bash, Python, perl ç­‰)ï¼Œä¾‹å¦‚Â <code>CMD [&quot;perl&quot;, &quot;-de0&quot;]</code>ï¼Œæˆ–è€…Â <code>CMD [&quot;PHP&quot;, &quot;-a&quot;]</code>ã€‚ä½¿ç”¨è¿™ç§å½¢å¼æ„å‘³ç€ï¼Œå½“ä½ æ‰§è¡Œç±»ä¼¼Â <code>docker run \-it python</code>Â æ—¶ï¼Œä½ ä¼šè¿›å…¥ä¸€ä¸ªå‡†å¤‡å¥½çš„Â <code>shell</code>Â ä¸­ã€‚<code>CMD</code>Â åº”è¯¥åœ¨æå°‘çš„æƒ…å†µä¸‹æ‰èƒ½ä»¥Â <code>CMD [&quot;param&quot;, &quot;param&quot;]</code>Â çš„å½¢å¼ä¸Â <code>ENTRYPOINT</code>Â ååŒä½¿ç”¨ï¼Œé™¤éä½ å’Œä½ çš„é•œåƒä½¿ç”¨è€…éƒ½å¯¹Â <code>ENTRYPOINT</code>Â çš„å·¥ä½œæ–¹å¼ååˆ†ç†Ÿæ‚‰ã€‚</p><h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><p><code>EXPOSE</code>Â æŒ‡ä»¤ç”¨äºæŒ‡å®šå®¹å™¨å°†è¦ç›‘å¬çš„ç«¯å£ã€‚å› æ­¤ï¼Œä½ åº”è¯¥ä¸ºä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨å¸¸è§çš„ç«¯å£ã€‚ä¾‹å¦‚ï¼Œæä¾›Â <code>Apache</code>Â web æœåŠ¡çš„é•œåƒåº”è¯¥ä½¿ç”¨Â <code>EXPOSE 80</code>ï¼Œè€Œæä¾›Â <code>MongoDB</code>Â æœåŠ¡çš„é•œåƒä½¿ç”¨Â <code>EXPOSE 27017</code>ã€‚</p><p>å¯¹äºå¤–éƒ¨è®¿é—®ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ‰§è¡ŒÂ <code>docker run</code>Â æ—¶ä½¿ç”¨ä¸€ä¸ªæ ‡å¿—æ¥æŒ‡ç¤ºå¦‚ä½•å°†æŒ‡å®šçš„ç«¯å£æ˜ å°„åˆ°æ‰€é€‰æ‹©çš„ç«¯å£ã€‚</p><h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><p>ä¸ºäº†æ–¹ä¾¿æ–°ç¨‹åºè¿è¡Œï¼Œä½ å¯ä»¥ä½¿ç”¨Â <code>ENV</code>Â æ¥ä¸ºå®¹å™¨ä¸­å®‰è£…çš„ç¨‹åºæ›´æ–°Â <code>PATH</code>Â ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ä½¿ç”¨Â <code>ENV PATH /usr/local/nginx/bin:$PATH</code>Â æ¥ç¡®ä¿Â <code>CMD [&quot;nginx&quot;]</code>Â èƒ½æ­£ç¡®è¿è¡Œã€‚</p><p><code>ENV</code>Â æŒ‡ä»¤ä¹Ÿå¯ç”¨äºä¸ºä½ æƒ³è¦å®¹å™¨åŒ–çš„æœåŠ¡æä¾›å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚ Postgres éœ€è¦çš„Â <code>PGDATA</code>ã€‚</p><p>æœ€åï¼Œ<code>ENV</code>Â ä¹Ÿèƒ½ç”¨äºè®¾ç½®å¸¸è§çš„ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ENV PG_MAJOR <span class="hljs-number">9.3</span><br><br>ENV PG_VERSION <span class="hljs-number">9.3</span><span class="hljs-number">.4</span><br><br>RUN curl -SL http://example.com/postgres-$PG_VERSION.tar.xz | tar -xJC /usr/src/postgress &amp;&amp; â€¦<br><br>ENV <span class="hljs-type">PATH</span> /usr/<span class="hljs-keyword">local</span>/postgres-$PG_MAJOR/bin:$<span class="hljs-type">PATH</span><br></code></pre></td></tr></table></figure><p>ç±»ä¼¼äºç¨‹åºä¸­çš„å¸¸é‡ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥è®©ä½ åªéœ€æ”¹å˜Â <code>ENV</code>Â æŒ‡ä»¤æ¥è‡ªåŠ¨çš„æ”¹å˜å®¹å™¨ä¸­çš„è½¯ä»¶ç‰ˆæœ¬ã€‚</p><h3 id="ADD-å’Œ-COPY"><a href="#ADD-å’Œ-COPY" class="headerlink" title="ADD å’Œ COPY"></a>ADD å’Œ COPY</h3><p>è™½ç„¶Â <code>ADD</code>Â å’ŒÂ <code>COPY</code>Â åŠŸèƒ½ç±»ä¼¼ï¼Œä½†ä¸€èˆ¬ä¼˜å…ˆä½¿ç”¨Â <code>COPY</code>ã€‚å› ä¸ºå®ƒæ¯”Â <code>ADD</code>Â æ›´é€æ˜ã€‚<code>COPY</code>Â åªæ”¯æŒç®€å•å°†æœ¬åœ°æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨ä¸­ï¼Œè€ŒÂ <code>ADD</code>Â æœ‰ä¸€äº›å¹¶ä¸æ˜æ˜¾çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚æœ¬åœ° tar æå–å’Œè¿œç¨‹ URL æ”¯æŒï¼‰ã€‚å› æ­¤ï¼Œ<code>ADD</code>Â çš„æœ€ä½³ç”¨ä¾‹æ˜¯å°†æœ¬åœ° tar æ–‡ä»¶è‡ªåŠ¨æå–åˆ°é•œåƒä¸­ï¼Œä¾‹å¦‚Â <code>ADD rootfs.tar.xz</code>ã€‚</p><p>å¦‚æœä½ çš„Â <code>Dockerfile</code>Â æœ‰å¤šä¸ªæ­¥éª¤éœ€è¦ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­ä¸åŒçš„æ–‡ä»¶ã€‚å•ç‹¬Â <code>COPY</code>Â æ¯ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§çš„Â <code>COPY</code>Â æ‰€æœ‰æ–‡ä»¶ï¼Œè¿™å°†ä¿è¯æ¯ä¸ªæ­¥éª¤çš„æ„å»ºç¼“å­˜åªåœ¨ç‰¹å®šçš„æ–‡ä»¶å˜åŒ–æ—¶å¤±æ•ˆã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">COPY</span> requirements.txt <span class="hljs-regexp">/tmp/</span><br><br>RUN pip install --requirement <span class="hljs-regexp">/tmp/</span>requirements.txt<br><br><span class="hljs-keyword">COPY</span> . <span class="hljs-regexp">/tmp/</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå°†Â <code>COPY . /tmp/</code>Â æ”¾ç½®åœ¨Â <code>RUN</code>Â æŒ‡ä»¤ä¹‹å‰ï¼Œåªè¦Â <code>.</code>Â ç›®å½•ä¸­ä»»ä½•ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œéƒ½ä¼šå¯¼è‡´åç»­æŒ‡ä»¤çš„ç¼“å­˜å¤±æ•ˆã€‚</p><p>ä¸ºäº†è®©é•œåƒå°½é‡å°ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨Â <code>ADD</code>Â æŒ‡ä»¤ä»è¿œç¨‹ URL è·å–åŒ…ï¼Œè€Œæ˜¯ä½¿ç”¨Â <code>curl</code>Â å’ŒÂ <code>wget</code>ã€‚è¿™æ ·ä½ å¯ä»¥åœ¨æ–‡ä»¶æå–å®Œä¹‹ååˆ æ‰ä¸å†éœ€è¦çš„æ–‡ä»¶æ¥é¿å…åœ¨é•œåƒä¸­é¢å¤–æ·»åŠ ä¸€å±‚ã€‚æ¯”å¦‚å°½é‡é¿å…ä¸‹é¢çš„ç”¨æ³•ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">ADD http:<span class="hljs-regexp">//</span>example.com<span class="hljs-regexp">/big.tar.xz /u</span>sr<span class="hljs-regexp">/src/</span>things/<br><br>RUN tar -xJf <span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/things/</span>big.tar.xz -C <span class="hljs-regexp">/usr/</span>src/things<br><br>RUN make -C <span class="hljs-regexp">/usr/</span>src/things all<br></code></pre></td></tr></table></figure><p>è€Œæ˜¯åº”è¯¥ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹æ³•ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">RUN mkdir -p <span class="hljs-regexp">/usr/</span>src/things \<br>    &amp;&amp; curl -SL http:<span class="hljs-regexp">//</span>example.com/big.tar.xz \<br>    | tar -xJC <span class="hljs-regexp">/usr/</span>src/things \<br>    &amp;&amp; make -C <span class="hljs-regexp">/usr/</span>src/things all<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä½¿ç”¨çš„ç®¡é“æ“ä½œï¼Œæ‰€ä»¥æ²¡æœ‰ä¸­é—´æ–‡ä»¶éœ€è¦åˆ é™¤ã€‚</p><p>å¯¹äºå…¶ä»–ä¸éœ€è¦Â <code>ADD</code>Â çš„è‡ªåŠ¨æå–åŠŸèƒ½çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä½ åº”è¯¥ä½¿ç”¨Â <code>COPY</code>ã€‚</p><h3 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h3><p><code>ENTRYPOINT</code>Â çš„æœ€ä½³ç”¨å¤„æ˜¯è®¾ç½®é•œåƒçš„ä¸»å‘½ä»¤ï¼Œå…è®¸å°†é•œåƒå½“æˆå‘½ä»¤æœ¬èº«æ¥è¿è¡Œï¼ˆç”¨Â <code>CMD</code>Â æä¾›é»˜è®¤é€‰é¡¹ï¼‰ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¤ºä¾‹é•œåƒæä¾›äº†å‘½ä»¤è¡Œå·¥å…·Â <code>s3cmd</code>:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">ENTRYPOINT <span class="hljs-selector-attr">[<span class="hljs-string">&quot;s3cmd&quot;</span>]</span><br><br>CMD <span class="hljs-selector-attr">[<span class="hljs-string">&quot;--help&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨ç›´æ¥è¿è¡Œè¯¥é•œåƒåˆ›å»ºçš„å®¹å™¨ä¼šæ˜¾ç¤ºå‘½ä»¤å¸®åŠ©ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ docker <span class="hljs-built_in">run</span> s3cmd<br></code></pre></td></tr></table></figure><p>æˆ–è€…æä¾›æ­£ç¡®çš„å‚æ•°æ¥æ‰§è¡ŒæŸä¸ªå‘½ä»¤ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">$ docker <span class="hljs-keyword">run</span><span class="language-bash"> s3cmd <span class="hljs-built_in">ls</span> s3://mybucket</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·é•œåƒåå¯ä»¥å½“æˆå‘½ä»¤è¡Œçš„å‚è€ƒã€‚</p><p><code>ENTRYPOINT</code>Â æŒ‡ä»¤ä¹Ÿå¯ä»¥ç»“åˆä¸€ä¸ªè¾…åŠ©è„šæœ¬ä½¿ç”¨ï¼Œå’Œå‰é¢å‘½ä»¤è¡Œé£æ ¼ç±»ä¼¼ï¼Œå³ä½¿å¯åŠ¨å·¥å…·éœ€è¦ä¸æ­¢ä¸€ä¸ªæ­¥éª¤ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>Postgres</code>Â å®˜æ–¹é•œåƒä½¿ç”¨ä¸‹é¢çš„è„šæœ¬ä½œä¸ºÂ <code>ENTRYPOINT</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -e<br><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> = <span class="hljs-string">&#x27;postgres&#x27;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">chown</span> -R postgres <span class="hljs-string">&quot;<span class="hljs-variable">$PGDATA</span>&quot;</span><br><br>    <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-subst">$(ls -A <span class="hljs-string">&quot;<span class="hljs-variable">$PGDATA</span>&quot;</span>)</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>        gosu postgres initdb<br>    <span class="hljs-keyword">fi</span><br><br>    <span class="hljs-built_in">exec</span> gosu postgres <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè¯¥è„šæœ¬ä½¿ç”¨äº† Bash çš„å†…ç½®å‘½ä»¤ execï¼Œæ‰€ä»¥æœ€åè¿è¡Œçš„è¿›ç¨‹å°±æ˜¯å®¹å™¨çš„ PID ä¸º 1 çš„è¿›ç¨‹ã€‚è¿™æ ·ï¼Œè¿›ç¨‹å°±å¯ä»¥æ¥æ”¶åˆ°ä»»ä½•å‘é€ç»™å®¹å™¨çš„ Unix ä¿¡å·äº†ã€‚</p></blockquote><p>è¯¥è¾…åŠ©è„šæœ¬è¢«æ‹·è´åˆ°å®¹å™¨ï¼Œå¹¶åœ¨å®¹å™¨å¯åŠ¨æ—¶é€šè¿‡Â <code>ENTRYPOINT</code>Â æ‰§è¡Œï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">COPY</span><span class="language-bash"> ./docker-entrypoint.sh /</span><br><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;/docker-entrypoint.sh&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>è¯¥è„šæœ¬å¯ä»¥è®©ç”¨æˆ·ç”¨å‡ ç§ä¸åŒçš„æ–¹å¼å’ŒÂ <code>Postgres</code>Â äº¤äº’ã€‚</p><p>ä½ å¯ä»¥å¾ˆç®€å•åœ°å¯åŠ¨Â <code>Postgres</code>ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ docker <span class="hljs-built_in">run</span> postgres<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ‰§è¡ŒÂ <code>Postgres</code>Â å¹¶ä¼ é€’å‚æ•°ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$ docker <span class="hljs-built_in">run</span> postgres postgres <span class="hljs-comment">--help</span><br></code></pre></td></tr></table></figure><p>æœ€åï¼Œä½ è¿˜å¯ä»¥å¯åŠ¨å¦å¤–ä¸€ä¸ªå®Œå…¨ä¸åŒçš„å·¥å…·ï¼Œæ¯”å¦‚Â <code>Bash</code>ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$ docker <span class="hljs-built_in">run</span> <span class="hljs-comment">--rm -it postgres bash</span><br></code></pre></td></tr></table></figure><h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><p><code>VOLUME</code>Â æŒ‡ä»¤ç”¨äºæš´éœ²ä»»ä½•æ•°æ®åº“å­˜å‚¨æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶ï¼Œæˆ–å®¹å™¨åˆ›å»ºçš„æ–‡ä»¶å’Œç›®å½•ã€‚å¼ºçƒˆå»ºè®®ä½¿ç”¨Â <code>VOLUME</code>Â æ¥ç®¡ç†é•œåƒä¸­çš„å¯å˜éƒ¨åˆ†å’Œç”¨æˆ·å¯ä»¥æ”¹å˜çš„éƒ¨åˆ†ã€‚</p><h3 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h3><p>å¦‚æœæŸä¸ªæœåŠ¡ä¸éœ€è¦ç‰¹æƒæ‰§è¡Œï¼Œå»ºè®®ä½¿ç”¨Â <code>USER</code>Â æŒ‡ä»¤åˆ‡æ¢åˆ°é root ç”¨æˆ·ã€‚å…ˆåœ¨Â <code>Dockerfile</code>Â ä¸­ä½¿ç”¨ç±»ä¼¼Â <code>RUN groupadd \-r postgres &amp;&amp; useradd \-r \-g postgres postgres</code>Â çš„æŒ‡ä»¤åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„ã€‚</p><blockquote><p>æ³¨æ„ï¼šåœ¨é•œåƒä¸­ï¼Œç”¨æˆ·å’Œç”¨æˆ·ç»„æ¯æ¬¡è¢«åˆ†é…çš„ UID&#x2F;GID éƒ½æ˜¯ä¸ç¡®å®šçš„ï¼Œä¸‹æ¬¡é‡æ–°æ„å»ºé•œåƒæ—¶è¢«åˆ†é…åˆ°çš„ UID&#x2F;GID å¯èƒ½ä¼šä¸ä¸€æ ·ã€‚å¦‚æœè¦ä¾èµ–ç¡®å®šçš„ UID&#x2F;GIDï¼Œä½ åº”è¯¥æ˜¾ç¤ºçš„æŒ‡å®šä¸€ä¸ª UID&#x2F;GIDã€‚</p></blockquote><p>ä½ åº”è¯¥é¿å…ä½¿ç”¨Â <code>sudo</code>ï¼Œå› ä¸ºå®ƒä¸å¯é¢„æœŸçš„ TTY å’Œä¿¡å·è½¬å‘è¡Œä¸ºå¯èƒ½é€ æˆçš„é—®é¢˜æ¯”å®ƒèƒ½è§£å†³çš„é—®é¢˜è¿˜å¤šã€‚å¦‚æœä½ çœŸçš„éœ€è¦å’ŒÂ <code>sudo</code>Â ç±»ä¼¼çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œä»¥ root æƒé™åˆå§‹åŒ–æŸä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œä»¥é root æƒé™æ‰§è¡Œå®ƒï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨Â <a href="https://github.com/tianon/gosu">gosu</a>ã€‚</p><p>æœ€åï¼Œä¸ºäº†å‡å°‘å±‚æ•°å’Œå¤æ‚åº¦ï¼Œé¿å…é¢‘ç¹åœ°ä½¿ç”¨Â <code>USER</code>Â æ¥å›åˆ‡æ¢ç”¨æˆ·ã€‚</p><h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h3><p>ä¸ºäº†æ¸…æ™°æ€§å’Œå¯é æ€§ï¼Œä½ åº”è¯¥æ€»æ˜¯åœ¨Â <code>WORKDIR</code>Â ä¸­ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚å¦å¤–ï¼Œä½ åº”è¯¥ä½¿ç”¨Â <code>WORKDIR</code>Â æ¥æ›¿ä»£ç±»ä¼¼äºÂ <code>RUN cd ... &amp;&amp; do-something</code>Â çš„æŒ‡ä»¤ï¼Œåè€…éš¾ä»¥é˜…è¯»ã€æ’é”™å’Œç»´æŠ¤ã€‚</p><h2 id="å®˜æ–¹é•œåƒç¤ºä¾‹"><a href="#å®˜æ–¹é•œåƒç¤ºä¾‹" class="headerlink" title="å®˜æ–¹é•œåƒç¤ºä¾‹"></a>å®˜æ–¹é•œåƒç¤ºä¾‹</h2><p>è¿™äº›å®˜æ–¹é•œåƒçš„ Dockerfile éƒ½æ˜¯å‚è€ƒå…¸èŒƒï¼š<a href="https://github.com/docker-library/docs">https://github.com/docker-library/docs</a></p><h1 id="èµ„æºé“¾æ¥"><a href="#èµ„æºé“¾æ¥" class="headerlink" title="èµ„æºé“¾æ¥"></a>èµ„æºé“¾æ¥</h1><h2 id="å®˜æ–¹ç½‘ç«™"><a href="#å®˜æ–¹ç½‘ç«™" class="headerlink" title="å®˜æ–¹ç½‘ç«™"></a>å®˜æ–¹ç½‘ç«™</h2><ul><li>Docker å®˜æ–¹ä¸»é¡µï¼š<a href="https://www.docker.com/">https://www.docker.com</a></li><li>Docker å®˜æ–¹åšå®¢ï¼š<a href="https://www.docker.com/blog/">https://www.docker.com/blog/</a></li><li>Docker å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/">https://docs.docker.com/</a></li><li>Docker Hubï¼š<a href="https://hub.docker.com/">https://hub.docker.com</a></li><li>Docker çš„æºä»£ç ä»“åº“ï¼š<a href="https://github.com/moby/moby">https://github.com/moby/moby</a></li><li>Docker è·¯çº¿å›¾Â <a href="https://github.com/docker/roadmap/projects">https://github.com/docker/roadmap/projects</a></li><li>Docker å‘å¸ƒç‰ˆæœ¬å†å²ï¼š<a href="https://docs.docker.com/release-notes/">https://docs.docker.com/release-notes/</a></li><li>Docker å¸¸è§é—®é¢˜ï¼š<a href="https://docs.docker.com/engine/faq/">https://docs.docker.com/engine/faq/</a></li><li>Docker è¿œç«¯åº”ç”¨ APIï¼š<a href="https://docs.docker.com/develop/sdk/">https://docs.docker.com/develop/sdk/</a></li></ul><h2 id="å®è·µå‚è€ƒ"><a href="#å®è·µå‚è€ƒ" class="headerlink" title="å®è·µå‚è€ƒ"></a>å®è·µå‚è€ƒ</h2><ul><li>Dockerfile å‚è€ƒï¼š<a href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></li><li>Dockerfile æœ€ä½³å®è·µï¼š<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/">https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/</a></li></ul><h2 id="æŠ€æœ¯äº¤æµ"><a href="#æŠ€æœ¯äº¤æµ" class="headerlink" title="æŠ€æœ¯äº¤æµ"></a>æŠ€æœ¯äº¤æµ</h2><ul><li>Docker é‚®ä»¶åˆ—è¡¨ï¼šÂ <a href="https://groups.google.com/forum/#!forum/docker-user">https://groups.google.com/forum/#!forum/docker-user</a></li><li>Docker çš„ IRC é¢‘é“ï¼š<a href="https://chat.freenode.net/#docker">https://chat.freenode.net#docker</a></li><li>Docker çš„ Twitter ä¸»é¡µï¼š<a href="https://twitter.com/docker">https://twitter.com/docker</a></li></ul><h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><ul><li>Docker çš„ StackOverflow é—®ç­”ä¸»é¡µï¼š<a href="https://stackoverflow.com/search?q=docker">https://stackoverflow.com/search?q=docker</a></li></ul><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><blockquote><p><a href="https://docker/_practice.gitee.io/zh-cn/">https://docker\_practice.gitee.io/zh-cn/</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jupyter NoteBook çš„å¿«æ·é”®ä½¿ç”¨æŒ‡å—</title>
    <link href="/2020/09/25/Jupyter%20NoteBook%20%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <url>/2020/09/25/Jupyter%20NoteBook%20%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="Jupyter-NoteBook-çš„å¿«æ·é”®ä½¿ç”¨æŒ‡å—"><a href="#Jupyter-NoteBook-çš„å¿«æ·é”®ä½¿ç”¨æŒ‡å—" class="headerlink" title="Jupyter NoteBook çš„å¿«æ·é”®ä½¿ç”¨æŒ‡å—"></a>Jupyter NoteBook çš„å¿«æ·é”®ä½¿ç”¨æŒ‡å—</h1><p>Â </p><p>Jupyter Notebook æœ‰ä¸¤ç§é”®ç›˜è¾“å…¥æ¨¡å¼ã€‚å³å‘½ä»¤æ¨¡å¼å’Œç¼–è¾‘æ¨¡å¼ï¼Œè¿™ä¸Â <a href="http://www.vim.org/">Vim</a>Â æœ‰äº›ç±»ä¼¼ã€‚åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹ï¼Œå¯ä»¥å¾€å•å…ƒä¸­é”®å…¥ä»£ç æˆ–æ–‡æœ¬ï¼Œæ­¤æ—¶å•å…ƒæ ¼è¢«ç»¿è‰²çš„æ¡†çº¿åŒ…å›´ï¼Œä¸”å‘½ä»¤æ¨¡å¼ä¸‹çš„å¿«æ·é”®ä¸ç”Ÿæ•ˆã€‚åœ¨å‘½ä»¤æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ç”¨å¿«æ·é”®å‘½ä»¤è¿è¡Œå•å…ƒæ ¼ï¼Œç§»åŠ¨å•å…ƒæ ¼ï¼Œåˆ‡æ¢å•å…ƒæ ¼ç¼–è¾‘çŠ¶æ€ç­‰ç­‰ï¼Œæ­¤æ—¶çš„å•å…ƒæ ¼è¢«ç°è‰²çš„æ¡†çº¿åŒ…å›´ï¼Œä¸”ç¼–è¾‘æ¨¡å¼ä¸‹çš„å¿«æ·é”®ä¸ç”Ÿæ•ˆã€‚</p><p>ä»å‘½ä»¤æ¨¡å¼è¿›å…¥ç¼–è¾‘æ¨¡å¼éœ€æŒ‰Â <code>Enter</code>Â é”®ï¼Œä»ç¼–è¾‘æ¨¡å¼åˆ‡æ¢åˆ°å‘½ä»¤æ¨¡å¼éœ€æŒ‰Â <code>Esc</code>Â é”®ã€‚</p><p>ä»¥ä¸‹ä¸¤è¡¨åˆ†åˆ«æ˜¯å¯¹å‘½ä»¤å’Œç¼–è¾‘ä¸¤ç§æ¨¡å¼ä¸‹å¿«æ·é”®çš„ç®€å•è¯´æ˜ï¼š</p><p>Â </p><h3 id="å‘½ä»¤æ¨¡å¼å¿«æ·é”®ï¼ˆæŒ‰-Esc-é”®å¼€å¯ï¼‰"><a href="#å‘½ä»¤æ¨¡å¼å¿«æ·é”®ï¼ˆæŒ‰-Esc-é”®å¼€å¯ï¼‰" class="headerlink" title="å‘½ä»¤æ¨¡å¼å¿«æ·é”®ï¼ˆæŒ‰ Esc é”®å¼€å¯ï¼‰:"></a>å‘½ä»¤æ¨¡å¼å¿«æ·é”®ï¼ˆæŒ‰ Esc é”®å¼€å¯ï¼‰:</h3><table><thead><tr><th>å¿«æ·é”®</th><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Enter</td><td>è½¬å…¥ç¼–è¾‘æ¨¡å¼</td><td></td></tr><tr><td>Shift-Enter</td><td>è¿è¡Œæœ¬å•å…ƒï¼Œé€‰ä¸­ä¸‹ä¸ªå•å…ƒ</td><td>æ–°å•å…ƒé»˜è®¤ä¸ºå‘½ä»¤æ¨¡å¼</td></tr><tr><td>Ctrl-Enter</td><td>è¿è¡Œæœ¬å•å…ƒ</td><td></td></tr><tr><td>Alt-Enter</td><td>è¿è¡Œæœ¬å•å…ƒï¼Œåœ¨å…¶ä¸‹æ’å…¥æ–°å•å…ƒ</td><td>æ–°å•å…ƒé»˜è®¤ä¸ºç¼–è¾‘æ¨¡å¼</td></tr><tr><td>Y</td><td>å•å…ƒè½¬å…¥ä»£ç çŠ¶æ€</td><td></td></tr><tr><td>M</td><td>å•å…ƒè½¬å…¥ markdown çŠ¶æ€</td><td></td></tr><tr><td>R</td><td>å•å…ƒè½¬å…¥ raw çŠ¶æ€</td><td></td></tr><tr><td>1</td><td>è®¾å®š 1 çº§æ ‡é¢˜</td><td>ä»…åœ¨ markdown çŠ¶æ€ä¸‹æ—¶å»ºè®®ä½¿ç”¨æ ‡é¢˜ç›¸å…³å¿«æ·é”®ï¼Œå¦‚æœå•å…ƒå¤„äºå…¶ä»–çŠ¶æ€ï¼Œåˆ™ä¼šå¼ºåˆ¶åˆ‡æ¢åˆ° markdown çŠ¶æ€</td></tr><tr><td>2</td><td>è®¾å®š 2 çº§æ ‡é¢˜</td><td></td></tr><tr><td>3</td><td>è®¾å®š 3 çº§æ ‡é¢˜</td><td></td></tr><tr><td>4</td><td>è®¾å®š 4 çº§æ ‡é¢˜</td><td></td></tr><tr><td>5</td><td>è®¾å®š 5 çº§æ ‡é¢˜</td><td></td></tr><tr><td>6</td><td>è®¾å®š 6 çº§æ ‡é¢˜</td><td></td></tr><tr><td>Up</td><td>é€‰ä¸­ä¸Šæ–¹å•å…ƒ</td><td></td></tr><tr><td>K</td><td>é€‰ä¸­ä¸Šæ–¹å•å…ƒ</td><td></td></tr><tr><td>Down</td><td>é€‰ä¸­ä¸‹æ–¹å•å…ƒ</td><td></td></tr><tr><td>J</td><td>é€‰ä¸­ä¸‹æ–¹å•å…ƒ</td><td></td></tr><tr><td>Shift-K</td><td>è¿ç»­é€‰æ‹©ä¸Šæ–¹å•å…ƒ</td><td></td></tr><tr><td>Shift-J</td><td>è¿ç»­é€‰æ‹©ä¸‹æ–¹å•å…ƒ</td><td></td></tr><tr><td>A</td><td>åœ¨ä¸Šæ–¹æ’å…¥æ–°å•å…ƒ</td><td></td></tr><tr><td>B</td><td>åœ¨ä¸‹æ–¹æ’å…¥æ–°å•å…ƒ</td><td></td></tr><tr><td>X</td><td>å‰ªåˆ‡é€‰ä¸­çš„å•å…ƒ</td><td></td></tr><tr><td>C</td><td>å¤åˆ¶é€‰ä¸­çš„å•å…ƒ</td><td></td></tr><tr><td>Shift-V</td><td>ç²˜è´´åˆ°ä¸Šæ–¹å•å…ƒ</td><td></td></tr><tr><td>V</td><td>ç²˜è´´åˆ°ä¸‹æ–¹å•å…ƒ</td><td></td></tr><tr><td>Z</td><td>æ¢å¤åˆ é™¤çš„æœ€åä¸€ä¸ªå•å…ƒ</td><td></td></tr><tr><td>D,D</td><td>åˆ é™¤é€‰ä¸­çš„å•å…ƒ</td><td>è¿ç»­æŒ‰ä¸¤ä¸ª D é”®</td></tr><tr><td>Shift-M</td><td>åˆå¹¶é€‰ä¸­çš„å•å…ƒ</td><td></td></tr><tr><td>Ctrl-S</td><td>ä¿å­˜å½“å‰ NoteBook</td><td></td></tr><tr><td>S</td><td>ä¿å­˜å½“å‰ NoteBook</td><td></td></tr><tr><td>L</td><td>å¼€å…³è¡Œå·</td><td>ç¼–è¾‘æ¡†çš„è¡Œå·æ˜¯å¯ä»¥å¼€å¯å’Œå…³é—­çš„</td></tr><tr><td>O</td><td>è½¬æ¢è¾“å‡º</td><td></td></tr><tr><td>Shift-O</td><td>è½¬æ¢è¾“å‡ºæ»šåŠ¨</td><td></td></tr><tr><td>Esc</td><td>å…³é—­é¡µé¢</td><td></td></tr><tr><td>Q</td><td>å…³é—­é¡µé¢</td><td></td></tr><tr><td>H</td><td>æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ©</td><td></td></tr><tr><td>I,I</td><td>ä¸­æ–­ NoteBook å†…æ ¸</td><td></td></tr><tr><td>0,0</td><td>é‡å¯ NoteBook å†…æ ¸</td><td></td></tr><tr><td>Shift</td><td>å¿½ç•¥</td><td></td></tr><tr><td>Shift-Space</td><td>å‘ä¸Šæ»šåŠ¨</td><td></td></tr><tr><td>Space</td><td>å‘ä¸‹æ»šåŠ¨</td><td></td></tr></tbody></table><p>Â </p><h3 id="ç¼–è¾‘æ¨¡å¼å¿«æ·é”®ï¼ˆ-æŒ‰-Enter-é”®å¯åŠ¨ï¼‰"><a href="#ç¼–è¾‘æ¨¡å¼å¿«æ·é”®ï¼ˆ-æŒ‰-Enter-é”®å¯åŠ¨ï¼‰" class="headerlink" title="ç¼–è¾‘æ¨¡å¼å¿«æ·é”®ï¼ˆ æŒ‰ Enter é”®å¯åŠ¨ï¼‰:"></a>ç¼–è¾‘æ¨¡å¼å¿«æ·é”®ï¼ˆ æŒ‰ Enter é”®å¯åŠ¨ï¼‰:</h3><table><thead><tr><th>å¿«æ·é”®</th><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Tab</td><td>ä»£ç è¡¥å…¨æˆ–ç¼©è¿›</td><td></td></tr><tr><td>Shift-Tab</td><td>æç¤º</td><td>è¾“å‡ºå¸®åŠ©ä¿¡æ¯ï¼Œéƒ¨åˆ†å‡½æ•°ã€ç±»ã€æ–¹æ³•ç­‰ä¼šæ˜¾ç¤ºå…¶å®šä¹‰åŸå‹ï¼Œå¦‚æœåœ¨å…¶ååŠ Â <code>?</code>Â å†è¿è¡Œä¼šæ˜¾ç¤ºæ›´åŠ è¯¦ç»†çš„å¸®åŠ©</td></tr><tr><td>Ctrl-]</td><td>ç¼©è¿›</td><td>å‘å³ç¼©è¿›</td></tr><tr><td>Ctrl-[</td><td>è§£é™¤ç¼©è¿›</td><td>å‘å·¦ç¼©è¿›</td></tr><tr><td>Ctrl-A</td><td>å…¨é€‰</td><td></td></tr><tr><td>Ctrl-Z</td><td>æ’¤é”€</td><td></td></tr><tr><td>Ctrl-Shift-Z</td><td>é‡åš</td><td></td></tr><tr><td>Ctrl-Y</td><td>é‡åš</td><td></td></tr><tr><td>Ctrl-Home</td><td>è·³åˆ°å•å…ƒå¼€å¤´</td><td></td></tr><tr><td>Ctrl-Up</td><td>è·³åˆ°å•å…ƒå¼€å¤´</td><td></td></tr><tr><td>Ctrl-End</td><td>è·³åˆ°å•å…ƒæœ«å°¾</td><td></td></tr><tr><td>Ctrl-Down</td><td>è·³åˆ°å•å…ƒæœ«å°¾</td><td></td></tr><tr><td>Ctrl-Left</td><td>è·³åˆ°å·¦è¾¹ä¸€ä¸ªå­—é¦–</td><td></td></tr><tr><td>Ctrl-Right</td><td>è·³åˆ°å³è¾¹ä¸€ä¸ªå­—é¦–</td><td></td></tr><tr><td>Ctrl-Backspace</td><td>åˆ é™¤å‰é¢ä¸€ä¸ªå­—</td><td></td></tr><tr><td>Ctrl-Delete</td><td>åˆ é™¤åé¢ä¸€ä¸ªå­—</td><td></td></tr><tr><td>Esc</td><td>åˆ‡æ¢åˆ°å‘½ä»¤æ¨¡å¼</td><td></td></tr><tr><td>Ctrl-M</td><td>åˆ‡æ¢åˆ°å‘½ä»¤æ¨¡å¼</td><td></td></tr><tr><td>Shift-Enter</td><td>è¿è¡Œæœ¬å•å…ƒï¼Œé€‰ä¸­ä¸‹ä¸€å•å…ƒ</td><td>æ–°å•å…ƒé»˜è®¤ä¸ºå‘½ä»¤æ¨¡å¼</td></tr><tr><td>Ctrl-Enter</td><td>è¿è¡Œæœ¬å•å…ƒ</td><td></td></tr><tr><td>Alt-Enter</td><td>è¿è¡Œæœ¬å•å…ƒï¼Œåœ¨ä¸‹é¢æ’å…¥ä¸€å•å…ƒ</td><td>æ–°å•å…ƒé»˜è®¤ä¸ºç¼–è¾‘æ¨¡å¼</td></tr><tr><td>Ctrl-Shiftâ€“</td><td>åˆ†å‰²å•å…ƒ</td><td>æŒ‰å…‰æ ‡æ‰€åœ¨è¡Œè¿›è¡Œåˆ†å‰²</td></tr><tr><td>Ctrl-Shift-Subtract</td><td>åˆ†å‰²å•å…ƒ</td><td></td></tr><tr><td>Ctrl-S</td><td>ä¿å­˜å½“å‰ NoteBook</td><td></td></tr><tr><td>Shift</td><td>å¿½ç•¥</td><td></td></tr><tr><td>Up</td><td>å…‰æ ‡ä¸Šç§»æˆ–è½¬å…¥ä¸Šä¸€å•å…ƒ</td><td></td></tr><tr><td>Down</td><td>å…‰æ ‡ä¸‹ç§»æˆ–è½¬å…¥ä¸‹ä¸€å•å…ƒ</td><td></td></tr><tr><td>Ctrl-&#x2F;</td><td>æ³¨é‡Šæ•´è¡Œ&#x2F;æ’¤é”€æ³¨é‡Š</td><td>ä»…ä»£ç çŠ¶æ€æœ‰æ•ˆ</td></tr></tbody></table><p><strong>æ³¨ï¼š</strong>Â å¦‚æœå¿«æ·é”®è¢«ç³»ç»Ÿä¸­çš„å…¶å®ƒåº”ç”¨å ç”¨ï¼Œåˆ™å¯èƒ½ä¼šå¤±æ•ˆ</p><p><strong>æ¥æºï¼š</strong>Â <a href="https://opus.konghy.cn/ipynb/jupyter-notebook-keyboard-shortcut.html">https://opus.konghy.cn/ipynb/jupyter-notebook-keyboard-shortcut.html</a></p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python markdown</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyMySQL è¯¦è§£</title>
    <link href="/2020/08/25/PyMySQL%20%E8%AF%A6%E8%A7%A3/"/>
    <url>/2020/08/25/PyMySQL%20%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p><a href="https://github.com/PyMySQL/PyMySQL">PyMySQL</a>Â æ˜¯ä¸€ä¸ªçº¯ Python å®ç°çš„ MySQL å®¢æˆ·ç«¯æ“ä½œåº“ï¼Œæ”¯æŒäº‹åŠ¡ã€å­˜å‚¨è¿‡ç¨‹ã€æ‰¹é‡æ‰§è¡Œç­‰ã€‚</p><p>PyMySQL éµå¾ª Python æ•°æ®åº“ API v2.0 è§„èŒƒï¼Œå¹¶åŒ…å«äº† pure-Python MySQL å®¢æˆ·ç«¯åº“ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>Â </p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> PyMySQL<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºæ•°æ®åº“è¿æ¥"><a href="#åˆ›å»ºæ•°æ®åº“è¿æ¥" class="headerlink" title="åˆ›å»ºæ•°æ®åº“è¿æ¥"></a>åˆ›å»ºæ•°æ®åº“è¿æ¥</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><br>connection = pymysql.connect(host=<span class="hljs-string">&#x27;localhost&#x27;</span>,<br>                             port=<span class="hljs-number">3306</span>,<br>                             user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                             password=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                             db=<span class="hljs-string">&#x27;demo&#x27;</span>,<br>                             charset=<span class="hljs-string">&#x27;utf8&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å‚æ•°åˆ—è¡¨ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>host</td><td>æ•°æ®åº“æœåŠ¡å™¨åœ°å€ï¼Œé»˜è®¤ localhost</td></tr><tr><td>user</td><td>ç”¨æˆ·åï¼Œé»˜è®¤ä¸ºå½“å‰ç¨‹åºè¿è¡Œç”¨æˆ·</td></tr><tr><td>password</td><td>ç™»å½•å¯†ç ï¼Œé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²</td></tr><tr><td>database</td><td>é»˜è®¤æ“ä½œçš„æ•°æ®åº“</td></tr><tr><td>port</td><td>æ•°æ®åº“ç«¯å£ï¼Œé»˜è®¤ä¸º 3306</td></tr><tr><td>bind_address</td><td>å½“å®¢æˆ·ç«¯æœ‰å¤šä¸ªç½‘ç»œæ¥å£æ—¶ï¼ŒæŒ‡å®šè¿æ¥åˆ°ä¸»æœºçš„æ¥å£ã€‚å‚æ•°å¯ä»¥æ˜¯ä¸»æœºåæˆ–IPåœ°å€ã€‚</td></tr><tr><td>unix_socket</td><td>unix å¥—æ¥å­—åœ°å€ï¼ŒåŒºåˆ«äº host è¿æ¥</td></tr><tr><td>read_timeout</td><td>è¯»å–æ•°æ®è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤æ— é™åˆ¶</td></tr><tr><td>write_timeout</td><td>å†™å…¥æ•°æ®è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤æ— é™åˆ¶</td></tr><tr><td>charset</td><td>æ•°æ®åº“ç¼–ç </td></tr><tr><td>sql_mode</td><td>æŒ‡å®šé»˜è®¤çš„ SQL_MODE</td></tr><tr><td>read_default_file</td><td>Specifies my.cnf file to read these parameters from under the [client] section.</td></tr><tr><td>conv</td><td>Conversion dictionary to use instead of the default one. This is used to provide custom marshalling and unmarshaling of types.</td></tr><tr><td>use_unicode</td><td>Whether or not to default to unicode strings. This option defaults to true for Py3k.</td></tr><tr><td>client_flag</td><td>Custom flags to send to MySQL. Find potential values in constants.CLIENT.</td></tr><tr><td>cursorclass</td><td>è®¾ç½®é»˜è®¤çš„æ¸¸æ ‡ç±»å‹</td></tr><tr><td>init_command</td><td>å½“è¿æ¥å»ºç«‹å®Œæˆä¹‹åæ‰§è¡Œçš„åˆå§‹åŒ– SQL è¯­å¥</td></tr><tr><td>connect_timeout</td><td>è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 10ï¼Œæœ€å° 1ï¼Œæœ€å¤§ 31536000</td></tr><tr><td>ssl</td><td>A dict of arguments similar to mysql_ssl_set()â€™s parameters. For now the capath and cipher arguments are not supported.</td></tr><tr><td>read_default_group</td><td>Group to read from in the configuration file.</td></tr><tr><td>compress</td><td>Not supported</td></tr><tr><td>named_pipe</td><td>Not supported</td></tr><tr><td>autocommit</td><td>æ˜¯å¦è‡ªåŠ¨æäº¤ï¼Œé»˜è®¤ä¸è‡ªåŠ¨æäº¤ï¼Œå‚æ•°å€¼ä¸º None è¡¨ç¤ºä»¥æœåŠ¡å™¨ä¸ºå‡†</td></tr><tr><td>local_infile</td><td>Boolean to enable the use of LOAD DATA LOCAL command. (default: False)</td></tr><tr><td>max_allowed_packet</td><td>å‘é€ç»™æœåŠ¡å™¨çš„æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤ä¸º 16MB</td></tr><tr><td>defer_connect</td><td>æ˜¯å¦æƒ°æ€§è¿æ¥ï¼Œé»˜è®¤ä¸ºç«‹å³è¿æ¥</td></tr><tr><td>auth_plugin_map</td><td>A dict of plugin names to a class that processes that plugin. The class will take the Connection object as the argument to the constructor. The class needs an authenticate method taking an authentication packet as an argument. For the dialog plugin, a prompt(echo, prompt) method can be used (if no authenticate method) for returning a string from the user. (experimental)</td></tr><tr><td>server_public_key</td><td>SHA256 authenticaiton plugin public key value. (default: None)</td></tr><tr><td>db</td><td>å‚æ•° database çš„åˆ«å</td></tr><tr><td>passwd</td><td>å‚æ•° password çš„åˆ«å</td></tr><tr><td>binary_prefix</td><td>Add _binary prefix on bytes and bytearray. (default: False)</td></tr></tbody></table><h2 id="æ‰§è¡Œ-SQL"><a href="#æ‰§è¡Œ-SQL" class="headerlink" title="æ‰§è¡Œ SQL"></a>æ‰§è¡Œ SQL</h2><ul><li><p>cursor.execute(sql, args) æ‰§è¡Œå•æ¡ SQL</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è·å–æ¸¸æ ‡</span><br>cursor = connection.cursor()<br>  <br><span class="hljs-comment"># åˆ›å»ºæ•°æ®è¡¨</span><br>effect_row = cursor.execute(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">CREATE TABLE `users` (</span><br><span class="hljs-string">`name` varchar(32) NOT NULL,</span><br><span class="hljs-string">`age` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27;,</span><br><span class="hljs-string">PRIMARY KEY (`name`)</span><br><span class="hljs-string">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br>  <br><span class="hljs-comment"># æ’å…¥æ•°æ®(å…ƒç»„æˆ–åˆ—è¡¨)</span><br>effect_row = cursor.execute(<span class="hljs-string">&#x27;INSERT INTO `users` (`name`, `age`) VALUES (%s, %s)&#x27;</span>, (<span class="hljs-string">&#x27;mary&#x27;</span>, <span class="hljs-number">18</span>))<br>  <br><span class="hljs-comment"># æ’å…¥æ•°æ®(å­—å…¸)</span><br>info = &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;fake&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">15</span>&#125;<br>effect_row = cursor.execute(<span class="hljs-string">&#x27;INSERT INTO `users` (`name`, `age`) VALUES (%(name)s, %(age)s)&#x27;</span>, info)<br>  <br>connection.commit()<br></code></pre></td></tr></table></figure></li><li><p>executemany(sql, args) æ‰¹é‡æ‰§è¡Œ SQL</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è·å–æ¸¸æ ‡</span><br>cursor = connection.cursor()<br>  <br><span class="hljs-comment"># æ‰¹é‡æ’å…¥</span><br>effect_row = cursor.executemany(<br>  <span class="hljs-string">&#x27;INSERT INTO `users` (`name`, `age`) VALUES (%s, %s) ON DUPLICATE KEY UPDATE age=VALUES(age)&#x27;</span>, [<br>      (<span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-number">13</span>),<br>      (<span class="hljs-string">&#x27;fake&#x27;</span>, <span class="hljs-number">28</span>),<br>  ])<br>  <br>connection.commit()<br></code></pre></td></tr></table></figure></li></ul><p>Â </p><p>æ³¨æ„ï¼šINSERTã€UPDATEã€DELETE ç­‰ä¿®æ”¹æ•°æ®çš„è¯­å¥éœ€æ‰‹åŠ¨æ‰§è¡Œ<code>connection.commit()</code>å®Œæˆå¯¹æ•°æ®ä¿®æ”¹çš„æäº¤ã€‚</p><h2 id="è·å–è‡ªå¢-ID"><a href="#è·å–è‡ªå¢-ID" class="headerlink" title="è·å–è‡ªå¢ ID"></a>è·å–è‡ªå¢ ID</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">cursor.lastrowid<br></code></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢æ•°æ®"><a href="#æŸ¥è¯¢æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ•°æ®"></a>æŸ¥è¯¢æ•°æ®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ‰§è¡ŒæŸ¥è¯¢ SQL</span><br>cursor.execute(<span class="hljs-string">&#x27;SELECT * FROM `users`&#x27;</span>)<br><br><span class="hljs-comment"># è·å–å•æ¡æ•°æ®</span><br>cursor.fetchone()<br><br><span class="hljs-comment"># è·å–å‰Næ¡æ•°æ®</span><br>cursor.fetchmany(<span class="hljs-number">3</span>)<br><br><span class="hljs-comment"># è·å–æ‰€æœ‰æ•°æ®</span><br>cursor.fetchall()<br></code></pre></td></tr></table></figure><h2 id="æ¸¸æ ‡æ§åˆ¶"><a href="#æ¸¸æ ‡æ§åˆ¶" class="headerlink" title="æ¸¸æ ‡æ§åˆ¶"></a>æ¸¸æ ‡æ§åˆ¶</h2><p>æ‰€æœ‰çš„æ•°æ®æŸ¥è¯¢æ“ä½œå‡åŸºäºæ¸¸æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>cursor.scroll(num, mode)</code>æ§åˆ¶æ¸¸æ ‡çš„ä½ç½®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">cursor.scroll(<span class="hljs-number">1</span>, mode=<span class="hljs-string">&#x27;relative&#x27;</span>) <span class="hljs-comment"># ç›¸å¯¹å½“å‰ä½ç½®ç§»åŠ¨</span><br>cursor.scroll(<span class="hljs-number">2</span>, mode=<span class="hljs-string">&#x27;absolute&#x27;</span>) <span class="hljs-comment"># ç›¸å¯¹ç»å¯¹ä½ç½®ç§»åŠ¨</span><br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®æ¸¸æ ‡ç±»å‹"><a href="#è®¾ç½®æ¸¸æ ‡ç±»å‹" class="headerlink" title="è®¾ç½®æ¸¸æ ‡ç±»å‹"></a>è®¾ç½®æ¸¸æ ‡ç±»å‹</h2><p>æŸ¥è¯¢æ—¶ï¼Œé»˜è®¤è¿”å›çš„æ•°æ®ç±»å‹ä¸ºå…ƒç»„ï¼Œå¯ä»¥è‡ªå®šä¹‰è®¾ç½®è¿”å›ç±»å‹ã€‚æ”¯æŒ5ç§æ¸¸æ ‡ç±»å‹ï¼š</p><ul><li>Cursor: é»˜è®¤ï¼Œå…ƒç»„ç±»å‹</li><li>DictCursor: å­—å…¸ç±»å‹</li><li>DictCursorMixin: æ”¯æŒè‡ªå®šä¹‰çš„æ¸¸æ ‡ç±»å‹ï¼Œéœ€å…ˆè‡ªå®šä¹‰æ‰å¯ä½¿ç”¨</li><li>SSCursor: æ— ç¼“å†²å…ƒç»„ç±»å‹</li><li>SSDictCursor: æ— ç¼“å†²å­—å…¸ç±»å‹</li></ul><p>æ— ç¼“å†²æ¸¸æ ‡ç±»å‹ï¼Œé€‚ç”¨äºæ•°æ®é‡å¾ˆå¤§ï¼Œä¸€æ¬¡æ€§è¿”å›å¤ªæ…¢ï¼Œæˆ–è€…æœåŠ¡ç«¯å¸¦å®½è¾ƒå°æ—¶ã€‚æºç æ³¨é‡Šï¼š</p><blockquote><p>Unbuffered Cursor, mainly useful for queries that return a lot of data, or for connections to remote servers over a slow network.</p><p>Instead of copying every row of data into a buffer, this will fetch rows as needed. The upside of this is the client uses much less memory, and rows are returned much faster when traveling over a slow network or if the result set is very big.</p><p>There are limitations, though. The MySQL protocol doesnâ€™t support returning the total number of rows, so the only way to tell how many rows there are is to iterate over every row returned. Also, it currently isnâ€™t possible to scroll backwards, as only the current row is held in memory.</p></blockquote><p>åˆ›å»ºè¿æ¥æ—¶ï¼Œé€šè¿‡ cursorclass å‚æ•°æŒ‡å®šç±»å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">connection = pymysql.connect(host=<span class="hljs-string">&#x27;localhost&#x27;</span>,<br>                             user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                             password=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                             db=<span class="hljs-string">&#x27;demo&#x27;</span>,<br>                             charset=<span class="hljs-string">&#x27;utf8&#x27;</span>,<br>                             cursorclass=pymysql.cursors.DictCursor)<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºæ¸¸æ ‡æ—¶æŒ‡å®šç±»å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">cursor = connection.cursor(cursor=pymysql.cursors.DictCursor)<br></code></pre></td></tr></table></figure><h2 id="äº‹åŠ¡å¤„ç†"><a href="#äº‹åŠ¡å¤„ç†" class="headerlink" title="äº‹åŠ¡å¤„ç†"></a>äº‹åŠ¡å¤„ç†</h2><ul><li><p>å¼€å¯äº‹åŠ¡Â <code>connection.begin()</code></p></li><li><p>æäº¤ä¿®æ”¹Â <code>connection.commit()</code></p></li><li><p>å›æ»šäº‹åŠ¡Â <code>connection.rollback()</code></p></li></ul><h2 id="é˜²-SQL-æ³¨å…¥"><a href="#é˜²-SQL-æ³¨å…¥" class="headerlink" title="é˜² SQL æ³¨å…¥"></a>é˜² SQL æ³¨å…¥</h2><ul><li><p>è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦Â <code>connection.escape_string(str)</code></p></li><li><p>å‚æ•°åŒ–è¯­å¥ æ”¯æŒä¼ å…¥å‚æ•°è¿›è¡Œè‡ªåŠ¨è½¬ä¹‰ã€æ ¼å¼åŒ– SQL è¯­å¥ï¼Œä»¥é¿å… SQL æ³¨å…¥ç­‰å®‰å…¨é—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ’å…¥æ•°æ®(å…ƒç»„æˆ–åˆ—è¡¨)</span><br>effect_row = cursor.execute(<span class="hljs-string">&#x27;INSERT INTO `users` (`name`, `age`) VALUES (%s, %s)&#x27;</span>, (<span class="hljs-string">&#x27;mary&#x27;</span>, <span class="hljs-number">18</span>))<br><br><span class="hljs-comment"># æ’å…¥æ•°æ®(å­—å…¸)</span><br>info = &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;fake&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">15</span>&#125;<br>effect_row = cursor.execute(<span class="hljs-string">&#x27;INSERT INTO `users` (`name`, `age`) VALUES (%(name)s, %(age)s)&#x27;</span>, info)<br><br><span class="hljs-comment"># æ‰¹é‡æ’å…¥</span><br>effect_row = cursor.executemany(<br><span class="hljs-string">&#x27;INSERT INTO `users` (`name`, `age`) VALUES (%s, %s) ON DUPLICATE KEY UPDATE age=VALUES(age)&#x27;</span>, [<br>  (<span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-number">13</span>),<br>  (<span class="hljs-string">&#x27;fake&#x27;</span>, <span class="hljs-number">28</span>),<br>])<br></code></pre></td></tr></table></figure></li></ul><p>Â </p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://www.cnblogs.com/wt11/p/6141225.html">Pythonä¸­æ“ä½œmysqlçš„pymysqlæ¨¡å—è¯¦è§£</a></li><li><a href="http://www.cnblogs.com/liubinsh/p/7568423.html">Pythonä¹‹pymysqlçš„ä½¿ç”¨</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>SQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“ mysql python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Celery çš„ç”¨æ³•ä»‹ç»</title>
    <link href="/2020/08/18/Celery%20%E7%9A%84%E7%94%A8%E6%B3%95%E4%BB%8B%E7%BB%8D/"/>
    <url>/2020/08/18/Celery%20%E7%9A%84%E7%94%A8%E6%B3%95%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="celeryä»‹ç»"><a href="#celeryä»‹ç»" class="headerlink" title="celeryä»‹ç»"></a><strong>celeryä»‹ç»</strong></h2><h3 id="ä»€ä¹ˆæ˜¯celery"><a href="#ä»€ä¹ˆæ˜¯celery" class="headerlink" title="ä»€ä¹ˆæ˜¯celery"></a><strong>ä»€ä¹ˆæ˜¯celery</strong></h3><p><strong>è¿™æ¬¡æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹Pythonçš„ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—celeryï¼Œé‚£ä¹ˆceleryæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</strong></p><ul><li><code>celeryæ˜¯ä¸€ä¸ªçµæ´»ä¸”å¯é çš„ï¼Œå¤„ç†å¤§é‡æ¶ˆæ¯çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¯ä»¥åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´å¤„ç†æŸä¸ªä»»åŠ¡ã€‚</code></li><li><code>celeryæ˜¯ä¸€ä¸ªä¸“æ³¨äºå®æ—¶å¤„ç†çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ”¯æŒä»»åŠ¡è°ƒåº¦ã€‚</code></li><li><code>celeryæ˜¯å¼€æºçš„ï¼Œæœ‰å¾ˆå¤šä½¿ç”¨è€…ã€‚</code></li><li><code>celeryå®Œå…¨åŸºäºPythonè¯­è¨€ç¼–å†™ã€‚</code></li></ul><p><strong>æ‰€ä»¥celeryæ˜¯ä¸€ä¸ªä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œç±»ä¼¼äºApacheçš„airflowï¼Œå½“ç„¶airflowä¹Ÿæ˜¯åŸºäºPythonè¯­è¨€ç¼–å†™ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œceleryæ˜¯ç”¨æ¥è°ƒåº¦ä»»åŠ¡çš„ï¼Œå®ƒæœ¬èº«å¹¶ä¸å…·å¤‡ä»»åŠ¡çš„å­˜å‚¨åŠŸèƒ½ï¼Œè€Œæˆ‘ä»¬è¯´åœ¨è°ƒåº¦ä»»åŠ¡çš„æ—¶å€™è‚¯å®šæ˜¯è¦æŠŠä»»åŠ¡å­˜èµ·æ¥çš„ï¼Œå› æ­¤åœ¨ä½¿ç”¨celeryçš„æ—¶å€™è¿˜éœ€è¦æ­é…ä¸€äº›å…·å¤‡å­˜å‚¨ã€è®¿é—®åŠŸèƒ½çš„å·¥å…·ï¼Œæ¯”å¦‚ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€Redisç¼“å­˜ã€æ•°æ®åº“ç­‰ç­‰ã€‚å®˜æ–¹æ¨èçš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—RabbitMQï¼Œä¸ªäººè®¤ä¸ºæœ‰äº›æ—¶å€™ä½¿ç”¨Redisä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œå½“ç„¶æˆ‘ä»¬éƒ½ä¼šä»‹ç»ã€‚</strong></p><p><strong>é‚£ä¹ˆceleryéƒ½å¯ä»¥åœ¨å“ªäº›åœºæ™¯ä¸­ä½¿ç”¨å‘¢ï¼Ÿ</strong></p><ul><li><code>å¼‚æ­¥ä»»åŠ¡ï¼šä¸€äº›è€—æ—¶çš„æ“ä½œå¯ä»¥äº¤ç»™celeryå¼‚æ­¥æ‰§è¡Œï¼Œè€Œä¸ç”¨ç­‰ç€ç¨‹åºå¤„ç†å®Œæ‰çŸ¥é“ç»“æœã€‚æ¯”å¦‚ï¼šè§†é¢‘è½¬ç ã€é‚®ä»¶å‘é€ã€æ¶ˆæ¯æ¨é€ç­‰ç­‰ã€‚</code></li><li><code>å®šæ—¶ä»»åŠ¡ï¼šæ¯”å¦‚å®šæ—¶æ¨é€æ¶ˆæ¯ã€å®šæ—¶çˆ¬å–æ•°æ®ã€å®šæ—¶ç»Ÿè®¡æ•°æ®ç­‰ç­‰</code></li></ul><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/traditional/p/11788756.html">è¿™æ˜¯ä¸€ç¯‡å¾ˆè¯¦ç»†çš„celeryç”¨æ³•ä»‹ç»</a></p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RESTful è®¾è®¡æ–¹æ³•</title>
    <link href="/2020/07/23/RESTful%20%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95/"/>
    <url>/2020/07/23/RESTful%20%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="RESTfulè®¾è®¡æ–¹æ³•"><a href="#RESTfulè®¾è®¡æ–¹æ³•" class="headerlink" title="RESTfulè®¾è®¡æ–¹æ³•"></a>RESTfulè®¾è®¡æ–¹æ³•</h1><h2 id="1-åŸŸå"><a href="#1-åŸŸå" class="headerlink" title="1. åŸŸå"></a>1. åŸŸå</h2><p>åº”è¯¥å°½é‡å°†APIéƒ¨ç½²åœ¨ä¸“ç”¨åŸŸåä¹‹ä¸‹ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>api.example.com<br></code></pre></td></tr></table></figure><p>å¦‚æœç¡®å®šAPIå¾ˆç®€å•ï¼Œä¸ä¼šæœ‰è¿›ä¸€æ­¥æ‰©å±•ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨ä¸»åŸŸåä¸‹ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>example.org<span class="hljs-regexp">/api/</span><br></code></pre></td></tr></table></figure><h2 id="2-ç‰ˆæœ¬ï¼ˆVersioningï¼‰"><a href="#2-ç‰ˆæœ¬ï¼ˆVersioningï¼‰" class="headerlink" title="2. ç‰ˆæœ¬ï¼ˆVersioningï¼‰"></a>2. ç‰ˆæœ¬ï¼ˆVersioningï¼‰</h2><p>åº”è¯¥å°†APIçš„ç‰ˆæœ¬å·æ”¾å…¥URLã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.example.com<span class="hljs-regexp">/app/</span><span class="hljs-number">1.0</span>/foo<br><br>http:<span class="hljs-regexp">//</span>www.example.com<span class="hljs-regexp">/app/</span><span class="hljs-number">1.1</span>/foo<br><br>http:<span class="hljs-regexp">//</span>www.example.com<span class="hljs-regexp">/app/</span><span class="hljs-number">2.0</span>/foo<br></code></pre></td></tr></table></figure><p>å¦ä¸€ç§åšæ³•æ˜¯ï¼Œå°†ç‰ˆæœ¬å·æ”¾åœ¨HTTPå¤´ä¿¡æ¯ä¸­ï¼Œä½†ä¸å¦‚æ”¾å…¥URLæ–¹ä¾¿å’Œç›´è§‚ã€‚<a href="https://developer.github.com/v3/media/#request-specific-version">Github</a>é‡‡ç”¨è¿™ç§åšæ³•ã€‚</p><p>å› ä¸ºä¸åŒçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç†è§£æˆåŒä¸€ç§èµ„æºçš„ä¸åŒè¡¨ç°å½¢å¼ï¼Œæ‰€ä»¥åº”è¯¥é‡‡ç”¨åŒä¸€ä¸ªURLã€‚ç‰ˆæœ¬å·å¯ä»¥åœ¨HTTPè¯·æ±‚å¤´ä¿¡æ¯çš„Acceptå­—æ®µä¸­è¿›è¡ŒåŒºåˆ†ï¼ˆå‚è§<a href="http://www.informit.com/articles/article.aspx?p=1566460">Versioning REST Services</a>ï¼‰ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Accept</span>: vnd.example-com.foo+json; version=<span class="hljs-number">1</span>.<span class="hljs-number">0</span><br><br><span class="hljs-attribute">Accept</span>: vnd.example-com.foo+json; version=<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><br><span class="hljs-attribute">Accept</span>: vnd.example-com.foo+json; version=<span class="hljs-number">2</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="3-è·¯å¾„ï¼ˆEndpointï¼‰"><a href="#3-è·¯å¾„ï¼ˆEndpointï¼‰" class="headerlink" title="3. è·¯å¾„ï¼ˆEndpointï¼‰"></a>3. è·¯å¾„ï¼ˆEndpointï¼‰</h2><p>è·¯å¾„åˆç§°â€ç»ˆç‚¹â€ï¼ˆendpointï¼‰ï¼Œè¡¨ç¤ºAPIçš„å…·ä½“ç½‘å€ï¼Œæ¯ä¸ªç½‘å€ä»£è¡¨ä¸€ç§èµ„æºï¼ˆresourceï¼‰</p><p><strong>(1) èµ„æºä½œä¸ºç½‘å€ï¼Œåªèƒ½æœ‰åè¯ï¼Œä¸èƒ½æœ‰åŠ¨è¯ï¼Œè€Œä¸”æ‰€ç”¨çš„åè¯å¾€å¾€ä¸æ•°æ®åº“çš„è¡¨åå¯¹åº”ã€‚</strong></p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œä»¥ä¸‹æ˜¯ä¸å¥½çš„ä¾‹å­:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">/getProducts<br>/listOrders<br>/retreiveClientByOrder?orderId=1<br></code></pre></td></tr></table></figure><p>å¯¹äºä¸€ä¸ªç®€æ´ç»“æ„ï¼Œä½ åº”è¯¥å§‹ç»ˆç”¨åè¯ã€‚ æ­¤å¤–ï¼Œåˆ©ç”¨çš„HTTPæ–¹æ³•å¯ä»¥åˆ†ç¦»ç½‘å€ä¸­çš„èµ„æºåç§°çš„æ“ä½œã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /products ï¼šå°†è¿”å›æ‰€æœ‰äº§å“æ¸…å•<br><span class="hljs-attribute">POST</span> /products ï¼šå°†äº§å“æ–°å»ºåˆ°é›†åˆ<br><span class="hljs-attribute">GET</span> /products/<span class="hljs-number">4</span> ï¼šå°†è·å–äº§å“ <span class="hljs-number">4</span><br><span class="hljs-attribute">PATCH</span>ï¼ˆæˆ–ï¼‰PUT /products/<span class="hljs-number">4</span> ï¼šå°†æ›´æ–°äº§å“ <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p><strong>(2) APIä¸­çš„åè¯åº”è¯¥ä½¿ç”¨å¤æ•°ã€‚æ— è®ºå­èµ„æºæˆ–è€…æ‰€æœ‰èµ„æºã€‚</strong></p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œè·å–äº§å“çš„APIå¯ä»¥è¿™æ ·å®šä¹‰</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">è·å–å•ä¸ªäº§å“ï¼šhttp:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/AppName/</span>rest<span class="hljs-regexp">/products/</span><span class="hljs-number">1</span><br>è·å–æ‰€æœ‰äº§å“: http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/AppName/</span>rest/products<br></code></pre></td></tr></table></figure><h2 id="3-HTTPåŠ¨è¯"><a href="#3-HTTPåŠ¨è¯" class="headerlink" title="3. HTTPåŠ¨è¯"></a>3. HTTPåŠ¨è¯</h2><p>å¯¹äºèµ„æºçš„å…·ä½“æ“ä½œç±»å‹ï¼Œç”±HTTPåŠ¨è¯è¡¨ç¤ºã€‚</p><p>å¸¸ç”¨çš„HTTPåŠ¨è¯æœ‰ä¸‹é¢å››ä¸ªï¼ˆæ‹¬å·é‡Œæ˜¯å¯¹åº”çš„SQLå‘½ä»¤ï¼‰ã€‚</p><ul><li>GETï¼ˆSELECTï¼‰ï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æºï¼ˆä¸€é¡¹æˆ–å¤šé¡¹ï¼‰ã€‚</li><li>POSTï¼ˆCREATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æºã€‚</li><li>PUTï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æºï¼‰ã€‚</li><li>DELETEï¼ˆDELETEï¼‰ï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æºã€‚</li></ul><p>è¿˜æœ‰ä¸‰ä¸ªä¸å¸¸ç”¨çš„HTTPåŠ¨è¯ã€‚</p><ul><li>PATCHï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°(æ›´æ–°)èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜çš„å±æ€§ï¼‰ã€‚</li><li>HEADï¼šè·å–èµ„æºçš„å…ƒæ•°æ®ã€‚</li><li>OPTIONSï¼šè·å–ä¿¡æ¯ï¼Œå…³äºèµ„æºçš„å“ªäº›å±æ€§æ˜¯å®¢æˆ·ç«¯å¯ä»¥æ”¹å˜çš„ã€‚</li></ul><p>ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ã€‚</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">GET /zoosï¼šåˆ—å‡ºæ‰€æœ‰åŠ¨ç‰©å›­<br>POST /zoosï¼šæ–°å»ºä¸€ä¸ªåŠ¨ç‰©å›­ï¼ˆä¸Šä¼ æ–‡ä»¶ï¼‰<br>GET <span class="hljs-regexp">/zoos/I</span>Dï¼šè·å–æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯<br>PUT <span class="hljs-regexp">/zoos/I</span>Dï¼šæ›´æ–°æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥åŠ¨ç‰©å›­çš„å…¨éƒ¨ä¿¡æ¯ï¼‰<br>PATCH <span class="hljs-regexp">/zoos/I</span>Dï¼šæ›´æ–°æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥åŠ¨ç‰©å›­çš„éƒ¨åˆ†ä¿¡æ¯ï¼‰<br><span class="hljs-keyword">DELETE</span> <span class="hljs-regexp">/zoos/I</span>Dï¼šåˆ é™¤æŸä¸ªåŠ¨ç‰©å›­<br>GET <span class="hljs-regexp">/zoos/I</span>D/animalsï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„æ‰€æœ‰åŠ¨ç‰©<br><span class="hljs-keyword">DELETE</span> <span class="hljs-regexp">/zoos/I</span>D<span class="hljs-regexp">/animals/I</span>Dï¼šåˆ é™¤æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„æŒ‡å®šåŠ¨ç‰©<br></code></pre></td></tr></table></figure><h2 id="4-è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰"><a href="#4-è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰" class="headerlink" title="4. è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰"></a>4. è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰</h2><p>å¦‚æœè®°å½•æ•°é‡å¾ˆå¤šï¼ŒæœåŠ¡å™¨ä¸å¯èƒ½éƒ½å°†å®ƒä»¬è¿”å›ç»™ç”¨æˆ·ã€‚APIåº”è¯¥æä¾›å‚æ•°ï¼Œè¿‡æ»¤è¿”å›ç»“æœã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„å‚æ•°ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">limit</span>=10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„æ•°é‡<br>?<span class="hljs-attribute">offset</span>=10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„å¼€å§‹ä½ç½®ã€‚<br>?<span class="hljs-attribute">page</span>=2&amp;per_page=100ï¼šæŒ‡å®šç¬¬å‡ é¡µï¼Œä»¥åŠæ¯é¡µçš„è®°å½•æ•°ã€‚<br>?<span class="hljs-attribute">sortby</span>=name&amp;order=ascï¼šæŒ‡å®šè¿”å›ç»“æœæŒ‰ç…§å“ªä¸ªå±æ€§æ’åºï¼Œä»¥åŠæ’åºé¡ºåºã€‚<br>?<span class="hljs-attribute">animal_type_id</span>=1ï¼šæŒ‡å®šç­›é€‰æ¡ä»¶<br></code></pre></td></tr></table></figure><p>å‚æ•°çš„è®¾è®¡å…è®¸å­˜åœ¨å†—ä½™ï¼Œå³å…è®¸APIè·¯å¾„å’ŒURLå‚æ•°å¶å°”æœ‰é‡å¤ã€‚æ¯”å¦‚ï¼ŒGET &#x2F;zoos&#x2F;ID&#x2F;animals ä¸ GET &#x2F;animals?zoo_id&#x3D;ID çš„å«ä¹‰æ˜¯ç›¸åŒçš„ã€‚</p><h2 id="6-çŠ¶æ€ç ï¼ˆStatus-Codesï¼‰"><a href="#6-çŠ¶æ€ç ï¼ˆStatus-Codesï¼‰" class="headerlink" title="6. çŠ¶æ€ç ï¼ˆStatus Codesï¼‰"></a>6. çŠ¶æ€ç ï¼ˆStatus Codesï¼‰</h2><p>æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›çš„çŠ¶æ€ç å’Œæç¤ºä¿¡æ¯ï¼Œå¸¸è§çš„æœ‰ä»¥ä¸‹ä¸€äº›ï¼ˆæ–¹æ‹¬å·ä¸­æ˜¯è¯¥çŠ¶æ€ç å¯¹åº”çš„HTTPåŠ¨è¯ï¼‰ã€‚</p><blockquote><ul><li>200 OK - [GET]ï¼šæœåŠ¡å™¨æˆåŠŸè¿”å›ç”¨æˆ·è¯·æ±‚çš„æ•°æ®</li><li>201 CREATED - [POST&#x2F;PUT&#x2F;PATCH]ï¼šç”¨æˆ·æ–°å»ºæˆ–ä¿®æ”¹æ•°æ®æˆåŠŸã€‚</li><li>202 Accepted - [*]ï¼šè¡¨ç¤ºä¸€ä¸ªè¯·æ±‚å·²ç»è¿›å…¥åå°æ’é˜Ÿï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰</li><li>204 NO CONTENT - [DELETE]ï¼šç”¨æˆ·åˆ é™¤æ•°æ®æˆåŠŸã€‚</li><li>400 INVALID REQUEST - [POST&#x2F;PUT&#x2F;PATCH]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚æœ‰é”™è¯¯ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ–°å»ºæˆ–ä¿®æ”¹æ•°æ®çš„æ“ä½œ</li><li>401 Unauthorized - [*]ï¼šè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰ã€‚</li><li>403 Forbidden - [*] è¡¨ç¤ºç”¨æˆ·å¾—åˆ°æˆæƒï¼ˆä¸401é”™è¯¯ç›¸å¯¹ï¼‰ï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚</li><li>404 NOT FOUND - [*]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚</li><li>406 Not Acceptable - [GET]ï¼šç”¨æˆ·è¯·æ±‚çš„æ ¼å¼ä¸å¯å¾—ï¼ˆæ¯”å¦‚ç”¨æˆ·è¯·æ±‚JSONæ ¼å¼ï¼Œä½†æ˜¯åªæœ‰XMLæ ¼å¼ï¼‰ã€‚</li><li>410 Gone -[GET]ï¼šç”¨æˆ·è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚</li><li>422 Unprocesable entity - [POST&#x2F;PUT&#x2F;PATCH] å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå‘ç”Ÿä¸€ä¸ªéªŒè¯é”™è¯¯ã€‚</li><li>500 INTERNAL SERVER ERROR - [*]ï¼šæœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œç”¨æˆ·å°†æ— æ³•åˆ¤æ–­å‘å‡ºçš„è¯·æ±‚æ˜¯å¦æˆåŠŸã€‚</li></ul></blockquote><p>çŠ¶æ€ç çš„å®Œå…¨åˆ—è¡¨å‚è§<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">è¿™é‡Œ</a>æˆ–<a href="https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81">è¿™é‡Œ</a>ã€‚</p><h2 id="7-é”™è¯¯å¤„ç†ï¼ˆError-handlingï¼‰"><a href="#7-é”™è¯¯å¤„ç†ï¼ˆError-handlingï¼‰" class="headerlink" title="7. é”™è¯¯å¤„ç†ï¼ˆError handlingï¼‰"></a>7. é”™è¯¯å¤„ç†ï¼ˆError handlingï¼‰</h2><p>å¦‚æœçŠ¶æ€ç æ˜¯4xxï¼ŒæœåŠ¡å™¨å°±åº”è¯¥å‘ç”¨æˆ·è¿”å›å‡ºé”™ä¿¡æ¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿”å›çš„ä¿¡æ¯ä¸­å°†errorä½œä¸ºé”®åï¼Œå‡ºé”™ä¿¡æ¯ä½œä¸ºé”®å€¼å³å¯ã€‚</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&#123;<br>    <span class="hljs-keyword">error</span>: <span class="hljs-string">&quot;Invalid API key&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="8-è¿”å›ç»“æœ"><a href="#8-è¿”å›ç»“æœ" class="headerlink" title="8. è¿”å›ç»“æœ"></a>8. è¿”å›ç»“æœ</h2><p>é’ˆå¯¹ä¸åŒæ“ä½œï¼ŒæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›çš„ç»“æœåº”è¯¥ç¬¦åˆä»¥ä¸‹è§„èŒƒã€‚</p><ul><li>GET &#x2F;collectionï¼šè¿”å›èµ„æºå¯¹è±¡çš„åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰</li><li>GET &#x2F;collection&#x2F;resourceï¼šè¿”å›å•ä¸ªèµ„æºå¯¹è±¡</li><li>POST &#x2F;collectionï¼šè¿”å›æ–°ç”Ÿæˆçš„èµ„æºå¯¹è±¡</li><li>PUT &#x2F;collection&#x2F;resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡</li><li>PATCH &#x2F;collection&#x2F;resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡</li><li>DELETE &#x2F;collection&#x2F;resourceï¼šè¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£</li></ul><h2 id="9-è¶…åª’ä½“ï¼ˆHypermedia-APIï¼‰"><a href="#9-è¶…åª’ä½“ï¼ˆHypermedia-APIï¼‰" class="headerlink" title="9. è¶…åª’ä½“ï¼ˆHypermedia APIï¼‰"></a>9. è¶…åª’ä½“ï¼ˆHypermedia APIï¼‰</h2><p>RESTful APIæœ€å¥½åšåˆ°Hypermediaï¼ˆå³è¿”å›ç»“æœä¸­æä¾›é“¾æ¥ï¼Œè¿å‘å…¶ä»–APIæ–¹æ³•ï¼‰ï¼Œä½¿å¾—ç”¨æˆ·ä¸æŸ¥æ–‡æ¡£ï¼Œä¹ŸçŸ¥é“ä¸‹ä¸€æ­¥åº”è¯¥åšä»€ä¹ˆã€‚</p><p>æ¯”å¦‚ï¼ŒGithubçš„APIå°±æ˜¯è¿™ç§è®¾è®¡ï¼Œè®¿é—®<a href="https://api.github.com/">api.github.com</a>ä¼šå¾—åˆ°ä¸€ä¸ªæ‰€æœ‰å¯ç”¨APIçš„ç½‘å€åˆ—è¡¨ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">&#123;<br><span class="hljs-string">&quot;current_user_url&quot;</span>: <span class="hljs-string">&quot;https://api.github.com/user&quot;</span>,<br><span class="hljs-string">&quot;authorizations_url&quot;</span>: <span class="hljs-string">&quot;https://api.github.com/authorizations&quot;</span>,<br><span class="hljs-regexp">//</span> ...<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæƒ³è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåº”è¯¥å»è®¿é—®<a href="https://api.github.com/user">api.github.com&#x2F;user</a>ï¼Œç„¶åå°±å¾—åˆ°äº†ä¸‹é¢ç»“æœã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Requires authentication&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;documentation_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://developer.github.com/v3&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼ŒæœåŠ¡å™¨ç»™å‡ºäº†æç¤ºä¿¡æ¯ï¼Œä»¥åŠæ–‡æ¡£çš„ç½‘å€ã€‚</p><h2 id="10-å…¶ä»–"><a href="#10-å…¶ä»–" class="headerlink" title="10. å…¶ä»–"></a>10. å…¶ä»–</h2><p>æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨JSONï¼Œé¿å…ä½¿ç”¨XMLã€‚</p><h2 id="11-Flask-Restlul-çš„ä½¿ç”¨"><a href="#11-Flask-Restlul-çš„ä½¿ç”¨" class="headerlink" title="11.Flask-Restlul çš„ä½¿ç”¨"></a>11.Flask-Restlul çš„ä½¿ç”¨</h2><p><a href="https://juejin.im/post/5d1ffe466fb9a07efd472cee">Flask-RESTfulæ˜¯ç”¨äºå¿«é€Ÿæ„å»ºREST APIçš„Flaskæ‰©å±•</a></p>]]></content>
    
    
    <categories>
      
      <category>RESTful</category>
      
    </categories>
    
    
    <tags>
      
      <tag>restful</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¤è¯† RESTful ä»€ä¹ˆæ˜¯RESTful</title>
    <link href="/2020/07/23/%E8%AE%A4%E8%AF%86%20RESTful%20%E4%BB%80%E4%B9%88%E6%98%AFRESTful/"/>
    <url>/2020/07/23/%E8%AE%A4%E8%AF%86%20RESTful%20%E4%BB%80%E4%B9%88%E6%98%AFRESTful/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="è®¤è¯†RESTful"><a href="#è®¤è¯†RESTful" class="headerlink" title="è®¤è¯†RESTful"></a>è®¤è¯†RESTful</h1><p><strong>åœ¨å‰åç«¯åˆ†ç¦»çš„åº”ç”¨æ¨¡å¼é‡Œï¼Œåç«¯APIæ¥å£å¦‚ä½•å®šä¹‰ï¼Ÿ</strong></p><ul><li><p>å¯¹äºæ¥å£çš„è¯·æ±‚æ–¹å¼ä¸è·¯å¾„ï¼Œæ¯ä¸ªåç«¯å¼€å‘äººå‘˜å¯èƒ½éƒ½æœ‰è‡ªå·±çš„å®šä¹‰æ–¹å¼ï¼Œé£æ ¼è¿¥å¼‚ã€‚</p></li><li><p>æ˜¯å¦å­˜åœ¨ä¸€ç§ç»Ÿä¸€çš„å®šä¹‰æ–¹å¼ï¼Œè¢«å¹¿å¤§å¼€å‘äººå‘˜æ¥å—è®¤å¯çš„æ–¹å¼å‘¢ï¼Ÿ</p></li><li><p>è¿™å°±æ˜¯è¢«æ™®éé‡‡ç”¨çš„APIçš„RESTfulè®¾è®¡é£æ ¼ã€‚</p></li><li><p>ä¾‹å¦‚å¯¹äºåç«¯æ•°æ®åº“ä¸­ä¿å­˜äº†å•†å“çš„ä¿¡æ¯ï¼Œå‰ç«¯å¯èƒ½éœ€è¦å¯¹å•†å“æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œé‚£ç›¸åº”çš„æ¯ä¸ªæ“ä½œåç«¯éƒ½éœ€è¦æä¾›ä¸€ä¸ªAPIæ¥å£ï¼š</p></li></ul><table><thead><tr><th>è¯·æ±‚æ–¹æ³•</th><th>è¯·æ±‚åœ°å€</th><th>åç«¯æ“ä½œ</th></tr></thead><tbody><tr><td>GET</td><td>&#x2F;goods</td><td>è·å–æ‰€æœ‰å•†å“</td></tr><tr><td>POST</td><td>&#x2F;goods</td><td>å¢åŠ å•†å“</td></tr><tr><td>GET</td><td>&#x2F;goods&#x2F;1</td><td>è·å–ç¼–å·ä¸º1çš„å•†å“</td></tr><tr><td>PUT</td><td>&#x2F;goods&#x2F;1</td><td>ä¿®æ”¹ç¼–å·ä¸º1çš„å•†å“</td></tr><tr><td>DELETE</td><td>&#x2F;goods&#x2F;1</td><td>åˆ é™¤ç¼–å·ä¸º1çš„å•†å“</td></tr></tbody></table><p>Â </p><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><ul><li>RESTfulæ˜¯ä¸€ç§å¼€å‘ç†å¿µã€‚<strong>REST</strong>æ˜¯<strong>è®¾è®¡é£æ ¼</strong>è€Œä¸æ˜¯æ ‡å‡†ã€‚</li><li>å…¬å¸ä¸­çš„åç«¯ç¨‹åºå‘˜åœ¨å®šä¹‰åç«¯çš„æ¥å£æ—¶ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦éµå®ˆè¿™ç§è®¾è®¡é£æ ¼ã€‚</li><li>RESTfulè®¾è®¡é£æ ¼çš„APIï¼Œæ¯ç§è¯·æ±‚æ–¹æ³•ï¼Œéƒ½å¯¹åº”åç«¯ä¸€ç§æ•°æ®åº“æ“ä½œã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>RESTful</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼ restful</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–‡ä»¶ä¸Šä¼   FlaskæŠ¥é”™</title>
    <link href="/2020/07/23/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%20%20Flask%E6%8A%A5%E9%94%99/"/>
    <url>/2020/07/23/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%20%20Flask%E6%8A%A5%E9%94%99/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="æŠ¥é”™ä¿¡æ¯ï¼šTypeError-expected-str-bytes-or-os-PathLike-object-not-FileStorage"><a href="#æŠ¥é”™ä¿¡æ¯ï¼šTypeError-expected-str-bytes-or-os-PathLike-object-not-FileStorage" class="headerlink" title="æŠ¥é”™ä¿¡æ¯ï¼šTypeError: expected str, bytes or os.PathLike object,not FileStorage"></a>æŠ¥é”™ä¿¡æ¯ï¼šTypeError: expected str, bytes or os.PathLike object,not FileStorage</h4><ul><li>Â ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ file æœ¬æ¥æƒ³é€šè¿‡open()æ¥æ‰“å¼€æ–‡ä»¶è¿›è¡Œå¤„ç†çš„ï¼Œä½†æ˜¯å´æŠ¥é”™äº†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/getfile&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getfile</span>():<br>    request_data = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>    rsrcmgr = PDFResourceManager()<br>    retstr = io.StringIO()<br>    codec = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>    laparams = LAParams()<br>    device = TextConverter(rsrcmgr, retstr, codec=codec, laparams=laparams)<br>    fp = <span class="hljs-built_in">open</span>(request_data, <span class="hljs-string">&#x27;rb&#x27;</span>)<br>    interpreter = PDFPageInterpreter(rsrcmgr, device)<br>    password = <span class="hljs-string">&quot;&quot;</span><br>    maxpages = <span class="hljs-number">0</span><br>    caching = <span class="hljs-literal">True</span><br>    pagenos = <span class="hljs-built_in">set</span>()<br><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> PDFPage.get_pages(fp, pagenos, maxpages=maxpages,<br>                                  password=password,<br>                                  caching=caching,<br>                                  check_extractable=<span class="hljs-literal">True</span>):<br>        interpreter.process_page(page)<br><br>    text = retstr.getvalue()<br><br>    fp.close()<br>    device.close()<br>    retstr.close()<br><span class="hljs-keyword">return</span> text<br></code></pre></td></tr></table></figure><ul><li>Â æŠ¥é”™</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">line 27, <span class="hljs-keyword">in</span> getfile fp = open(request_data, <span class="hljs-string">&#x27;rb&#x27;</span>).decode(<span class="hljs-string">&quot;utf-8&quot;</span>) TypeError: expected str, bytes or os.PathLike object, not FileStorage<br></code></pre></td></tr></table></figure><ul><li>Â è§£å†³æ–¹æ¡ˆ</li></ul><blockquote><p>TheÂ <code>request.files[&#39;file&#39;]</code>Â is an instance of aÂ <a href="http://werkzeug.pocoo.org/docs/0.14/datastructures/#werkzeug.datastructures.FileStorage">FileStorage</a>Â class (see alsoÂ <a href="http://flask.pocoo.org/docs/0.12/api/#flask.Request.files">http://flask.pocoo.org/docs/0.12/api/#flask.Request.files</a>), so you canâ€™t do theÂ <code>fp = open(request_data, &#39;rb&#39;)</code>. The FileStorage object contains aÂ <code>stream</code>Â attribute that should point to an open temporary file, and probably you can pass that toÂ <code>PDFPage.get_pages()</code></p></blockquote><blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼šFiles [â€˜ fileâ€™]æ˜¯ FileStorage ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥ä¸èƒ½æ‰§è¡Œ fp &#x3D; open (request _ dataï¼Œâ€˜ rbâ€™)</p><p>FileStorage å¯¹è±¡åŒ…å«Â <code>stream</code>Â  å±æ€§ï¼Œè¯¥å±æ€§åº”è¯¥æŒ‡å‘ä¸€ä¸ªæ‰“å¼€çš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å°†å…¶ä¼ é€’ç»™ PDFPage.get _ pages ()</p></blockquote><p>Â </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/getfile&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getfile</span>():<br>    file = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>    rsrcmgr = PDFResourceManager()<br>    retstr = io.StringIO()<br>    codec = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>    laparams = LAParams()<br>    device = TextConverter(rsrcmgr, retstr, codec=codec, laparams=laparams)<br>    interpreter = PDFPageInterpreter(rsrcmgr, device)<br>    password = <span class="hljs-string">&quot;&quot;</span><br>    maxpages = <span class="hljs-number">0</span><br>    caching = <span class="hljs-literal">True</span><br>    pagenos = <span class="hljs-built_in">set</span>()<br><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> PDFPage.get_pages(file.stream, pagenos, maxpages=maxpages,<br>                                  password=password,<br>                                  caching=caching,<br>                                  check_extractable=<span class="hljs-literal">True</span>):<br>        interpreter.process_page(page)<br><br>    text = retstr.getvalue()<br><br>    device.close()<br>    retstr.close()<br><span class="hljs-keyword">return</span> text<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¿›å…¥ Docker å®¹å™¨çš„å‡ ç§æ–¹å¼ attach,ssh,nsenter,exec</title>
    <link href="/2020/07/14/%E8%BF%9B%E5%85%A5%20Docker%20%E5%AE%B9%E5%99%A8%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F%20attach,ssh,nsenter,exec/"/>
    <url>/2020/07/14/%E8%BF%9B%E5%85%A5%20Docker%20%E5%AE%B9%E5%99%A8%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F%20attach,ssh,nsenter,exec/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p>åœ¨ä½¿ç”¨Dockeråˆ›å»ºäº†å®¹å™¨ä¹‹åï¼Œå¤§å®¶æ¯”è¾ƒå…³å¿ƒçš„å°±æ˜¯å¦‚ä½•è¿›å…¥è¯¥å®¹å™¨äº†ï¼Œå…¶å®è¿›å…¥Dockerå®¹å™¨æœ‰å¥½å‡ å¤šç§æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è®²ä¸€ä¸‹å¸¸ç”¨çš„å‡ ç§è¿›å…¥Dockerå®¹å™¨çš„æ–¹æ³•ã€‚</p><p>è¿›å…¥Dockerå®¹å™¨æ¯”è¾ƒå¸¸è§çš„å‡ ç§åšæ³•å¦‚ä¸‹ï¼š</p><ul><li>ä½¿ç”¨docker attach</li><li>ä½¿ç”¨SSH</li><li>ä½¿ç”¨nsenter</li><li>ä½¿ç”¨exec</li></ul><h1 id="ä¸€ã€ä½¿ç”¨docker-attachè¿›å…¥Dockerå®¹å™¨"><a href="#ä¸€ã€ä½¿ç”¨docker-attachè¿›å…¥Dockerå®¹å™¨" class="headerlink" title="ä¸€ã€ä½¿ç”¨docker attachè¿›å…¥Dockerå®¹å™¨"></a>ä¸€ã€ä½¿ç”¨docker attachè¿›å…¥Dockerå®¹å™¨</h1><p>ã€€ã€€Dockeræä¾›äº†attachå‘½ä»¤æ¥è¿›å…¥Dockerå®¹å™¨ã€‚</p><p>Â </p><p>ã€€ã€€æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤æ€çš„Dockerå®¹å™¨ï¼Œç„¶åä½¿ç”¨docker attachå‘½ä»¤è¿›å…¥è¯¥å®¹å™¨ã€‚</p><ol><li>$Â sudoÂ dockerÂ runÂ -itdÂ ubuntu:14.04Â &#x2F;bin&#x2F;bash</li></ol><p>Â Â </p><p>Â </p><p>ã€€ã€€ç„¶åæˆ‘ä»¬ä½¿ç”¨docker psæŸ¥çœ‹åˆ°è¯¥å®¹å™¨ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å°±ä½¿ç”¨docker attachè¿›å…¥è¯¥å®¹å™¨</p><ol><li>$Â sudoÂ dockerÂ attachÂ 44fc0f0582d9</li></ol><p>Â Â </p><p>ã€€ã€€å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»è¿›å…¥åˆ°è¯¥å®¹å™¨ä¸­äº†ã€‚</p><p>Â </p><p>ã€€ã€€ä½†åœ¨ï¼Œä½¿ç”¨è¯¥å‘½ä»¤æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å½“å¤šä¸ªçª—å£åŒæ—¶ä½¿ç”¨è¯¥å‘½ä»¤è¿›å…¥è¯¥å®¹å™¨æ—¶ï¼Œæ‰€æœ‰çš„çª—å£éƒ½ä¼šåŒæ­¥æ˜¾ç¤ºã€‚å¦‚æœæœ‰ä¸€ä¸ªçª—å£é˜»å¡äº†ï¼Œé‚£ä¹ˆå…¶ä»–çª—å£ä¹Ÿæ— æ³•å†è¿›è¡Œæ“ä½œã€‚</p><p>Â </p><p>å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæ‰€ä»¥docker attachå‘½ä»¤ä¸å¤ªé€‚åˆäºç”Ÿäº§ç¯å¢ƒï¼Œå¹³æ—¶è‡ªå·±å¼€å‘åº”ç”¨æ—¶å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤ã€‚</p><h1 id="äºŒã€ä½¿ç”¨SSHè¿›å…¥Dockerå®¹å™¨"><a href="#äºŒã€ä½¿ç”¨SSHè¿›å…¥Dockerå®¹å™¨" class="headerlink" title="äºŒã€ä½¿ç”¨SSHè¿›å…¥Dockerå®¹å™¨"></a>äºŒã€ä½¿ç”¨SSHè¿›å…¥Dockerå®¹å™¨</h1><p>ã€€ã€€åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ’é™¤äº†ä½¿ç”¨docker attachå‘½ä»¤è¿›å…¥å®¹å™¨ä¹‹åï¼Œç›¸ä¿¡å¤§å®¶ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯sshã€‚åœ¨é•œåƒï¼ˆæˆ–å®¹å™¨ï¼‰ä¸­å®‰è£…SSH Serverï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¤šäººè¿›å…¥</p><p>å®¹å™¨ä¸”ç›¸äº’ä¹‹é—´ä¸å—å¹²æ‰°äº†ï¼Œç›¸ä¿¡å¤§å®¶åœ¨å½“å‰çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼ˆæ²¡æœ‰ä½¿ç”¨Dockerçš„æƒ…å†µï¼‰ä¹Ÿæ˜¯è¿™æ ·åšçš„ã€‚ä½†æ˜¯ä½¿ç”¨äº†Dockerå®¹å™¨ä¹‹åä¸å»ºè®®ä½¿ç”¨sshè¿›å…¥åˆ°Dockerå®¹</p><p>å™¨å†…ã€‚å…³äºä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ï¼Œè¯·å‚è€ƒå¦‚ä¸‹æ–‡ç« ï¼š</p><p><a href="http://www.oschina.net/translate/why-you-dont-need-to-run-sshd-in-docker?cmp">ä¸ºä»€ä¹ˆä¸éœ€è¦åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ sshd</a></p><h1 id="ä¸‰ã€ä½¿ç”¨nsenterè¿›å…¥Dockerå®¹å™¨"><a href="#ä¸‰ã€ä½¿ç”¨nsenterè¿›å…¥Dockerå®¹å™¨" class="headerlink" title="ä¸‰ã€ä½¿ç”¨nsenterè¿›å…¥Dockerå®¹å™¨"></a>ä¸‰ã€ä½¿ç”¨nsenterè¿›å…¥Dockerå®¹å™¨</h1><p>ã€€ã€€åœ¨ä¸Šé¢ä¸¤ç§æ–¹å¼éƒ½ä¸é€‚åˆçš„æƒ…å†µä¸‹ï¼Œè¿˜æœ‰ä¸€ç§æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•ï¼Œå³ä½¿ç”¨nsenterè¿›å…¥Dockerå®¹å™¨ã€‚å…³äºä»€ä¹ˆæ˜¯nsenterè¯·å‚è€ƒå¦‚ä¸‹æ–‡ç« ï¼š</p><p><a href="https://github.com/jpetazzo/nsenter">https://github.com/jpetazzo/nsenter</a></p><p>åœ¨äº†è§£äº†ä»€ä¹ˆæ˜¯nsenterä¹‹åï¼Œç³»ç»Ÿé»˜è®¤å°†æˆ‘ä»¬éœ€è¦çš„nsenterå®‰è£…åˆ°ä¸»æœºä¸­</p><p>å¦‚æœæ²¡æœ‰å®‰è£…çš„è¯ï¼ŒæŒ‰ä¸‹é¢æ­¥éª¤å®‰è£…å³å¯ï¼ˆæ³¨æ„æ˜¯ä¸»æœºè€Œéå®¹å™¨æˆ–é•œåƒï¼‰</p><p>å…·ä½“çš„å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><ol><li>$Â wgetÂ <a href="https://www.kernel.org/pub/linux/utils/util-linux/v2.24/util-linux-2.24.tar.gz">https://www.kernel.org/pub/linux/utils/util-linux/v2.24/util-linux-2.24.tar.gz</a>Â Â </li><li>$Â tarÂ -xzvfÂ util-linux-2.24.tar.gzÂ Â </li><li>$Â cdÂ util-linux-2.24&#x2F;Â Â </li><li>$Â .&#x2F;configureÂ â€“without-ncursesÂ Â </li><li>$Â makeÂ nsenterÂ Â </li><li>$Â sudoÂ cpÂ nsenterÂ &#x2F;usr&#x2F;local&#x2F;bin</li></ol><p>Â Â </p><p>å®‰è£…å¥½nsenterä¹‹åå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹è¯¥å‘½ä»¤çš„ä½¿ç”¨ã€‚</p><p>Â <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTAyOTc0My8yMDE3MDIvMTAyOTc0My0yMDE3MDIwNzE1NTU0ODk5NC0zNjA4Njg4NjAucG5n?x-oss-process=image/format,png"></p><p>Â </p><p>ã€€ã€€nsenterå¯ä»¥è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„åç§°ç©ºé—´ã€‚æ‰€ä»¥ä¸ºäº†è¿æ¥åˆ°æŸä¸ªå®¹å™¨æˆ‘ä»¬è¿˜éœ€è¦è·å–è¯¥å®¹å™¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹çš„PIDã€‚å¯ä»¥ä½¿ç”¨docker inspectå‘½ä»¤æ¥æ‹¿åˆ°è¯¥PIDã€‚</p><p>docker inspectå‘½ä»¤ä½¿ç”¨å¦‚ä¸‹ï¼š</p><ol><li>$Â sudoÂ dockerÂ inspectÂ â€“help</li></ol><p> Â Â </p><p>inspectå‘½ä»¤å¯ä»¥åˆ†å±‚çº§æ˜¾ç¤ºä¸€ä¸ªé•œåƒæˆ–å®¹å™¨çš„ä¿¡æ¯ã€‚æ¯”å¦‚æˆ‘ä»¬å½“å‰æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTAyOTc0My8yMDE3MDIvMTAyOTc0My0yMDE3MDIwNzE1NTYzNDkxNi01NDkyMTk1NjMucG5n?x-oss-process=image/format,png"></p><p>Â </p><p>Â </p><p>å¯ä»¥ä½¿ç”¨docker inspectæ¥æŸ¥çœ‹è¯¥å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><ol><li>$Â sudoÂ dockerÂ inspectÂ 44fc0f0582d9</li></ol><p>Â Â </p><p>Â </p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTAyOTc0My8yMDE3MDIvMTAyOTc0My0yMDE3MDIwNzE1NTcxNjk5NC0yMTI1MjkwMDA0LnBuZw?x-oss-process=image/format,png"></p><p>Â </p><p>ç”±å…¶è¯¥ä¿¡æ¯éå¸¸å¤šï¼Œæ­¤å¤„åªæˆªå–äº†å…¶ä¸­ä¸€éƒ¨åˆ†è¿›è¡Œå±•ç¤ºã€‚å¦‚æœè¦æ˜¾ç¤ºè¯¥å®¹å™¨ç¬¬ä¸€ä¸ªè¿›è¡Œçš„PIDå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼</p><ol><li>$Â sudoÂ dockerÂ inspectÂ -fÂ {<!-- -->{.State.Pid}}Â 44fc0f0582d9</li></ol><p>Â Â </p><p>Â </p><p>Â <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTAyOTc0My8yMDE3MDIvMTAyOTc0My0yMDE3MDIwNzE1NTgyMjUyNi0xODQ1Nzc4NDU2LnBuZw?x-oss-process=image/format,png"></p><p>Â </p><p>åœ¨æ‹¿åˆ°è¯¥è¿›ç¨‹PIDä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨nsenterå‘½ä»¤è®¿é—®è¯¥å®¹å™¨äº†ã€‚</p><ol><li>$Â sudoÂ nsenterÂ â€“targetÂ 3326Â â€“mountÂ â€“utsÂ â€“ipcÂ â€“netÂ â€“pid</li></ol><p>Â Â </p><ol><li>$Â sudoÂ nsenterÂ â€“targetÂ 3326Â â€“mountÂ â€“utsÂ â€“ipcÂ â€“netÂ â€“pid</li></ol><p>Â Â </p><p>å…¶ä¸­çš„3326å³åˆšæ‰æ‹¿åˆ°çš„è¿›ç¨‹çš„PID</p><p>Â </p><p>å½“ç„¶ï¼Œå¦‚æœä½ è®¤ä¸ºæ¯æ¬¡éƒ½è¾“å…¥é‚£ä¹ˆå¤šå‚æ•°å¤ªéº»çƒ¦çš„è¯ï¼Œç½‘ä¸Šä¹Ÿæœ‰è®¸å¤šåšå¥½çš„è„šæœ¬ä¾›å¤§å®¶ä½¿ç”¨ã€‚</p><p>åœ°å€å¦‚ä¸‹ï¼š</p><p><a href="http://yeasy.gitbooks.io/docker_practice/content/container/enter.html">http://yeasy.gitbooks.io/docker_practice/content/container/enter.html</a></p><p><a href="http://www.tuicool.com/articles/eYnUBrR">http://www.tuicool.com/articles/eYnUBrR</a></p><p>Â </p><p><strong>å››ã€ä½¿ç”¨docker execè¿›å…¥Dockerå®¹å™¨</strong></p><p>ã€€ã€€é™¤äº†ä¸Šé¢å‡ ç§åšæ³•ä¹‹å¤–ï¼Œdockeråœ¨1.3.Xç‰ˆæœ¬ä¹‹åè¿˜æä¾›äº†ä¸€ä¸ªæ–°çš„å‘½ä»¤execç”¨äºè¿›å…¥å®¹å™¨ï¼Œè¿™ç§æ–¹å¼ç›¸å¯¹æ›´ç®€å•ä¸€äº›ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥å‘½ä»¤çš„ä½¿ç”¨ï¼š</p><ol><li>$Â sudoÂ dockerÂ execÂ â€“help</li></ol><p> Â Â </p><p>Â </p><p>Â <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTAyOTc0My8yMDE3MDIvMTAyOTc0My0yMDE3MDIwNzE2MDI0NDY4Mi0xMDE5MDcxMDkyLnBuZw?x-oss-process=image/format,png"></p><p>Â </p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨è¯¥å‘½ä»¤è¿›å…¥ä¸€ä¸ªå·²ç»åœ¨è¿è¡Œçš„å®¹å™¨</p><ol><li>$Â sudoÂ dockerÂ psÂ Â </li><li>$Â sudoÂ dockerÂ execÂ -itÂ 775c7c9ee1e1Â &#x2F;bin&#x2F;bash</li></ol><p>Â </p><p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/xhyan/p/6593075.html">https://www.cnblogs.com/xhyan/p/6593075.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker linux ubuntu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux ubuntu pip install mysqlclient æŠ¥é”™é—®é¢˜è§£å†³</title>
    <link href="/2020/07/13/Linux%20ubuntu%20pip%20install%20mysqlclient%20%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"/>
    <url>/2020/07/13/Linux%20ubuntu%20pip%20install%20mysqlclient%20%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><ul><li><h3 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h3></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Looking <span class="hljs-keyword">in</span> indexes: https://pypi.douban.com/simple<br>Collecting mysqlclient<br>  Using cached https://pypi.doubanio.com/packages/a5/e1/e5f2b231c05dc51d9d87fa5066f90d1405345c54b14b0b11a1c859020f21/mysqlclient-2.0.1.tar.gz (87 kB)<br>    ERROR: Command errored out with <span class="hljs-built_in">exit</span> status 1:<br>     <span class="hljs-built_in">command</span>: /home/zunder/Desktop/env/djenv/bin/python3 -c <span class="hljs-string">&#x27;import sys, setuptools, tokenize; sys.argv[0] = &#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;/tmp/pip-install-1qfymr2e/mysqlclient/setup.py&#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;; __file__=&#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;/tmp/pip-install-1qfymr2e/mysqlclient/setup.py&#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;;f=getattr(tokenize, &#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;open&#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;, open)(__file__);code=f.read().replace(&#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;\r\n&#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;, &#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;\n&#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;);f.close();exec(compile(code, __file__, &#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;exec&#x27;</span><span class="hljs-string">&quot;&#x27;&quot;</span><span class="hljs-string">&#x27;))&#x27;</span> egg_info --egg-base /tmp/pip-pip-egg-info-9lw6d9f3<br>         cwd: /tmp/pip-install-1qfymr2e/mysqlclient/<br>    Complete output (12 lines):<br>    /bin/sh: 1: mysql_config: not found<br>    /bin/sh: 1: mariadb_config: not found<br>    /bin/sh: 1: mysql_config: not found<br>    Traceback (most recent call last):<br>      File <span class="hljs-string">&quot;&lt;string&gt;&quot;</span>, line 1, <span class="hljs-keyword">in</span> &lt;module&gt;<br>      File <span class="hljs-string">&quot;/tmp/pip-install-1qfymr2e/mysqlclient/setup.py&quot;</span>, line 15, <span class="hljs-keyword">in</span> &lt;module&gt;<br>        metadata, options = get_config()<br>      File <span class="hljs-string">&quot;/tmp/pip-install-1qfymr2e/mysqlclient/setup_posix.py&quot;</span>, line 65, <span class="hljs-keyword">in</span> get_config<br>        libs = mysql_config(<span class="hljs-string">&quot;libs&quot;</span>)<br>      File <span class="hljs-string">&quot;/tmp/pip-install-1qfymr2e/mysqlclient/setup_posix.py&quot;</span>, line 31, <span class="hljs-keyword">in</span> mysql_config<br>        raise OSError(<span class="hljs-string">&quot;&#123;&#125; not found&quot;</span>.format(_mysql_config_path))<br>    OSError: mysql_config not found<br>    ----------------------------------------<br>ERROR: Command errored out with <span class="hljs-built_in">exit</span> status 1: python setup.py egg_info Check the logs <span class="hljs-keyword">for</span> full <span class="hljs-built_in">command</span> output.<br></code></pre></td></tr></table></figure><ul><li><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3></li></ul><blockquote><p>apt-get install libmysqlclient-dev</p></blockquote><p>Â </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash">Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>The following additional packages will be installed:<br>  libmysqlclient20 libssl-dev libssl-doc libssl1.0.0 zlib1g zlib1g-dev<br>The following NEW packages will be installed:<br>  libmysqlclient-dev libmysqlclient20 libssl-dev libssl-doc zlib1g-dev<br>The following packages will be upgraded:<br>  libssl1.0.0 zlib1g<br>2 upgraded, 5 newly installed, 0 to remove and 721 not upgraded.<br>Need to get 4,260 kB/5,394 kB of archives.<br>After this operation, 20.5 MB of additional disk space will be used.<br>Do you want to <span class="hljs-built_in">continue</span>? [Y/n] Y<br>Get:1 https://mirrors.tuna.tsinghua.edu.cn/ubuntu xenial-updates/main amd64 libmysqlclient20 amd64 5.7.30-0ubuntu0.16.04.1 [685 kB]<br>Get:2 https://mirrors.tuna.tsinghua.edu.cn/ubuntu xenial-updates/main amd64 zlib1g-dev amd64 1:1.2.8.dfsg-2ubuntu4.3 [167 kB]<br>Get:3 https://mirrors.tuna.tsinghua.edu.cn/ubuntu xenial-updates/main amd64 libssl-dev amd64 1.0.2g-1ubuntu4.16 [1,344 kB]<br>Get:4 https://mirrors.tuna.tsinghua.edu.cn/ubuntu xenial-updates/main amd64 libmysqlclient-dev amd64 5.7.30-0ubuntu0.16.04.1 [986 kB]<br>Get:5 https://mirrors.tuna.tsinghua.edu.cn/ubuntu xenial-updates/main amd64 libssl-doc all 1.0.2g-1ubuntu4.16 [1,078 kB]<br>Fetched 4,260 kB <span class="hljs-keyword">in</span> 2s (1,654 kB/s)<br>Preconfiguring packages ...<br>(Reading database ... 214443 files and directories currently installed.)<br>Preparing to unpack .../zlib1g_1%3a1.2.8.dfsg-2ubuntu4.3_amd64.deb ...<br>Unpacking zlib1g:amd64 (1:1.2.8.dfsg-2ubuntu4.3) over (1:1.2.8.dfsg-2ubuntu4) ...<br>Processing triggers <span class="hljs-keyword">for</span> libc-bin (2.23-0ubuntu3) ...<br>Setting up zlib1g:amd64 (1:1.2.8.dfsg-2ubuntu4.3) ...<br>Processing triggers <span class="hljs-keyword">for</span> libc-bin (2.23-0ubuntu3) ...<br>(Reading database ... 214443 files and directories currently installed.)<br>Preparing to unpack .../libssl1.0.0_1.0.2g-1ubuntu4.16_amd64.deb ...<br>Unpacking libssl1.0.0:amd64 (1.0.2g-1ubuntu4.16) over (1.0.2g-1ubuntu4) ...<br>Selecting previously unselected package libmysqlclient20:amd64.<br>Preparing to unpack .../libmysqlclient20_5.7.30-0ubuntu0.16.04.1_amd64.deb ...<br>Unpacking libmysqlclient20:amd64 (5.7.30-0ubuntu0.16.04.1) ...<br>Selecting previously unselected package zlib1g-dev:amd64.<br>Preparing to unpack .../zlib1g-dev_1%3a1.2.8.dfsg-2ubuntu4.3_amd64.deb ...<br>Unpacking zlib1g-dev:amd64 (1:1.2.8.dfsg-2ubuntu4.3) ...<br>Selecting previously unselected package libssl-dev:amd64.<br>Preparing to unpack .../libssl-dev_1.0.2g-1ubuntu4.16_amd64.deb ...<br>Unpacking libssl-dev:amd64 (1.0.2g-1ubuntu4.16) ...<br>Selecting previously unselected package libmysqlclient-dev.<br>Preparing to unpack .../libmysqlclient-dev_5.7.30-0ubuntu0.16.04.1_amd64.deb ...<br>Unpacking libmysqlclient-dev (5.7.30-0ubuntu0.16.04.1) ...<br>Selecting previously unselected package libssl-doc.<br>Preparing to unpack .../libssl-doc_1.0.2g-1ubuntu4.16_all.deb ...<br>Unpacking libssl-doc (1.0.2g-1ubuntu4.16) ...<br>Processing triggers <span class="hljs-keyword">for</span> libc-bin (2.23-0ubuntu3) ...<br>Processing triggers <span class="hljs-keyword">for</span> man-db (2.7.5-1) ...<br>Setting up libssl1.0.0:amd64 (1.0.2g-1ubuntu4.16) ...<br>Setting up libmysqlclient20:amd64 (5.7.30-0ubuntu0.16.04.1) ...<br>Setting up zlib1g-dev:amd64 (1:1.2.8.dfsg-2ubuntu4.3) ...<br>Setting up libssl-dev:amd64 (1.0.2g-1ubuntu4.16) ...<br>Setting up libmysqlclient-dev (5.7.30-0ubuntu0.16.04.1) ...<br>Setting up libssl-doc (1.0.2g-1ubuntu4.16) ...<br>Processing triggers <span class="hljs-keyword">for</span> libc-bin (2.23-0ubuntu3) ...<br></code></pre></td></tr></table></figure><blockquote><p>apt-get install libssl-dev</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>libssl-dev is already the newest version (1.0.2g-1ubuntu4.16).<br>libssl-dev <span class="hljs-built_in">set</span> to manually installed.<br>0 upgraded, 0 newly installed, 0 to remove and 721 not upgraded.<br></code></pre></td></tr></table></figure><ul><li><h3 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h3></li></ul><blockquote><p>Â pip install mysqlclient -i <a href="https://pypi.douban.com/simple">https://pypi.douban.com/simple</a></p></blockquote><p>Â æˆåŠŸå®‰è£…ï¼</p><p><img src="https://img-blog.csdnimg.cn/20200713115437135.png"></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux ubuntu python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python SQLAlchemy è¿æ¥MySQLçš„CURDæ“ä½œ ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç† session</title>
    <link href="/2020/07/08/Python%20SQLAlchemy%20%E8%BF%9E%E6%8E%A5MySQL%E7%9A%84CURD%E6%93%8D%E4%BD%9C%20%E4%BD%BF%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%20session/"/>
    <url>/2020/07/08/Python%20SQLAlchemy%20%E8%BF%9E%E6%8E%A5MySQL%E7%9A%84CURD%E6%93%8D%E4%BD%9C%20%E4%BD%BF%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%20session/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><ul><li><h3 id="ä½¿ç”¨-contextmanager-æ¥ç®¡ç†"><a href="#ä½¿ç”¨-contextmanager-æ¥ç®¡ç†" class="headerlink" title="ä½¿ç”¨Â contextmanager æ¥ç®¡ç†"></a>ä½¿ç”¨Â contextmanager æ¥ç®¡ç†</h3></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> scoped_session,sessionmaker<br><br><br>db_connect = <span class="hljs-string">&quot;mysql+pymysql://root:password@localhost:3306/db_name?charset=utf8&quot;</span><br><br>create=create_engine(db_connect)<br>SessionType=scoped_session(sessionmaker(bind=create,expire_on_commit=<span class="hljs-literal">False</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">GetSession</span>():<br>    <span class="hljs-keyword">return</span> SessionType()<br><br><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager<br><br><span class="hljs-meta">@contextmanager</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">session_socpe</span>():<br>    session=GetSession()<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">yield</span> session<br>        session.commit()<br>    <span class="hljs-keyword">except</span>:<br>        session.rollback()<br>        <span class="hljs-keyword">raise</span><br>    <span class="hljs-keyword">finally</span>:<br>        session.close()<br></code></pre></td></tr></table></figure><ul><li><h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3></li><li>Â æŸ¥è¯¢</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> session_socpe() <span class="hljs-keyword">as</span> session:<br>    obj = session.query(Modelç±»).<span class="hljs-built_in">filter</span>(Modelç±».å­—æ®µ==å‚æ•°).first()<br></code></pre></td></tr></table></figure><ul><li>å¢åŠ </li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> session_socpe() <span class="hljs-keyword">as</span> session:<br>    obj = Modelç±»(å­—æ®µ<span class="hljs-number">1</span>=å€¼<span class="hljs-number">1</span>, å­—æ®µ<span class="hljs-number">2</span>=å€¼<span class="hljs-number">2</span>, å­—æ®µ<span class="hljs-number">3</span>=å€¼<span class="hljs-number">3</span>)<br>    session.add(obj)<br></code></pre></td></tr></table></figure><ul><li>Â åˆ é™¤</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> session_socpe() <span class="hljs-keyword">as</span> session:<br>    obj = session.query(Modelç±»).<span class="hljs-built_in">filter</span>(Modelç±».å­—æ®µ==å‚æ•°).delete()<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> session_socpe() <span class="hljs-keyword">as</span> session:<br>    obj = session.query(Modelç±»).<span class="hljs-built_in">filter</span>(Modelç±».å­—æ®µ==å‚æ•°).update(&#123;<span class="hljs-string">&quot;ä¿®æ”¹å­—æ®µ&quot;</span>:<span class="hljs-string">&quot;ä¿®æ”¹å€¼&quot;</span>&#125;)<br></code></pre></td></tr></table></figure><blockquote><p>æ¯æ¬¡ä¿®æ”¹æ—¶ï¼Œä¸ç”¨é¢‘ç¹åœ°session.commit()</p><p>ä¹Ÿæ–¹ä¾¿äº† ä¸‡ä¸€å‡ºé”™å çš„ rollback å›æ»š</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql æ•°æ®åº“ orm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python SQLAlchemy è‡ªåŠ¨ç”Ÿæˆæ¨¡å‹ models æ–‡ä»¶</title>
    <link href="/2020/07/08/Python%20SQLAlchemy%20%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B%20models%20%E6%96%87%E4%BB%B6/"/>
    <url>/2020/07/08/Python%20SQLAlchemy%20%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B%20models%20%E6%96%87%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><ul><li>Â å®‰è£…æ¨¡å—</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip3 install sqlacodegen<br></code></pre></td></tr></table></figure><ul><li>Â æ‰§è¡Œ</li></ul><p>Â </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlacodegen mysql+pymysql://root:password@127.0.0.1:3306/db_name &gt; test_model.py<br><br>root:mysql ç”¨æˆ·<br>password:mysql å¯†ç <br>db_name: æ•°æ®åº“åç§°<br>test_model.py:å¯¼å‡ºçš„åå­—<br><br>--tables <span class="hljs-built_in">test</span> : å¯ä»¥æŒ‡å®š<span class="hljs-built_in">test</span>æ•°æ®è¡¨<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ py æ–‡ä»¶Â  å¾—åˆ°ä»¥ä¸‹</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> CHAR, Column, DateTime, Enum, String, Text, text<br><span class="hljs-keyword">from</span> sqlalchemy.dialects.mysql <span class="hljs-keyword">import</span> INTEGER<br><span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base<br><br>Base = declarative_base()<br>metadata = Base.metadata<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveUser</span>(<span class="hljs-title class_ inherited__">Base</span>):<br>    __tablename__ = <span class="hljs-string">&#x27;save_user&#x27;</span><br><br>    <span class="hljs-built_in">id</span> = Column(INTEGER(<span class="hljs-number">11</span>), primary_key=<span class="hljs-literal">True</span>)<br>    userName = Column(String(<span class="hljs-number">32</span>), unique=<span class="hljs-literal">True</span>)<br>    password = Column(String(<span class="hljs-number">16</span>), index=<span class="hljs-literal">True</span>)<br>    createTime = Column(DateTime)<br></code></pre></td></tr></table></figure><ul><li>Â æˆåŠŸ!</li></ul>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python mysql æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django ORM æ›´æ–°/ä¿®æ”¹æ“ä½œ</title>
    <link href="/2020/07/01/Django%20ORM%20%E6%9B%B4%E6%96%B0!%E4%BF%AE%E6%94%B9%E6%93%8D%E4%BD%9C/"/>
    <url>/2020/07/01/Django%20ORM%20%E6%9B%B4%E6%96%B0!%E4%BF%AE%E6%94%B9%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="model-updateå¸¸è§„ç”¨æ³•"><a href="#model-updateå¸¸è§„ç”¨æ³•" class="headerlink" title="model updateå¸¸è§„ç”¨æ³•"></a>model updateå¸¸è§„ç”¨æ³•</h1><p>å‡å¦‚æˆ‘ä»¬çš„è¡¨ç»“æ„æ˜¯è¿™æ ·çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(models.Model):<br>    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>)<br>    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">&#x27;æ¿€æ´»çŠ¶æ€&#x27;</span>)<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬ä¿®æ”¹ç”¨æˆ·åå’ŒçŠ¶æ€å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">User.objects.<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>).update(username=<span class="hljs-string">&#x27;nick&#x27;</span>,is_active=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">_t = User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br>_t.username=<span class="hljs-string">&#x27;nick&#x27;</span><br>_t.is_active=<span class="hljs-literal">True</span><br>_t.save()<br></code></pre></td></tr></table></figure><p>æ–¹æ³•ä¸€é€‚åˆæ›´æ–°ä¸€æ‰¹æ•°æ®ï¼Œç±»ä¼¼äºmysqlè¯­å¥<code>update user set username=&#39;nick&#39; where id = 1</code></p><p>Â </p><p>æ–¹æ³•äºŒé€‚åˆæ›´æ–°ä¸€æ¡æ•°æ®ï¼Œä¹Ÿåªèƒ½æ›´æ–°ä¸€æ¡æ•°æ®ï¼Œå½“åªæœ‰ä¸€æ¡æ•°æ®æ›´æ–°æ—¶æ¨èä½¿ç”¨æ­¤æ–¹æ³•ï¼Œå¦å¤–æ­¤æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹</p><h1 id="å…·æœ‰auto-nowå±æ€§å­—æ®µçš„æ›´æ–°"><a href="#å…·æœ‰auto-nowå±æ€§å­—æ®µçš„æ›´æ–°" class="headerlink" title="å…·æœ‰auto_nowå±æ€§å­—æ®µçš„æ›´æ–°"></a>å…·æœ‰auto_nowå±æ€§å­—æ®µçš„æ›´æ–°</h1><p>æˆ‘ä»¬é€šå¸¸ä¼šç»™è¡¨æ·»åŠ ä¸‰ä¸ªé»˜è®¤å­—æ®µ</p><ul><li>è‡ªå¢IDï¼Œè¿™ä¸ªdjangoå·²ç»é»˜è®¤åŠ äº†ï¼Œå°±åƒä¸Šè¾¹çš„å»ºè¡¨è¯­å¥ï¼Œè™½ç„¶åªå†™äº†usernameå’Œis_activeä¸¤ä¸ªå­—æ®µï¼Œä½†è¡¨å»ºå¥½åä¹Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„è‡ªå¢idå­—æ®µ</li><li>åˆ›å»ºæ—¶é—´ï¼Œç”¨æ¥æ ‡è¯†è¿™æ¡è®°å½•çš„åˆ›å»ºæ—¶é—´ï¼Œå…·æœ‰<code>auto_now_add</code>å±æ€§ï¼Œåˆ›å»ºè®°å½•æ—¶ä¼šè‡ªåŠ¨å¡«å……å½“å‰æ—¶é—´åˆ°æ­¤å­—æ®µ</li><li>ä¿®æ”¹æ—¶é—´ï¼Œç”¨æ¥æ ‡è¯†è¿™æ¡è®°å½•æœ€åä¸€æ¬¡çš„ä¿®æ”¹æ—¶é—´ï¼Œå…·æœ‰<code>auto_now</code>å±æ€§ï¼Œå½“è®°å½•å‘ç”Ÿå˜åŒ–æ—¶å¡«å……å½“å‰æ—¶é—´åˆ°æ­¤å­—æ®µ</li></ul><p>å°±åƒä¸‹è¾¹è¿™æ ·çš„è¡¨ç»“æ„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(models.Model):<br>    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>)<br>    update_time = models.DateTimeField(auto_now=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>)<br>    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>)<br>    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">&#x27;æ¿€æ´»çŠ¶æ€&#x27;</span>)<br></code></pre></td></tr></table></figure><p><strong>å½“è¡¨æœ‰å­—æ®µå…·æœ‰<code>auto_now</code>å±æ€§ä¸”ä½ å¸Œæœ›ä»–èƒ½è‡ªåŠ¨æ›´æ–°æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ä¸Šè¾¹æ–¹æ³•äºŒçš„æ›´æ–°ï¼Œä¸ç„¶auto_nowå­—æ®µä¸ä¼šæ›´æ–°</strong>ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><p>Â </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">_t = User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br>_t.username=<span class="hljs-string">&#x27;nick&#x27;</span><br>_t.is_active=<span class="hljs-literal">True</span><br>_t.save()<br></code></pre></td></tr></table></figure><h1 id="json-x2F-dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ"><a href="#json-x2F-dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ" class="headerlink" title="json&#x2F;dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ"></a>json&#x2F;dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ</h1><p>ç›®å‰ä¸»æµçš„webå¼€æ”¾æ–¹å¼éƒ½è®²ç©¶å‰åç«¯åˆ†ç¦»ï¼Œåˆ†ç¦»ä¹‹åå‰åç«¯äº¤äº’çš„æ•°æ®æ ¼å¼å¤§éƒ½ç”¨é€šç”¨çš„jasonå‹ï¼Œé‚£ä¹ˆå¦‚ä½•ç”¨æœ€å°‘çš„ä»£ç æ–¹ä¾¿çš„æ›´æ–°jsonæ ¼å¼æ•°æ®åˆ°æ•°æ®åº“å‘¢ï¼ŸåŒæ ·å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">data = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:<span class="hljs-string">&#x27;nick&#x27;</span>,<span class="hljs-string">&#x27;is_active&#x27;</span>:<span class="hljs-string">&#x27;0&#x27;</span>&#125;<br>User.objects.<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>).update(**data)<br></code></pre></td></tr></table></figure><ul><li>åŒæ ·è¿™ç§æ–¹æ³•ä¸èƒ½è‡ªåŠ¨æ›´æ–°å…·æœ‰<code>auto_now</code>å±æ€§å­—æ®µçš„å€¼</li><li>é€šå¸¸æˆ‘ä»¬å†å˜é‡å‰åŠ ä¸€ä¸ªæ˜Ÿå·(*)è¡¨ç¤ºè¿™ä¸ªå˜é‡æ˜¯å…ƒç»„&#x2F;åˆ—è¡¨ï¼ŒåŠ ä¸¤ä¸ªæ˜Ÿå·è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯å­—å…¸</li></ul><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">data = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:<span class="hljs-string">&#x27;nick&#x27;</span>,<span class="hljs-string">&#x27;is_active&#x27;</span>:<span class="hljs-string">&#x27;0&#x27;</span>&#125;<br>_t = User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br>_t.__dict__.update(**data)<br>_t.save()<br></code></pre></td></tr></table></figure><ul><li>æ–¹æ³•äºŒå’Œæ–¹æ³•ä¸€åŒæ ·æ— æ³•è‡ªåŠ¨æ›´æ–°<code>auto_now</code>å­—æ®µçš„å€¼</li><li>æ³¨æ„è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸€ä¸ª<code>__dict__</code>æ–¹æ³•</li></ul><p>æ–¹æ³•ä¸‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">_t = User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br>_t.role=Role.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">3</span>)<br>_t.save()<br></code></pre></td></tr></table></figure><h1 id="ForeignKeyå­—æ®µæ›´æ–°"><a href="#ForeignKeyå­—æ®µæ›´æ–°" class="headerlink" title="ForeignKeyå­—æ®µæ›´æ–°"></a>ForeignKeyå­—æ®µæ›´æ–°</h1><p>å‡å¦‚æˆ‘ä»¬çš„è¡¨ä¸­æœ‰Foreignkeyå¤–é”®æ—¶ï¼Œè¯¥å¦‚ä½•æ›´æ–°å‘¢ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(models.Model):<br>    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>)<br>    update_time = models.DateTimeField(auto_now=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>)<br>    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>)<br>    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">&#x27;æ¿€æ´»çŠ¶æ€&#x27;</span>)<br>    role = models.ForeignKey(Role, on_delete=models.CASCADE, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;è§’è‰²&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">User.objects.<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>).update(role=<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><ul><li>æœ€ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥è®©ç»™roleå­—æ®µè®¾ç½®ä¸ºä¸€ä¸ªidå³å¯</li><li>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨dictä½œä¸ºå‚æ•°æ›´æ–°ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">User.objects.<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>).update(**&#123;<span class="hljs-string">&#x27;username&#x27;</span>:<span class="hljs-string">&#x27;nick&#x27;</span>,<span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-number">3</span>&#125;)<br></code></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">_role = Role.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">2</span>)<br>User.objects.<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>).update(role=_role)<br></code></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥èµ‹å€¼ä¸€ä¸ªå®ä¾‹ç»™role</li><li>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨dictä½œä¸ºå‚æ•°æ›´æ–°ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">_role = Role.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br>User.objects.<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>).update(**&#123;<span class="hljs-string">&#x27;username&#x27;</span>:<span class="hljs-string">&#x27;nick&#x27;</span>,<span class="hljs-string">&#x27;role&#x27;</span>:_role&#125;)<br></code></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">_t = User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br>_t.role=Role.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">3</span>)<br>_t.save()<br></code></pre></td></tr></table></figure><ul><li>æ³¨æ„ï¼š<strong>è¿™é‡Œçš„roleå¿…é¡»èµ‹å€¼ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸èƒ½å†™id</strong>ï¼Œä¸ç„¶ä¼šæŠ¥é”™<code>&quot;User.role&quot; must be a &quot;Role&quot; instance</code></li><li>å½“ä½¿ç”¨dictä½œä¸ºå‚æ•°æ›´æ–°æ—¶åˆæœ‰ä¸€ç‚¹ä¸åŒï¼Œå¦‚ä¸‹ä»£ç ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">_t = User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br>_t.__dict__.update(**&#123;<span class="hljs-string">&#x27;username&#x27;</span>:<span class="hljs-string">&#x27;nick&#x27;</span>,<span class="hljs-string">&#x27;role_id&#x27;</span>:<span class="hljs-number">2</span>&#125;)<br>_t.save()<br></code></pre></td></tr></table></figure><ul><li>**Foreignkeyå¤–é”®å¿…é¡»åŠ ä¸Š<code>_id</code>**ï¼Œä¾‹å¦‚ï¼š{â€˜role_idâ€™:3}</li><li>role_idåè¾¹å¿…é¡»è·Ÿä¸€ä¸ªidï¼ˆintæˆ–strç±»å‹éƒ½å¯ï¼‰ï¼Œä¸èƒ½è·Ÿroleå®ä¾‹</li></ul><h1 id="ManyToManyFieldå­—æ®µæ›´æ–°"><a href="#ManyToManyFieldå­—æ®µæ›´æ–°" class="headerlink" title="ManyToManyFieldå­—æ®µæ›´æ–°"></a>ManyToManyFieldå­—æ®µæ›´æ–°</h1><p>å‡å¦‚æˆ‘ä»¬çš„è¡¨ä¸­æœ‰ManyToManyFieldå­—æ®µæ—¶æ›´æ–°åˆæœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(models.Model):<br>    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>)<br>    update_time = models.DateTimeField(auto_now=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>)<br>    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>)<br>    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">&#x27;æ¿€æ´»çŠ¶æ€&#x27;</span>)<br>    role = models.ForeignKey(Role, on_delete=models.CASCADE, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;è§’è‰²&#x27;</span>)<br>    groups = models.ManyToManyField(Group, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;ç»„&#x27;</span>)<br></code></pre></td></tr></table></figure><p>m2mæ›´æ–°ï¼šm2må­—æ®µæ²¡æœ‰ç›´æ¥æ›´æ–°çš„æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡æ¸…ç©ºå†æ·»åŠ çš„æ–¹æ³•æ›´æ–°äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">_t = User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br>_t.groups.clear()<br>_t.groups.add(*[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>])<br>_t.save()<br></code></pre></td></tr></table></figure><ul><li><p><code>add()</code>ï¼šm2må­—æ®µæ·»åŠ ä¸€ä¸ªå€¼ï¼Œå½“æœ‰å¤šä¸ªå€¼çš„æ—¶å€™å¯ç”¨åˆ—è¡¨ï¼Œå‚ç…§ä¸Šè¾¹ä¾‹å­</p><ul><li>_t.groups.add(2)</li><li>_t.groups.add(Group.objects.get(id&#x3D;2))</li></ul></li><li><p><code>remove()</code>ï¼šm2må­—æ®µç§»é™¤ä¸€ä¸ªå€¼ï¼Œï¼Œå½“æœ‰å¤šä¸ªå€¼çš„æ—¶å€™å¯ç”¨åˆ—è¡¨ï¼Œå‚ç…§ä¸Šè¾¹ä¾‹å­</p><ul><li>_t.groups.remove(2)</li><li>_t.groups.remove(Group.objects.get(id&#x3D;2))</li></ul></li><li><p><code>clear()</code>ï¼šæ¸…ç©ºm2må­—æ®µçš„å€¼</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django ORM select æŸ¥è¯¢æ“ä½œ</title>
    <link href="/2020/07/01/Django%20ORM%20select%20%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C/"/>
    <url>/2020/07/01/Django%20ORM%20select%20%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è·å–æ‰€æœ‰æ•°æ®ï¼Œå¯¹åº”SQLï¼šselect * from User</span><br>User.objects.<span class="hljs-built_in">all</span>()<br><br><span class="hljs-comment"># åŒ¹é…ï¼Œå¯¹åº”SQLï¼šselect * from User where name = &#x27;Uzi&#x27;</span><br>User.objects.<span class="hljs-built_in">filter</span>(name=<span class="hljs-string">&#x27;Uzi&#x27;</span>)<br><br><span class="hljs-comment"># ä¸åŒ¹é…ï¼Œå¯¹åº”SQLï¼šselect * from User where name != &#x27;Uzi&#x27;</span><br>User.objects.exclude(name=<span class="hljs-string">&#x27;Uzi&#x27;</span>)<br><br><span class="hljs-comment"># è·å–å•æ¡æ•°æ®ï¼ˆæœ‰ä¸”ä»…æœ‰ä¸€æ¡ï¼Œidå”¯ä¸€ï¼‰ï¼Œå¯¹åº”SQLï¼šselect * from User where id = 724</span><br>User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">123</span>)<br></code></pre></td></tr></table></figure><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><p>Â </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è·å–æ€»æ•°ï¼Œå¯¹åº”SQLï¼šselect count(1) from User</span><br>User.objects.count()<br>User.objects.<span class="hljs-built_in">filter</span>(name=<span class="hljs-string">&#x27;Uzi&#x27;</span>).count()<br><br><span class="hljs-comment"># æ¯”è¾ƒï¼Œgt:&gt;ï¼Œgte:&gt;=ï¼Œlt:&lt;ï¼Œlte:&lt;=,å¯¹åº”SQLï¼šselect * from User where id &gt; 724</span><br>User.objects.<span class="hljs-built_in">filter</span>(id__gt=<span class="hljs-number">724</span>)<br>User.objects.<span class="hljs-built_in">filter</span>(id__gt=<span class="hljs-number">1</span>, id__lt=<span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># åŒ…å«ï¼Œinï¼Œå¯¹åº”SQLï¼šselect * from User where id in (11,22,33)</span><br>User.objects.<span class="hljs-built_in">filter</span>(id__in=[<span class="hljs-number">11</span>, <span class="hljs-number">22</span>, <span class="hljs-number">33</span>])<br>User.objects.exclude(id__in=[<span class="hljs-number">11</span>, <span class="hljs-number">22</span>, <span class="hljs-number">33</span>])<br><br><span class="hljs-comment"># isnullï¼šisnull=Trueä¸ºç©ºï¼Œisnull=Falseä¸ä¸ºç©ºï¼Œå¯¹åº”SQLï¼šselect * from User where pub_date is null</span><br>User.objects.<span class="hljs-built_in">filter</span>(pub_date__isnull=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># likeï¼Œcontainså¤§å°å†™æ•æ„Ÿï¼Œicontainså¤§å°å†™ä¸æ•æ„Ÿï¼Œç›¸åŒç”¨æ³•çš„è¿˜æœ‰startswithã€endswith</span><br>User.objects.<span class="hljs-built_in">filter</span>(name__contains=<span class="hljs-string">&quot;sre&quot;</span>)<br>User.objects.exclude(name__contains=<span class="hljs-string">&quot;sre&quot;</span>)<br><br><span class="hljs-comment"># èŒƒå›´ï¼Œbetween andï¼Œå¯¹åº”SQLï¼šselect * from User where id between 3 and 8</span><br>User.objects.<span class="hljs-built_in">filter</span>(id__range=[<span class="hljs-number">3</span>, <span class="hljs-number">8</span>])<br><br><span class="hljs-comment"># æ’åºï¼Œorder byï¼Œ&#x27;id&#x27;æŒ‰idæ­£åºï¼Œ&#x27;-id&#x27;æŒ‰idå€’å™</span><br>User.objects.<span class="hljs-built_in">filter</span>(name=<span class="hljs-string">&#x27;Uzi&#x27;</span>).order_by(<span class="hljs-string">&#x27;id&#x27;</span>)<br>User.objects.<span class="hljs-built_in">filter</span>(name=<span class="hljs-string">&#x27;Uzi&#x27;</span>).order_by(<span class="hljs-string">&#x27;-id&#x27;</span>)<br><br><span class="hljs-comment"># å¤šçº§æ’åºï¼Œorder byï¼Œå…ˆæŒ‰nameè¿›è¡Œæ­£åºæ’åˆ—ï¼Œå¦‚æœnameä¸€è‡´åˆ™å†æŒ‰ç…§idå€’å™æ’åˆ—</span><br>User.objects.<span class="hljs-built_in">filter</span>(name=<span class="hljs-string">&#x27;Uzi&#x27;</span>).order_by(<span class="hljs-string">&#x27;name&#x27;</span>,<span class="hljs-string">&#x27;-id&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="è¿›é˜¶æ“ä½œ"><a href="#è¿›é˜¶æ“ä½œ" class="headerlink" title="è¿›é˜¶æ“ä½œ"></a>è¿›é˜¶æ“ä½œ</h2><p>Â </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># limitï¼Œå¯¹åº”SQLï¼šselect * from User limit 3;</span><br>User.objects.<span class="hljs-built_in">all</span>()[:<span class="hljs-number">3</span>]<br><br><span class="hljs-comment"># limitï¼Œå–ç¬¬ä¸‰æ¡ä»¥åçš„æ•°æ®ï¼Œæ²¡æœ‰å¯¹åº”çš„SQLï¼Œç±»ä¼¼çš„å¦‚ï¼šselect * from User limit 3,10000000ï¼Œä»ç¬¬3æ¡å¼€å§‹å–æ•°æ®ï¼Œå–10000000æ¡ï¼ˆ10000000å¤§äºè¡¨ä¸­æ•°æ®æ¡æ•°ï¼‰</span><br>User.objects.<span class="hljs-built_in">all</span>()[<span class="hljs-number">3</span>:]<br><br><span class="hljs-comment"># offsetï¼Œå–å‡ºç»“æœçš„ç¬¬10-20æ¡æ•°æ®ï¼ˆä¸åŒ…å«10ï¼ŒåŒ…å«20ï¼‰,ä¹Ÿæ²¡æœ‰å¯¹åº”SQLï¼Œå‚è€ƒä¸Šè¾¹çš„SQLå†™æ³•</span><br>User.objects.<span class="hljs-built_in">all</span>()[<span class="hljs-number">10</span>:<span class="hljs-number">20</span>]<br><br><span class="hljs-comment"># åˆ†ç»„ï¼Œgroup byï¼Œå¯¹åº”SQLï¼šselect username,count(1) from User group by username;</span><br><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Count<br>User.objects.values_list(<span class="hljs-string">&#x27;username&#x27;</span>).annotate(Count(<span class="hljs-string">&#x27;id&#x27;</span>))<br><br><span class="hljs-comment"># å»é‡distinctï¼Œå¯¹åº”SQLï¼šselect distinct(username) from User</span><br>User.objects.values(<span class="hljs-string">&#x27;username&#x27;</span>).distinct().count()<br><br><span class="hljs-comment"># filterå¤šåˆ—ã€æŸ¥è¯¢å¤šåˆ—ï¼Œå¯¹åº”SQLï¼šselect username,fullname from accounts_user</span><br>User.objects.values_list(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;fullname&#x27;</span>)<br><br><span class="hljs-comment"># filterå•åˆ—ã€æŸ¥è¯¢å•åˆ—ï¼Œæ­£å¸¸values_listç»™å‡ºçš„ç»“æœæ˜¯ä¸ªåˆ—è¡¨ï¼Œé‡Œè¾¹é‡Œè¾¹çš„æ¯æ¡æ•°æ®å¯¹åº”ä¸€ä¸ªå…ƒç»„ï¼Œå½“åªæŸ¥è¯¢ä¸€åˆ—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨flatæ ‡ç­¾å»æ‰å…ƒç»„ï¼Œå°†æ¯æ¡æ•°æ®çš„ç»“æœä»¥å­—ç¬¦ä¸²çš„å½¢å¼å­˜å‚¨åœ¨åˆ—è¡¨ä¸­ï¼Œä»è€Œé¿å…è§£æå…ƒç»„çš„éº»çƒ¦</span><br>User.objects.values_list(<span class="hljs-string">&#x27;username&#x27;</span>, flat=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># intå­—æ®µå–æœ€å¤§å€¼ã€æœ€å°å€¼ã€ç»¼åˆã€å¹³å‡æ•°</span><br><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Sum,Count,Max,Min,Avg<br><br>User.objects.aggregate(Count(â€˜<span class="hljs-built_in">id</span>â€™))<br>User.objects.aggregate(Sum(â€˜ageâ€™))<br></code></pre></td></tr></table></figure><h2 id="æ—¶é—´å­—æ®µ"><a href="#æ—¶é—´å­—æ®µ" class="headerlink" title="æ—¶é—´å­—æ®µ"></a>æ—¶é—´å­—æ®µ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åŒ¹é…æ—¥æœŸï¼Œdate</span><br>User.objects.<span class="hljs-built_in">filter</span>(create_time__date=datetime.date(<span class="hljs-number">2018</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>))<br>User.objects.<span class="hljs-built_in">filter</span>(create_time__date__gt=datetime.date(<span class="hljs-number">2018</span>, <span class="hljs-number">8</span>, <span class="hljs-number">2</span>))<br><br><span class="hljs-comment"># åŒ¹é…å¹´ï¼Œyearï¼Œç›¸åŒç”¨æ³•çš„è¿˜æœ‰åŒ¹é…æœˆmonthï¼ŒåŒ¹é…æ—¥dayï¼ŒåŒ¹é…å‘¨week_dayï¼ŒåŒ¹é…æ—¶hourï¼ŒåŒ¹é…åˆ†minuteï¼ŒåŒ¹é…ç§’second</span><br>User.objects.<span class="hljs-built_in">filter</span>(create_time__year=<span class="hljs-number">2018</span>)<br>User.objects.<span class="hljs-built_in">filter</span>(create_time__year__gte=<span class="hljs-number">2018</span>)<br><br><span class="hljs-comment"># æŒ‰å¤©ç»Ÿè®¡å½’æ¡£</span><br>today = datetime.date.today()<br>select = &#123;<span class="hljs-string">&#x27;day&#x27;</span>: connection.ops.date_trunc_sql(<span class="hljs-string">&#x27;day&#x27;</span>, <span class="hljs-string">&#x27;create_time&#x27;</span>)&#125;<br>deploy_date_count = Task.objects.<span class="hljs-built_in">filter</span>(<br>Â  Â  create_time__range=(today - datetime.timedelta(days=<span class="hljs-number">7</span>), today)<br>).extra(select=select).values(<span class="hljs-string">&#x27;day&#x27;</span>).annotate(number=Count(<span class="hljs-string">&#x27;id&#x27;</span>))<br></code></pre></td></tr></table></figure><h2 id="Q-çš„ä½¿ç”¨"><a href="#Q-çš„ä½¿ç”¨" class="headerlink" title="Q çš„ä½¿ç”¨"></a>Q çš„ä½¿ç”¨</h2><p><strong>Qå¯¹è±¡å¯ä»¥å¯¹å…³é”®å­—å‚æ•°è¿›è¡Œå°è£…ï¼Œä»è€Œæ›´å¥½çš„åº”ç”¨å¤šä¸ªæŸ¥è¯¢ï¼Œå¯ä»¥ç»„åˆ&amp;(and)ã€|(or)ã€~(not)æ“ä½œç¬¦ã€‚</strong></p><p>ä¾‹å¦‚ä¸‹è¾¹çš„è¯­å¥  Â </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Q<br><br>User.objects.<span class="hljs-built_in">filter</span>(<br>    Q(role__startswith=<span class="hljs-string">&#x27;sre_&#x27;</span>),<br>    Q(name=<span class="hljs-string">&#x27;å…¬ä¼—å·&#x27;</span>) | Q(name=<span class="hljs-string">&#x27;Uzi&#x27;</span>)<br>)<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">è½¬æ¢æˆSQLè¯­å¥å¦‚ä¸‹ï¼š<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">User</span> <span class="hljs-keyword">where</span> role <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;sre_%&#x27;</span> <span class="hljs-keyword">and</span> (name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;å…¬ä¼—å·&#x27;</span> <span class="hljs-keyword">or</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;Uzi&#x27;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html">é€šå¸¸æ›´å¤šçš„æ—¶å€™æˆ‘ä»¬ç”¨Qæ¥åšæœç´¢é€»è¾‘ï¼Œæ¯”å¦‚å‰å°æœç´¢æ¡†è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œåå°å»æ•°æ®åº“ä¸­æ£€ç´¢æ ‡é¢˜æˆ–å†…å®¹ä¸­æ˜¯å¦åŒ…å«<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">_s = request.GET.get(<span class="hljs-string">&#x27;search&#x27;</span>)<br><br>_t = Blog.objects.<span class="hljs-built_in">all</span>()<br><span class="hljs-keyword">if</span> _s:<br>    _t = _t.<span class="hljs-built_in">filter</span>(<br>        Q(title__icontains=_s) |<br>        Q(content__icontains=_s)<br>    )<br><br><span class="hljs-keyword">return</span> _t<br>å¤–é”®ï¼šForeignKey<br>è¡¨ç»“æ„ï¼š<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Role</span>(models.Model):<br>    name = models.CharField(max_length=<span class="hljs-number">16</span>, unique=<span class="hljs-literal">True</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(models.Model):<br>    username = models.EmailField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>)<br>    role = models.ForeignKey(Role, on_delete=models.CASCADE)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs python">æ­£å‘æŸ¥è¯¢:<br><span class="hljs-comment"># æŸ¥è¯¢ç”¨æˆ·çš„è§’è‰²å</span><br>_t = User.objects.get(username=<span class="hljs-string">&#x27;Uzi&#x27;</span>)<br>_t.role.name<br>åå‘æŸ¥è¯¢ï¼š<br><span class="hljs-comment"># æŸ¥è¯¢è§’è‰²ä¸‹åŒ…å«çš„æ‰€æœ‰ç”¨æˆ·</span><br>_t = Role.objects.get(name=<span class="hljs-string">&#x27;Role03&#x27;</span>)<br>_t.user_set.<span class="hljs-built_in">all</span>()<br>å¦ä¸€ç§åå‘æŸ¥è¯¢çš„æ–¹æ³•ï¼š<br>_t = Role.objects.get(name=<span class="hljs-string">&#x27;Role03&#x27;</span>)<br><br><span class="hljs-comment"># è¿™ç§æ–¹æ³•æ¯”ä¸Šä¸€ç§_setçš„æ–¹æ³•æŸ¥è¯¢é€Ÿåº¦è¦å¿«</span><br>User.objects.<span class="hljs-built_in">filter</span>(role=_t)<br>ç¬¬ä¸‰ç§åå‘æŸ¥è¯¢çš„æ–¹æ³•ï¼š<br>å¦‚æœå¤–é”®å­—æ®µæœ‰related_nameå±æ€§ï¼Œä¾‹å¦‚modelså¦‚ä¸‹ï¼š<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(models.Model):<br>    username = models.EmailField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>)<br>    role = models.ForeignKey(Role, on_delete=models.CASCADE,related_name=<span class="hljs-string">&#x27;roleUsers&#x27;</span>)<br>é‚£ä¹ˆå¯ä»¥ç›´æ¥ç”¨related_nameå±æ€§å–åˆ°æŸè§’è‰²çš„æ‰€æœ‰ç”¨æˆ·<br><br>_t = Role.objects.get(name = <span class="hljs-string">&#x27;Role03&#x27;</span>)<br>_t.roleUsers.<span class="hljs-built_in">all</span>()<br>M2Mï¼šManyToManyField<br>è¡¨ç»“æ„ï¼š<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Group</span>(models.Model):<br>    name = models.CharField(max_length=<span class="hljs-number">16</span>, unique=<span class="hljs-literal">True</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(models.Model):<br>    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>)<br>    groups = models.ManyToManyField(Group, related_name=<span class="hljs-string">&#x27;groupUsers&#x27;</span>)<br>æ­£å‘æŸ¥è¯¢:<br><span class="hljs-comment"># æŸ¥è¯¢ç”¨æˆ·éš¶å±ç»„</span><br>_t = User.objects.get(username = <span class="hljs-string">&#x27;Uzi&#x27;</span>)<br>_t.groups.<span class="hljs-built_in">all</span>()<br>åå‘æŸ¥è¯¢ï¼š<br><span class="hljs-comment"># æŸ¥è¯¢ç»„åŒ…å«ç”¨æˆ·</span><br>_t = Group.objects.get(name = <span class="hljs-string">&#x27;groupC&#x27;</span>)<br>_t.user_set.<span class="hljs-built_in">all</span>()<br>åŒæ ·M2Må­—æ®µå¦‚æœæœ‰related_nameå±æ€§ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ç”¨ä¸‹è¾¹çš„æ–¹å¼åæŸ¥<br><br>_t = Group.objects.get(name = <span class="hljs-string">&#x27;groupC&#x27;</span>)<br>_t.groupUsers.<span class="hljs-built_in">all</span>()<br>get_object_or_404<br>æ­£å¸¸å¦‚æœæˆ‘ä»¬è¦å»æ•°æ®åº“é‡Œæœç´¢æŸä¸€æ¡æ•°æ®æ—¶ï¼Œé€šå¸¸ä½¿ç”¨ä¸‹è¾¹çš„æ–¹æ³•ï¼š<br><br>_t = User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">734</span>)<br><br>ä½†å½“<span class="hljs-built_in">id</span>=<span class="hljs-number">724</span>çš„æ•°æ®ä¸å­˜åœ¨æ—¶ï¼Œç¨‹åºå°†ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯<br><br>abcer.models.DoesNotExist: User matching query does <span class="hljs-keyword">not</span> exist.<br><br>ä¸ºäº†ç¨‹åºå…¼å®¹å’Œå¼‚å¸¸åˆ¤æ–­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹è¾¹ä¸¤ç§æ–¹å¼:<br><br>æ–¹å¼ä¸€ï¼šgetæ”¹ä¸º<span class="hljs-built_in">filter</span><br>_t = User.objects.<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">id</span>=<span class="hljs-number">724</span>)<br><span class="hljs-comment"># å–å‡º_tä¹‹åå†å»åˆ¤æ–­_tæ˜¯å¦å­˜åœ¨</span><br>æ–¹å¼äºŒï¼šä½¿ç”¨get_object_or_404<br><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> get_object_or_404<br><br>_t = get_object_or_404(User, <span class="hljs-built_in">id</span>=<span class="hljs-number">724</span>)<br><span class="hljs-comment"># get_object_or_404æ–¹æ³•ï¼Œå®ƒä¼šå…ˆè°ƒç”¨djangoçš„getæ–¹æ³•ï¼Œå¦‚æœæŸ¥è¯¢çš„å¯¹è±¡ä¸å­˜åœ¨çš„è¯ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªHttp404çš„å¼‚å¸¸</span><br>å®ç°æ–¹æ³•ç±»ä¼¼äºä¸‹è¾¹è¿™æ ·ï¼š<br><br><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> Http404<br><br><span class="hljs-keyword">try</span>:<br>    _t = User.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">724</span>)<br><span class="hljs-keyword">except</span> User.DoesNotExist:<br>    <span class="hljs-keyword">raise</span> Http404<br>get_or_create<br>é¡¾åæ€ä¹‰ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªå¯¹è±¡å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå¦‚ä¸‹ï¼š<br><br><span class="hljs-built_in">object</span>, created = User.objects.get_or_create(username=<span class="hljs-string">&#x27;Uzi&#x27;</span>)<br>è¿”å›ä¸€ä¸ªç”±<span class="hljs-built_in">object</span>å’Œcreatedç»„æˆçš„å…ƒç»„ï¼Œå…¶ä¸­<span class="hljs-built_in">object</span>å°±æ˜¯ä¸€ä¸ªæŸ¥è¯¢åˆ°çš„æˆ–è€…æ˜¯è¢«åˆ›å»ºçš„å¯¹è±¡ï¼Œcreatedæ˜¯ä¸€ä¸ªè¡¨ç¤ºæ˜¯å¦åˆ›å»ºäº†æ–°å¯¹è±¡çš„å¸ƒå°”å€¼<br><br>å®ç°æ–¹å¼ç±»ä¼¼äºä¸‹è¾¹è¿™æ ·ï¼š<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-built_in">object</span> = User.objects.get(username=<span class="hljs-string">&#x27;Uzi&#x27;</span>)<br><br>    created = <span class="hljs-literal">False</span><br>exception User.DoesNoExist:<br>    <span class="hljs-built_in">object</span> = User(username=<span class="hljs-string">&#x27;Uzi&#x27;</span>)<br>    <span class="hljs-built_in">object</span>.save()<br><br>    created = <span class="hljs-literal">True</span><br><br>returen <span class="hljs-built_in">object</span>, created<br><br>æ‰§è¡ŒåŸç”ŸSQL<br>Djangoä¸­èƒ½ç”¨ORMçš„å°±ç”¨å®ƒORMå§ï¼Œä¸å»ºè®®æ‰§è¡ŒåŸç”ŸSQLï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›å®‰å…¨é—®é¢˜ï¼Œå¦‚æœå®åœ¨æ˜¯SQLå¤ªå¤æ‚ORMå®ç°ä¸äº†ï¼Œé‚£å°±çœ‹çœ‹ä¸‹è¾¹æ‰§è¡ŒåŸç”ŸSQLçš„æ–¹æ³•ï¼Œè·Ÿç›´æ¥ä½¿ç”¨pymysqlåŸºæœ¬ä¸€è‡´äº†<br><br><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> connection<br><br><span class="hljs-keyword">with</span> connection.cursor() <span class="hljs-keyword">as</span> cursor:<br>    cursor.execute(<span class="hljs-string">&#x27;select * from accounts_User&#x27;</span>)<br>    row = cursor.fetchall()<br><br><span class="hljs-keyword">return</span> row<br><br>æ³¨æ„è¿™é‡Œè¡¨åå­—è¦ç”¨appå+ä¸‹åˆ’çº¿+modelåçš„æ–¹å¼<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>orm python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python epoll socketå®ä¾‹</title>
    <link href="/2020/06/23/python%20epoll%20socket%E5%AE%9E%E4%BE%8B/"/>
    <url>/2020/06/23/python%20epoll%20socket%E5%AE%9E%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket, logging<br><span class="hljs-keyword">import</span> select, errno<br><br>logger = logging.getLogger(<span class="hljs-string">&quot;network-server&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">InitLog</span>():<br>    logger.setLevel(logging.DEBUG)<br><br>    fh = logging.FileHandler(<span class="hljs-string">&quot;network-server.log&quot;</span>)<br>    fh.setLevel(logging.DEBUG)<br>    ch = logging.StreamHandler()<br>    ch.setLevel(logging.ERROR)<br><br>    formatter = logging.Formatter(<span class="hljs-string">&quot;%(asctime)s - %(name)s - %(levelname)s - %(message)s&quot;</span>)<br>    ch.setFormatter(formatter)<br>    fh.setFormatter(formatter)<br><br>    logger.addHandler(fh)<br>    logger.addHandler(ch)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br><br>    InitLog()<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># åˆ›å»º TCP socket ä½œä¸ºç›‘å¬ socket</span><br>        listen_fd = socket.socket(socket.AF_INET, socket.SOCK_STREAM, <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(<span class="hljs-string">&quot;create socket failed&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># è®¾ç½® SO_REUSEADDR é€‰é¡¹</span><br>        listen_fd.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(<span class="hljs-string">&quot;setsocketopt SO_REUSEADDR failed&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># è¿›è¡Œ bind -- æ­¤å¤„æœªæŒ‡å®š ip åœ°å€ï¼Œå³ bind äº†å…¨éƒ¨ç½‘å¡ ip ä¸Š</span><br>        listen_fd.bind((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">8008</span>))<br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(<span class="hljs-string">&quot;bind failed&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># è®¾ç½® listen çš„ backlog æ•°</span><br>        listen_fd.listen(<span class="hljs-number">100</span>)<br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(msg)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># åˆ›å»º epoll å¥æŸ„</span><br>        epoll_fd = select.epoll()<br>        <span class="hljs-comment"># å‘ epoll å¥æŸ„ä¸­æ³¨å†Œ ç›‘å¬ socket çš„ å¯è¯» äº‹ä»¶</span><br>        epoll_fd.register(listen_fd.fileno(), select.EPOLLIN)<br>    <span class="hljs-keyword">except</span> select.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(msg)<br><br>    connections = &#123;&#125;<br>    addresses = &#123;&#125;<br>    datalist = &#123;&#125;<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># epoll è¿›è¡Œ fd æ‰«æçš„åœ°æ–¹ -- æœªæŒ‡å®šè¶…æ—¶æ—¶é—´åˆ™ä¸ºé˜»å¡ç­‰å¾…</span><br>        epoll_list = epoll_fd.poll()<br><br>        <span class="hljs-keyword">for</span> fd, events <span class="hljs-keyword">in</span> epoll_list:<br>            <span class="hljs-comment"># è‹¥ä¸ºç›‘å¬ fd è¢«æ¿€æ´»</span><br>            <span class="hljs-keyword">if</span> fd == listen_fd.fileno():<br>                <span class="hljs-comment"># è¿›è¡Œ accept -- è·å¾—è¿æ¥ä¸Šæ¥ client çš„ ip å’Œ portï¼Œä»¥åŠ socket å¥æŸ„</span><br>                conn, addr = listen_fd.accept()<br>                logger.debug(<span class="hljs-string">&quot;accept connection from %s, %d, fd = %d&quot;</span> % (addr[<span class="hljs-number">0</span>], addr[<span class="hljs-number">1</span>], conn.fileno()))<br>                <span class="hljs-comment"># å°†è¿æ¥ socket è®¾ç½®ä¸º éé˜»å¡</span><br>                conn.setblocking(<span class="hljs-number">0</span>)<br>                <span class="hljs-comment"># å‘ epoll å¥æŸ„ä¸­æ³¨å†Œ è¿æ¥ socket çš„ å¯è¯» äº‹ä»¶</span><br>                epoll_fd.register(conn.fileno(), select.EPOLLIN | select.EPOLLET)<br>                <span class="hljs-comment"># å°† conn å’Œ addr ä¿¡æ¯åˆ†åˆ«ä¿å­˜èµ·æ¥</span><br>                connections[conn.fileno()] = conn<br>                addresses[conn.fileno()] = addr<br>            <span class="hljs-keyword">elif</span> select.EPOLLIN &amp; events:<br>                <span class="hljs-comment"># æœ‰ å¯è¯» äº‹ä»¶æ¿€æ´»</span><br>                datas = <span class="hljs-string">&#x27;&#x27;</span><br>                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                    <span class="hljs-keyword">try</span>:<br>                        <span class="hljs-comment"># ä»æ¿€æ´» fd ä¸Š recv 10 å­—èŠ‚æ•°æ®</span><br>                        data = connections[fd].recv(<span class="hljs-number">10</span>)<br>                        <span class="hljs-comment"># è‹¥å½“å‰æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®ï¼Œå¹¶ä¸”ä¹‹å‰çš„ç´¯è®¡æ•°æ®ä¹Ÿæ²¡æœ‰</span><br>                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> datas:<br>                            <span class="hljs-comment"># ä» epoll å¥æŸ„ä¸­ç§»é™¤è¯¥ è¿æ¥ fd</span><br>                            epoll_fd.unregister(fd)<br>                            <span class="hljs-comment"># server ä¾§ä¸»åŠ¨å…³é—­è¯¥ è¿æ¥ fd</span><br>                            connections[fd].close()<br>                            logger.debug(<span class="hljs-string">&quot;%s, %d closed&quot;</span> % (addresses[fd][<span class="hljs-number">0</span>], addresses[fd][<span class="hljs-number">1</span>]))<br>                            <span class="hljs-keyword">break</span><br>                        <span class="hljs-keyword">else</span>:<br>                            <span class="hljs-comment"># å°†æ¥æ”¶åˆ°çš„æ•°æ®æ‹¼æ¥ä¿å­˜åœ¨ datas ä¸­</span><br>                            datas += data<br>                    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>                        <span class="hljs-comment"># åœ¨ éé˜»å¡ socket ä¸Šè¿›è¡Œ recv éœ€è¦å¤„ç† è¯»ç©¿ çš„æƒ…å†µ</span><br>                        <span class="hljs-comment"># è¿™é‡Œå®é™…ä¸Šæ˜¯åˆ©ç”¨ è¯»ç©¿ å‡º å¼‚å¸¸ çš„æ–¹å¼è·³åˆ°è¿™é‡Œè¿›è¡Œåç»­å¤„ç†</span><br>                        <span class="hljs-keyword">if</span> msg.errno == errno.EAGAIN:<br>                            logger.debug(<span class="hljs-string">&quot;%s receive %s&quot;</span> % (fd, datas))<br>                            <span class="hljs-comment"># å°†å·²æ¥æ”¶æ•°æ®ä¿å­˜èµ·æ¥</span><br>                            datalist[fd] = datas<br>                            <span class="hljs-comment"># æ›´æ–° epoll å¥æŸ„ä¸­è¿æ¥d æ³¨å†Œäº‹ä»¶ä¸º å¯å†™</span><br>                            epoll_fd.modify(fd, select.EPOLLET | select.EPOLLOUT)<br>                            <span class="hljs-keyword">break</span><br>                        <span class="hljs-keyword">else</span>:<br>                            <span class="hljs-comment"># å‡ºé”™å¤„ç†</span><br>                            epoll_fd.unregister(fd)<br>                            connections[fd].close()<br>                            logger.error(msg)<br>                            <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">elif</span> select.EPOLLHUP &amp; events:<br>                <span class="hljs-comment"># æœ‰ HUP äº‹ä»¶æ¿€æ´»</span><br>                epoll_fd.unregister(fd)<br>                connections[fd].close()<br>                logger.debug(<span class="hljs-string">&quot;%s, %d closed&quot;</span> % (addresses[fd][<span class="hljs-number">0</span>], addresses[fd][<span class="hljs-number">1</span>]))<br>            <span class="hljs-keyword">elif</span> select.EPOLLOUT &amp; events:<br>                <span class="hljs-comment"># æœ‰ å¯å†™ äº‹ä»¶æ¿€æ´»</span><br>                sendLen = <span class="hljs-number">0</span><br>                <span class="hljs-comment"># é€šè¿‡ while å¾ªç¯ç¡®ä¿å°† buf ä¸­çš„æ•°æ®å…¨éƒ¨å‘é€å‡ºå»</span><br>                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                    <span class="hljs-comment"># å°†ä¹‹å‰æ”¶åˆ°çš„æ•°æ®å‘å› client -- é€šè¿‡ sendLen æ¥æ§åˆ¶å‘é€ä½ç½®</span><br>                    sendLen += connections[fd].send(datalist[fd][sendLen:])<br>                    <span class="hljs-comment"># åœ¨å…¨éƒ¨å‘é€å®Œæ¯•åé€€å‡º while å¾ªç¯</span><br>                    <span class="hljs-keyword">if</span> sendLen == <span class="hljs-built_in">len</span>(datalist[fd]):<br>                        <span class="hljs-keyword">break</span><br>                <span class="hljs-comment"># æ›´æ–° epoll å¥æŸ„ä¸­è¿æ¥ fd æ³¨å†Œäº‹ä»¶ä¸º å¯è¯»</span><br>                epoll_fd.modify(fd, select.EPOLLIN | select.EPOLLET)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># å…¶ä»– epoll äº‹ä»¶ä¸è¿›è¡Œå¤„ç†</span><br>                <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>epoll socket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¿›ç¨‹é—´é€šä¿¡-Queue</title>
    <link href="/2020/06/19/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-Queue/"/>
    <url>/2020/06/19/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-Queue/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="1-Queueçš„ä½¿ç”¨"><a href="#1-Queueçš„ä½¿ç”¨" class="headerlink" title="1. Queueçš„ä½¿ç”¨"></a>1. Queueçš„ä½¿ç”¨</h2><p>å¯ä»¥ä½¿ç”¨multiprocessingæ¨¡å—çš„Queueå®ç°å¤šè¿›ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼ŒQueueæœ¬èº«æ˜¯ä¸€ä¸ªæ¶ˆæ¯åˆ—é˜Ÿç¨‹åºï¼Œé¦–å…ˆç”¨ä¸€ä¸ªå°å®ä¾‹æ¥æ¼”ç¤ºä¸€ä¸‹Queueçš„å·¥ä½œåŸç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> multiprocessing<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—, 3:è¡¨ç¤ºé˜Ÿåˆ—ä¸­æœ€å¤§æ¶ˆæ¯ä¸ªæ•°</span><br>    queue = multiprocessing.Queue(<span class="hljs-number">3</span>)<br>    <span class="hljs-comment"># æ”¾å…¥æ•°æ®</span><br>    queue.put(<span class="hljs-number">1</span>)<br>    queue.put(<span class="hljs-string">&quot;hello&quot;</span>)<br>    queue.put([<span class="hljs-number">3</span>,<span class="hljs-number">5</span>])<br>    <span class="hljs-comment"># æ€»ç»“: é˜Ÿåˆ—å¯ä»¥æ”¾å…¥ä»»æ„æ•°æ®ç±»å‹</span><br>    <span class="hljs-comment"># æç¤ºï¼š å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œéœ€è¦ç­‰å¾…é˜Ÿåˆ—æœ‰ç©ºé—²ä½ç½®æ‰èƒ½æ”¾å…¥æ•°æ®ï¼Œå¦åˆ™ä¸€ç›´ç­‰å¾…</span><br>    <span class="hljs-comment"># queue.put((5,6))</span><br>    <span class="hljs-comment"># æç¤ºï¼š å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œä¸ç­‰å¾…é˜Ÿåˆ—æœ‰ç©ºé—²ä½ç½®ï¼Œå¦‚æœæ”¾å…¥ä¸æˆåŠŸç›´æ¥å´©æºƒ</span><br>    <span class="hljs-comment"># queue.put_nowait((5,6))</span><br>    <span class="hljs-comment"># å»ºè®®ï¼š å‘é˜Ÿåˆ—æ”¾å…¥æ•°æ®ç»Ÿä¸€ä½¿ç”¨put</span><br><br>    <span class="hljs-comment"># æŸ¥çœ‹é˜Ÿåˆ—æ˜¯å¦æ»¡äº†</span><br>    <span class="hljs-comment"># print(queue.full())</span><br><br>    <span class="hljs-comment"># æ³¨æ„ç‚¹ï¼šqueue.empty()åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ç©ºäº†ä¸å¯é </span><br>    <span class="hljs-comment"># æŸ¥çœ‹é˜Ÿåˆ—æ˜¯å¦ç©ºäº†</span><br>    <span class="hljs-comment"># print(queue.empty())</span><br><br>    <span class="hljs-comment"># è§£å†³åŠæ³•: 1. åŠ å»¶æ—¶æ“ä½œ 2. ä½¿ç”¨åˆ¤æ–­é˜Ÿåˆ—çš„ä¸ªæ•°,ä¸ä½¿ç”¨empty</span><br>    <span class="hljs-comment"># time.sleep(0.01)</span><br>    <span class="hljs-keyword">if</span> queue.qsize() == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é˜Ÿåˆ—ä¸ºç©º&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é˜Ÿåˆ—ä¸ä¸ºç©º&quot;</span>)<br><br>    <span class="hljs-comment"># è·å–é˜Ÿåˆ—çš„ä¸ªæ•°</span><br>    size = queue.qsize()<br>    <span class="hljs-built_in">print</span>(size)<br><br>    <span class="hljs-comment"># è·å–æ•°æ®</span><br>    value = queue.get()<br>    <span class="hljs-built_in">print</span>(value)<br>    <span class="hljs-comment"># è·å–é˜Ÿåˆ—çš„ä¸ªæ•°</span><br>    size = queue.qsize()<br>    <span class="hljs-built_in">print</span>(size)<br>    <span class="hljs-comment"># è·å–æ•°æ®</span><br>    value = queue.get()<br>    <span class="hljs-built_in">print</span>(value)<br>    <span class="hljs-comment"># è·å–æ•°æ®</span><br>    value = queue.get()<br>    <span class="hljs-built_in">print</span>(value)<br><br>    <span class="hljs-comment"># è·å–é˜Ÿåˆ—çš„ä¸ªæ•°</span><br>    size = queue.qsize()<br>    <span class="hljs-built_in">print</span>(size)<br><br>    <span class="hljs-comment"># æç¤ºï¼šå¦‚æœé˜Ÿåˆ—ç©ºäº†ï¼Œå†å–å€¼éœ€è¦ç­‰å¾…ï¼Œåªæœ‰é˜Ÿåˆ—æœ‰å€¼ä»¥åæ‰èƒ½è·å–é˜Ÿåˆ—ä¸­æ•°æ®</span><br>    <span class="hljs-comment"># value = queue.get()</span><br>    <span class="hljs-comment"># print(value)</span><br>    <span class="hljs-comment"># æç¤ºï¼š å¦‚æœé˜Ÿåˆ—ç©ºäº† ï¼Œä¸éœ€è¦ç­‰å¾…é˜Ÿåˆ—æœ‰å€¼ï¼Œä½†æ˜¯å¦‚æœå–å€¼çš„æ—¶å€™å‘ç°é˜Ÿåˆ—ç©ºäº†ç›´æ¥å´©æºƒ</span><br>    <span class="hljs-comment"># å»ºè®®å¤§å®¶: å‘é˜Ÿåˆ—å–å€¼ä½¿ç”¨get</span><br>    <span class="hljs-comment"># value = queue.get_nowait()</span><br>    <span class="hljs-comment"># print(value)</span><br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">é˜Ÿåˆ—ä¸ä¸ºç©º<br><span class="hljs-number">3</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br>hello<br><span class="hljs-string">[3, 5]</span><br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>è¯´æ˜</p><p>åˆå§‹åŒ–Queue()å¯¹è±¡æ—¶ï¼ˆä¾‹å¦‚ï¼šq&#x3D;Queue()ï¼‰ï¼Œè‹¥æ‹¬å·ä¸­æ²¡æœ‰æŒ‡å®šæœ€å¤§å¯æ¥æ”¶çš„æ¶ˆæ¯æ•°é‡ï¼Œæˆ–æ•°é‡ä¸ºè´Ÿå€¼ï¼Œé‚£ä¹ˆå°±ä»£è¡¨å¯æ¥å—çš„æ¶ˆæ¯æ•°é‡æ²¡æœ‰ä¸Šé™ï¼ˆç›´åˆ°å†…å­˜çš„å°½å¤´ï¼‰ï¼›</p><ul><li><p>Queue.qsize()ï¼šè¿”å›å½“å‰é˜Ÿåˆ—åŒ…å«çš„æ¶ˆæ¯æ•°é‡ï¼›</p></li><li><p>Queue.empty()ï¼šå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å›Trueï¼Œåä¹‹False , æ³¨æ„è¿™ä¸ªæ“ä½œæ˜¯ä¸å¯é çš„ã€‚</p></li><li><p>Queue.full()ï¼šå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œè¿”å›True,åä¹‹Falseï¼›</p></li><li><p>Queue.get([block[, timeout]])ï¼šè·å–é˜Ÿåˆ—ä¸­çš„ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åå°†å…¶ä»åˆ—é˜Ÿä¸­ç§»é™¤ï¼Œblocké»˜è®¤å€¼ä¸ºTrueï¼›</p></li></ul><p>1ï¼‰å¦‚æœblockä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸”æ²¡æœ‰è®¾ç½®timeoutï¼ˆå•ä½ç§’ï¼‰ï¼Œæ¶ˆæ¯åˆ—é˜Ÿå¦‚æœä¸ºç©ºï¼Œæ­¤æ—¶ç¨‹åºå°†è¢«é˜»å¡ï¼ˆåœåœ¨è¯»å–çŠ¶æ€ï¼‰ï¼Œç›´åˆ°ä»æ¶ˆæ¯åˆ—é˜Ÿè¯»åˆ°æ¶ˆæ¯ä¸ºæ­¢ï¼Œå¦‚æœè®¾ç½®äº†timeoutï¼Œåˆ™ä¼šç­‰å¾…timeoutç§’ï¼Œè‹¥è¿˜æ²¡è¯»å–åˆ°ä»»ä½•æ¶ˆæ¯ï¼Œåˆ™æŠ›å‡ºâ€Queue.Emptyâ€å¼‚å¸¸ï¼›</p><p>2ï¼‰å¦‚æœblockå€¼ä¸ºFalseï¼Œæ¶ˆæ¯åˆ—é˜Ÿå¦‚æœä¸ºç©ºï¼Œåˆ™ä¼šç«‹åˆ»æŠ›å‡ºâ€Queue.Emptyâ€å¼‚å¸¸ï¼›</p><ul><li><p>Queue.get_nowait()ï¼šç›¸å½“Queue.get(False)ï¼›</p></li><li><p>Queue.put(item,[block[, timeout]])ï¼šå°†itemæ¶ˆæ¯å†™å…¥é˜Ÿåˆ—ï¼Œblocké»˜è®¤å€¼ä¸ºTrueï¼›</p></li></ul><p>1ï¼‰å¦‚æœblockä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸”æ²¡æœ‰è®¾ç½®timeoutï¼ˆå•ä½ç§’ï¼‰ï¼Œæ¶ˆæ¯åˆ—é˜Ÿå¦‚æœå·²ç»æ²¡æœ‰ç©ºé—´å¯å†™å…¥ï¼Œæ­¤æ—¶ç¨‹åºå°†è¢«é˜»å¡ï¼ˆåœåœ¨å†™å…¥çŠ¶æ€ï¼‰ï¼Œç›´åˆ°ä»æ¶ˆæ¯åˆ—é˜Ÿè…¾å‡ºç©ºé—´ä¸ºæ­¢ï¼Œå¦‚æœè®¾ç½®äº†timeoutï¼Œåˆ™ä¼šç­‰å¾…timeoutç§’ï¼Œè‹¥è¿˜æ²¡ç©ºé—´ï¼Œåˆ™æŠ›å‡ºâ€Queue.Fullâ€å¼‚å¸¸ï¼›</p><p>2ï¼‰å¦‚æœblockå€¼ä¸ºFalseï¼Œæ¶ˆæ¯åˆ—é˜Ÿå¦‚æœæ²¡æœ‰ç©ºé—´å¯å†™å…¥ï¼Œåˆ™ä¼šç«‹åˆ»æŠ›å‡ºâ€Queue.Fullâ€å¼‚å¸¸ï¼›</p><ul><li>Queue.put_nowait(item)ï¼šç›¸å½“Queue.put(item, False)ï¼›</li></ul><h2 id="2-æ¶ˆæ¯é˜Ÿåˆ—Queueå®Œæˆè¿›ç¨‹é—´é€šä¿¡çš„æ¼”ç»ƒ"><a href="#2-æ¶ˆæ¯é˜Ÿåˆ—Queueå®Œæˆè¿›ç¨‹é—´é€šä¿¡çš„æ¼”ç»ƒ" class="headerlink" title="2. æ¶ˆæ¯é˜Ÿåˆ—Queueå®Œæˆè¿›ç¨‹é—´é€šä¿¡çš„æ¼”ç»ƒ"></a>2. æ¶ˆæ¯é˜Ÿåˆ—Queueå®Œæˆè¿›ç¨‹é—´é€šä¿¡çš„æ¼”ç»ƒ</h2><p>æˆ‘ä»¬ä»¥Queueä¸ºä¾‹ï¼Œåœ¨çˆ¶è¿›ç¨‹ä¸­åˆ›å»ºä¸¤ä¸ªå­è¿›ç¨‹ï¼Œä¸€ä¸ªå¾€Queueé‡Œå†™æ•°æ®ï¼Œä¸€ä¸ªä»Queueé‡Œè¯»æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> multiprocessing<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-comment"># å†™å…¥æ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">write_data</span>(<span class="hljs-params">queue</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        <span class="hljs-keyword">if</span> queue.full():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é˜Ÿåˆ—æ»¡äº†&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>        queue.put(i)<br>        time.sleep(<span class="hljs-number">0.2</span>)<br>        <span class="hljs-built_in">print</span>(i)<br><br><br><span class="hljs-comment"># è¯»å–æ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_data</span>(<span class="hljs-params">queue</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># åŠ å…¥æ•°æ®ä»é˜Ÿåˆ—å–å®Œäº†ï¼Œé‚£ä¹ˆè·³å‡ºå¾ªç¯</span><br>        <span class="hljs-keyword">if</span> queue.qsize() == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é˜Ÿåˆ—ç©ºäº†&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>        value = queue.get()<br>        <span class="hljs-built_in">print</span>(value)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—</span><br>    queue = multiprocessing.Queue(<span class="hljs-number">5</span>)<br><br>    <span class="hljs-comment"># åˆ›å»ºå†™å…¥æ•°æ®çš„è¿›ç¨‹</span><br>    write_process = multiprocessing.Process(target=write_data, args=(queue,))<br>    <span class="hljs-comment"># åˆ›å»ºè¯»å–æ•°æ®çš„è¿›ç¨‹</span><br>    read_process = multiprocessing.Process(target=read_data, args=(queue,))<br><br>    <span class="hljs-comment"># å¯åŠ¨è¿›ç¨‹</span><br>    write_process.start()<br>    <span class="hljs-comment"># ä¸»è¿›ç¨‹ç­‰å¾…å†™å…¥è¿›ç¨‹æ‰§è¡Œå®Œæˆä»¥åä»£ç å†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</span><br>    write_process.join()<br>    read_process.start()<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs">0<br>1<br>2<br>3<br>4<br>é˜Ÿåˆ—æ»¡äº†<br>0<br>1<br>2<br>3<br>4<br>é˜Ÿåˆ—ç©ºäº†<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python é˜Ÿåˆ— å¤šè¿›ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ajaxçš„ä½¿ç”¨</title>
    <link href="/2020/06/19/Ajax%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2020/06/19/Ajax%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h2><p>ajaxä¸€ä¸ªå‰åå°é…åˆçš„æŠ€æœ¯ï¼Œå®ƒå¯ä»¥è®©javascriptå‘é€httpè¯·æ±‚ï¼Œä¸åå°é€šä¿¡ï¼Œè·å–æ•°æ®å’Œä¿¡æ¯ã€‚ajaxæŠ€æœ¯çš„åŸç†æ˜¯å®ä¾‹åŒ–xmlhttpå¯¹è±¡ï¼Œä½¿ç”¨æ­¤å¯¹è±¡ä¸åå°é€šä¿¡ã€‚jqueryå°†å®ƒå°è£…æˆäº†ä¸€ä¸ªå‡½æ•°$.ajax()ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªå‡½æ•°æ¥æ‰§è¡Œajaxè¯·æ±‚ã€‚</p><p>ajaxéœ€è¦åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸‹è¿è¡Œã€‚</p><p>$.ajaxä½¿ç”¨æ–¹æ³•</p><p>å¸¸ç”¨å‚æ•°ï¼š<br>1ã€url è¯·æ±‚åœ°å€<br>2ã€type è¯·æ±‚æ–¹å¼ï¼Œé»˜è®¤æ˜¯â€™GETâ€™ï¼Œå¸¸ç”¨çš„è¿˜æœ‰â€™POSTâ€™<br>3ã€dataType è®¾ç½®è¿”å›çš„æ•°æ®æ ¼å¼ï¼Œå¸¸ç”¨çš„æ˜¯â€™jsonâ€™æ ¼å¼ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºâ€™textâ€™æˆ–è€…â€™htmlâ€™<br>4ã€data è®¾ç½®å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®<br>5ã€success è®¾ç½®è¯·æ±‚æˆåŠŸåçš„å›è°ƒå‡½æ•°<br>6ã€error è®¾ç½®è¯·æ±‚å¤±è´¥åçš„å›è°ƒå‡½æ•°<br>7ã€async è®¾ç½®æ˜¯å¦å¼‚æ­¥ï¼Œé»˜è®¤å€¼æ˜¯â€™trueâ€™ï¼Œè¡¨ç¤ºå¼‚æ­¥</p><p>ä»¥å‰çš„å†™æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$.<span class="hljs-title function_">ajax</span>(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/change_data&#x27;</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,<br>    <span class="hljs-attr">dataType</span>: <span class="hljs-string">&#x27;json&#x27;</span>,<br>    <span class="hljs-attr">data</span>:&#123;<span class="hljs-string">&#x27;code&#x27;</span>:<span class="hljs-number">10086</span>&#125;<br>    <span class="hljs-attr">success</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">dat</span>)&#123;<br>        <span class="hljs-title function_">alert</span>(dat.<span class="hljs-property">name</span>);<br>    &#125;,<br>    <span class="hljs-attr">error</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;æœåŠ¡å™¨è¶…æ—¶ï¼Œè¯·é‡è¯•ï¼&#x27;</span>);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ–°çš„å†™æ³•(æ¨è)ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$.<span class="hljs-title function_">ajax</span>(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/change_data&#x27;</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,<br>    <span class="hljs-attr">dataType</span>: <span class="hljs-string">&#x27;json&#x27;</span>,<br>    <span class="hljs-attr">data</span>:&#123;<span class="hljs-string">&#x27;code&#x27;</span>:<span class="hljs-number">10086</span>&#125;<br>&#125;)<br>.<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">dat</span>) &#123;<br>    <span class="hljs-title function_">alert</span>(dat.<span class="hljs-property">name</span>);<br>&#125;)<br>.<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;æœåŠ¡å™¨è¶…æ—¶ï¼Œè¯·é‡è¯•ï¼&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>$.ajaxçš„ç®€å†™æ–¹å¼</p><p>$.ajaxæŒ‰ç…§è¯·æ±‚æ–¹å¼å¯ä»¥ç®€å†™æˆ$.getæˆ–è€…$.postæ–¹å¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/change_data&quot;</span>, &#123;<span class="hljs-string">&#x27;code&#x27;</span>:<span class="hljs-number">10086</span>&#125;,<br>  <span class="hljs-keyword">function</span>(<span class="hljs-params">dat</span>)&#123;<br>    <span class="hljs-title function_">alert</span>(dat.<span class="hljs-property">name</span>);<br>&#125;);<br><br>$.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/change_data&quot;</span>, &#123;<span class="hljs-string">&#x27;code&#x27;</span>:<span class="hljs-number">10086</span>&#125;,<br>  <span class="hljs-keyword">function</span>(<span class="hljs-params">dat</span>)&#123;<br>    <span class="hljs-title function_">alert</span>(dat.<span class="hljs-property">name</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>Â </p><h2 id="æ•°æ®æ¥å£"><a href="#æ•°æ®æ¥å£" class="headerlink" title="æ•°æ®æ¥å£"></a><strong>æ•°æ®æ¥å£</strong></h2><p>æ•°æ®æ¥å£æ˜¯åå°ç¨‹åºæä¾›çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªurlåœ°å€ï¼Œè®¿é—®è¿™ä¸ªåœ°å€ï¼Œä¼šå¯¹æ•°æ®è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥çš„æ“ä½œï¼Œæœ€ç»ˆä¼šè¿”å›jsonæ ¼å¼çš„æ•°æ®æˆ–è€…æ“ä½œä¿¡æ¯ï¼Œæ ¼å¼ä¹Ÿå¯ä»¥æ˜¯textã€xmlç­‰ã€‚</p><h2 id="åŒæ­¥å’Œå¼‚æ­¥"><a href="#åŒæ­¥å’Œå¼‚æ­¥" class="headerlink" title="åŒæ­¥å’Œå¼‚æ­¥"></a><strong>åŒæ­¥å’Œå¼‚æ­¥</strong></h2><p>ç°å®ç”Ÿæ´»ä¸­ï¼ŒåŒæ­¥æŒ‡çš„æ˜¯åŒæ—¶åšå‡ ä»¶äº‹æƒ…ï¼Œå¼‚æ­¥æŒ‡çš„æ˜¯åšå®Œä¸€ä»¶äº‹åå†åšå¦å¤–ä¸€ä»¶äº‹ï¼Œç¨‹åºä¸­çš„åŒæ­¥å’Œå¼‚æ­¥æ˜¯æŠŠç°å®ç”Ÿæ´»ä¸­çš„æ¦‚å¿µå¯¹è°ƒï¼Œä¹Ÿå°±æ˜¯ç¨‹åºä¸­çš„å¼‚æ­¥æŒ‡çš„æ˜¯ç°å®ç”Ÿæ´»ä¸­çš„åŒæ­¥ï¼Œç¨‹åºä¸­çš„åŒæ­¥æŒ‡çš„æ˜¯ç°å®ç”Ÿæ´»ä¸­çš„å¼‚æ­¥ã€‚</p><h2 id="å±€éƒ¨åˆ·æ–°å’Œæ— åˆ·æ–°"><a href="#å±€éƒ¨åˆ·æ–°å’Œæ— åˆ·æ–°" class="headerlink" title="å±€éƒ¨åˆ·æ–°å’Œæ— åˆ·æ–°"></a><strong>å±€éƒ¨åˆ·æ–°å’Œæ— åˆ·æ–°</strong></h2><p>ajaxå¯ä»¥å®ç°å±€éƒ¨åˆ·æ–°ï¼Œä¹Ÿå«åšæ— åˆ·æ–°ï¼Œæ— åˆ·æ–°æŒ‡çš„æ˜¯æ•´ä¸ªé¡µé¢ä¸åˆ·æ–°ï¼Œåªæ˜¯å±€éƒ¨åˆ·æ–°ï¼Œajaxå¯ä»¥è‡ªå·±å‘é€httpè¯·æ±‚ï¼Œä¸ç”¨é€šè¿‡æµè§ˆå™¨çš„åœ°å€æ ï¼Œæ‰€ä»¥é¡µé¢æ•´ä½“ä¸ä¼šåˆ·æ–°ï¼Œajaxè·å–åˆ°åå°æ•°æ®ï¼Œæ›´æ–°é¡µé¢æ˜¾ç¤ºæ•°æ®çš„éƒ¨åˆ†ï¼Œå°±åšåˆ°äº†é¡µé¢å±€éƒ¨åˆ·æ–°ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ajax js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Djangoå¼€å‘ç¥å¥‡çš„ç¬¬ä¸‰æ–¹åŒ…</title>
    <link href="/2020/06/19/Django%E5%BC%80%E5%8F%91%E7%A5%9E%E5%A5%87%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85/"/>
    <url>/2020/06/19/Django%E5%BC%80%E5%8F%91%E7%A5%9E%E5%A5%87%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p>Â </p><h2 id="1-Python-social-auth"><a href="#1-Python-social-auth" class="headerlink" title="1. Python social auth"></a>1. Python social auth</h2><p>ä¸€æ¬¾ç¤¾äº¤è´¦å·è®¤è¯&#x2F;æ³¨å†Œæœºåˆ¶ï¼Œæ”¯æŒDjangoã€Flaskã€Webpyç­‰åœ¨å†…çš„å¤šä¸ªå¼€å‘æ¡†æ¶ï¼Œæä¾›äº†çº¦50å¤šä¸ªæœåŠ¡å•†çš„æˆæƒè®¤è¯æ”¯æŒï¼Œå¦‚Googleã€Twitterã€æ–°æµªå¾®åšç­‰ç«™ç‚¹ï¼Œé…ç½®ç®€å•ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/pennersr/django-allauth">pennersr&#x2F;django-allauth</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://django-allauth.readthedocs.io/en/latest/">Welcome to django-allauth!</a></p><p>ç‚¹è¯„ï¼šå¢å¼º Django å†…ç½®çš„ django.contrib.auth æ¨¡å—ï¼Œæä¾›ç™»å½•ã€æ³¨å†Œã€é‚®ä»¶éªŒè¯ã€æ‰¾å›å¯†ç ç­‰ä¸€åˆ‡ç”¨æˆ·éªŒè¯ç›¸å…³çš„åŠŸèƒ½ã€‚å¦å¤–è¿˜æä¾› OAuth ç¬¬ä¸‰æ–¹ç™»å½•åŠŸèƒ½ï¼Œä¾‹å¦‚å›½å†…çš„å¾®åšã€å¾®ä¿¡ç™»å½•ï¼Œå›½å¤–çš„ GitHubã€Googleã€facebook ç™»å½•ç­‰ï¼Œå‡ ä¹å›Šæ‹¬äº†å¤§éƒ¨åˆ†çƒ­é—¨çš„ç¬¬ä¸‰æ–¹è´¦æˆ·ç™»å½•ã€‚é…ç½®ç®€å•ï¼Œå¼€ç®±å³ç”¨ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> python-social-auth<br></code></pre></td></tr></table></figure><h2 id="2-Django-Guardian"><a href="#2-Django-Guardian" class="headerlink" title="2. Django Guardian"></a>2. Django Guardian</h2><p>Djangoé»˜è®¤æ²¡æœ‰æä¾›å¯¹è±¡ï¼ˆObjectï¼‰çº§åˆ«çš„æƒé™æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥æ‰©å±•æ¥å¸®åŠ©Djangoå®ç°å¯¹è±¡çº§åˆ«çš„æƒé™æ§åˆ¶ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django-guardian<br></code></pre></td></tr></table></figure><h2 id="3-Django-OAuth-Toolkit"><a href="#3-Django-OAuth-Toolkit" class="headerlink" title="3. Django OAuth Toolkit"></a>3. Django OAuth Toolkit</h2><p>å¯ä»¥å¸®åŠ©Djangoé¡¹ç›®å®ç°æ•°æ®ã€é€»è¾‘çš„OAuth2åŠŸèƒ½ï¼Œå¯ä¸Django RESTæ¡†æ¶å®Œç¾æ•´åˆèµ·æ¥ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django-oauth-toolkit<br></code></pre></td></tr></table></figure><h2 id="4-django-allauth"><a href="#4-django-allauth" class="headerlink" title="4. django-allauth"></a>4. django-allauth</h2><p>å¯ç”¨äºè´¦å·æ³¨å†Œã€ç®¡ç†å’Œç¬¬ä¸‰æ–¹ç¤¾äº¤è´¦å·çš„è®¤è¯ã€‚</p><p>django-allauth æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè§£å†³ä½ çš„æ³¨å†Œå’Œè®¤è¯éœ€æ±‚çš„ã€å¯é‡ç”¨çš„ Django åº”ç”¨ã€‚æ— è®ºä½ éœ€è¦æ„å»ºæœ¬åœ°æ³¨å†Œç³»ç»Ÿè¿˜æ˜¯ç¤¾äº¤è´¦æˆ·æ³¨å†Œç³»ç»Ÿï¼Œdjango-allauth éƒ½èƒ½å¤Ÿå¸®ä½ åšåˆ°ã€‚</p><p>è¿™ä¸ªåº”ç”¨æ”¯æŒå¤šç§è®¤è¯ä½“ç³»ï¼Œæ¯”å¦‚ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶ã€‚ä¸€æ—¦ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œå®ƒè¿˜å¯ä»¥æä¾›ä»æ— éœ€è®¤è¯åˆ°ç”µå­é‚®ä»¶è®¤è¯çš„å¤šç§è´¦æˆ·éªŒè¯çš„ç­–ç•¥ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ”¯æŒå¤šç§ç¤¾äº¤è´¦æˆ·å’Œç”µå­é‚®ä»¶è´¦æˆ·ã€‚å®ƒè¿˜æ”¯æŒæ’æ‹”å¼æ³¨å†Œè¡¨å•ï¼Œå¯è®©ç”¨æˆ·åœ¨æ³¨å†Œæ—¶å›ç­”ä¸€äº›é™„åŠ é—®é¢˜ã€‚</p><p>django-allauth æ”¯æŒå¤šäº 20 ç§è®¤è¯æä¾›è€…ï¼ŒåŒ…æ‹¬ Facebookã€Googleã€å¾®åš å’Œ å¾®ä¿¡ã€‚å¦‚æœä½ å‘ç°äº†ä¸€ä¸ªå®ƒä¸æ”¯æŒçš„ç¤¾äº¤ç½‘ç«™ï¼Œå¾ˆæœ‰å¯èƒ½é€šè¿‡ç¬¬ä¸‰æ–¹æ’ä»¶æä¾›è¯¥ç½‘ç«™çš„æ¥å…¥æ”¯æŒã€‚è¿™ä¸ªé¡¹ç›®è¿˜æ”¯æŒè‡ªå®šä¹‰åç«¯ï¼Œå¯ä»¥æ”¯æŒè‡ªå®šä¹‰çš„è®¤è¯æ–¹å¼ï¼Œå¯¹æ¯ä¸ªæœ‰å®šåˆ¶è®¤è¯éœ€æ±‚çš„äººæ¥è¯´è¿™éƒ½å¾ˆæ£’ã€‚</p><p>django-allauth æ˜“äºé…ç½®ï¼Œä¸”æœ‰å®Œå–„çš„æ–‡æ¡£ã€‚è¯¥é¡¹ç›®é€šè¿‡äº†å¾ˆå¤šæµ‹è¯•ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›¸ä¿¡å®ƒçš„æ‰€æœ‰éƒ¨ä»¶éƒ½ä¼šæ­£å¸¸è¿ä½œã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django-allauth<br></code></pre></td></tr></table></figure><h2 id="5-Celery"><a href="#5-Celery" class="headerlink" title="5. Celery"></a>5. Celery</h2><p>ç”¨æ¥ç®¡ç†å¼‚æ­¥ã€åˆ†å¸ƒå¼çš„æ¶ˆæ¯ä½œä¸šé˜Ÿåˆ—ï¼Œå¯ç”¨äºç”Ÿäº§ç³»ç»Ÿæ¥å¤„ç†ç™¾ä¸‡çº§åˆ«çš„ä»»åŠ¡ã€‚</p><p>django-celeryæ˜¯django webå¼€å‘ä¸­æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡æˆ–å®šæ—¶ä»»åŠ¡çš„æœ€ä½³é€‰æ‹©ã€‚å®ƒçš„åº”ç”¨åœºæ™¯åŒ…æ‹¬:</p><ul><li>å¼‚æ­¥ä»»åŠ¡: å½“ç”¨æˆ·è§¦å‘ä¸€ä¸ªåŠ¨ä½œéœ€è¦è¾ƒé•¿æ—¶é—´æ¥æ‰§è¡Œå®Œæˆæ—¶ï¼Œå¯ä»¥æŠŠå®ƒä½œä¸ºä»»åŠ¡äº¤ç»™celeryå¼‚æ­¥æ‰§è¡Œï¼Œæ‰§è¡Œå®Œå†è¿”å›ç»™ç”¨æˆ·ã€‚è¿™ç‚¹å’Œä½ åœ¨å‰ç«¯ä½¿ç”¨ajaxå®ç°å¼‚æ­¥åŠ è½½æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚</li><li>å®šæ—¶ä»»åŠ¡ã€‚å‡è®¾æœ‰å¤šå°æœåŠ¡å™¨ï¼Œå¤šä¸ªä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡çš„ç®¡ç†æ˜¯å¾ˆå›°éš¾çš„ï¼Œä½ è¦åœ¨ä¸åŒç”µè„‘ä¸Šå†™ä¸åŒçš„crontabï¼Œè€Œä¸”è¿˜ä¸å¥½ç®¡ç†ã€‚Celeryå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåœ¨ä¸åŒçš„æœºå™¨è®¾å®šä¸åŒä»»åŠ¡ã€‚</li><li>å…¶ä»–å¯ä»¥å¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡ã€‚æ¯”å¦‚å‘é€çŸ­ä¿¡ï¼Œé‚®ä»¶ï¼Œæ¨é€æ¶ˆæ¯ï¼Œæ¸…ç†&#x2F;è®¾ç½®ç¼“å­˜ç­‰ã€‚è¿™ç‚¹è¿˜æ˜¯æ¯”è¾ƒæœ‰ç”¨çš„ã€‚</li></ul><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> Celery<br></code></pre></td></tr></table></figure><h2 id="6-Django-REST-æ¡†æ¶"><a href="#6-Django-REST-æ¡†æ¶" class="headerlink" title="6. Django REST æ¡†æ¶"></a>6. Django REST æ¡†æ¶</h2><p>æ„å»ºREST APIçš„ä¼˜ç§€æ¡†æ¶ï¼Œå¯ç®¡ç†å†…å®¹åå•†ã€åºåˆ—åŒ–ã€åˆ†é¡µç­‰ï¼Œå¼€å‘è€…å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æµè§ˆæ„å»ºçš„APIã€‚</p><p>REST API æ­£åœ¨è¿…é€Ÿæˆä¸ºç°ä»£ Web åº”ç”¨çš„æ ‡å‡†åŠŸèƒ½ã€‚ API å°±æ˜¯ç®€å•çš„ä½¿ç”¨ JSON å¯¹è¯è€Œä¸æ˜¯ HTMLï¼Œå½“ç„¶ä½ å¯ä»¥åªç”¨ Django åšåˆ°è¿™äº›ã€‚ä½ å¯ä»¥åˆ¶ä½œè‡ªå·±çš„è§†å›¾ï¼Œè®¾ç½®åˆé€‚çš„ Content-Typeï¼Œç„¶åè¿”å› JSON è€Œä¸æ˜¯æ¸²æŸ“åçš„ HTML å“åº”ã€‚è¿™æ˜¯åœ¨åƒ Django Rest Frameworkï¼ˆä¸‹ç§° DRFï¼‰è¿™æ ·çš„ API æ¡†æ¶å‘å¸ƒä¹‹å‰ï¼Œå¤§å¤šæ•°äººæ‰€åšçš„ã€‚</p><p>å¦‚æœä½ å¯¹ Django çš„è§†å›¾ç±»å¾ˆç†Ÿæ‚‰ï¼Œä½ ä¼šè§‰å¾—ä½¿ç”¨ DRF æ„å»º REST API ä¸ä½¿ç”¨å®ƒä»¬å¾ˆç›¸ä¼¼ï¼Œä¸è¿‡ DRF åªé’ˆå¯¹ç‰¹å®š API ä½¿ç”¨åœºæ™¯è€Œè®¾è®¡ã€‚ä¸€èˆ¬çš„ API è®¾ç½®åªéœ€è¦ä¸€ç‚¹ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰æä¾›ä¸€ä»½è®©ä½ å…´å¥‹çš„ç¤ºä¾‹ä»£ç ï¼Œè€Œæ˜¯å¼ºè°ƒäº†ä¸€äº›å¯ä»¥è®©ä½ ç”Ÿæ´»çš„æ›´èˆ’é€‚çš„ DRF ç‰¹æ€§ï¼š</p><ul><li>å¯è‡ªåŠ¨é¢„è§ˆçš„ API å¯ä»¥ä½¿ä½ çš„å¼€å‘å’Œäººå·¥æµ‹è¯•è½»è€Œæ˜“ä¸¾ã€‚ä½ å¯ä»¥æŸ¥çœ‹ DRF çš„ç¤ºä¾‹ä»£ç ã€‚ä½ å¯ä»¥æŸ¥çœ‹ API å“åº”ï¼Œå¹¶ä¸”ä¸éœ€è¦ä½ åšä»»ä½•äº‹å°±å¯ä»¥æ”¯æŒ POST&#x2F;PUT&#x2F;DELETE ç±»å‹çš„æ“ä½œã€‚</li><li>ä¾¿äºé›†æˆå„ç§è®¤è¯æ–¹å¼ï¼Œå¦‚ OAuth, Basic Auth, æˆ–API Tokensã€‚</li><li>å†…å»ºè¯·æ±‚é€Ÿç‡é™åˆ¶ã€‚</li><li>å½“ä¸ django-rest-swagger ç»„åˆä½¿ç”¨æ—¶ï¼ŒAPI æ–‡æ¡£å‡ ä¹å¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€‚</li><li>å¹¿æ³›çš„ç¬¬ä¸‰æ–¹åº“ç”Ÿæ€ã€‚</li></ul><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> djangorestframework<br></code></pre></td></tr></table></figure><h2 id="7-Django-stored-messages"><a href="#7-Django-stored-messages" class="headerlink" title="7. Django stored messages"></a>7. Django stored messages</h2><p>å¯ä»¥å¾ˆå¥½åœ°é›†æˆåœ¨Djangoçš„æ¶ˆæ¯æ¡†æ¶ä¸­ï¼ˆdjango.contrib.messagesï¼‰å¹¶è®©ç”¨æˆ·å†³å®šä¼šè¯è¿‡ç¨‹ä¸­å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ¶ˆæ¯ã€‚</p><h2 id="8-django-cors-headers"><a href="#8-django-cors-headers" class="headerlink" title="8. django-cors-headers"></a>8. django-cors-headers</h2><p>ä¸€æ¬¾è®¾ç½®CORSï¼ˆCross-Origin Resource Sharingï¼‰æ ‡å¤´çš„åº”ç”¨ï¼ŒåŸºäºXmlHttpRequestï¼Œå¯¹ç®¡ç†Djangoåº”ç”¨ä¸­çš„è·¨åŸŸè¯·æ±‚éå¸¸æœ‰å¸®åŠ©ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django-cors-headers<br></code></pre></td></tr></table></figure><h2 id="9-Debug-toolbar"><a href="#9-Debug-toolbar" class="headerlink" title="9. Debug toolbar"></a>9. Debug toolbar</h2><p>å¯åœ¨è®¾ç½®é¢æ¿æ˜¾ç¤ºå½“å‰è¯·æ±‚&#x2F;å“åº”çš„å„ç§è°ƒè¯•ä¿¡æ¯ã€‚é™¤äº†æœ¬èº«æä¾›çš„æ“ä½œé¢æ¿å¤–ï¼Œè¿˜æœ‰æ¥è‡ªç¤¾åŒºçš„å¤šä¸ªç¬¬ä¸‰æ–¹é¢æ¿ã€‚</p><p>è¯¥å·¥å…·ç»™django webå¼€å‘æä¾›äº†å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½ï¼ŒåŒ…æ‹¬æŸ¥çœ‹æ‰§è¡Œçš„sqlè¯­å¥ï¼ŒdbæŸ¥è¯¢æ¬¡æ•°ï¼Œrequestï¼Œheadersï¼Œè°ƒè¯•æ¦‚è§ˆç­‰ã€‚ é€šè¿‡å®‰è£…æ’ä»¶Pymplerï¼Œä½ è¿˜å¯ä»¥äº†è§£å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">pip <span class="hljs-keyword">install </span>django-<span class="hljs-built_in">debug</span>-toolbar<br></code></pre></td></tr></table></figure><p><strong>é™æ€èµ„æº</strong></p><h2 id="10-Django-Storages"><a href="#10-Django-Storages" class="headerlink" title="10. Django Storages"></a>10. Django Storages</h2><p>å¯ä½¿é™æ€èµ„æºæ–¹ä¾¿åœ°å­˜å‚¨åœ¨å¤–éƒ¨æœåŠ¡ä¸Šã€‚å®‰è£…ååªéœ€è¿è¡Œâ€œpython <a href="https://link.zhihu.com/?target=http://manage.py">manage.py</a> collectstaticâ€å‘½ä»¤å°±å¯ä»¥å°†å…¨éƒ¨æ”¹åŠ¨çš„é™æ€æ–‡ä»¶å¤åˆ¶åˆ°é€‰å®šçš„åç«¯ã€‚å¯ç»“åˆåº“â€œpython-botoâ€ä¸€èµ·ä½¿ç”¨ï¼Œå°†é™æ€æ–‡ä»¶å­˜å‚¨åˆ°Amazon S3ä¸Šã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django-storages<br></code></pre></td></tr></table></figure><h2 id="11-Django-Pipeline"><a href="#11-Django-Pipeline" class="headerlink" title="11. Django Pipeline"></a>11. Django Pipeline</h2><p>é™æ€èµ„æºç®¡ç†åº”ç”¨ï¼Œæ”¯æŒè¿æ¥å’Œå‹ç¼©CSS&#x2F;Javascriptæ–‡ä»¶ã€æ”¯æŒCSSå’ŒJavascriptçš„å¤šç§ç¼–è¯‘å™¨ã€å†…åµŒJavaScriptæ¨¡æ¿ï¼Œå¯å……åˆ†å…è®¸è‡ªå®šä¹‰ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django-pipeline<br></code></pre></td></tr></table></figure><h2 id="12-Django-Compressor"><a href="#12-Django-Compressor" class="headerlink" title="12. Django Compressor"></a>12. Django Compressor</h2><p>å¯å°†é¡µé¢ä¸­é“¾æ¥çš„ä»¥åŠç›´æ¥ç¼–å†™çš„JavaScriptå’ŒCSSæ‰“åŒ…åˆ°ä¸€ä¸ªå•ä¸€çš„ç¼“å­˜æ–‡ä»¶ä¸­ï¼Œä»¥å‡å°‘é¡µé¢å¯¹æœåŠ¡å™¨çš„è¯·æ±‚æ•°ï¼ŒåŠ å¿«é¡µé¢çš„åŠ è½½é€Ÿåº¦ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django_compressor<br></code></pre></td></tr></table></figure><h2 id="13-Reversion"><a href="#13-Reversion" class="headerlink" title="13. Reversion"></a>13. Reversion</h2><p>ä¸ºæ¨¡å‹æä¾›ç‰ˆæœ¬æ§åˆ¶åŠŸèƒ½ï¼Œç¨å¾®é…ç½®åï¼Œå°±å¯ä»¥æ¢å¤å·²ç»åˆ é™¤çš„æ¨¡å‹æˆ–å›æ»šåˆ°æ¨¡å‹å†å²ä¸­çš„ä»»ä½•ä¸€ç‚¹ã€‚æœ€æ–°ç‰ˆæœ¬æ”¯æŒDjango 1.6ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django-reversion<br></code></pre></td></tr></table></figure><h2 id="14-Django-extensions"><a href="#14-Django-extensions" class="headerlink" title="14. Django extensions"></a>14. Django extensions</h2><p>Djangoæ¡†æ¶çš„æ‰©å±•åŠŸèƒ½é›†åˆï¼ŒåŒ…æ‹¬managementå‘½ä»¤æ‰©å±•ã€æ•°æ®åº“å­—æ®µæ‰©å±•ã€adminåå°æ‰©å±•ç­‰ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django-extensions<br></code></pre></td></tr></table></figure><h2 id="15-Django-braces"><a href="#15-Django-braces" class="headerlink" title="15. Django braces"></a>15. Django braces</h2><p>æ˜¯ä¸€ç³»åˆ—å¯å¤ç”¨çš„è¡Œä¸ºã€è§†å›¾æ¨¡å‹ã€è¡¨æ ¼å’Œå…¶ä»–ç»„ä»¶çš„åˆé›†ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django-braces<br></code></pre></td></tr></table></figure><h2 id="16-django-haystack-å…¨æ–‡æ£€ç´¢å¼•æ“"><a href="#16-django-haystack-å…¨æ–‡æ£€ç´¢å¼•æ“" class="headerlink" title="16.django-haystack - å…¨æ–‡æ£€ç´¢å¼•æ“"></a>16.django-haystack - å…¨æ–‡æ£€ç´¢å¼•æ“</h2><p>å…¨æ–‡æ£€ç´¢ä¸åŒäºæ ‡é¢˜çš„ç®€å•åŒ¹é…ï¼Œæ˜¯ä¸€ä»¶æŠ€æœ¯éš¾åº¦æ¯”è¾ƒé«˜çš„æ´»ã€‚å½“æ–‡ç« å¾ˆé•¿æ—¶ï¼Œä½ å¾ˆéš¾æ‰¾åˆ°ç²¾ç¡®çš„åŒ¹é…ï¼ŒåŒæ—¶æœç´¢å…¨æ–‡éœ€è¦æ¶ˆè€—å¤§é‡çš„è®¡ç®—èµ„æºã€‚æœ‰äº†haystackï¼Œä½ å¯ä»¥ç›´æ¥djangoä¸­ç›´æ¥æ·»åŠ æœç´¢åŠŸèƒ½ï¼Œåƒæœç´¢æ ‡é¢˜ä¸€æ ·æœç´¢å…¨æ–‡ï¼Œè€Œæ— éœ€å…³æ³¨ç´¢å¼•å»ºç«‹ã€æœç´¢è§£æç­‰æŠ€æœ¯é—®é¢˜ã€‚haystackæ”¯æŒå¤šç§æœç´¢å¼•æ“ï¼Œä¸ä»…ä»…æ˜¯whooshï¼Œä½¿ç”¨solrã€elastic searchç­‰æœç´¢ï¼Œä¹Ÿå¯é€šè¿‡haystackï¼Œè€Œä¸”ç›´æ¥åˆ‡æ¢å¼•æ“å³å¯ï¼Œç”šè‡³æ— éœ€ä¿®æ”¹æœç´¢ä»£ç ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://django-haystack.readthedocs.io/en/master/">Welcome to Haystack!</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/django-haystack/django-haystack">django-haystack&#x2F;django-haystack</a></p><h2 id="17-django-ckeditor-å¯Œæ–‡æœ¬ç¼–è¾‘å™¨"><a href="#17-django-ckeditor-å¯Œæ–‡æœ¬ç¼–è¾‘å™¨" class="headerlink" title="17.django-ckeditor - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨"></a>17.django-ckeditor - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</h2><p>djangoæ²¡æœ‰æä¾›å®˜æ–¹çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè€Œckeditoræ°å¥½æ˜¯å†…å®¹å‹ç½‘ç«™åå°ç®¡ç†ä¸­ä¸å¯æˆ–ç¼ºçš„æ§ä»¶ã€‚ckeditoræ˜¯ä¸€æ¬¾åŸºäºjavascriptï¼Œä½¿ç”¨éå¸¸å¹¿æ³›çš„å¼€æºç½‘é¡µç¼–è¾‘å™¨ã€‚å®ƒå…è®¸ç”¨æˆ·ç›´æ¥ç¼–å†™å›¾æ–‡ï¼Œæ’å…¥åˆ—è¡¨å’Œè¡¨æ ¼ï¼Œå¹¶æ”¯æŒæ–‡æœ¬å’ŒHTMLæ ¼å¼ä»£ç è¾“å…¥ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/django-ckeditor/django-ckeditor">django-ckeditor&#x2F;django-ckeditor</a></p><h2 id="18-django-imagekit-è‡ªåŠ¨åŒ–å¤„ç†å›¾åƒ"><a href="#18-django-imagekit-è‡ªåŠ¨åŒ–å¤„ç†å›¾åƒ" class="headerlink" title="18.django-imagekit - è‡ªåŠ¨åŒ–å¤„ç†å›¾åƒ"></a>18.django-imagekit - è‡ªåŠ¨åŒ–å¤„ç†å›¾åƒ</h2><p>ç°ä»£ç½‘ç«™å¼€å‘ä¸€èˆ¬å…ä¸äº†å¤„ç†ä¸€äº›å›¾ç‰‡ï¼Œä¾‹å¦‚å¤´åƒã€ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ç­‰å†…å®¹ã€‚django-imagekit å¸®ä½ é…åˆ django çš„ model æ¨¡å—è‡ªåŠ¨å®Œæˆå›¾ç‰‡çš„è£å‰ªã€å‹ç¼©ã€ç”Ÿæˆç¼©ç•¥å›¾ã€åŠ æ°´å°ç­‰ä¸€ç³»åˆ—å›¾ç‰‡ç›¸å…³çš„æ“ä½œã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/matthewwithanm/django-imagekit">matthewwithanm&#x2F;django-imagekit</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=http://django-imagekit.rtfd.org/">Installation - ImageKit 3.2.6 documentation</a></p><h2 id="19-django-xadmin-æ›´ç¾è§‚æ›´å¼ºå¤§çš„åå°"><a href="#19-django-xadmin-æ›´ç¾è§‚æ›´å¼ºå¤§çš„åå°" class="headerlink" title="19.django-xadmin - æ›´ç¾è§‚æ›´å¼ºå¤§çš„åå°"></a>19.django-xadmin - æ›´ç¾è§‚æ›´å¼ºå¤§çš„åå°</h2><p>å¦‚æœä½ ä¸å–œæ¬¢djangoè‡ªå¸¦åå°adminç®€é™‹çš„æ ·å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨xadminã€‚xadminæ˜¯åŸºäºbootstrapå’Œadminçš„ä¸€ä¸ªæ›´å¼ºå¤§çš„åå°ç®¡ç†ç³»ç»Ÿã€‚åº”è¯¥ä¼šç»™æœ‰å¼ºè¿«ç—‡çš„ä½ å¸¦æ¥æƒŠå–œã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/sshwsfc/xadmin">sshwsfc&#x2F;xadmin</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://xadmin.readthedocs.io/en/docs-chinese/">Welcome to Django Xadminâ€™s Documentation!</a></p><h2 id="20-django-constance-å¸¸é‡ç®¡ç†"><a href="#20-django-constance-å¸¸é‡ç®¡ç†" class="headerlink" title="20.django-constance - å¸¸é‡ç®¡ç†"></a>20.django-constance - å¸¸é‡ç®¡ç†</h2><p>æœ‰æ—¶æˆ‘ä»¬ä¼šåœ¨ django çš„ settings ä¸­è®¾ç½®ä¸€äº›å¸¸é‡ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šè¿›è¡Œå˜æ›´ã€‚åˆ©ç”¨è¿™ä¸ªåŒ…ï¼Œåªéœ€ç®€å•çš„é…ç½®å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ admin ç®¡ç†åå°å¯ä»¥ä¿®æ”¹ç®¡ç†å¸¸é‡ã€‚</p><p>Django çš„å¥½å¤„å°±æ˜¯å¤§è€Œå…¨ï¼Œä¸ä»…å†…ç½®äº† ORMã€è¡¨å•ã€æ¨¡æ¿å¼•æ“ã€ç”¨æˆ·ç³»ç»Ÿç­‰ï¼Œè€Œä¸”ç¬¬ä¸‰æ–¹åº”ç”¨çš„ç”Ÿæ€ä¹Ÿæ˜¯ååˆ†å®Œå–„ï¼Œå¼€å‘ä¸­å¤§éƒ¨åˆ†å¸¸è§çš„åŠŸèƒ½éƒ½èƒ½æ‰¾åˆ°å¯¹åº”çš„ç¬¬ä¸‰æ–¹å®ç°ã€‚åœ¨è¿™é‡Œç»™å¤§å®¶æ¨è 10 ä¸ªååˆ†ä¼˜ç§€çš„ Django ç¬¬ä¸‰æ–¹åº“ï¼ˆGitHub æ˜Ÿæ˜Ÿæ•°åŸºæœ¬éƒ½åœ¨ 1000 ä»¥ä¸Šï¼Œè€Œä¸”éƒ½åœ¨æŒç»­ç»´æŠ¤ä¸æ›´æ–°ä¸­ï¼‰ã€‚è™½ç„¶è¿™äº›åº“å¾ˆé€‚åˆç”¨äºç¤¾äº¤ç½‘ç«™çš„å¼€å‘ï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯é€šç”¨çš„ï¼Œå¯ä»¥ç”¨äºä»»ä½•ç”¨ Django å¼€å‘çš„é¡¹ç›®ã€‚ä½¿ç”¨è¿™äº›åº“å°†å¤§å¤§æé«˜å¼€å‘æ•ˆç‡å’Œç”Ÿäº§åŠ›ã€‚</p><h2 id="21-django-model-utils"><a href="#21-django-model-utils" class="headerlink" title="21.django-model-utils"></a>21.django-model-utils</h2><p>ç®€ä»‹ï¼šå¢å¼º Django çš„ model æ¨¡å—ã€‚å†…ç½®äº†ä¸€äº›é€šç”¨çš„ model Mixinï¼Œä¾‹å¦‚ TimeStampedModel ä¸ºæ¨¡å‹æä¾›ä¸€ä¸ªåˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´çš„å­—æ®µï¼Œè¿˜æœ‰ä¸€äº›æœ‰ç”¨çš„ Fieldï¼Œå‡ ä¹æ¯ä¸ª Django é¡¹ç›®éƒ½èƒ½ç”¨å¾—ä¸Šã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/jazzband/django-model-utils">jazzband&#x2F;django-model-utils</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=http://django-model-utils.readthedocs.io/en/latest/">django-model-utils - django-model-utils 3.2.0 documentation</a></p><h2 id="22-django-crispy-forms"><a href="#22-django-crispy-forms" class="headerlink" title="22.django-crispy-forms"></a>22.django-crispy-forms</h2><p>ç®€ä»‹ï¼šå¤§å¤§å¢å¼º Django å†…ç½®çš„è¡¨å•åŠŸèƒ½ï¼ŒDjango å†…ç½®çš„è¡¨å•ç”ŸæˆåŸç”Ÿçš„ HTML è¡¨å•ä»£ç è¿˜å¯ä»¥ï¼Œä½†ä¸ºå…¶è®¾ç½®æ ·å¼æ˜¯ä¸€ä¸ªéº»çƒ¦çš„äº‹æƒ…ã€‚django-crispy-forms å¸®åŠ©ä½ ä½¿ç”¨ä¸€è¡Œä»£ç æ¸²æŸ“ä¸€ä¸ª Bootstrap æ ·å¼çš„è¡¨å•ï¼Œå½“ç„¶å®ƒè¿˜æ”¯æŒå…¶å®ƒä¸€äº›çƒ­é—¨çš„ CSS æ¡†æ¶æ ·å¼çš„æ¸²æŸ“ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/django-crispy-forms/django-crispy-forms">django-crispy-forms&#x2F;django-crispy-forms</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=http://django-crispy-forms.rtfd.org/">Forms have never been this crispy</a></p><h2 id="23-django-mptt"><a href="#23-django-mptt" class="headerlink" title="23.django-mptt"></a>23.django-mptt</h2><p>ç®€ä»‹ï¼šé…åˆ Django çš„ ORM ç³»ç»Ÿï¼Œä¸ºæ•°æ®åº“çš„è®°å½•ç”Ÿæˆæ ‘å½¢ç»“æ„ï¼Œå¹¶æä¾›ä¾¿æ·çš„æ“ä½œæ ‘å‹è®°å½•çš„ APIã€‚ä¾‹å¦‚å¯ä»¥ä½¿ç”¨å®ƒå®ç°ä¸€ä¸ªå¤šçº§çš„è¯„è®ºç³»ç»Ÿã€‚æ€»ä¹‹ï¼Œåªè¦ä½ çš„æ•°æ®ç»“æ„å¯èƒ½éœ€è¦ä½¿ç”¨æ ‘æ¥è¡¨ç¤ºï¼Œdjango-mptt å°†å¤§å¤§æé«˜ä½ çš„å¼€å‘æ•ˆç‡ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/django-mptt/django-mptt">django-mptt&#x2F;django-mptt</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://django-mptt.readthedocs.io/">Django MPTT documentation</a></p><h2 id="24-django-contrib-comments"><a href="#24-django-contrib-comments" class="headerlink" title="24.django-contrib-comments"></a>24.django-contrib-comments</h2><p>ç®€ä»‹ï¼šç”¨äºæä¾›è¯„è®ºåŠŸèƒ½ï¼Œæœ€å…ˆé›†æˆåœ¨ django çš„ contrib å†…ç½®åº“é‡Œï¼Œåæ¥è¢«ç§»å‡ºæ¥å•ç‹¬ç»´æŠ¤ã€‚è¿™ä¸ªè¯„è®ºåº“æä¾›äº†åŸºæœ¬çš„è¯„è®ºåŠŸèƒ½ï¼Œä½†æ˜¯åªæ”¯æŒå•çº§è¯„è®ºã€‚å¥½åœ¨è¿™ä¸ªåº“å…·æœ‰å¾ˆå¥½çš„æ‹“å±•æ€§ï¼ŒåŸºäºä¸Šè¾¹æåˆ°çš„ django-mpttï¼Œå°±å¯ä»¥æ„å»ºä¸€ä¸ªæ”¯æŒå±‚çº§è¯„è®ºçš„è¯„è®ºåº“ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/django/django-contrib-comments">django&#x2F;django-contrib-comments</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://django-contrib-comments.readthedocs.io/">Django â€œexcontribâ€ Comments</a></p><h2 id="25-django-brace"><a href="#25-django-brace" class="headerlink" title="25.django-brace"></a>25.django-brace</h2><p>ç®€ä»‹ï¼šdjango å†…ç½®çš„ class based view å¾ˆ awesomeï¼Œä½†è¿˜æœ‰ä¸€äº›é€šç”¨çš„ç±»è§†å›¾æ²¡æœ‰åŒ…å«åœ¨ django æºç ä¸­ï¼Œè¿™ä¸ªåº“è¡¥å……äº†æ›´å¤šå¸¸ç”¨çš„ç±»è§†å›¾ã€‚ç±»è§†å›¾æ˜¯ django çš„ä¸€ä¸ªå¾ˆé‡è¦ä¹Ÿå¾ˆä¼˜é›…çš„ç‰¹æ€§ï¼Œä½¿ç”¨ç±»è§†å›¾å¯ä»¥å‡å°‘è§†å›¾å‡½æ•°çš„ä»£ç ç¼–å†™é‡ã€æé«˜è§†å›¾å‡½æ•°çš„ä»£ç å¤ç”¨æ€§ç­‰ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/brack3t/django-braces">brack3t&#x2F;django-braces</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=http://django-braces.readthedocs.io/en/latest/index.html">Welcome to django-bracesâ€™s documentation!</a></p><p>ç‚¹è¯„ï¼šæ·±å…¥å­¦ä¹ ç±»è§†å›¾å¯ä»¥çœ‹Djangoç±»è§†å›¾æºç åˆ†æã€‚</p><h2 id="26-django-notifications-hq"><a href="#26-django-notifications-hq" class="headerlink" title="26.django-notifications-hq"></a>26.django-notifications-hq</h2><p>ç®€ä»‹ï¼šä¸ºä½ çš„ç½‘ç«™æä¾›ç±»ä¼¼äº GitHub è¿™æ ·çš„é€šçŸ¥åŠŸèƒ½ã€‚æœªè¯»é€šçŸ¥æ•°ã€é€šçŸ¥åˆ—è¡¨ã€æ ‡ä¸ºå·²è¯»ç­‰ç­‰ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/django-notifications/django-notifications">django-notifications&#x2F;django-notifications</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://pypi.python.org/pypi/django-notifications-hq/">django-notifications-hq</a></p><h2 id="27-django-simple-captcha"><a href="#27-django-simple-captcha" class="headerlink" title="27.django-simple-captcha"></a>27.django-simple-captcha</h2><p>ç®€ä»‹ï¼šé…åˆ django çš„è¡¨å•æ¨¡å—ï¼Œæ–¹ä¾¿åœ°ä¸ºè¡¨å•æ·»åŠ ä¸€ä¸ªéªŒè¯ç å­—æ®µã€‚å¯¹éªŒè¯æ€§è¦æ±‚ä¸é«˜çš„éœ€æ±‚ï¼Œä¾‹å¦‚æ³¨å†Œè¡¨å•é˜²æ­¢æœºå™¨äººè‡ªåŠ¨æ³¨å†Œç­‰ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/mbi/django-simple-captcha">mbi&#x2F;django-simple-captcha</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=http://django-simple-captcha.readthedocs.io/en/latest/">Django Simple Captcha</a></p><h2 id="28-django-anymail"><a href="#28-django-anymail" class="headerlink" title="28.django-anymail"></a>28.django-anymail</h2><p>ç®€ä»‹ï¼šé…åˆ django çš„ email æ¨¡å—ï¼Œåªéœ€ç®€å•é…ç½®ï¼Œå°±å¯ä»¥ä½¿ç”¨ Mailgunã€SendGrid ç­‰å‘é€é‚®ä»¶ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/anymail/django-anymail">anymail&#x2F;django-anymail</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://anymail.readthedocs.io/">Anymail: Django email integration for transactional ESPs</a></p><h2 id="29-django-activity-stream"><a href="#29-django-activity-stream" class="headerlink" title="29.django-activity-stream"></a>29.django-activity-stream</h2><p>ç®€ä»‹ï¼šç¤¾äº¤ç±»ç½‘ç«™å…ä¸äº†å…³æ³¨ã€æ”¶è—ã€ç‚¹èµã€ç”¨æˆ·åŠ¨æ€ç­‰åŠŸèƒ½ï¼Œè¿™ä¸€ä¸ª app å…¨æå®šã€‚ç”šè‡³ç”¨å®ƒå®ç°ä¸€ä¸ªæœ‹å‹åœˆä¹Ÿä¸æ˜¯ä¸å¯èƒ½ã€‚</p><p>GitHub åœ°å€ï¼š<a href="https://link.zhihu.com/?target=https://github.com/justquick/django-activity-stream">justquick&#x2F;django-activity-stream</a></p><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://link.zhihu.com/?target=http://django-activity-stream.rtfd.io/en/latest/">Django Activity Stream Documentation</a></p><h2 id="30-Datatables"><a href="#30-Datatables" class="headerlink" title="30.Datatables"></a>30.Datatables</h2><p>æ˜¯ä¸€æ¬¾jqueryè¡¨æ ¼æ’ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªé«˜åº¦çµæ´»çš„å·¥å…·ï¼Œå¯ä»¥å°†ä»»ä½•HTMLè¡¨æ ¼æ·»åŠ é«˜çº§çš„äº¤äº’åŠŸèƒ½ã€‚</p><p>å®˜ç½‘ï¼š<a href="https://link.zhihu.com/?target=https://datatables.net/">Table plug-in for jQuery</a> ä¸­æ–‡ç½‘ç«™ï¼š<a href="https://link.zhihu.com/?target=http://datatables.club/">Datatables ä¸­æ–‡ç½‘</a></p><p>Â </p><p>é“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/76255269">https://zhuanlan.zhihu.com/p/76255269</a><br>æ¥æºï¼šçŸ¥ä¹</p>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨</title>
    <link href="/2020/06/17/Git%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5%E8%A1%A8/"/>
    <url>/2020/06/17/Git%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5%E8%A1%A8/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="ä¸€ã€-Git-å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥"><a href="#ä¸€ã€-Git-å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥" class="headerlink" title="ä¸€ã€ Git å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥"></a>ä¸€ã€ Git å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h2><p><img src="https://img-blog.csdnimg.cn/20200617151856288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQ3NDU0MA==,size_16,color_FFFFFF,t_70"></p><ul><li>git branch æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰åˆ†æ”¯</li><li>git status æŸ¥çœ‹å½“å‰çŠ¶æ€</li><li>git commit æäº¤</li><li>git branch -a æŸ¥çœ‹æ‰€æœ‰çš„åˆ†æ”¯</li><li>git branch -r æŸ¥çœ‹è¿œç¨‹æ‰€æœ‰åˆ†æ”¯</li><li>git commit -am â€œinitâ€ æäº¤å¹¶ä¸”åŠ æ³¨é‡Š</li><li>git remote add origin git@192.168.1.119:ndshow</li><li>git push origin master å°†æ–‡ä»¶ç»™æ¨åˆ°æœåŠ¡å™¨ä¸Š</li><li>git remote show origin æ˜¾ç¤ºè¿œç¨‹åº“originé‡Œçš„èµ„æº</li><li>git push origin master:develop</li><li>git push origin master:hb-dev å°†æœ¬åœ°åº“ä¸æœåŠ¡å™¨ä¸Šçš„åº“è¿›è¡Œå…³è”</li><li>git checkout â€“track origin&#x2F;dev åˆ‡æ¢åˆ°è¿œç¨‹devåˆ†æ”¯</li><li>git branch -D master develop åˆ é™¤æœ¬åœ°åº“develop</li><li>git checkout -b dev å»ºç«‹ä¸€ä¸ªæ–°çš„æœ¬åœ°åˆ†æ”¯dev</li><li>git merge origin&#x2F;dev å°†åˆ†æ”¯devä¸å½“å‰åˆ†æ”¯è¿›è¡Œåˆå¹¶</li><li>git checkout dev åˆ‡æ¢åˆ°æœ¬åœ°devåˆ†æ”¯</li><li>git remote show æŸ¥çœ‹è¿œç¨‹åº“</li><li>git add .</li><li>git rm æ–‡ä»¶å(åŒ…æ‹¬è·¯å¾„) ä»gitä¸­åˆ é™¤æŒ‡å®šæ–‡ä»¶</li><li>git clone git:&#x2F;&#x2F;github.com&#x2F;schacon&#x2F;grit.git ä»æœåŠ¡å™¨ä¸Šå°†ä»£ç ç»™æ‹‰ä¸‹æ¥</li><li>git config â€“list çœ‹æ‰€æœ‰ç”¨æˆ·</li><li>git ls-files çœ‹å·²ç»è¢«æäº¤çš„</li><li>git rm [file name] åˆ é™¤ä¸€ä¸ªæ–‡ä»¶</li><li>git commit -a æäº¤å½“å‰reposçš„æ‰€æœ‰çš„æ”¹å˜</li><li>git add [file name] æ·»åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°git index</li><li>git commit -v å½“ä½ ç”¨ï¼vå‚æ•°çš„æ—¶å€™å¯ä»¥çœ‹commitçš„å·®å¼‚</li><li>git commit -m â€œThis is the message describing the commitâ€ æ·»åŠ commitä¿¡æ¯</li><li>git commit -a -aæ˜¯ä»£è¡¨addï¼ŒæŠŠæ‰€æœ‰çš„changeåŠ åˆ°git indexé‡Œç„¶åå†commit</li><li>git commit -a -v ä¸€èˆ¬æäº¤å‘½ä»¤</li><li>git log çœ‹ä½ commitçš„æ—¥å¿—</li><li>git diff æŸ¥çœ‹å°šæœªæš‚å­˜çš„æ›´æ–°</li><li>git rm a.a ç§»é™¤æ–‡ä»¶(ä»æš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸­åˆ é™¤)</li><li>git rm â€“cached a.a ç§»é™¤æ–‡ä»¶(åªä»æš‚å­˜åŒºä¸­åˆ é™¤)</li><li>git commit -m â€œremoveâ€ ç§»é™¤æ–‡ä»¶(ä»Gitä¸­åˆ é™¤)</li><li>git rm -f a.a å¼ºè¡Œç§»é™¤ä¿®æ”¹åæ–‡ä»¶(ä»æš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸­åˆ é™¤)</li><li>git diff â€“cached æˆ– $ git diff â€“staged æŸ¥çœ‹å°šæœªæäº¤çš„æ›´æ–°</li><li>git stash push å°†æ–‡ä»¶ç»™pushåˆ°ä¸€ä¸ªä¸´æ—¶ç©ºé—´ä¸­</li><li>git stash pop å°†æ–‡ä»¶ä»ä¸´æ—¶ç©ºé—´popä¸‹æ¥</li></ul><hr><ul><li>git remote add origin git@github.com:username&#x2F;Hello-World.git</li><li>git push origin master å°†æœ¬åœ°é¡¹ç›®ç»™æäº¤åˆ°æœåŠ¡å™¨ä¸­</li></ul><hr><ul><li>git pull æœ¬åœ°ä¸æœåŠ¡å™¨ç«¯åŒæ­¥</li></ul><hr><ul><li>git push (è¿œç¨‹ä»“åº“å) (åˆ†æ”¯å) å°†æœ¬åœ°åˆ†æ”¯æ¨é€åˆ°æœåŠ¡å™¨ä¸Šå»ã€‚</li><li>git push origin serverfix:awesomebranch</li></ul><hr><ul><li>git fetch ç›¸å½“äºæ˜¯ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°ï¼Œä¸ä¼šè‡ªåŠ¨merge</li><li>git commit -a -m â€œlog_messageâ€ (-aæ˜¯æäº¤æ‰€æœ‰æ”¹åŠ¨ï¼Œ-mæ˜¯åŠ å…¥logä¿¡æ¯)</li></ul><hr><p>åˆå§‹åŒ–ç‰ˆæœ¬åº“ï¼Œå¹¶æäº¤åˆ°è¿œç¨‹æœåŠ¡å™¨ç«¯</p><p>mkdir WebApp<br>cd WebApp<br>git init æœ¬åœ°åˆå§‹åŒ–<br>touch README<br>git add README æ·»åŠ æ–‡ä»¶<br>git commit -m â€˜first commitâ€™<br>git remote add origin git@github.com:daixu&#x2F;WebApp.git</p><p>ä¸Šé¢çš„å‘½ä»¤ä¼šå¢åŠ URLåœ°å€ä¸ºâ€™git@github.com:daixu&#x2F;WebApp.gitâ€™ï¼Œåç§°ä¸ºoriginçš„è¿œç¨‹æœåŠ¡å™¨åº“ï¼Œä»¥åæäº¤ä»£ç çš„æ—¶å€™åªéœ€è¦ä½¿ç”¨ originåˆ«åå³å¯</p><h2 id="äºŒã€-Git-å‘½ä»¤é€ŸæŸ¥è¡¨"><a href="#äºŒã€-Git-å‘½ä»¤é€ŸæŸ¥è¡¨" class="headerlink" title="äºŒã€ Git å‘½ä»¤é€ŸæŸ¥è¡¨"></a>äºŒã€ Git å‘½ä»¤é€ŸæŸ¥è¡¨</h2><h3 id="1ã€å¸¸ç”¨çš„Gitå‘½ä»¤"><a href="#1ã€å¸¸ç”¨çš„Gitå‘½ä»¤" class="headerlink" title="1ã€å¸¸ç”¨çš„Gitå‘½ä»¤"></a>1ã€å¸¸ç”¨çš„Gitå‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git add</td><td>æ·»åŠ è‡³æš‚å­˜åŒº</td></tr><tr><td>git addâ€“interactive</td><td>äº¤äº’å¼æ·»åŠ </td></tr><tr><td>git apply</td><td>åº”ç”¨è¡¥ä¸</td></tr><tr><td>git am</td><td>åº”ç”¨é‚®ä»¶æ ¼å¼è¡¥ä¸</td></tr><tr><td>git annotate</td><td>åŒä¹‰è¯ï¼Œç­‰åŒäº git blame</td></tr><tr><td>git archive</td><td>æ–‡ä»¶å½’æ¡£æ‰“åŒ…</td></tr><tr><td>git bisect</td><td>äºŒåˆ†æŸ¥æ‰¾</td></tr><tr><td>git blame</td><td>æ–‡ä»¶é€è¡Œè¿½æº¯</td></tr><tr><td>git branch</td><td>åˆ†æ”¯ç®¡ç†</td></tr><tr><td>git cat-file</td><td>ç‰ˆæœ¬åº“å¯¹è±¡ç ”ç©¶å·¥å…·</td></tr><tr><td>git checkout</td><td>æ£€å‡ºåˆ°å·¥ä½œåŒºã€åˆ‡æ¢æˆ–åˆ›å»ºåˆ†æ”¯</td></tr><tr><td>git cherry-pick</td><td>æäº¤æ‹£é€‰</td></tr><tr><td>git citool</td><td>å›¾å½¢åŒ–æäº¤ï¼Œç›¸å½“äº git gui å‘½ä»¤</td></tr><tr><td>git clean</td><td>æ¸…é™¤å·¥ä½œåŒºæœªè·Ÿè¸ªæ–‡ä»¶</td></tr><tr><td>git clone</td><td>å…‹éš†ç‰ˆæœ¬åº“</td></tr><tr><td>git commit</td><td>æäº¤</td></tr><tr><td>git config</td><td>æŸ¥è¯¢å’Œä¿®æ”¹é…ç½®</td></tr><tr><td>git describe</td><td>é€šè¿‡é‡Œç¨‹ç¢‘ç›´è§‚åœ°æ˜¾ç¤ºæäº¤ID</td></tr><tr><td>git diff</td><td>å·®å¼‚æ¯”è¾ƒ</td></tr><tr><td>git difftool</td><td>è°ƒç”¨å›¾å½¢åŒ–å·®å¼‚æ¯”è¾ƒå·¥å…·</td></tr><tr><td>git fetch</td><td>è·å–è¿œç¨‹ç‰ˆæœ¬åº“çš„æäº¤</td></tr><tr><td>git format-patch</td><td>åˆ›å»ºé‚®ä»¶æ ¼å¼çš„è¡¥ä¸æ–‡ä»¶ã€‚å‚è§ git am å‘½ä»¤</td></tr><tr><td>git grep</td><td>æ–‡ä»¶å†…å®¹æœç´¢å®šä½å·¥å…·</td></tr><tr><td>git gui</td><td>åŸºäºTcl&#x2F;Tkçš„å›¾å½¢åŒ–å·¥å…·ï¼Œä¾§é‡æäº¤ç­‰æ“ä½œ</td></tr><tr><td>git help</td><td>å¸®åŠ©</td></tr><tr><td>git init</td><td>ç‰ˆæœ¬åº“åˆå§‹åŒ–</td></tr><tr><td>git init-db*</td><td>åŒä¹‰è¯ï¼Œç­‰åŒäº git init</td></tr><tr><td>git log</td><td>æ˜¾ç¤ºæäº¤æ—¥å¿—</td></tr><tr><td>git merge</td><td>åˆ†æ”¯åˆå¹¶</td></tr><tr><td>git mergetool</td><td>å›¾å½¢åŒ–å†²çªè§£å†³</td></tr><tr><td>git mv</td><td>é‡å‘½å</td></tr><tr><td>git pull</td><td>æ‹‰å›è¿œç¨‹ç‰ˆæœ¬åº“çš„æäº¤</td></tr><tr><td>git push</td><td>æ¨é€è‡³è¿œç¨‹ç‰ˆæœ¬åº“</td></tr><tr><td>git rebase</td><td>åˆ†æ”¯å˜åŸº</td></tr><tr><td>git rebaseâ€“interactive</td><td>äº¤äº’å¼åˆ†æ”¯å˜åŸº</td></tr><tr><td>git reflog</td><td>åˆ†æ”¯ç­‰å¼•ç”¨å˜æ›´è®°å½•ç®¡ç†</td></tr><tr><td>git remote</td><td>è¿œç¨‹ç‰ˆæœ¬åº“ç®¡ç†</td></tr><tr><td>git repo-config*</td><td>åŒä¹‰è¯ï¼Œç­‰åŒäº git config</td></tr><tr><td>git reset</td><td>é‡ç½®æ”¹å˜åˆ†æ”¯â€œæ¸¸æ ‡â€æŒ‡å‘</td></tr><tr><td>git rev-parse</td><td>å°†å„ç§å¼•ç”¨è¡¨ç¤ºæ³•è½¬æ¢ä¸ºå“ˆå¸Œå€¼ç­‰</td></tr><tr><td>git revert</td><td>åè½¬æäº¤</td></tr><tr><td>git rm</td><td>åˆ é™¤æ–‡ä»¶</td></tr><tr><td>git show</td><td>æ˜¾ç¤ºå„ç§ç±»å‹çš„å¯¹è±¡</td></tr><tr><td>git stage*</td><td>åŒä¹‰è¯ï¼Œç­‰åŒäº git add</td></tr><tr><td>git stash</td><td>ä¿å­˜å’Œæ¢å¤è¿›åº¦</td></tr><tr><td>git status</td><td>æ˜¾ç¤ºå·¥ä½œåŒºæ–‡ä»¶çŠ¶æ€</td></tr><tr><td>git tag</td><td>é‡Œç¨‹ç¢‘ç®¡ç†</td></tr></tbody></table><h3 id="2ã€å¯¹è±¡åº“æ“ä½œç›¸å…³å‘½ä»¤"><a href="#2ã€å¯¹è±¡åº“æ“ä½œç›¸å…³å‘½ä»¤" class="headerlink" title="2ã€å¯¹è±¡åº“æ“ä½œç›¸å…³å‘½ä»¤"></a>2ã€å¯¹è±¡åº“æ“ä½œç›¸å…³å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git commit-tree</td><td>ä»æ ‘å¯¹è±¡åˆ›å»ºæäº¤</td></tr><tr><td>git hash-object</td><td>ä»æ ‡å‡†è¾“å…¥æˆ–æ–‡ä»¶è®¡ç®—å“ˆå¸Œå€¼æˆ–åˆ›å»ºå¯¹è±¡</td></tr><tr><td>git ls-files</td><td>æ˜¾ç¤ºå·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶</td></tr><tr><td>git ls-tree</td><td>æ˜¾ç¤ºæ ‘å¯¹è±¡åŒ…å«çš„æ–‡ä»¶</td></tr><tr><td>git mktag</td><td>è¯»å–æ ‡å‡†è¾“å…¥åˆ›å»ºä¸€ä¸ªé‡Œç¨‹ç¢‘å¯¹è±¡</td></tr><tr><td>git mktree</td><td>è¯»å–æ ‡å‡†è¾“å…¥åˆ›å»ºä¸€ä¸ªæ ‘å¯¹è±¡</td></tr><tr><td>git read-tree</td><td>è¯»å–æ ‘å¯¹è±¡åˆ°æš‚å­˜åŒº</td></tr><tr><td>git update-index</td><td>å·¥ä½œåŒºå†…å®¹æ³¨å†Œåˆ°æš‚å­˜åŒºåŠæš‚å­˜åŒºç®¡ç†</td></tr><tr><td>git unpack-file</td><td>åˆ›å»ºä¸´æ—¶æ–‡ä»¶åŒ…å«æŒ‡å®š blob çš„å†…å®¹</td></tr><tr><td>git write-tree</td><td>ä»æš‚å­˜åŒºåˆ›å»ºä¸€ä¸ªæ ‘å¯¹è±¡</td></tr></tbody></table><h3 id="3ã€å¼•ç”¨æ“ä½œç›¸å…³å‘½ä»¤"><a href="#3ã€å¼•ç”¨æ“ä½œç›¸å…³å‘½ä»¤" class="headerlink" title="3ã€å¼•ç”¨æ“ä½œç›¸å…³å‘½ä»¤"></a>3ã€å¼•ç”¨æ“ä½œç›¸å…³å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git check-ref-format</td><td>æ£€æŸ¥å¼•ç”¨åç§°æ˜¯å¦ç¬¦åˆè§„èŒƒ</td></tr><tr><td>git for-each-ref</td><td>å¼•ç”¨è¿­ä»£å™¨ï¼Œç”¨äºshellç¼–ç¨‹</td></tr><tr><td>git ls-remote</td><td>æ˜¾ç¤ºè¿œç¨‹ç‰ˆæœ¬åº“çš„å¼•ç”¨</td></tr><tr><td>git name-rev</td><td>å°†æäº¤IDæ˜¾ç¤ºä¸ºå‹å¥½åç§°</td></tr><tr><td>git peek-remote*</td><td>è¿‡æ—¶å‘½ä»¤ï¼Œè¯·ä½¿ç”¨ git ls-remote</td></tr><tr><td>git rev-list</td><td>æ˜¾ç¤ºç‰ˆæœ¬èŒƒå›´</td></tr><tr><td>git show-branch</td><td>æ˜¾ç¤ºåˆ†æ”¯åˆ—è¡¨åŠæ‹“æ‰‘å…³ç³»</td></tr><tr><td>git show-ref</td><td>æ˜¾ç¤ºæœ¬åœ°å¼•ç”¨</td></tr><tr><td>git symbolic-ref</td><td>æ˜¾ç¤ºæˆ–è€…è®¾ç½®ç¬¦å·å¼•ç”¨</td></tr><tr><td>git update-ref</td><td>æ›´æ–°å¼•ç”¨çš„æŒ‡å‘</td></tr><tr><td>git verify-tag</td><td>æ ¡éªŒ GPG ç­¾åçš„Tag</td></tr></tbody></table><h3 id="4ã€ç‰ˆæœ¬åº“ç®¡ç†ç›¸å…³å‘½ä»¤"><a href="#4ã€ç‰ˆæœ¬åº“ç®¡ç†ç›¸å…³å‘½ä»¤" class="headerlink" title="4ã€ç‰ˆæœ¬åº“ç®¡ç†ç›¸å…³å‘½ä»¤"></a>4ã€ç‰ˆæœ¬åº“ç®¡ç†ç›¸å…³å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git count-objects</td><td>æ˜¾ç¤ºæ¾æ•£å¯¹è±¡çš„æ•°é‡å’Œç£ç›˜å ç”¨</td></tr><tr><td>git filter-branch</td><td>ç‰ˆæœ¬åº“é‡æ„</td></tr><tr><td>git fsck</td><td>å¯¹è±¡åº“å®Œæ•´æ€§æ£€æŸ¥</td></tr><tr><td>git fsck-objects*</td><td>åŒä¹‰è¯ï¼Œç­‰åŒäº git fsck</td></tr><tr><td>git gc</td><td>ç‰ˆæœ¬åº“å­˜å‚¨ä¼˜åŒ–</td></tr><tr><td>git index-pack</td><td>ä»æ‰“åŒ…æ–‡ä»¶åˆ›å»ºå¯¹åº”çš„ç´¢å¼•æ–‡ä»¶</td></tr><tr><td>git lost-found*</td><td>è¿‡æ—¶ï¼Œè¯·ä½¿ç”¨ git fsck â€“lost-found å‘½ä»¤</td></tr><tr><td>git pack-objects</td><td>ä»æ ‡å‡†è¾“å…¥è¯»å…¥å¯¹è±¡IDï¼Œæ‰“åŒ…åˆ°æ–‡ä»¶</td></tr><tr><td>git pack-redundant</td><td>æŸ¥æ‰¾å¤šä½™çš„ pack æ–‡ä»¶</td></tr><tr><td>git pack-refs</td><td>å°†å¼•ç”¨æ‰“åŒ…åˆ° .git&#x2F;packed-refs æ–‡ä»¶ä¸­</td></tr><tr><td>git prune</td><td>ä»å¯¹è±¡åº“åˆ é™¤è¿‡æœŸå¯¹è±¡</td></tr><tr><td>git prune-packed</td><td>å°†å·²ç»æ‰“åŒ…çš„æ¾æ•£å¯¹è±¡åˆ é™¤</td></tr><tr><td>git relink</td><td>ä¸ºæœ¬åœ°ç‰ˆæœ¬åº“ä¸­ç›¸åŒçš„å¯¹è±¡å»ºç«‹ç¡¬è¿æ¥</td></tr><tr><td>git repack</td><td>å°†ç‰ˆæœ¬åº“æœªæ‰“åŒ…çš„æ¾æ•£å¯¹è±¡æ‰“åŒ…</td></tr><tr><td>git show-index</td><td>è¯»å–åŒ…çš„ç´¢å¼•æ–‡ä»¶ï¼Œæ˜¾ç¤ºæ‰“åŒ…æ–‡ä»¶ä¸­çš„å†…å®¹</td></tr><tr><td>git unpack-objects</td><td>ä»æ‰“åŒ…æ–‡ä»¶é‡Šæ”¾æ–‡ä»¶</td></tr><tr><td>git verify-pack</td><td>æ ¡éªŒå¯¹è±¡åº“æ‰“åŒ…æ–‡ä»¶</td></tr></tbody></table><h3 id="5ã€æ•°æ®ä¼ è¾“ç›¸å…³å‘½ä»¤"><a href="#5ã€æ•°æ®ä¼ è¾“ç›¸å…³å‘½ä»¤" class="headerlink" title="5ã€æ•°æ®ä¼ è¾“ç›¸å…³å‘½ä»¤"></a>5ã€æ•°æ®ä¼ è¾“ç›¸å…³å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git fetch-pack</td><td>æ‰§è¡Œ git fetch æˆ– git pull</td></tr><tr><td>git receive-pack</td><td>æ‰§è¡Œ git push å‘½ä»¤æ—¶åœ¨è¿œç¨‹æ‰§è¡Œçš„å‘½ä»¤ï¼Œç”¨äºæ¥å—æ¨é€çš„æ•°æ®</td></tr><tr><td>git send-pack</td><td>æ‰§è¡Œ git push å‘½ä»¤æ—¶åœ¨æœ¬åœ°æ‰§è¡Œçš„å‘½ä»¤ï¼Œç”¨äºå‘å…¶ä»–ç‰ˆæœ¬åº“æ¨é€æ•°æ®</td></tr><tr><td>git upload-archive</td><td>æ‰§è¡Œ git archive â€“remote</td></tr><tr><td>git upload-pack</td><td>æ‰§è¡Œ git fetch æˆ– git pull å‘½ä»¤æ—¶åœ¨è¿œç¨‹æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œå°†å¯¹è±¡æ‰“åŒ…ã€ä¸Šä¼ </td></tr></tbody></table><h3 id="6ã€é‚®ä»¶ç›¸å…³å‘½ä»¤"><a href="#6ã€é‚®ä»¶ç›¸å…³å‘½ä»¤" class="headerlink" title="6ã€é‚®ä»¶ç›¸å…³å‘½ä»¤"></a>6ã€é‚®ä»¶ç›¸å…³å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git imap-send</td><td>å°†è¡¥ä¸é€šè¿‡ IMAP å‘é€</td></tr><tr><td>git mailinfo</td><td>ä»é‚®ä»¶å¯¼å‡ºæäº¤è¯´æ˜å’Œè¡¥ä¸</td></tr><tr><td>git mailsplit</td><td>å°† mbox æˆ– Maildir æ ¼å¼é‚®ç®±ä¸­é‚®ä»¶é€ä¸€æå–ä¸ºæ–‡ä»¶</td></tr><tr><td>git request-pull</td><td>åˆ›å»ºåŒ…å«æäº¤é—´å·®å¼‚å’Œæ‰§è¡ŒPULLæ“ä½œåœ°å€çš„ä¿¡æ¯</td></tr><tr><td>git send-email</td><td>å‘é€é‚®ä»¶</td></tr></tbody></table><h3 id="7ã€åè®®ç›¸å…³å‘½ä»¤"><a href="#7ã€åè®®ç›¸å…³å‘½ä»¤" class="headerlink" title="7ã€åè®®ç›¸å…³å‘½ä»¤"></a>7ã€åè®®ç›¸å…³å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git daemon</td><td>å®ç°Gitåè®®</td></tr><tr><td>git http-backend</td><td>å®ç°HTTPåè®®çš„CGIç¨‹åºï¼Œæ”¯æŒæ™ºèƒ½HTTPåè®®</td></tr><tr><td>git instaweb</td><td>å³æ—¶å¯åŠ¨æµè§ˆå™¨é€šè¿‡ gitweb æµè§ˆå½“å‰ç‰ˆæœ¬åº“</td></tr><tr><td>git shell</td><td>å—é™åˆ¶çš„shellï¼Œæä¾›ä»…æ‰§è¡ŒGitå‘½ä»¤çš„SSHè®¿é—®</td></tr><tr><td>git update-server-info</td><td>æ›´æ–°å“‘åè®®éœ€è¦çš„è¾…åŠ©æ–‡ä»¶</td></tr><tr><td>git http-fetch</td><td>é€šè¿‡HTTPåè®®è·å–ç‰ˆæœ¬åº“</td></tr><tr><td>git http-push</td><td>é€šè¿‡HTTP&#x2F;DAVåè®®æ¨é€</td></tr><tr><td>git remote-ext</td><td>ç”±Gitå‘½ä»¤è°ƒç”¨ï¼Œé€šè¿‡å¤–éƒ¨å‘½ä»¤æä¾›æ‰©å±•åè®®æ”¯æŒ</td></tr><tr><td>git remote-fd</td><td>ç”±Gitå‘½ä»¤è°ƒç”¨ï¼Œä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºåè®®æ¥å£</td></tr><tr><td>git remote-ftp</td><td>ç”±Gitå‘½ä»¤è°ƒç”¨ï¼Œæä¾›å¯¹FTPåè®®çš„æ”¯æŒ</td></tr><tr><td>git remote-ftps</td><td>ç”±Gitå‘½ä»¤è°ƒç”¨ï¼Œæä¾›å¯¹FTPSåè®®çš„æ”¯æŒ</td></tr><tr><td>git remote-http</td><td>ç”±Gitå‘½ä»¤è°ƒç”¨ï¼Œæä¾›å¯¹HTTPåè®®çš„æ”¯æŒ</td></tr><tr><td>git remote-https</td><td>ç”±Gitå‘½ä»¤è°ƒç”¨ï¼Œæä¾›å¯¹HTTPSåè®®çš„æ”¯æŒ</td></tr><tr><td>git remote-testgit</td><td>åè®®æ‰©å±•ç¤ºä¾‹è„šæœ¬</td></tr></tbody></table><h3 id="8ã€ç‰ˆæœ¬åº“è½¬æ¢å’Œäº¤äº’ç›¸å…³å‘½ä»¤"><a href="#8ã€ç‰ˆæœ¬åº“è½¬æ¢å’Œäº¤äº’ç›¸å…³å‘½ä»¤" class="headerlink" title="8ã€ç‰ˆæœ¬åº“è½¬æ¢å’Œäº¤äº’ç›¸å…³å‘½ä»¤"></a>8ã€ç‰ˆæœ¬åº“è½¬æ¢å’Œäº¤äº’ç›¸å…³å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git archimport</td><td>å¯¼å…¥Archç‰ˆæœ¬åº“åˆ°Git</td></tr><tr><td>git bundle</td><td>æäº¤æ‰“åŒ…å’Œè§£åŒ…ï¼Œä»¥ä¾¿åœ¨ä¸åŒç‰ˆæœ¬åº“é—´ä¼ é€’</td></tr><tr><td>git cvsexportcommit</td><td>å°†Gitçš„ä¸€ä¸ªæäº¤ä½œä¸ºä¸€ä¸ªCVSæ£€å‡º</td></tr><tr><td>git cvsimport</td><td>å¯¼å…¥CVSç‰ˆæœ¬åº“åˆ°Gitã€‚æˆ–è€…ä½¿ç”¨ cvs2git</td></tr><tr><td>git cvsserver</td><td>Gitçš„CVSåè®®æ¨¡æ‹Ÿå™¨ï¼Œå¯ä¾›CVSå‘½ä»¤è®¿é—®Gitç‰ˆæœ¬åº“</td></tr><tr><td>git fast-export</td><td>å°†æäº¤å¯¼å‡ºä¸º git-fast-import æ ¼å¼</td></tr><tr><td>git fast-import</td><td>å…¶ä»–ç‰ˆæœ¬åº“è¿ç§»è‡³Gitçš„é€šç”¨å·¥å…·</td></tr><tr><td>git svn</td><td>Git ä½œä¸ºå‰ç«¯æ“ä½œ Subversion</td></tr></tbody></table><h3 id="9ã€åˆå¹¶ç›¸å…³çš„è¾…åŠ©å‘½ä»¤"><a href="#9ã€åˆå¹¶ç›¸å…³çš„è¾…åŠ©å‘½ä»¤" class="headerlink" title="9ã€åˆå¹¶ç›¸å…³çš„è¾…åŠ©å‘½ä»¤"></a>9ã€åˆå¹¶ç›¸å…³çš„è¾…åŠ©å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git merge-base</td><td>ä¾›å…¶ä»–è„šæœ¬è°ƒç”¨ï¼Œæ‰¾åˆ°ä¸¤ä¸ªæˆ–å¤šä¸ªæäº¤æœ€è¿‘çš„å…±åŒç¥–å…ˆ</td></tr><tr><td>git merge-file</td><td>é’ˆå¯¹æ–‡ä»¶çš„ä¸¤ä¸ªä¸åŒç‰ˆæœ¬æ‰§è¡Œä¸‰å‘æ–‡ä»¶åˆå¹¶</td></tr><tr><td>git merge-index</td><td>å¯¹indexä¸­çš„å†²çªæ–‡ä»¶è°ƒç”¨æŒ‡å®šçš„å†²çªè§£å†³å·¥å…·</td></tr><tr><td>git merge-octopus</td><td>åˆå¹¶ä¸¤ä¸ªä»¥ä¸Šåˆ†æ”¯ã€‚å‚è§ git merge çš„octopusåˆå¹¶ç­–ç•¥</td></tr><tr><td>git merge-one-file</td><td>ç”± git merge-index è°ƒç”¨çš„æ ‡å‡†è¾…åŠ©ç¨‹åº</td></tr><tr><td>git merge-ours</td><td>åˆå¹¶ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬ï¼ŒæŠ›å¼ƒä»–äººç‰ˆæœ¬ã€‚å‚è§ git merge çš„oursåˆå¹¶ç­–ç•¥</td></tr><tr><td>git merge-recursive</td><td>é’ˆå¯¹ä¸¤ä¸ªåˆ†æ”¯çš„ä¸‰å‘åˆå¹¶ã€‚å‚è§ git merge çš„recursiveåˆå¹¶ç­–ç•¥</td></tr><tr><td>git merge-resolve</td><td>é’ˆå¯¹ä¸¤ä¸ªåˆ†æ”¯çš„ä¸‰å‘åˆå¹¶ã€‚å‚è§ git merge çš„resolveåˆå¹¶ç­–ç•¥</td></tr><tr><td>git merge-subtree</td><td>å­æ ‘åˆå¹¶ã€‚å‚è§ git merge çš„ subtree åˆå¹¶ç­–ç•¥</td></tr><tr><td>git merge-tree</td><td>æ˜¾å¼ä¸‰å‘åˆå¹¶ç»“æœï¼Œä¸æ”¹å˜æš‚å­˜åŒº</td></tr><tr><td>git fmt-merge-msg</td><td>ä¾›æ‰§è¡Œåˆå¹¶æ“ä½œçš„è„šæœ¬è°ƒç”¨ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªåˆå¹¶æäº¤è¯´æ˜</td></tr><tr><td>git rerere</td><td>é‡ç”¨æ‰€è®°å½•çš„å†²çªè§£å†³æ–¹æ¡ˆ</td></tr></tbody></table><h3 id="10ã€-æ‚é¡¹"><a href="#10ã€-æ‚é¡¹" class="headerlink" title="10ã€ æ‚é¡¹"></a>10ã€ æ‚é¡¹</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>git bisectâ€“helper</td><td>ç”± git bisect å‘½ä»¤è°ƒç”¨ï¼Œç¡®è®¤äºŒåˆ†æŸ¥æ‰¾è¿›åº¦</td></tr><tr><td>git check-attr</td><td>æ˜¾ç¤ºæŸä¸ªæ–‡ä»¶æ˜¯å¦è®¾ç½®äº†æŸä¸ªå±æ€§</td></tr><tr><td>git checkout-index</td><td>ä»æš‚å­˜åŒºæ‹·è´æ–‡ä»¶è‡³å·¥ä½œåŒº</td></tr><tr><td>git cherry</td><td>æŸ¥æ‰¾æ²¡æœ‰åˆå¹¶åˆ°ä¸Šæ¸¸çš„æäº¤</td></tr><tr><td>git diff-files</td><td>æ¯”è¾ƒæš‚å­˜åŒºå’Œå·¥ä½œåŒºï¼Œç›¸å½“äº git diff â€“raw</td></tr><tr><td>git diff-index</td><td>æ¯”è¾ƒæš‚å­˜åŒºå’Œç‰ˆæœ¬åº“ï¼Œç›¸å½“äº git diff â€“cached â€“raw</td></tr><tr><td>git diff-tree</td><td>æ¯”è¾ƒä¸¤ä¸ªæ ‘å¯¹è±¡ï¼Œç›¸å½“äº git diff â€“raw A B</td></tr><tr><td>git difftoolâ€“helper</td><td>ç”± git difftool å‘½ä»¤è°ƒç”¨ï¼Œé»˜è®¤è¦ä½¿ç”¨çš„å·®å¼‚æ¯”è¾ƒå·¥å…·</td></tr><tr><td>git get-tar-commit-id</td><td>ä» git archive åˆ›å»ºçš„ tar åŒ…ä¸­æå–æäº¤ID</td></tr><tr><td>git guiâ€“askpass</td><td>å‘½ä»¤ git gui çš„è·å–ç”¨æˆ·å£ä»¤è¾“å…¥ç•Œé¢</td></tr><tr><td>git notes</td><td>æäº¤è¯„è®ºç®¡ç†</td></tr><tr><td>git patch-id</td><td>è¡¥ä¸è¿‡æ»¤è¡Œå·å’Œç©ºç™½å­—ç¬¦åç”Ÿæˆè¡¥ä¸å”¯ä¸€ID</td></tr><tr><td>git quiltimport</td><td>å°†Quiltè¡¥ä¸åˆ—è¡¨åº”ç”¨åˆ°å½“å‰åˆ†æ”¯</td></tr><tr><td>git replace</td><td>æäº¤æ›¿æ¢</td></tr><tr><td>git shortlog</td><td>å¯¹ git log çš„æ±‡æ€»è¾“å‡ºï¼Œé€‚åˆäºäº§å“å‘å¸ƒè¯´æ˜</td></tr><tr><td>git stripspace</td><td>åˆ é™¤ç©ºè¡Œï¼Œä¾›å…¶ä»–è„šæœ¬è°ƒç”¨</td></tr><tr><td>git submodule</td><td>å­æ¨¡ç»„ç®¡ç†</td></tr><tr><td>git tar-tree</td><td>è¿‡æ—¶å‘½ä»¤ï¼Œè¯·ä½¿ç”¨ git archive</td></tr><tr><td>git var</td><td>æ˜¾ç¤º Git ç¯å¢ƒå˜é‡</td></tr><tr><td>git webâ€“browse</td><td>å¯åŠ¨æµè§ˆå™¨ä»¥æŸ¥çœ‹ç›®å½•æˆ–æ–‡ä»¶</td></tr><tr><td>git whatchanged</td><td>æ˜¾ç¤ºæäº¤å†å²åŠæ¯æ¬¡æäº¤çš„æ”¹åŠ¨</td></tr><tr><td>git-mergetoolâ€“lib</td><td>åŒ…å«äºå…¶ä»–è„šæœ¬ä¸­ï¼Œæä¾›åˆå¹¶&#x2F;å·®å¼‚æ¯”è¾ƒå·¥å…·çš„é€‰æ‹©å’Œæ‰§è¡Œ</td></tr><tr><td>git-parse-remote</td><td>åŒ…å«äºå…¶ä»–è„šæœ¬ä¸­ï¼Œæä¾›æ“ä½œè¿œç¨‹ç‰ˆæœ¬åº“çš„å‡½æ•°</td></tr><tr><td>git-sh-setup</td><td>åŒ…å«äºå…¶ä»–è„šæœ¬ä¸­ï¼Œæä¾› shell ç¼–ç¨‹çš„å‡½æ•°åº“</td></tr></tbody></table><h2 id="ä¸‰ã€ä¸€äº›ç®€å•çš„ä½¿ç”¨ä¾‹å­"><a href="#ä¸‰ã€ä¸€äº›ç®€å•çš„ä½¿ç”¨ä¾‹å­" class="headerlink" title="ä¸‰ã€ä¸€äº›ç®€å•çš„ä½¿ç”¨ä¾‹å­"></a>ä¸‰ã€ä¸€äº›ç®€å•çš„ä½¿ç”¨ä¾‹å­</h2><p>git init                                    # åˆå§‹åŒ–æœ¬åœ°gitä»“åº“ï¼ˆåˆ›å»ºæ–°ä»“åº“ï¼‰<br>git config â€“global user.name â€œxxxâ€             # é…ç½®ç”¨æˆ·å<br>git config â€“global user.email â€œxxx@xxx.comâ€    # é…ç½®é‚®ä»¶<br>git config â€“global color.ui true               # git statusç­‰å‘½ä»¤è‡ªåŠ¨ç€è‰²<br>git config â€“global color.status auto<br>git config â€“global color.diff auto<br>git config â€“global color.branch auto<br>git config â€“global color.interactive auto<br>git clone git+ssh:&#x2F;&#x2F;git@192.168.53.168&#x2F;VT.git   # cloneè¿œç¨‹ä»“åº“<br>git status                                      # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬çŠ¶æ€ï¼ˆæ˜¯å¦ä¿®æ”¹ï¼‰<br>git add xyz                                     # æ·»åŠ xyzæ–‡ä»¶è‡³index<br>git add .                           # å¢åŠ å½“å‰å­ç›®å½•ä¸‹æ‰€æœ‰æ›´æ”¹è¿‡çš„æ–‡ä»¶è‡³index<br>git commit -m â€˜xxxâ€™                             # æäº¤<br>git commit â€“amend -m â€˜xxxâ€™                  # åˆå¹¶ä¸Šä¸€æ¬¡æäº¤ï¼ˆç”¨äºåå¤ä¿®æ”¹ï¼‰<br>git commit -am â€˜xxxâ€™                            # å°†addå’Œcommitåˆä¸ºä¸€æ­¥<br>git rm xxx                                      # åˆ é™¤indexä¸­çš„æ–‡ä»¶<br>git rm -r *                                     # é€’å½’åˆ é™¤<br>git log                                         # æ˜¾ç¤ºæäº¤æ—¥å¿—<br>git log -1                                      # æ˜¾ç¤º1è¡Œæ—¥å¿— -nä¸ºnè¡Œ<br>git log -5<br>git log â€“stat                                  # æ˜¾ç¤ºæäº¤æ—¥å¿—åŠç›¸å…³å˜åŠ¨æ–‡ä»¶<br>git log -p -m<br>git show dfb02e6e4f2f7b573337763e5c0013802e392818   # æ˜¾ç¤ºæŸä¸ªæäº¤çš„è¯¦ç»†å†…å®¹<br>git show dfb02                                      # å¯åªç”¨commitidçš„å‰å‡ ä½<br>git show HEAD                                       # æ˜¾ç¤ºHEADæäº¤æ—¥å¿—<br>git show HEAD^                  # æ˜¾ç¤ºHEADçš„çˆ¶ï¼ˆä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼‰çš„æäº¤æ—¥å¿— ^^ä¸ºä¸Šä¸¤ä¸ªç‰ˆæœ¬ ^5ä¸ºä¸Š5ä¸ªç‰ˆæœ¬<br>git tag                                             # æ˜¾ç¤ºå·²å­˜åœ¨çš„tag<br>git tag -a v2.0 -m â€˜xxxâ€™                            # å¢åŠ v2.0çš„tag<br>git show v2.0                                       # æ˜¾ç¤ºv2.0çš„æ—¥å¿—åŠè¯¦ç»†å†…å®¹<br>git log v2.0                                        # æ˜¾ç¤ºv2.0çš„æ—¥å¿—<br>git diff                                        # æ˜¾ç¤ºæ‰€æœ‰æœªæ·»åŠ è‡³indexçš„å˜æ›´<br>git diff â€“cached                               # æ˜¾ç¤ºæ‰€æœ‰å·²æ·»åŠ indexä½†è¿˜æœªcommitçš„å˜æ›´<br>git diff HEAD^                                  # æ¯”è¾ƒä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å·®å¼‚<br>git diff HEAD â€“ .&#x2F;lib                          # æ¯”è¾ƒä¸HEADç‰ˆæœ¬libç›®å½•çš„å·®å¼‚<br>git diff origin&#x2F;master..master  # æ¯”è¾ƒè¿œç¨‹åˆ†æ”¯masterä¸Šæœ‰æœ¬åœ°åˆ†æ”¯masterä¸Šæ²¡æœ‰çš„<br>git diff origin&#x2F;master..master â€“stat   # åªæ˜¾ç¤ºå·®å¼‚çš„æ–‡ä»¶ï¼Œä¸æ˜¾ç¤ºå…·ä½“å†…å®¹<br>git remote add origin git+ssh:&#x2F;&#x2F;git@192.168.53.168&#x2F;VT.git # å¢åŠ è¿œç¨‹å®šä¹‰ï¼ˆç”¨äºpush&#x2F;pull&#x2F;fetchï¼‰<br>git branch                                                # æ˜¾ç¤ºæœ¬åœ°åˆ†æ”¯<br>git branch â€“contains 50089                      # æ˜¾ç¤ºåŒ…å«æäº¤50089çš„åˆ†æ”¯<br>git branch -a                                             # æ˜¾ç¤ºæ‰€æœ‰åˆ†æ”¯<br>git branch -r                                             # æ˜¾ç¤ºæ‰€æœ‰åŸåˆ›åˆ†æ”¯<br>git branch â€“merged                         # æ˜¾ç¤ºæ‰€æœ‰å·²åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯<br>git branch â€“no-merged                      # æ˜¾ç¤ºæ‰€æœ‰æœªåˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯<br>git branch -m master master_copy                          # æœ¬åœ°åˆ†æ”¯æ”¹å<br>git checkout -b master_copy         # ä»å½“å‰åˆ†æ”¯åˆ›å»ºæ–°åˆ†æ”¯master_copyå¹¶æ£€å‡º<br>git checkout -b master master_copy                        # ä¸Šé¢çš„å®Œæ•´ç‰ˆ<br>git checkout features&#x2F;performance    # æ£€å‡ºå·²å­˜åœ¨çš„features&#x2F;performanceåˆ†æ”¯<br>git checkout â€“track hotfixes&#x2F;BJVEP933   # æ£€å‡ºè¿œç¨‹åˆ†æ”¯hotfixes&#x2F;BJVEP933å¹¶åˆ›å»ºæœ¬åœ°è·Ÿè¸ªåˆ†æ”¯<br>git checkout v2.0                                         # æ£€å‡ºç‰ˆæœ¬v2.0<br>git checkout -b devel origin&#x2F;develop                      # ä»è¿œç¨‹åˆ†æ”¯developåˆ›å»ºæ–°æœ¬åœ°åˆ†æ”¯develå¹¶æ£€å‡º<br>git checkout â€“ README      # æ£€å‡ºheadç‰ˆæœ¬çš„READMEæ–‡ä»¶ï¼ˆå¯ç”¨äºä¿®æ”¹é”™è¯¯å›é€€ï¼‰<br>git merge origin&#x2F;master                     # åˆå¹¶è¿œç¨‹masteråˆ†æ”¯è‡³å½“å‰åˆ†æ”¯<br>git cherry-pick ff44785404a8e               # åˆå¹¶æäº¤ff44785404a8eçš„ä¿®æ”¹<br>git push origin master                      # å°†å½“å‰åˆ†æ”¯pushåˆ°è¿œç¨‹masteråˆ†æ”¯<br>git push origin :hotfixes&#x2F;BJVEP933      # åˆ é™¤è¿œç¨‹ä»“åº“çš„hotfixes&#x2F;BJVEP933åˆ†æ”¯<br>git push â€“tags                             # æŠŠæ‰€æœ‰tagæ¨é€åˆ°è¿œç¨‹ä»“åº“<br>git fetch                   # è·å–æ‰€æœ‰è¿œç¨‹åˆ†æ”¯ï¼ˆä¸æ›´æ–°æœ¬åœ°åˆ†æ”¯ï¼Œå¦éœ€mergeï¼‰<br>git fetch â€“prune               # è·å–æ‰€æœ‰åŸåˆ›åˆ†æ”¯å¹¶æ¸…é™¤æœåŠ¡å™¨ä¸Šå·²åˆ æ‰çš„åˆ†æ”¯<br>git pull origin master              # è·å–è¿œç¨‹åˆ†æ”¯masterå¹¶mergeåˆ°å½“å‰åˆ†æ”¯<br>git mv README README2                       # é‡å‘½åæ–‡ä»¶READMEä¸ºREADME2<br>git reset â€“hard HEAD       # å°†å½“å‰ç‰ˆæœ¬é‡ç½®ä¸ºHEADï¼ˆé€šå¸¸ç”¨äºmergeå¤±è´¥å›é€€ï¼‰<br>git rebase<br>git branch -d hotfixes&#x2F;BJVEP933     # åˆ é™¤åˆ†æ”¯hotfixes&#x2F;BJVEP933ï¼ˆæœ¬åˆ†æ”¯ä¿®æ”¹å·²åˆå¹¶åˆ°å…¶ä»–åˆ†æ”¯ï¼‰<br>git branch -D hotfixes&#x2F;BJVEP933         # å¼ºåˆ¶åˆ é™¤åˆ†æ”¯hotfixes&#x2F;BJVEP933<br>git ls-files                                # åˆ—å‡ºgit indexåŒ…å«çš„æ–‡ä»¶<br>git show-branch                                 # å›¾ç¤ºå½“å‰åˆ†æ”¯å†å²<br>git show-branch â€“all                           # å›¾ç¤ºæ‰€æœ‰åˆ†æ”¯å†å²<br>git whatchanged                             # æ˜¾ç¤ºæäº¤å†å²å¯¹åº”çš„æ–‡ä»¶ä¿®æ”¹<br>git revert dfb02e6e4f2f7b573337763e5c0013802e392818       # æ’¤é”€æäº¤dfb02e6e4f2f7b573337763e5c0013802e392818<br>git ls-tree HEAD                            # å†…éƒ¨å‘½ä»¤ï¼šæ˜¾ç¤ºæŸä¸ªgitå¯¹è±¡<br>git rev-parse v2.0                  # å†…éƒ¨å‘½ä»¤ï¼šæ˜¾ç¤ºæŸä¸ªrefå¯¹äºçš„SHA1 HASH<br>git reflog                                  # æ˜¾ç¤ºæ‰€æœ‰æäº¤ï¼ŒåŒ…æ‹¬å­¤ç«‹èŠ‚ç‚¹<br>git show HEAD@{5}<br>git show master@{yesterday}                 # æ˜¾ç¤ºmasteråˆ†æ”¯æ˜¨å¤©çš„çŠ¶æ€<br>git log â€“pretty&#x3D;format:â€™%h %sâ€™ â€“graph         # å›¾ç¤ºæäº¤æ—¥å¿—<br>git show HEAD~3<br>git show -s â€“pretty&#x3D;raw 2be7fcb476<br>git stash                                   # æš‚å­˜å½“å‰ä¿®æ”¹ï¼Œå°†æ‰€æœ‰è‡³ä¸ºHEADçŠ¶æ€<br>git stash list                                            # æŸ¥çœ‹æ‰€æœ‰æš‚å­˜<br>git stash show -p stash@{0}                               # å‚è€ƒç¬¬ä¸€æ¬¡æš‚å­˜<br>git stash apply stash@{0}                                 # åº”ç”¨ç¬¬ä¸€æ¬¡æš‚å­˜<br>git grep â€œdelete fromâ€                      # æ–‡ä»¶ä¸­æœç´¢æ–‡æœ¬â€œdelete fromâ€<br>git grep -e â€˜#defineâ€™ â€“and -e SORT_DIRENT<br>git gc<br>git fsck</p><p>æ›´å¤šâ€¦.</p><p>Gitå¸¸ç”¨æ“ä½œå‘½ä»¤ï¼š<br>1) è¿œç¨‹ä»“åº“ç›¸å…³å‘½ä»¤<br>æ£€å‡ºä»“åº“ï¼š$ git clone git:&#x2F;&#x2F;github.com&#x2F;jquery&#x2F;jquery.git<br>æŸ¥çœ‹è¿œç¨‹ä»“åº“ï¼š$ git remote -v<br>æ·»åŠ è¿œç¨‹ä»“åº“ï¼š$ git remote add [name] [url]<br>åˆ é™¤è¿œç¨‹ä»“åº“ï¼š$ git remote rm [name]<br>ä¿®æ”¹è¿œç¨‹ä»“åº“ï¼š$ git remote set-url â€“push [name] [newUrl]<br>æ‹‰å–è¿œç¨‹ä»“åº“ï¼š$ git pull [remoteName] [localBranchName]<br>æ¨é€è¿œç¨‹ä»“åº“ï¼š$ git push [remoteName] [localBranchName]</p><p>*å¦‚æœæƒ³æŠŠæœ¬åœ°çš„æŸä¸ªåˆ†æ”¯testæäº¤åˆ°è¿œç¨‹ä»“åº“ï¼Œå¹¶ä½œä¸ºè¿œç¨‹ä»“åº“çš„masteråˆ†æ”¯ï¼Œæˆ–è€…ä½œä¸ºå¦å¤–ä¸€ä¸ªåå«testçš„åˆ†æ”¯ï¼Œå¦‚ä¸‹ï¼š<br>$git push origin test:master         &#x2F;&#x2F; æäº¤æœ¬åœ°teståˆ†æ”¯ä½œä¸ºè¿œç¨‹çš„masteråˆ†æ”¯<br>$git push origin test:test              &#x2F;&#x2F; æäº¤æœ¬åœ°teståˆ†æ”¯ä½œä¸ºè¿œç¨‹çš„teståˆ†æ”¯</p><p>2ï¼‰åˆ†æ”¯(branch)æ“ä½œç›¸å…³å‘½ä»¤<br>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ï¼š$ git branch<br>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ï¼š$ git branch -r<br>åˆ›å»ºæœ¬åœ°åˆ†æ”¯ï¼š$ git branch [name] â€”-æ³¨æ„æ–°åˆ†æ”¯åˆ›å»ºåä¸ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºå½“å‰åˆ†æ”¯<br>åˆ‡æ¢åˆ†æ”¯ï¼š$ git checkout [name]<br>åˆ›å»ºæ–°åˆ†æ”¯å¹¶ç«‹å³åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ï¼š$ git checkout -b [name]<br>åˆ é™¤åˆ†æ”¯ï¼š$ git branch -d [name] â€”- -dé€‰é¡¹åªèƒ½åˆ é™¤å·²ç»å‚ä¸äº†åˆå¹¶çš„åˆ†æ”¯ï¼Œå¯¹äºæœªæœ‰åˆå¹¶çš„åˆ†æ”¯æ˜¯æ— æ³•åˆ é™¤çš„ã€‚å¦‚æœæƒ³å¼ºåˆ¶åˆ é™¤ä¸€ä¸ªåˆ†æ”¯ï¼Œå¯ä»¥ä½¿ç”¨-Dé€‰é¡¹<br>åˆå¹¶åˆ†æ”¯ï¼š$ git merge [name] â€”-å°†åç§°ä¸º[name]çš„åˆ†æ”¯ä¸å½“å‰åˆ†æ”¯åˆå¹¶<br>åˆ›å»ºè¿œç¨‹åˆ†æ”¯(æœ¬åœ°åˆ†æ”¯pushåˆ°è¿œç¨‹)ï¼š$ git push origin [name]<br>åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š$ git push origin :heads&#x2F;[name] æˆ– $ gitpush origin :[name] </p><p>*åˆ›å»ºç©ºçš„åˆ†æ”¯ï¼š(æ‰§è¡Œå‘½ä»¤ä¹‹å‰è®°å¾—å…ˆæäº¤ä½ å½“å‰åˆ†æ”¯çš„ä¿®æ”¹ï¼Œå¦åˆ™ä¼šè¢«å¼ºåˆ¶åˆ å¹²å‡€æ²¡å¾—åæ‚”)<br>$git symbolic-ref HEAD refs&#x2F;heads&#x2F;[name]<br>$rm .git&#x2F;index<br>$git clean -fdx</p><p>3ï¼‰ç‰ˆæœ¬(tag)æ“ä½œç›¸å…³å‘½ä»¤<br>æŸ¥çœ‹ç‰ˆæœ¬ï¼š$ git tag<br>åˆ›å»ºç‰ˆæœ¬ï¼š$ git tag [name]<br>åˆ é™¤ç‰ˆæœ¬ï¼š$ git tag -d [name]<br>æŸ¥çœ‹è¿œç¨‹ç‰ˆæœ¬ï¼š$ git tag -r<br>åˆ›å»ºè¿œç¨‹ç‰ˆæœ¬(æœ¬åœ°ç‰ˆæœ¬pushåˆ°è¿œç¨‹)ï¼š$ git push origin [name]<br>åˆ é™¤è¿œç¨‹ç‰ˆæœ¬ï¼š$ git push origin :refs&#x2F;tags&#x2F;[name]<br>åˆå¹¶è¿œç¨‹ä»“åº“çš„tagåˆ°æœ¬åœ°ï¼š$ git pull origin â€“tags<br>ä¸Šä¼ æœ¬åœ°tagåˆ°è¿œç¨‹ä»“åº“ï¼š$ git push origin â€“tags<br>åˆ›å»ºå¸¦æ³¨é‡Šçš„tagï¼š$ git tag -a [name] -m â€˜yourMessageâ€™</p><p>4) å­æ¨¡å—(submodule)ç›¸å…³æ“ä½œå‘½ä»¤<br>æ·»åŠ å­æ¨¡å—ï¼š$ git submodule add [url] [path]<br>   å¦‚ï¼š$git submodule add git:&#x2F;&#x2F;github.com&#x2F;soberh&#x2F;ui-libs.git src&#x2F;main&#x2F;webapp&#x2F;ui-libs<br>åˆå§‹åŒ–å­æ¨¡å—ï¼š$ git submodule init  â€”-åªåœ¨é¦–æ¬¡æ£€å‡ºä»“åº“æ—¶è¿è¡Œä¸€æ¬¡å°±è¡Œ<br>æ›´æ–°å­æ¨¡å—ï¼š$ git submodule update â€”-æ¯æ¬¡æ›´æ–°æˆ–åˆ‡æ¢åˆ†æ”¯åéƒ½éœ€è¦è¿è¡Œä¸€ä¸‹<br>åˆ é™¤å­æ¨¡å—ï¼šï¼ˆåˆ†4æ­¥èµ°å“¦ï¼‰<br> 1) $ git rm â€“cached [path]<br> 2) ç¼–è¾‘â€œ.gitmodulesâ€æ–‡ä»¶ï¼Œå°†å­æ¨¡å—çš„ç›¸å…³é…ç½®èŠ‚ç‚¹åˆ é™¤æ‰<br> 3) ç¼–è¾‘â€œ .git&#x2F;configâ€æ–‡ä»¶ï¼Œå°†å­æ¨¡å—çš„ç›¸å…³é…ç½®èŠ‚ç‚¹åˆ é™¤æ‰<br> 4) æ‰‹åŠ¨åˆ é™¤å­æ¨¡å—æ®‹ç•™çš„ç›®å½•</p><p>5ï¼‰å¿½ç•¥ä¸€äº›æ–‡ä»¶ã€æ–‡ä»¶å¤¹ä¸æäº¤<br>åœ¨ä»“åº“æ ¹ç›®å½•ä¸‹åˆ›å»ºåç§°ä¸ºâ€œ.gitignoreâ€çš„æ–‡ä»¶ï¼Œå†™å…¥ä¸éœ€è¦çš„æ–‡ä»¶å¤¹åæˆ–æ–‡ä»¶ï¼Œæ¯ä¸ªå…ƒç´ å ä¸€è¡Œå³å¯ï¼Œå¦‚<br>target<br>bin<br>*.db</p>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github linux git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>websocket ä¸ socket éé˜»å¡é€šä¿¡</title>
    <link href="/2020/06/12/websocket%20%E4%B8%8E%20socket%20%E9%9D%9E%E9%98%BB%E5%A1%9E%E9%80%9A%E4%BF%A1/"/>
    <url>/2020/06/12/websocket%20%E4%B8%8E%20socket%20%E9%9D%9E%E9%98%BB%E5%A1%9E%E9%80%9A%E4%BF%A1/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p>Â è®°å½•ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> select<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> threading<br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><span class="hljs-keyword">from</span> flask_sockets <span class="hljs-keyword">import</span> Sockets<br><span class="hljs-keyword">from</span> gevent <span class="hljs-keyword">import</span> pywsgi<br><span class="hljs-keyword">from</span> geventwebsocket.handler <span class="hljs-keyword">import</span> WebSocketHandler<br><br><br>app = Flask(__name__)<br>sockets = Sockets(app)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    SOCKET_HOST = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span><br>    SOCKET_PORT = <span class="hljs-number">2020</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_thread_method</span>(<span class="hljs-params">sock,socket_lock,ws</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> sock:  <span class="hljs-comment"># å¦‚æœsocketå…³é—­ï¼Œé€€å‡º</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-comment"># ä½¿ç”¨selectç›‘å¬å®¢æˆ·ç«¯ï¼ˆè¿™é‡Œå®¢æˆ·ç«¯éœ€è¦ä¸åœæ¥æ”¶æœåŠ¡ç«¯çš„æ•°æ®ï¼Œæ‰€ä»¥ç›‘å¬å®¢æˆ·ç«¯ï¼‰</span><br>        <span class="hljs-comment"># ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦ç›‘å¬è¯»äº‹ä»¶åˆ—è¡¨ï¼Œå› ä¸ºæ˜¯å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬åªç›‘å¬åˆ›å»ºçš„ä¸€ä¸ªsocketå°±ok</span><br>        <span class="hljs-comment"># ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦ç›‘å¬å†™äº‹ä»¶åˆ—è¡¨ï¼Œ</span><br>        <span class="hljs-comment"># ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¦ç›‘å¬å¼‚å¸¸äº‹ä»¶åˆ—è¡¨ï¼Œ</span><br>        <span class="hljs-comment"># æœ€åä¸€ä¸ªå‚æ•°æ˜¯ç›‘å¬è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ°¸ä¸è¶…æ—¶ã€‚å¦‚æœè®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œè¿‡äº†è¶…æ—¶æ—¶é—´çº¿ç¨‹å°±ä¸ä¼šé˜»å¡åœ¨selectæ–¹æ³•ä¸Šï¼Œä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ</span><br>        <span class="hljs-comment"># è¿”å›å‚æ•° åˆ†åˆ«å¯¹åº”ç›‘å¬åˆ°çš„è¯»äº‹ä»¶åˆ—è¡¨ï¼Œå†™äº‹ä»¶åˆ—è¡¨ï¼Œå¼‚å¸¸äº‹ä»¶åˆ—è¡¨</span><br>        rs, _, _ = select.select([sock], [], [], <span class="hljs-number">10</span>)<br>        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> rs:  <span class="hljs-comment"># æˆ‘ä»¬è¿™é‡Œåªç›‘å¬è¯»äº‹ä»¶ï¼Œæ‰€ä»¥åªç®¡è¯»çš„è¿”å›å¥æŸ„æ•°ç»„</span><br>            socket_lock.acquire()  <span class="hljs-comment"># åœ¨è¯»å–ä¹‹å‰å…ˆåŠ é”ï¼Œé”å®šsocketå¯¹è±¡ï¼ˆsockæ˜¯ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„å…±äº«èµ„æºï¼Œé”å®šäº†sockå°±èƒ½ä¿è¯å­çº¿ç¨‹åœ¨ä½¿ç”¨sockæ—¶ï¼Œä¸»çº¿ç¨‹æ— æ³•å¯¹sockè¿›è¡Œæ“ä½œï¼‰</span><br><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> sock:  <span class="hljs-comment"># è¿™é‡Œéœ€è¦åˆ¤æ–­ä¸‹ï¼Œå› ä¸ºæœ‰å¯èƒ½åœ¨selectååˆ°åŠ é”ä¹‹é—´socketè¢«å…³é—­äº†</span><br>                socket_lock.release()<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">try</span>:<br>                data = r.recv(<span class="hljs-number">1024</span>)  <span class="hljs-comment"># è¯»æ•°æ®ï¼ŒæŒ‰è‡ªå·±çš„æ–¹å¼è¯»</span><br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                data = <span class="hljs-literal">None</span><br><br>            socket_lock.release()  <span class="hljs-comment"># è¯»å–å®Œæˆä¹‹åè§£é”ï¼Œé‡Šæ”¾èµ„æº</span><br><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;server close&#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(data)<br>                ws.send(data.decode())<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">start_client</span>(<span class="hljs-params">ws</span>):<br><br>    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>    sock.connect((Config.SOCKET_HOST, Config.SOCKET_PORT))<br>    <span class="hljs-comment"># åˆ›å»ºçº¿ç¨‹é”ï¼Œé˜²æ­¢ä¸»çº¿ç¨‹socketè¢«closeäº†ï¼Œå­çº¿ç¨‹è¿˜åœ¨recvè€Œå¼•å‘çš„å¼‚å¸¸</span><br>    socket_lock = threading.Lock()<br><br>    <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»è¯»å–æ•°æ®</span><br>    read_thread = threading.Thread(target=read_thread_method, args=(sock,socket_lock,ws))<br>    read_thread.setDaemon(<span class="hljs-literal">True</span>)<br>    read_thread.start()<br><br><br>    <span class="hljs-keyword">return</span> sock,socket_lock,read_thread<br><br>    <span class="hljs-comment"># # æµ‹è¯•ä¸æ–­å†™æ•°æ®</span><br>    <span class="hljs-comment"># for x in range(5):</span><br>    <span class="hljs-comment">#     print(x)</span><br>    <span class="hljs-comment">#     sock.send(str(x).encode())</span><br>    <span class="hljs-comment">#     sleep(1)  # äº¤å‡ºCPUæ—¶é—´ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹åªèƒ½çœ‹ç€</span><br><br>    <span class="hljs-comment"># æ¸…ç†socketï¼ŒåŒæ ·é“ç†ï¼Œè¿™é‡Œéœ€è¦é”å®šå’Œè§£é”</span><br>    <span class="hljs-comment"># socket_lock.acquire()</span><br>    <span class="hljs-comment"># sock.close()</span><br>    <span class="hljs-comment"># socket_lock.release()</span><br><br><br><span class="hljs-comment"># socket è·¯ç”±</span><br><span class="hljs-meta">@sockets.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">echo_socket</span>(<span class="hljs-params">ws</span>):<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å½“å‰/:&#x27;</span>, ws)<br>    sock,socket_lock,read_thread = start_client(ws)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¿æ¥äº†poll&quot;</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> ws.closed:<br><br><br>        message = ws.receive()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n message:&quot;</span>,message,<span class="hljs-built_in">type</span>(message))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ws.closed:&quot;</span>, ws.closed)<br>        <span class="hljs-comment"># print(&quot;çº¿ç¨‹id=&#123;&#125;,\nçº¿ç¨‹åç§°=&#123;&#125;,\næ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹åˆ—è¡¨:&#123;&#125;,\næ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡=&#123;&#125;,\nå½“å‰æ¿€æ´»çº¿ç¨‹=&#123;&#125;&quot;.format(</span><br>        <span class="hljs-comment">#     read_thread.ident, read_thread.getName(), threading.enumerate(), threading.active_count(),</span><br>        <span class="hljs-comment">#     read_thread.isAlive)</span><br>        <span class="hljs-comment"># )</span><br>        <span class="hljs-keyword">if</span> message:<br>            ws.send(<span class="hljs-string">&quot;callback&quot;</span>)<br>            sock.send(message.encode())<br>        <span class="hljs-keyword">if</span> ws.closed:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å…³é—­äº† sock &quot;</span><br>            socket_lock.acquire()<br>            sock.close()<br>            socket_lock.release()<br><br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br><br>    <span class="hljs-keyword">try</span>:<br>        server = pywsgi.WSGIServer((<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-number">2021</span>), application=app, handler_class=WebSocketHandler)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;websocket server start ... &quot;</span>)<br>        server.serve_forever()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;error:&#x27;</span>,e)<br><br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>socket python epoll</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¸¸è§å‡ ç§åŠ å¯†ç®—æ³•çš„Pythonå®ç°</title>
    <link href="/2020/05/29/%E5%B8%B8%E8%A7%81%E5%87%A0%E7%A7%8D%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E7%9A%84Python%E5%AE%9E%E7%8E%B0/"/>
    <url>/2020/05/29/%E5%B8%B8%E8%A7%81%E5%87%A0%E7%A7%8D%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E7%9A%84Python%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p>ç”Ÿæ´»ä¸­æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›åŠ å¯†ç®—æ³•ï¼Œä»Šå¤©æˆ‘ä»¬å°±èŠèŠè¿™äº›åŠ å¯†ç®—æ³•çš„Pythonå®ç°ã€‚éƒ¨åˆ†å¸¸ç”¨çš„åŠ å¯†æ–¹æ³•åŸºæœ¬éƒ½æœ‰å¯¹åº”çš„Pythonåº“ï¼ŒåŸºæœ¬ä¸å†éœ€è¦æˆ‘ä»¬ç”¨ä»£ç å®ç°å…·ä½“ç®—æ³•ã€‚</p><p>Â </p><p><strong>ä¸€ã€MD5åŠ å¯†</strong></p><p>å…¨ç§°ï¼šMD5æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼ˆè‹±è¯­ï¼šMD5 Message-Digest Algorithmï¼‰ï¼Œä¸€ç§è¢«å¹¿æ³›ä½¿ç”¨çš„å¯†ç æ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥äº§ç”Ÿå‡ºä¸€ä¸ª128ä½ï¼ˆ16å­—èŠ‚ï¼‰çš„æ•£åˆ—å€¼ï¼ˆhash valueï¼‰ï¼Œç”¨äºç¡®ä¿ä¿¡æ¯ä¼ è¾“å®Œæ•´ä¸€è‡´ã€‚md5åŠ å¯†ç®—æ³•æ˜¯ä¸å¯é€†çš„ï¼Œæ‰€ä»¥è§£å¯†ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡æš´åŠ›ç©·ä¸¾æ–¹æ³•ï¼Œé€šè¿‡ç½‘ç«™çš„æ¥å£å®ç°è§£å¯†ã€‚</p><p><strong>Pythonä»£ç ï¼š</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">importÂ hashlib<br>mÂ =Â hashlib<span class="hljs-selector-class">.md5</span>()<br>m<span class="hljs-selector-class">.update</span>(str<span class="hljs-selector-class">.encode</span>(<span class="hljs-string">&quot;utf8&quot;</span>))<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(m.hexdigest()</span></span>)<br></code></pre></td></tr></table></figure><p>Â </p><p><strong>äºŒã€SHA1åŠ å¯†</strong></p><p>å…¨ç§°ï¼šå®‰å…¨å“ˆå¸Œç®—æ³•ï¼ˆSecure Hash Algorithmï¼‰ä¸»è¦é€‚ç”¨äºæ•°å­—ç­¾åæ ‡å‡†ï¼ˆDigital Signature Standard DSSï¼‰é‡Œé¢å®šä¹‰çš„æ•°å­—ç­¾åç®—æ³•ï¼ˆDigital Signature Algorithm DSAï¼‰ï¼ŒSHA1æ¯”MD5çš„å®‰å…¨æ€§æ›´å¼ºã€‚å¯¹äºé•¿åº¦å°äº2^ 64ä½çš„æ¶ˆæ¯ï¼ŒSHA1ä¼šäº§ç”Ÿä¸€ä¸ª160ä½çš„æ¶ˆæ¯æ‘˜è¦ã€‚</p><p><strong>Pythonä»£ç ï¼š</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import hashlib<br>sha1Â =Â hashlib<span class="hljs-selector-class">.sha1</span>()<br>dataÂ =Â <span class="hljs-string">&#x27;2333333&#x27;</span><br>sha1<span class="hljs-selector-class">.update</span>(data<span class="hljs-selector-class">.encode</span>(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>sha1_dataÂ =Â sha1<span class="hljs-selector-class">.hexdigest</span>()<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(sha1_data)</span></span><br></code></pre></td></tr></table></figure><p>Â </p><p><strong>ä¸‰ã€HMACåŠ å¯†</strong></p><p>å…¨ç§°ï¼šæ•£åˆ—æ¶ˆæ¯é‰´åˆ«ç ï¼ˆHash Message Authentication Codeï¼‰ï¼ŒÂ HMACåŠ å¯†ç®—æ³•æ˜¯ä¸€ç§å®‰å…¨çš„åŸºäºåŠ å¯†hashå‡½æ•°å’Œå…±äº«å¯†é’¥çš„æ¶ˆæ¯è®¤è¯åè®®ã€‚å®ç°åŸç†æ˜¯ç”¨å…¬å¼€å‡½æ•°å’Œå¯†é’¥äº§ç”Ÿä¸€ä¸ªå›ºå®šé•¿åº¦çš„å€¼ä½œä¸ºè®¤è¯æ ‡è¯†ï¼Œç”¨è¿™ä¸ªæ ‡è¯†é‰´åˆ«æ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚ä½¿ç”¨ä¸€ä¸ªå¯†é’¥ç”Ÿæˆä¸€ä¸ªå›ºå®šå¤§å°çš„å°æ•°æ®å—ï¼Œå³ MACï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°æ¶ˆæ¯ä¸­ï¼Œç„¶åä¼ è¾“ã€‚æ¥æ”¶æ–¹åˆ©ç”¨ä¸å‘é€æ–¹å…±äº«çš„å¯†é’¥è¿›è¡Œé‰´åˆ«è®¤è¯ç­‰ã€‚</p><p><strong>Pythonä»£ç ï¼š</strong></p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span>Â hmac<br><span class="hljs-keyword">import</span>Â hashlib<br><span class="hljs-meta">#Â ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯†é’¥keyï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¾…åŠ å¯†çš„å­—ç¬¦ä¸²ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯hashå‡½æ•°</span><br>macÂ =Â hmac.<span class="hljs-keyword">new</span><span class="hljs-type"></span>(<span class="hljs-string">&#x27;key&#x27;</span>,<span class="hljs-string">&#x27;hello&#x27;</span>,hashlib.md5)<br>mac.digest()Â Â <span class="hljs-meta">#Â å­—ç¬¦ä¸²çš„asciiæ ¼å¼</span><br>mac.hexdigest()Â Â <span class="hljs-meta">#Â åŠ å¯†åå­—ç¬¦ä¸²çš„åå…­è¿›åˆ¶æ ¼å¼</span><br></code></pre></td></tr></table></figure><p>Â </p><p><strong>å››ã€DESåŠ å¯†</strong></p><p>å…¨ç§°ï¼šæ•°æ®åŠ å¯†æ ‡å‡†ï¼ˆData Encryption Standardï¼‰ï¼Œå±äºå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚DESæ˜¯ä¸€ä¸ªåˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œå…¸å‹çš„DESä»¥64ä½ä¸ºåˆ†ç»„å¯¹æ•°æ®åŠ å¯†ï¼ŒåŠ å¯†å’Œè§£å¯†ç”¨çš„æ˜¯åŒä¸€ä¸ªç®—æ³•ã€‚å®ƒçš„å¯†é’¥é•¿åº¦æ˜¯56ä½ï¼ˆå› ä¸ºæ¯ä¸ªç¬¬8 ä½éƒ½ç”¨ä½œå¥‡å¶æ ¡éªŒï¼‰ï¼Œå¯†é’¥å¯ä»¥æ˜¯ä»»æ„çš„56ä½çš„æ•°ï¼Œè€Œä¸”å¯ä»¥ä»»æ„æ—¶å€™æ”¹å˜ã€‚</p><p><strong>Pythonä»£ç ï¼š</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs routeros">importÂ binascii<br><span class="hljs-keyword">from</span>Â pyDesÂ importÂ des,Â CBC,Â PAD_PKCS5<br><span class="hljs-comment">#Â éœ€è¦å®‰è£…Â pipÂ installÂ pyDes</span><br><br>defÂ des_encrypt(secret_key,Â s):<br>Â Â Â Â ivÂ =Â secret_key<br>Â Â Â Â kÂ =Â des(secret_key,Â CBC,Â iv,Â <span class="hljs-attribute">pad</span>=None,Â <span class="hljs-attribute">padmode</span>=PAD_PKCS5)<br>Â Â Â Â enÂ =Â k.encrypt(s,Â <span class="hljs-attribute">padmode</span>=PAD_PKCS5)<br>Â Â Â Â returnÂ binascii.b2a_hex(en)<br><br>defÂ des_decrypt(secret_key,Â s):<br>Â Â Â Â ivÂ =Â secret_key<br>Â Â Â Â kÂ =Â des(secret_key,Â CBC,Â iv,Â <span class="hljs-attribute">pad</span>=None,Â <span class="hljs-attribute">padmode</span>=PAD_PKCS5)<br>Â Â Â Â deÂ =Â k.decrypt(binascii.a2b_hex(s),Â <span class="hljs-attribute">padmode</span>=PAD_PKCS5)<br>Â Â Â Â returnÂ de<br><br>secret_strÂ =Â des_encrypt(<span class="hljs-string">&#x27;12345678&#x27;</span>,Â <span class="hljs-string">&#x27;IÂ loveÂ YOU~&#x27;</span>)<br><span class="hljs-built_in">print</span>(secret_str)<br>clear_strÂ =Â des_decrypt(<span class="hljs-string">&#x27;12345678&#x27;</span>,Â secret_str)<br><span class="hljs-built_in">print</span>(clear_str)<br></code></pre></td></tr></table></figure><p>Â </p><p><strong>äº”ã€AESåŠ å¯†</strong></p><p>å…¨ç§°ï¼šé«˜çº§åŠ å¯†æ ‡å‡†ï¼ˆè‹±è¯­ï¼šAdvanced Encryption Standardï¼‰ï¼Œåœ¨å¯†ç å­¦ä¸­åˆç§°RijndaelåŠ å¯†æ³•ï¼Œæ˜¯ç¾å›½è”é‚¦æ”¿åºœé‡‡ç”¨çš„ä¸€ç§åŒºå—åŠ å¯†æ ‡å‡†ã€‚è¿™ä¸ªæ ‡å‡†ç”¨æ¥æ›¿ä»£åŸå…ˆçš„DESï¼Œå·²ç»è¢«å¤šæ–¹åˆ†æä¸”å¹¿ä¸ºå…¨ä¸–ç•Œæ‰€ä½¿ç”¨ã€‚</p><p><strong>Pythonä»£ç ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>Â base64<br><span class="hljs-keyword">from</span>Â Crypto.CipherÂ <span class="hljs-keyword">import</span>Â AES<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">AESå¯¹ç§°åŠ å¯†ç®—æ³•</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-comment">#Â éœ€è¦è¡¥ä½ï¼Œsträ¸æ˜¯16çš„å€æ•°é‚£å°±è¡¥è¶³ä¸º16çš„å€æ•°</span><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">add_to_16</span>(<span class="hljs-params">value</span>):<br>Â Â Â Â <span class="hljs-keyword">while</span>Â <span class="hljs-built_in">len</span>(value)Â %Â <span class="hljs-number">16</span>Â !=Â <span class="hljs-number">0</span>:<br>Â Â Â Â Â Â Â Â valueÂ +=Â <span class="hljs-string">&#x27;\0&#x27;</span><br>Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-built_in">str</span>.encode(value)Â Â <span class="hljs-comment">#Â è¿”å›bytes</span><br><span class="hljs-comment">#Â åŠ å¯†æ–¹æ³•</span><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">key,Â text</span>):<br>Â Â Â Â aesÂ =Â AES.new(add_to_16(key),Â AES.MODE_ECB)Â Â <span class="hljs-comment">#Â åˆå§‹åŒ–åŠ å¯†å™¨</span><br>Â Â Â Â encrypt_aesÂ =Â aes.encrypt(add_to_16(text))Â Â <span class="hljs-comment">#Â å…ˆè¿›è¡ŒaesåŠ å¯†</span><br>Â Â Â Â encrypted_textÂ =Â <span class="hljs-built_in">str</span>(base64.encodebytes(encrypt_aes),Â encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)Â Â <span class="hljs-comment">#Â æ‰§è¡ŒåŠ å¯†å¹¶è½¬ç è¿”å›bytes</span><br>Â Â Â Â <span class="hljs-keyword">return</span>Â encrypted_text<br><span class="hljs-comment">#Â è§£å¯†æ–¹æ³•</span><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">key,Â text</span>):<br>Â Â Â Â aesÂ =Â AES.new(add_to_16(key),Â AES.MODE_ECB)Â Â <span class="hljs-comment">#Â åˆå§‹åŒ–åŠ å¯†å™¨</span><br>Â Â Â Â base64_decryptedÂ =Â base64.decodebytes(text.encode(encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>))Â Â <span class="hljs-comment">#Â ä¼˜å…ˆé€†å‘è§£å¯†base64æˆbytes</span><br>Â Â Â Â decrypted_textÂ =Â <span class="hljs-built_in">str</span>(aes.decrypt(base64_decrypted),Â encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>).replace(<span class="hljs-string">&#x27;\0&#x27;</span>,Â <span class="hljs-string">&#x27;&#x27;</span>)Â Â <span class="hljs-comment">#Â æ‰§è¡Œè§£å¯†å¯†å¹¶è½¬ç è¿”å›str</span><br>Â Â Â Â <span class="hljs-keyword">return</span>Â decrypted_text<br></code></pre></td></tr></table></figure><p>Â </p><p><strong>å…­ã€RSAåŠ å¯†</strong></p><p>å…¨ç§°ï¼šRivest-Shamir-Adlemanï¼ŒRSAåŠ å¯†ç®—æ³•æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚åœ¨å…¬å¼€å¯†é’¥åŠ å¯†å’Œç”µå­å•†ä¸šä¸­RSAè¢«å¹¿æ³›ä½¿ç”¨ã€‚å®ƒè¢«æ™®éè®¤ä¸ºæ˜¯ç›®å‰æœ€ä¼˜ç§€çš„å…¬é’¥æ–¹æ¡ˆä¹‹ä¸€ã€‚RSAæ˜¯ç¬¬ä¸€ä¸ªèƒ½åŒæ—¶ç”¨äºåŠ å¯†å’Œæ•°å­—ç­¾åçš„ç®—æ³•ï¼Œå®ƒèƒ½å¤ŸæŠµæŠ—åˆ°ç›®å‰ä¸ºæ­¢å·²çŸ¥çš„æ‰€æœ‰å¯†ç æ”»å‡»ã€‚</p><p><strong>Pythonä»£ç ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Â -*-Â coding:Â UTF-8Â -*-</span><br><span class="hljs-comment">#Â referenceÂ codes:Â https://www.jianshu.com/p/7a4645691c68</span><br><br><span class="hljs-keyword">import</span>Â base64<br><span class="hljs-keyword">import</span>Â rsa<br><span class="hljs-keyword">from</span>Â rsaÂ <span class="hljs-keyword">import</span>Â common<br><br><span class="hljs-comment">#Â ä½¿ç”¨Â rsaåº“è¿›è¡ŒRSAç­¾åå’ŒåŠ è§£å¯†</span><br><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">RsaUtil</span>(<span class="hljs-title class_ inherited__">object</span>):<br>Â Â Â Â PUBLIC_KEY_PATHÂ =Â <span class="hljs-string">&#x27;xxxxpublic_key.pem&#x27;</span>Â Â <span class="hljs-comment">#Â å…¬é’¥</span><br>Â Â Â Â PRIVATE_KEY_PATHÂ =Â <span class="hljs-string">&#x27;xxxxxprivate_key.pem&#x27;</span>Â Â <span class="hljs-comment">#Â ç§é’¥</span><br><br>Â Â Â Â <span class="hljs-comment">#Â åˆå§‹åŒ–key</span><br>Â Â Â Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,</span><br><span class="hljs-params">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â company_pub_file=PUBLIC_KEY_PATH,</span><br><span class="hljs-params">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â company_pri_file=PRIVATE_KEY_PATH</span>):<br><br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â company_pub_file:<br>Â Â Â Â Â Â Â Â Â Â Â Â self.company_public_keyÂ =Â rsa.PublicKey.load_pkcs1_openssl_pem(<span class="hljs-built_in">open</span>(company_pub_file).read())<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â company_pri_file:<br>Â Â Â Â Â Â Â Â Â Â Â Â self.company_private_keyÂ =Â rsa.PrivateKey.load_pkcs1(<span class="hljs-built_in">open</span>(company_pri_file).read())<br><br>Â Â Â Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">get_max_length</span>(<span class="hljs-params">self,Â rsa_key,Â encrypt=<span class="hljs-literal">True</span></span>):<br>Â Â Â Â Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;åŠ å¯†å†…å®¹è¿‡é•¿æ—¶Â éœ€è¦åˆ†æ®µåŠ å¯†Â æ¢ç®—æ¯ä¸€æ®µçš„é•¿åº¦.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â :paramÂ rsa_key:Â é’¥åŒ™.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â :paramÂ encrypt:Â æ˜¯å¦æ˜¯åŠ å¯†.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â Â Â Â Â blocksizeÂ =Â common.byte_size(rsa_key.n)<br>Â Â Â Â Â Â Â Â reserve_sizeÂ =Â <span class="hljs-number">11</span>Â Â <span class="hljs-comment">#Â é¢„ç•™ä½ä¸º11</span><br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â <span class="hljs-keyword">not</span>Â encrypt:Â Â <span class="hljs-comment">#Â è§£å¯†æ—¶ä¸éœ€è¦è€ƒè™‘é¢„ç•™ä½</span><br>Â Â Â Â Â Â Â Â Â Â Â Â reserve_sizeÂ =Â <span class="hljs-number">0</span><br>Â Â Â Â Â Â Â Â maxlengthÂ =Â blocksizeÂ -Â reserve_size<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â maxlength<br><br>Â Â Â Â <span class="hljs-comment">#Â åŠ å¯†Â æ”¯ä»˜æ–¹å…¬é’¥</span><br>Â Â Â Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">encrypt_by_public_key</span>(<span class="hljs-params">self,Â message</span>):<br>Â Â Â Â Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;ä½¿ç”¨å…¬é’¥åŠ å¯†.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â :paramÂ message:Â éœ€è¦åŠ å¯†çš„å†…å®¹.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â åŠ å¯†ä¹‹åéœ€è¦å¯¹æ¥è¿‡è¿›è¡Œbase64è½¬ç </span><br><span class="hljs-string">Â Â Â Â Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â Â Â Â Â encrypt_resultÂ =Â <span class="hljs-string">b&#x27;&#x27;</span><br>Â Â Â Â Â Â Â Â max_lengthÂ =Â self.get_max_length(self.company_public_key)<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">while</span>Â message:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">input</span>Â =Â message[:max_length]<br>Â Â Â Â Â Â Â Â Â Â Â Â messageÂ =Â message[max_length:]<br>Â Â Â Â Â Â Â Â Â Â Â Â outÂ =Â rsa.encrypt(<span class="hljs-built_in">input</span>,Â self.company_public_key)<br>Â Â Â Â Â Â Â Â Â Â Â Â encrypt_resultÂ +=Â out<br>Â Â Â Â Â Â Â Â encrypt_resultÂ =Â base64.b64encode(encrypt_result)<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â encrypt_result<br><br>Â Â Â Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">decrypt_by_private_key</span>(<span class="hljs-params">self,Â message</span>):<br>Â Â Â Â Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;ä½¿ç”¨ç§é’¥è§£å¯†.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â :paramÂ message:Â éœ€è¦åŠ å¯†çš„å†…å®¹.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â è§£å¯†ä¹‹åçš„å†…å®¹ç›´æ¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¸éœ€è¦åœ¨è¿›è¡Œè½¬ä¹‰</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â Â Â Â Â decrypt_resultÂ =Â <span class="hljs-string">b&quot;&quot;</span><br><br>Â Â Â Â Â Â Â Â max_lengthÂ =Â self.get_max_length(self.company_private_key,Â <span class="hljs-literal">False</span>)<br>Â Â Â Â Â Â Â Â decrypt_messageÂ =Â base64.b64decode(message)<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">while</span>Â decrypt_message:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">input</span>Â =Â decrypt_message[:max_length]<br>Â Â Â Â Â Â Â Â Â Â Â Â decrypt_messageÂ =Â decrypt_message[max_length:]<br>Â Â Â Â Â Â Â Â Â Â Â Â outÂ =Â rsa.decrypt(<span class="hljs-built_in">input</span>,Â self.company_private_key)<br>Â Â Â Â Â Â Â Â Â Â Â Â decrypt_resultÂ +=Â out<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â decrypt_result<br><br>Â Â Â Â <span class="hljs-comment">#Â ç­¾åÂ å•†æˆ·ç§é’¥Â base64è½¬ç </span><br>Â Â Â Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">sign_by_private_key</span>(<span class="hljs-params">self,Â data</span>):<br>Â Â Â Â Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;ç§é’¥ç­¾å.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â :paramÂ data:Â éœ€è¦ç­¾åçš„å†…å®¹.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â ä½¿ç”¨SHA-1Â æ–¹æ³•è¿›è¡Œç­¾åï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨MD5ï¼‰</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â ç­¾åä¹‹åï¼Œéœ€è¦è½¬ä¹‰åè¾“å‡º</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â Â Â Â Â signatureÂ =Â rsa.sign(<span class="hljs-built_in">str</span>(data),Â priv_key=self.company_private_key,Â <span class="hljs-built_in">hash</span>=<span class="hljs-string">&#x27;SHA-1&#x27;</span>)<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â base64.b64encode(signature)<br><br>Â Â Â Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">verify_by_public_key</span>(<span class="hljs-params">self,Â message,Â signature</span>):<br>Â Â Â Â Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;å…¬é’¥éªŒç­¾.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â :paramÂ message:Â éªŒç­¾çš„å†…å®¹.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â Â Â Â Â :paramÂ signature:Â å¯¹éªŒç­¾å†…å®¹ç­¾åçš„å€¼ï¼ˆç­¾åä¹‹åï¼Œä¼šè¿›è¡Œb64encodeè½¬ç ï¼Œæ‰€ä»¥éªŒç­¾å‰ä¹Ÿéœ€è½¬ç ï¼‰.</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â Â Â Â Â signatureÂ =Â base64.b64decode(signature)<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â rsa.verify(message,Â signature,Â self.company_public_key)<br></code></pre></td></tr></table></figure><p>Â </p><p><strong>ä¸ƒã€ECCåŠ å¯†</strong></p><p>å…¨ç§°ï¼šæ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆElliptic Curve Cryptographyï¼‰ï¼ŒECCåŠ å¯†ç®—æ³•æ˜¯ä¸€ç§å…¬é’¥åŠ å¯†æŠ€æœ¯ï¼Œä»¥æ¤­åœ†æ›²çº¿ç†è®ºä¸ºåŸºç¡€ã€‚åˆ©ç”¨æœ‰é™åŸŸä¸Šæ¤­åœ†æ›²çº¿çš„ç‚¹æ„æˆçš„Abelç¾¤ç¦»æ•£å¯¹æ•°éš¾è§£æ€§ï¼Œå®ç°åŠ å¯†ã€è§£å¯†å’Œæ•°å­—ç­¾åã€‚å°†æ¤­åœ†æ›²çº¿ä¸­çš„åŠ æ³•è¿ç®—ä¸ç¦»æ•£å¯¹æ•°ä¸­çš„æ¨¡ä¹˜è¿ç®—ç›¸å¯¹åº”ï¼Œå°±å¯ä»¥å»ºç«‹åŸºäºæ¤­åœ†æ›²çº¿çš„å¯¹åº”å¯†ç ä½“åˆ¶ã€‚</p><p><strong>Pythonä»£ç ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Â -*-Â coding:utf-8Â *-</span><br><span class="hljs-comment">#Â author:Â DYBOY</span><br><span class="hljs-comment">#Â referenceÂ codes:Â https://blog.dyboy.cn/websecurity/121.html</span><br><span class="hljs-comment">#Â description:Â ECCæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•å®ç°</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Â Â Â Â è€ƒè™‘K=kG ï¼Œå…¶ä¸­Kã€Gä¸ºæ¤­åœ†æ›²çº¿Ep(a,b)ä¸Šçš„ç‚¹ï¼Œnä¸ºGçš„é˜¶ï¼ˆnG=OâˆÂ ï¼‰ï¼Œkä¸ºå°äºnçš„æ•´æ•°ã€‚</span><br><span class="hljs-string">Â Â Â Â åˆ™ç»™å®škå’ŒGï¼Œæ ¹æ®åŠ æ³•æ³•åˆ™ï¼Œè®¡ç®—Kå¾ˆå®¹æ˜“ä½†åè¿‡æ¥ï¼Œç»™å®šKå’ŒGï¼Œæ±‚kå°±éå¸¸å›°éš¾ã€‚</span><br><span class="hljs-string">Â Â Â Â å› ä¸ºå®é™…ä½¿ç”¨ä¸­çš„ECCåŸåˆ™ä¸ŠæŠŠpå–å¾—ç›¸å½“å¤§ï¼Œnä¹Ÿç›¸å½“å¤§ï¼Œè¦æŠŠnä¸ªè§£ç‚¹é€ä¸€ç®—å‡ºæ¥åˆ—æˆä¸Šè¡¨æ˜¯ä¸å¯èƒ½çš„ã€‚</span><br><span class="hljs-string">Â Â Â Â è¿™å°±æ˜¯æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•çš„æ•°å­¦ä¾æ®</span><br><span class="hljs-string">Â Â Â Â ç‚¹Gç§°ä¸ºåŸºç‚¹ï¼ˆbaseÂ pointï¼‰</span><br><span class="hljs-string">Â Â Â Â kï¼ˆk&lt;nï¼‰ä¸ºç§æœ‰å¯†é’¥ï¼ˆprivteÂ keyï¼‰</span><br><span class="hljs-string">Â Â Â Â Kä¸ºå…¬å¼€å¯†é’¥ï¼ˆpublicÂ key)</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">get_inverse</span>(<span class="hljs-params">mu,Â p</span>):<br>Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Â Â Â Â è·å–yçš„è´Ÿå…ƒ</span><br><span class="hljs-string">Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â <span class="hljs-keyword">for</span>Â iÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,Â p):<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (i*mu)%pÂ ==Â <span class="hljs-number">1</span>:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â i<br>Â Â Â Â <span class="hljs-keyword">return</span>Â -<span class="hljs-number">1</span><br><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">get_gcd</span>(<span class="hljs-params">zi,Â mu</span>):<br>Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Â Â Â Â è·å–æœ€å¤§å…¬çº¦æ•°</span><br><span class="hljs-string">Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â <span class="hljs-keyword">if</span>Â mu:<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â get_gcd(mu,Â zi%mu)<br>Â Â Â Â <span class="hljs-keyword">else</span>:<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â zi<br><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">get_np</span>(<span class="hljs-params">x1,Â y1,Â x2,Â y2,Â a,Â p</span>):<br>Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Â Â Â Â è·å–n*pï¼Œæ¯æ¬¡+pï¼Œç›´åˆ°æ±‚è§£é˜¶æ•°np=-p</span><br><span class="hljs-string">Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â flagÂ =Â <span class="hljs-number">1</span>Â Â <span class="hljs-comment">#Â å®šä¹‰ç¬¦å·ä½ï¼ˆ+/-ï¼‰</span><br><br>Â Â Â Â <span class="hljs-comment">#Â å¦‚æœÂ p=qÂ Â k=(3x2+a)/2y1modÂ p</span><br>Â Â Â Â <span class="hljs-keyword">if</span>Â x1Â ==Â x2Â <span class="hljs-keyword">and</span>Â y1Â ==Â y2:<br>Â Â Â Â Â Â Â Â ziÂ =Â <span class="hljs-number">3</span>Â *Â (x1Â **Â <span class="hljs-number">2</span>)Â +Â aÂ Â <span class="hljs-comment">#Â è®¡ç®—åˆ†å­Â Â Â Â Â Â ã€æ±‚å¯¼ã€‘</span><br>Â Â Â Â Â Â Â Â muÂ =Â <span class="hljs-number">2</span>Â *Â y1Â Â Â Â <span class="hljs-comment">#Â è®¡ç®—åˆ†æ¯</span><br><br>Â Â Â Â <span class="hljs-comment">#Â è‹¥Pâ‰ Qï¼Œåˆ™k=(y2-y1)/(x2-x1)Â modÂ p</span><br>Â Â Â Â <span class="hljs-keyword">else</span>:<br>Â Â Â Â Â Â Â Â ziÂ =Â y2Â -Â y1<br>Â Â Â Â Â Â Â Â muÂ =Â x2Â -Â x1<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â zi*Â muÂ &lt;Â <span class="hljs-number">0</span>:<br>Â Â Â Â Â Â Â Â Â Â Â Â flagÂ =Â <span class="hljs-number">0</span>Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â ç¬¦å·0ä¸º-ï¼ˆè´Ÿæ•°ï¼‰</span><br>Â Â Â Â Â Â Â Â Â Â Â Â ziÂ =Â <span class="hljs-built_in">abs</span>(zi)<br>Â Â Â Â Â Â Â Â Â Â Â Â muÂ =Â <span class="hljs-built_in">abs</span>(mu)<br><br>Â Â Â Â <span class="hljs-comment">#Â å°†åˆ†å­å’Œåˆ†æ¯åŒ–ä¸ºæœ€ç®€</span><br>Â Â Â Â gcd_valueÂ =Â get_gcd(zi,Â mu)Â Â Â Â Â <span class="hljs-comment">#Â æœ€å¤§å…¬ç´„æ•¸</span><br>Â Â Â Â ziÂ =Â ziÂ //Â gcd_valueÂ Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ•´é™¤</span><br>Â Â Â Â muÂ =Â muÂ //Â gcd_value<br>Â Â Â Â <span class="hljs-comment">#Â æ±‚åˆ†æ¯çš„é€†å…ƒÂ Â é€†å…ƒï¼šÂ âˆ€a âˆˆG ï¼Œãƒ§bâˆˆG ä½¿å¾— ab = ba = e</span><br>Â Â Â Â <span class="hljs-comment">#Â P(x,y)çš„è´Ÿå…ƒæ˜¯Â (x,-yÂ modÂ p)=Â (x,p-y)Â ï¼Œæœ‰P+(-P)=Â Oâˆ</span><br>Â Â Â Â inverse_valueÂ =Â get_inverse(mu,Â p)<br>Â Â Â Â kÂ =Â (ziÂ *Â inverse_value)<br><br>Â Â Â Â <span class="hljs-keyword">if</span>Â flagÂ ==Â <span class="hljs-number">0</span>:Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ–œç‡è´Ÿæ•°Â flag==0</span><br>Â Â Â Â Â Â Â Â kÂ =Â -k<br>Â Â Â Â kÂ =Â kÂ %Â p<br>Â Â Â Â <span class="hljs-comment">#Â è®¡ç®—x3,y3Â P+Q</span><br>Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â x3â‰¡k2-x1-x2(modÂ p)</span><br><span class="hljs-string">Â Â Â Â Â Â Â Â y3â‰¡k(x1-x3)-y1(modÂ p)</span><br><span class="hljs-string">Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â x3Â =Â (kÂ **Â <span class="hljs-number">2</span>Â -Â x1Â -Â x2)Â %Â p<br>Â Â Â Â y3Â =Â (kÂ *Â (x1Â -Â x3)Â -Â y1)Â %Â p<br>Â Â Â Â <span class="hljs-keyword">return</span>Â x3,y3<br><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">get_rank</span>(<span class="hljs-params">x0,Â y0,Â a,Â b,Â p</span>):<br>Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Â Â Â Â è·å–æ¤­åœ†æ›²çº¿çš„é˜¶</span><br><span class="hljs-string">Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â x1Â =Â x0Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#-pçš„xåæ ‡</span><br>Â Â Â Â y1Â =Â (-<span class="hljs-number">1</span>*y0)%pÂ Â Â Â Â Â <span class="hljs-comment">#-pçš„yåæ ‡</span><br>Â Â Â Â tempXÂ =Â x0<br>Â Â Â Â tempYÂ =Â y0<br>Â Â Â Â nÂ =Â <span class="hljs-number">1</span><br>Â Â Â Â <span class="hljs-keyword">while</span>Â <span class="hljs-literal">True</span>:<br>Â Â Â Â Â Â Â Â nÂ +=Â <span class="hljs-number">1</span><br>Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ±‚p+qçš„å’Œï¼Œå¾—åˆ°n*pï¼Œç›´åˆ°æ±‚å‡ºé˜¶</span><br>Â Â Â Â Â Â Â Â p_x,p_yÂ =Â get_np(tempX,Â tempY,Â x0,Â y0,Â a,Â p)<br>Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â å¦‚æœÂ ==Â -p,é‚£ä¹ˆé˜¶æ•°+1ï¼Œè¿”å›</span><br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â p_xÂ ==Â x1Â <span class="hljs-keyword">and</span>Â p_yÂ ==Â y1:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â n+<span class="hljs-number">1</span><br>Â Â Â Â Â Â Â Â tempXÂ =Â p_x<br>Â Â Â Â Â Â Â Â tempYÂ =Â p_y<br><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">get_param</span>(<span class="hljs-params">x0,Â a,Â b,Â p</span>):<br>Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Â Â Â Â è®¡ç®—pä¸-p</span><br><span class="hljs-string">Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â y0Â =Â -<span class="hljs-number">1</span><br>Â Â Â Â <span class="hljs-keyword">for</span>Â iÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(p):<br>Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ»¡è¶³å–æ¨¡çº¦æŸæ¡ä»¶ï¼Œæ¤­åœ†æ›²çº¿Ep(a,b)ï¼Œpä¸ºè´¨æ•°ï¼Œx,yâˆˆ[0,p-1]</span><br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â i**<span class="hljs-number">2</span>%pÂ ==Â (x0**<span class="hljs-number">3</span>Â +Â a*x0Â +Â b)%p:<br>Â Â Â Â Â Â Â Â Â Â Â Â y0Â =Â i<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">break</span><br><br>Â Â Â Â <span class="hljs-comment">#Â å¦‚æœy0æ²¡æœ‰ï¼Œè¿”å›false</span><br>Â Â Â Â <span class="hljs-keyword">if</span>Â y0Â ==Â -<span class="hljs-number">1</span>:<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-literal">False</span><br><br>Â Â Â Â <span class="hljs-comment">#Â è®¡ç®—-yï¼ˆè´Ÿæ•°å–æ¨¡ï¼‰</span><br>Â Â Â Â x1Â =Â x0<br>Â Â Â Â y1Â =Â (-<span class="hljs-number">1</span>*y0)Â %Â p<br>Â Â Â Â <span class="hljs-keyword">return</span>Â x0,y0,x1,y1<br><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">get_graph</span>(<span class="hljs-params">a,Â b,Â p</span>):<br>Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Â Â Â Â è¾“å‡ºæ¤­åœ†æ›²çº¿æ•£ç‚¹å›¾</span><br><span class="hljs-string">Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â x_yÂ =Â []<br>Â Â Â Â <span class="hljs-comment">#Â åˆå§‹åŒ–äºŒç»´æ•°ç»„</span><br>Â Â Â Â <span class="hljs-keyword">for</span>Â iÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(p):<br>Â Â Â Â Â Â Â Â x_y.append([<span class="hljs-string">&#x27;-&#x27;</span>Â <span class="hljs-keyword">for</span>Â iÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(p)])<br><br>Â Â Â Â <span class="hljs-keyword">for</span>Â iÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(p):<br>Â Â Â Â Â Â Â Â valÂ =get_param(i,Â a,Â b,Â p)Â Â <span class="hljs-comment">#Â æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹</span><br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>(valÂ !=Â <span class="hljs-literal">False</span>):<br>Â Â Â Â Â Â Â Â Â Â Â Â x0,y0,x1,y1Â =Â val<br>Â Â Â Â Â Â Â Â Â Â Â Â x_y[x0][y0]Â =Â <span class="hljs-number">1</span><br>Â Â Â Â Â Â Â Â Â Â Â Â x_y[x1][y1]Â =Â <span class="hljs-number">1</span><br><br>Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¤­åœ†æ›²çº¿çš„æ•£åˆ—å›¾ä¸ºï¼š&quot;</span>)<br>Â Â Â Â <span class="hljs-keyword">for</span>Â iÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(p):Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â i=Â 0-&gt;Â p-1</span><br>Â Â Â Â Â Â Â Â tempÂ =Â p-<span class="hljs-number">1</span>-iÂ Â Â Â Â Â Â Â <span class="hljs-comment">#Â å€’åº</span><br><br>Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ ¼å¼åŒ–è¾“å‡º1/2ä½æ•°ï¼Œyåæ ‡è½´</span><br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â tempÂ &gt;=Â <span class="hljs-number">10</span>:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">print</span>(temp,Â end=<span class="hljs-string">&quot;Â &quot;</span>)<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">else</span>:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">print</span>(temp,Â end=<span class="hljs-string">&quot;Â Â &quot;</span>)<br><br>Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â è¾“å‡ºå…·ä½“åæ ‡çš„å€¼ï¼Œä¸€è¡Œ</span><br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">for</span>Â jÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(p):<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">print</span>(x_y[j][temp],Â end=<span class="hljs-string">&quot;Â Â &quot;</span>)<br>Â Â Â Â Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)Â Â Â <span class="hljs-comment">#æ¢è¡Œ</span><br><br>Â Â Â Â <span class="hljs-comment">#Â è¾“å‡ºÂ xÂ åæ ‡è½´</span><br>Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Â Â &quot;</span>,Â end=<span class="hljs-string">&quot;&quot;</span>)<br>Â Â Â Â <span class="hljs-keyword">for</span>Â iÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(p):<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â iÂ &gt;=<span class="hljs-number">10</span>:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">print</span>(i,Â end=<span class="hljs-string">&quot;Â &quot;</span>)<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">else</span>:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">print</span>(i,Â end=<span class="hljs-string">&quot;Â Â &quot;</span>)<br>Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">get_ng</span>(<span class="hljs-params">G_x,Â G_y,Â key,Â a,Â p</span>):<br>Â Â Â Â <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Â Â Â Â è®¡ç®—nG</span><br><span class="hljs-string">Â Â Â Â &quot;&quot;&quot;</span><br>Â Â Â Â temp_xÂ =Â G_x<br>Â Â Â Â temp_yÂ =Â G_y<br>Â Â Â Â <span class="hljs-keyword">while</span>Â keyÂ !=Â <span class="hljs-number">1</span>:<br>Â Â Â Â Â Â Â Â temp_x,temp_yÂ =Â get_np(temp_x,temp_y,Â G_x,Â G_y,Â a,Â p)<br>Â Â Â Â Â Â Â Â keyÂ -=Â <span class="hljs-number">1</span><br>Â Â Â Â <span class="hljs-keyword">return</span>Â temp_x,temp_y<br><br><span class="hljs-keyword">def</span>Â <span class="hljs-title function_">ecc_main</span>():<br>Â Â Â Â <span class="hljs-keyword">while</span>Â <span class="hljs-literal">True</span>:<br>Â Â Â Â Â Â Â Â aÂ =Â <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æ¤­åœ†æ›²çº¿å‚æ•°a(a&gt;0)çš„å€¼ï¼š&quot;</span>))<br>Â Â Â Â Â Â Â Â bÂ =Â <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æ¤­åœ†æ›²çº¿å‚æ•°b(b&gt;0)çš„å€¼ï¼š&quot;</span>))<br>Â Â Â Â Â Â Â Â pÂ =Â <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æ¤­åœ†æ›²çº¿å‚æ•°p(pä¸ºç´ æ•°)çš„å€¼ï¼š&quot;</span>))Â Â Â <span class="hljs-comment">#ç”¨ä½œæ¨¡è¿ç®—</span><br><br>Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ¡ä»¶æ»¡è¶³åˆ¤æ–­</span><br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-number">4</span>*(a**<span class="hljs-number">3</span>)+<span class="hljs-number">27</span>*(b**<span class="hljs-number">2</span>))%pÂ ==Â <span class="hljs-number">0</span>:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ‚¨è¾“å…¥çš„å‚æ•°æœ‰è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼ï¼ï¼\n&quot;</span>)<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">else</span>:<br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">break</span><br><br>Â Â Â Â <span class="hljs-comment">#Â è¾“å‡ºæ¤­åœ†æ›²çº¿æ•£ç‚¹å›¾</span><br>Â Â Â Â get_graph(a,Â b,Â p)<br><br>Â Â Â Â <span class="hljs-comment">#Â é€‰ç‚¹ä½œä¸ºGç‚¹</span><br>Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;user1ï¼šåœ¨å¦‚ä¸Šåæ ‡ç³»ä¸­é€‰ä¸€ä¸ªå€¼ä¸ºGçš„åæ ‡&quot;</span>)<br>Â Â Â Â G_xÂ =Â <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;user1ï¼šè¯·è¾“å…¥é€‰å–çš„xåæ ‡å€¼ï¼š&quot;</span>))<br>Â Â Â Â G_yÂ =Â <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;user1ï¼šè¯·è¾“å…¥é€‰å–çš„yåæ ‡å€¼ï¼š&quot;</span>))<br><br>Â Â Â Â <span class="hljs-comment">#Â è·å–æ¤­åœ†æ›²çº¿çš„é˜¶</span><br>Â Â Â Â nÂ =Â get_rank(G_x,Â G_y,Â a,Â b,Â p)<br><br>Â Â Â Â <span class="hljs-comment">#Â user1ç”Ÿæˆç§é’¥ï¼Œå°key</span><br>Â Â Â Â keyÂ =Â <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;user1ï¼šè¯·è¾“å…¥ç§é’¥å°keyï¼ˆ&lt;&#123;&#125;ï¼‰ï¼š&quot;</span>.<span class="hljs-built_in">format</span>(n)))<br><br>Â Â Â Â <span class="hljs-comment">#Â user1ç”Ÿæˆå…¬é’¥ï¼Œå¤§KEY</span><br>Â Â Â Â KEY_x,kEY_yÂ =Â get_ng(G_x,Â G_y,Â key,Â a,Â p)<br><br>Â Â Â Â <span class="hljs-comment">#Â user2é˜¶æ®µ</span><br>Â Â Â Â <span class="hljs-comment">#Â user2æ‹¿åˆ°user1çš„å…¬é’¥KEYï¼ŒEp(a,b)é˜¶nï¼ŒåŠ å¯†éœ€è¦åŠ å¯†çš„æ˜æ–‡æ•°æ®</span><br>Â Â Â Â <span class="hljs-comment">#Â åŠ å¯†å‡†å¤‡</span><br>Â Â Â Â kÂ =Â <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;user2ï¼šè¯·è¾“å…¥ä¸€ä¸ªæ•´æ•°kï¼ˆ&lt;&#123;&#125;ï¼‰ç”¨äºæ±‚kGå’ŒkQï¼š&quot;</span>.<span class="hljs-built_in">format</span>(n)))<br>Â Â Â Â k_G_x,k_G_yÂ =Â get_ng(G_x,Â G_y,Â k,Â a,Â p)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â kG</span><br>Â Â Â Â k_Q_x,k_Q_yÂ =Â get_ng(KEY_x,Â kEY_y,Â k,Â a,Â p)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â kQ</span><br><br>Â Â Â Â <span class="hljs-comment">#Â åŠ å¯†</span><br>Â Â Â Â plain_textÂ =Â <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;user2ï¼šè¯·è¾“å…¥éœ€è¦åŠ å¯†çš„å­—ç¬¦ä¸²:&quot;</span>)<br>Â Â Â Â plain_textÂ =Â plain_text.strip()<br>Â Â Â Â <span class="hljs-comment">#plain_text = int(input(&quot;user1ï¼šè¯·è¾“å…¥éœ€è¦åŠ å¯†çš„å¯†æ–‡ï¼š&quot;))</span><br>Â Â Â Â cÂ =Â []<br>Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¯†æ–‡ä¸ºï¼š&quot;</span>,end=<span class="hljs-string">&quot;&quot;</span>)<br>Â Â Â Â <span class="hljs-keyword">for</span>Â charÂ <span class="hljs-keyword">in</span>Â plain_text:<br>Â Â Â Â Â Â Â Â intcharÂ =Â <span class="hljs-built_in">ord</span>(char)<br>Â Â Â Â Â Â Â Â cipher_textÂ =Â intchar*k_Q_x<br>Â Â Â Â Â Â Â Â c.append([k_G_x,Â k_G_y,Â cipher_text])<br>Â Â Â Â Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;(&#123;&#125;,&#123;&#125;),&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(k_G_x,Â k_G_y,Â cipher_text),end=<span class="hljs-string">&quot;-&quot;</span>)<br><br><br>Â Â Â Â <span class="hljs-comment">#Â user1é˜¶æ®µ</span><br>Â Â Â Â <span class="hljs-comment">#Â æ‹¿åˆ°user2åŠ å¯†çš„æ•°æ®è¿›è¡Œè§£å¯†</span><br>Â Â Â Â <span class="hljs-comment">#Â çŸ¥é“Â k_G_x,k_G_yï¼Œkeyæƒ…å†µä¸‹ï¼Œæ±‚è§£k_Q_x,k_Q_yæ˜¯å®¹æ˜“çš„ï¼Œç„¶åplain_textÂ =Â cipher_text/k_Q_x</span><br>Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nuser1è§£å¯†å¾—åˆ°æ˜æ–‡ï¼š&quot;</span>,end=<span class="hljs-string">&quot;&quot;</span>)<br>Â Â Â Â <span class="hljs-keyword">for</span>Â charArrÂ <span class="hljs-keyword">in</span>Â c:<br>Â Â Â Â Â Â Â Â decrypto_text_x,decrypto_text_yÂ =Â get_ng(charArr[<span class="hljs-number">0</span>],Â charArr[<span class="hljs-number">1</span>],Â key,Â a,Â p)<br>Â Â Â Â Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(charArr[<span class="hljs-number">2</span>]//decrypto_text_x),end=<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-keyword">if</span>Â __name__Â ==Â <span class="hljs-string">&quot;__main__&quot;</span>:<br>Â Â Â Â <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;*************ECCæ¤­åœ†æ›²çº¿åŠ å¯†*************&quot;</span>)<br>Â Â Â Â ecc_main()<br></code></pre></td></tr></table></figure><p>- æ¥æºäºPythonä¹±ç‚–Â ï¼Œä½œè€… - æˆ‘è¢«ç‹—å’¬äº†</p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python åŠ å¯†è§£å¯† ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>selector Python selectorsæ¨¡å— I/Oå¤šè·¯å¤ç”¨</title>
    <link href="/2020/04/29/selector%20Python%20selectors%E6%A8%A1%E5%9D%97%20I!O%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/"/>
    <url>/2020/04/29/selector%20Python%20selectors%E6%A8%A1%E5%9D%97%20I!O%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h3 id="selectorsæ¨¡å—"><a href="#selectorsæ¨¡å—" class="headerlink" title="selectorsæ¨¡å—"></a><strong>selectorsæ¨¡å—</strong></h3><p>æ­¤æ¨¡å—å…è®¸é«˜çº§å’Œé«˜æ•ˆçš„I &#x2F; Oå¤šè·¯å¤ç”¨ï¼Œæ„å»ºåœ¨selectæ¨¡å—åŸè¯­ä¸Šã€‚é¼“åŠ±ç”¨æˆ·ä½¿ç”¨æ­¤æ¨¡å—ï¼Œé™¤éä»–ä»¬éœ€è¦ç²¾ç¡®æ§åˆ¶æ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿçº§åŸè¯­ã€‚ï¼ˆ é»˜è®¤ä½¿ç”¨epollï¼Œä½†ç”±äºWindowsä¸æ”¯æŒepollï¼Œå¦‚æœåœ¨ä½ çš„Windowsä¸Šæ‰¾ä¸åˆ°epollçš„è¯ï¼Œå°±ä¼šç”¨selectï¼‰  å®ƒå®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡åŸºç±»ï¼Œæœ‰å‡ ä¸ªå…·ä½“çš„å®ç°å·¥å…·(KqueueSelector, EpollSelectorâ€¦),å¯ä»¥ç”¨äºç­‰å¾…å¤šä¸ªæ–‡ä»¶å¯¹è±¡çš„I &#x2F; Oå°±ç»ªé€šçŸ¥ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œfile objectâ€ æŒ‡çš„æ˜¯ä»»ä½•fileno() methodï¼Œæˆ–ä¸€ä¸ªåŸå§‹æ–‡ä»¶çš„æè¿°ç¬¦ã€‚è¯·å‚é˜…æ–‡ä»¶å¯¹è±¡ã€‚BaseSelectorKqueueSelectorEpollSelectorfileno()<br> ã€€<strong>DefaultSelector</strong> æ˜¯åˆ«ååˆ°å½“å‰å¹³å°ä¸Šå¯ç”¨çš„æœ€æœ‰æ•ˆçš„å®ç°ï¼šè¿™åº”è¯¥æ˜¯å¤§å¤šæ•°ç”¨æˆ·çš„é»˜è®¤é€‰æ‹©<br>   æ³¨æ„æ”¯æŒçš„æ–‡ä»¶å¯¹è±¡ç±»å‹å–å†³äºå¹³å°ï¼šåœ¨Windowsä¸Šï¼Œæ”¯æŒå¥—æ¥å­—ï¼Œä½†ä¸æ”¯æŒç®¡é“ï¼Œè€Œåœ¨Unixä¸Šï¼Œæ”¯æŒä¸¤è€…ï¼ˆä¹Ÿå¯ä»¥æ”¯æŒå…¶ä»–ç±»å‹ï¼Œä¾‹å¦‚fifosæˆ–ç‰¹æ®Šæ–‡ä»¶è®¾å¤‡ï¼‰</p><h3 id="å®ä¾‹-serverç«¯"><a href="#å®ä¾‹-serverç«¯" class="headerlink" title="å®ä¾‹- serverç«¯"></a>å®ä¾‹- serverç«¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> selectors<br><span class="hljs-keyword">from</span> socket <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">accept</span>(<span class="hljs-params">sk,mask</span>):<br>    conn,addr=sk.accept()<br>    sel.register(conn,selectors.EVENT_READ,read)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>(<span class="hljs-params">conn,mask</span>):<br>    <span class="hljs-keyword">try</span>:<br>        data=conn.recv(<span class="hljs-number">1024</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;closing&#x27;</span>,conn)<br>            sel.unregister(conn)<br>            conn.close()<br>            <span class="hljs-keyword">return</span><br>        conn.send(data.upper()+<span class="hljs-string">b&#x27;_SB&#x27;</span>)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;closing&#x27;</span>, conn)<br>        sel.unregister(conn)<br>        conn.close()<br><br>sk=socket()<br>sk.setsockopt(SOL_SOCKET,SO_REUSEADDR,<span class="hljs-number">1</span>)<br>sk.bind((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-number">8008</span>))<br>sk.listen(<span class="hljs-number">5</span>)<br>sk.setblocking(<span class="hljs-literal">False</span>) <span class="hljs-comment">#è®¾ç½®socketçš„æ¥å£ä¸ºéé˜»å¡</span><br>sel=selectors.DefaultSelector()   <span class="hljs-comment"># é€‰æ‹©ä¸€ä¸ªé€‚åˆæˆ‘çš„IOå¤šè·¯å¤ç”¨çš„æœºåˆ¶</span><br>sel.register(sk,selectors.EVENT_READ,accept)<br><span class="hljs-comment">#ç›¸å½“äºç½‘selectçš„è¯»åˆ—è¡¨é‡Œappendäº†ä¸€ä¸ªskå¯¹è±¡,å¹¶ä¸”ç»‘å®šäº†ä¸€ä¸ªå›è°ƒå‡½æ•°accept</span><br><span class="hljs-comment"># è¯´ç™½äº†å°±æ˜¯ å¦‚æœæœ‰äººè¯·æ±‚è¿æ¥sk,å°±è°ƒç”¨acceptæ–¹æ³•</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    events=sel.select() <span class="hljs-comment">#æ£€æµ‹æ‰€æœ‰çš„sk,connï¼Œæ˜¯å¦æœ‰å®Œæˆwait dataé˜¶æ®µ</span><br>    <span class="hljs-keyword">for</span> sel_obj,mask <span class="hljs-keyword">in</span> events:  <span class="hljs-comment"># [conn]</span><br>        callback=sel_obj.data <span class="hljs-comment">#callback=read</span><br>        callback(sel_obj.fileobj,mask) <span class="hljs-comment">#read(conn,1)</span><br></code></pre></td></tr></table></figure><h3 id="å®ä¾‹-clientç«¯"><a href="#å®ä¾‹-clientç«¯" class="headerlink" title="å®ä¾‹-clientç«¯"></a>å®ä¾‹-clientç«¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>():<br>    sk = socket.socket()<br>    sk.connect((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-number">8008</span>))<br>    sk.send(<span class="hljs-string">b&#x27;hello&#x27;</span>)<br>    time.sleep(<span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(sk.recv(<span class="hljs-number">1024</span>))<br>    sk.close()<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>    threading.Thread(target=func).start()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python socket epoll</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python IOæ¨¡å‹ï¼ˆé˜»å¡ã€éé˜»å¡ã€å¤šè·¯å¤ç”¨ä¸å¼‚æ­¥ï¼‰</title>
    <link href="/2020/04/29/Python%20IO%E6%A8%A1%E5%9E%8B%EF%BC%88%E9%98%BB%E5%A1%9E%E3%80%81%E9%9D%9E%E9%98%BB%E5%A1%9E%E3%80%81%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8E%E5%BC%82%E6%AD%A5%EF%BC%89/"/>
    <url>/2020/04/29/Python%20IO%E6%A8%A1%E5%9E%8B%EF%BC%88%E9%98%BB%E5%A1%9E%E3%80%81%E9%9D%9E%E9%98%BB%E5%A1%9E%E3%80%81%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8E%E5%BC%82%E6%AD%A5%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="IOæ¨¡å‹"><a href="#IOæ¨¡å‹" class="headerlink" title="IOæ¨¡å‹"></a>IOæ¨¡å‹</h1><p>ã€€ã€€åŒæ­¥IOå’Œå¼‚æ­¥IOï¼Œé˜»å¡IOå’Œéé˜»å¡IOåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸åŒç¯å¢ƒä¸‹ç»™å‡ºçš„ç­”æ¡ˆä¹Ÿæ˜¯ä¸ä¸€çš„ã€‚æ‰€ä»¥å…ˆé™å®šä¸€ä¸‹ä¸Šä¸‹æ–‡æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p><p><em><code>æœ¬æ–‡è®¨è®ºçš„èƒŒæ™¯æ˜¯Linuxç¯å¢ƒä¸‹çš„network IOã€‚</code></em></p><p><strong>åœ¨æ·±å…¥äº†è§£ä¹‹å‰ï¼Œæˆ‘ä»¬åº”å…ˆäº†è§£å‡ ä¸ªæ¦‚å¿µï¼š</strong></p><p>Â ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´<br>ã€€ - è¿›ç¨‹åˆ‡æ¢<br>ã€€ - è¿›ç¨‹çš„é˜»å¡<br>ã€€ - æ–‡ä»¶æè¿°ç¬¦<br>ã€€ - ç¼“å­˜ I&#x2F;O</p><p><strong>ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´</strong></p><p>ã€€ã€€ç°åœ¨æ“ä½œç³»ç»Ÿéƒ½æ˜¯é‡‡ç”¨è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œé‚£ä¹ˆå¯¹32ä½æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®ƒçš„å¯»å€ç©ºé—´ï¼ˆè™šæ‹Ÿå­˜å‚¨ç©ºé—´ï¼‰ä¸º4Gï¼ˆ2çš„32æ¬¡æ–¹ï¼‰ã€‚æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯å†…æ ¸ï¼Œç‹¬ç«‹äºæ™®é€šçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†ä¿è¯ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œå†…æ ¸ï¼ˆkernelï¼‰ï¼Œä¿è¯å†…æ ¸çš„å®‰å…¨ï¼Œæ“å¿ƒç³»ç»Ÿå°†è™šæ‹Ÿç©ºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå†…æ ¸ç©ºé—´ï¼Œä¸€éƒ¨åˆ†ä¸ºç”¨æˆ·ç©ºé—´ã€‚é’ˆå¯¹linuxæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå°†æœ€é«˜çš„1Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0xC0000000åˆ°0xFFFFFFFFï¼‰ï¼Œä¾›å†…æ ¸ä½¿ç”¨ï¼Œç§°ä¸ºå†…æ ¸ç©ºé—´ï¼Œè€Œå°†è¾ƒä½çš„3Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0x00000000åˆ°0xBFFFFFFFï¼‰ï¼Œä¾›å„ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œç§°ä¸ºç”¨æˆ·ç©ºé—´ã€‚</p><p>Â </p><p><strong>è¿›ç¨‹åˆ‡æ¢</strong></p><p>ã€€ã€€ä¸ºäº†æ§åˆ¶è¿›ç¨‹çš„æ‰§è¡Œï¼Œå†…æ ¸å¿…é¡»æœ‰èƒ½åŠ›æŒ‚èµ·æ­£åœ¨CPUä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶æ¢å¤ä»¥å‰æŒ‚èµ·çš„æŸä¸ªè¿›ç¨‹çš„æ‰§è¡Œã€‚è¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºè¿›ç¨‹åˆ‡æ¢ã€‚å› æ­¤å¯ä»¥è¯´ï¼Œä»»ä½•è¿›ç¨‹éƒ½æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ”¯æŒä¸‹è¿è¡Œçš„ï¼Œæ˜¯ä¸å†…æ ¸ç´§å¯†ç›¸å…³çš„ã€‚</p><p>ä»ä¸€ä¸ªè¿›ç¨‹çš„è¿è¡Œè½¬åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸Šè¿è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ç»è¿‡ä¸‹é¢è¿™äº›å˜åŒ–ï¼š<br>ã€€ã€€1. ä¿å­˜å¤„ç†æœºä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨å’Œå…¶ä»–å¯„å­˜å™¨ã€‚<br>ã€€ã€€2. æ›´æ–°PCBä¿¡æ¯ã€‚</p><p>ã€€ã€€3. æŠŠè¿›ç¨‹çš„PCBç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—ï¼Œå¦‚å°±ç»ªã€åœ¨æŸäº‹ä»¶é˜»å¡ç­‰é˜Ÿåˆ—ã€‚<br>ã€€ã€€4. é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œå¹¶æ›´æ–°å…¶PCBã€‚<br>ã€€ã€€5. æ›´æ–°å†…å­˜ç®¡ç†çš„æ•°æ®ç»“æ„ã€‚<br>ã€€ã€€6. æ¢å¤å¤„ç†æœºä¸Šä¸‹æ–‡ã€‚</p><p>æ€»è€Œè¨€ä¹‹å°±æ˜¯å¾ˆè€—èµ„æºï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="http://guojing.me/linux-kernel-architecture/posts/process-switch/">è¿›ç¨‹åˆ‡æ¢</a></p><p>_æ³¨ï¼šè¿›ç¨‹æ§åˆ¶å—ï¼ˆProcessing Control Blockï¼‰ï¼Œæ˜¯<a href="http://baike.baidu.com/view/880.htm">æ“ä½œç³»ç»Ÿ</a><a href="http://baike.baidu.com/view/22680.htm">æ ¸å¿ƒ</a>ä¸­ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸»è¦è¡¨ç¤º<a href="http://baike.baidu.com/view/19746.htm">è¿›ç¨‹</a>çŠ¶æ€ã€‚å…¶ä½œç”¨æ˜¯ä½¿ä¸€ä¸ªåœ¨<a href="http://baike.baidu.com/view/1189611.htm">å¤šé“ç¨‹åº</a>ç¯å¢ƒä¸‹ä¸èƒ½ç‹¬ç«‹è¿è¡Œçš„ç¨‹åºï¼ˆå«æ•°æ®ï¼‰ï¼Œæˆä¸ºä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½æˆ–ä¸å…¶å®ƒè¿›ç¨‹å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹ã€‚æˆ–è€…è¯´ï¼ŒOSæ˜¯æ ¹æ®PCBæ¥å¯¹å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹è¿›è¡Œæ§åˆ¶å’Œç®¡ç†çš„ã€‚ PCBé€šå¸¸æ˜¯ç³»ç»Ÿå†…å­˜å ç”¨åŒºä¸­çš„ä¸€ä¸ªè¿ç»­å­˜åŒºï¼Œå®ƒå­˜æ”¾ç€<a href="http://baike.baidu.com/view/880.htm">æ“ä½œç³»ç»Ÿ</a>ç”¨äºæè¿°è¿›ç¨‹æƒ…å†µåŠæ§åˆ¶è¿›ç¨‹è¿è¡Œæ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯Â _</p><p><strong>è¿›ç¨‹çš„é˜»å¡</strong></p><p>ã€€ã€€æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼Œç”±äºæœŸå¾…çš„æŸäº›äº‹ä»¶æœªå‘ç”Ÿï¼Œå¦‚è¯·æ±‚ç³»ç»Ÿèµ„æºå¤±è´¥ã€ç­‰å¾…æŸç§æ“ä½œçš„å®Œæˆã€æ–°æ•°æ®å°šæœªåˆ°è¾¾æˆ–æ— æ–°å·¥ä½œåšç­‰ï¼Œåˆ™ç”±ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œé˜»å¡åŸè¯­(Block)ï¼Œä½¿è‡ªå·±ç”±è¿è¡ŒçŠ¶æ€å˜ä¸ºé˜»å¡çŠ¶æ€ã€‚å¯è§ï¼Œè¿›ç¨‹çš„é˜»å¡æ˜¯è¿›ç¨‹è‡ªèº«çš„ä¸€ç§ä¸»åŠ¨è¡Œä¸ºï¼Œä¹Ÿå› æ­¤åªæœ‰å¤„äºè¿è¡Œæ€çš„è¿›ç¨‹ï¼ˆè·å¾—CPUï¼‰ï¼Œæ‰å¯èƒ½å°†å…¶è½¬ä¸ºé˜»å¡çŠ¶æ€ã€‚<code>å½“è¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œæ˜¯ä¸å ç”¨CPUèµ„æºçš„</code>ã€‚</p><p><strong>æ–‡ä»¶æè¿°ç¬¦fd</strong></p><p>ã€€ã€€æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile descriptorï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ä¸ªæœ¯è¯­ï¼Œæ˜¯ä¸€ä¸ªç”¨äºè¡¨è¿°æŒ‡å‘æ–‡ä»¶çš„å¼•ç”¨çš„æŠ½è±¡åŒ–æ¦‚å¿µã€‚</p><p>ã€€ã€€æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚ä½†æ˜¯æ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äºUNIXã€Linuxè¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚</p><p>Â </p><p><strong>ç¼“å­˜ I&#x2F;O</strong></p><p>ã€€ã€€ç¼“å­˜ I&#x2F;O åˆè¢«ç§°ä½œæ ‡å‡† I&#x2F;Oï¼Œå¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤ I&#x2F;O æ“ä½œéƒ½æ˜¯ç¼“å­˜ I&#x2F;Oã€‚åœ¨ Linux çš„ç¼“å­˜ I&#x2F;O æœºåˆ¶ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šå°† I&#x2F;O çš„æ•°æ®ç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿçš„é¡µç¼“å­˜ï¼ˆ page cache ï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®ä¼šå…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åæ‰ä¼šä»æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ã€‚</p><p>ç¼“å­˜ I&#x2F;O çš„ç¼ºç‚¹ï¼š<br>ã€€ã€€æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­éœ€è¦åœ¨åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´å’Œå†…æ ¸è¿›è¡Œå¤šæ¬¡æ•°æ®æ‹·è´æ“ä½œï¼Œè¿™äº›æ•°æ®æ‹·è´æ“ä½œæ‰€å¸¦æ¥çš„ CPU ä»¥åŠå†…å­˜å¼€é”€æ˜¯éå¸¸å¤§çš„ã€‚</p><h2 id="IOæ¨¡å¼"><a href="#IOæ¨¡å¼" class="headerlink" title="IOæ¨¡å¼"></a>IOæ¨¡å¼</h2><p>å¯¹äºä¸€æ¬¡IOè®¿é—®ï¼ˆä»¥readä¸¾ä¾‹ï¼‰ï¼Œæ•°æ®ä¼šå…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åæ‰ä¼šä»æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ã€‚æ‰€ä»¥è¯´ï¼Œå½“ä¸€ä¸ªreadæ“ä½œå‘ç”Ÿæ—¶ï¼Œå®ƒä¼šç»å†ä¸¤ä¸ªé˜¶æ®µï¼š<br>ã€€ã€€1. ç­‰å¾…æ•°æ®å‡†å¤‡ (Waiting for the data to be ready)<br>ã€€ã€€2. å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°è¿›ç¨‹ä¸­ (Copying the data from the kernel to the process)</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTA1MDM5My8yMDE3MDQvMTA1MDM5My0yMDE3MDQxNTIxMTkxNzg0NS04NzI2MjYyNzEucG5n?x-oss-process=image/format,png"></p><p><em>è¯¦ç»†ï¼š<a href="http://blog.csdn.net/haiross/article/details/39078853">http://blog.csdn.net/haiross/article/details/39078853</a></em></p><p>Â </p><p>æ­£å¼å› ä¸ºè¿™ä¸¤ä¸ªé˜¶æ®µï¼Œlinuxç³»ç»Ÿäº§ç”Ÿäº†ä¸‹é¢äº”ç§ç½‘ç»œæ¨¡å¼çš„æ–¹æ¡ˆã€‚<br>ã€€ - é˜»å¡ I&#x2F;Oï¼ˆblocking IOï¼‰<br>ã€€ - éé˜»å¡ I&#x2F;Oï¼ˆnonblocking IOï¼‰<br>ã€€ - I&#x2F;O å¤šè·¯å¤ç”¨ï¼ˆ IO multiplexingï¼‰<br>ã€€ - ä¿¡å·é©±åŠ¨ I&#x2F;Oï¼ˆ signal driven IOï¼‰<br>ã€€ - å¼‚æ­¥ I&#x2F;Oï¼ˆasynchronous IOï¼‰</p><p>æ³¨ï¼šç”±äºsignal driven IOåœ¨å®é™…ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥æˆ‘è¿™åªæåŠå‰©ä¸‹çš„å››ç§IO Modelã€‚</p><p>Â </p><p><strong>é˜»å¡ I&#x2F;Oï¼ˆblocking IOï¼‰</strong></p><p>é˜»å¡I&#x2F;Oæ¨¡å‹æ˜¯æœ€å¹¿æ³›çš„æ¨¡å‹ï¼Œåœ¨linuxä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„socketéƒ½æ˜¯blockingï¼Œä¸€ä¸ªå…¸å‹çš„è¯»æ“ä½œæµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTA1MDM5My8yMDE3MDMvMTA1MDM5My0yMDE3MDMwODE5MDAxNTI5Ny0xNDIwNDg3Nzc5LnBuZw?x-oss-process=image/format,png"></p><p>ã€€ã€€å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†recvfromè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œkernelå°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ï¼ˆå¯¹äºç½‘ç»œIOæ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æ•°æ®åœ¨ä¸€å¼€å§‹è¿˜æ²¡æœ‰åˆ°è¾¾ã€‚æ¯”å¦‚ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„UDPåŒ…ã€‚è¿™ä¸ªæ—¶å€™kernelå°±è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®åˆ°æ¥ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®è¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­æ˜¯éœ€è¦ä¸€ä¸ªè¿‡ç¨‹çš„ã€‚è€Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿™è¾¹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«é˜»å¡ï¼ˆå½“ç„¶ï¼Œæ˜¯è¿›ç¨‹è‡ªå·±é€‰æ‹©çš„é˜»å¡ï¼‰ã€‚å½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»kernelä¸­æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œç„¶åkernelè¿”å›ç»“æœï¼Œç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œèµ·æ¥ã€‚</p><p>ã€€**ã€€æ‰€ä»¥ï¼Œblocking IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½è¢«blockäº†ã€‚**</p><p>**Â æ³¨æ„ï¼šè¿›ç¨‹å¤„äºé˜»å¡æ¨¡å¼æ—¶ï¼Œè®©å‡ºCPUï¼Œè¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚**</p><p>Â </p><p><strong>éé˜»å¡ I&#x2F;Oï¼ˆnonblocking IOï¼‰</strong></p><p>linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®socketä½¿å…¶å˜ä¸ºnon-blockingã€‚å½“å¯¹ä¸€ä¸ªnon-blocking socketæ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œæµç¨‹æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p>Â </p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTA1MDM5My8yMDE3MDMvMTA1MDM5My0yMDE3MDMwODE5MDIxNDg3NS0xNzA4MDgwMTk2LnBuZw?x-oss-process=image/format,png"></p><p>ã€€ã€€å½“ç”¨æˆ·è¿›ç¨‹å‘å‡ºreadæ“ä½œæ—¶ï¼Œå¦‚æœkernelä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸ä¼šblockç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹åˆ»è¿”å›ä¸€ä¸ªerrorã€‚ä»ç”¨æˆ·è¿›ç¨‹è§’åº¦è®² ï¼Œå®ƒå‘èµ·ä¸€ä¸ªreadæ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœã€‚ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­ç»“æœæ˜¯ä¸€ä¸ªerroræ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€readæ“ä½œã€‚ä¸€æ—¦kernelä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·è¿›ç¨‹çš„system callï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·å†…å­˜ï¼Œç„¶åè¿”å›ã€‚</p><p>ã€€ã€€<strong>æ‰€ä»¥ï¼Œnonblocking IOçš„ç‰¹ç‚¹æ˜¯ç”¨æˆ·è¿›ç¨‹éœ€è¦ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®kernelæ•°æ®å¥½äº†æ²¡æœ‰ã€‚</strong></p><p>é˜»å¡IOä¸éé˜»å¡IOçš„æ€§èƒ½åŒºåˆ«</p><p>ã€€ã€€åœ¨é˜»å¡æ¨¡å¼ä¸‹ï¼Œè‹¥ä»ç½‘ç»œæµä¸­è¯»å–ä¸åˆ°æŒ‡å®šå¤§å°çš„æ•°æ®é‡ï¼Œé˜»å¡IOå°±åœ¨é‚£é‡Œé˜»å¡ç€ã€‚æ¯”å¦‚ï¼Œå·²çŸ¥åé¢ä¼šæœ‰10ä¸ªå­—èŠ‚çš„æ•°æ®å‘è¿‡æ¥ï¼Œä½†æ˜¯æˆ‘ç°åœ¨åªæ”¶åˆ°8ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±åœ¨é‚£å‚»å‚»åœ°ç­‰åˆ°ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åˆ°æ¥ï¼Œå¯¹ï¼Œå°±åœ¨é‚£ç­‰ç€ï¼Œå•¥äº‹ä¹Ÿä¸åšï¼Œç›´åˆ°æŠŠè¿™10ä¸ªå­—èŠ‚è¯»å–å®Œï¼Œè¿™æ‰å°†é˜»å¡æ”¾å¼€é€šè¡Œã€‚</p><p>ã€€ã€€åœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œè‹¥ä»ç½‘ç»œæµä¸­è¯»å–ä¸åˆ°æŒ‡å®šå¤§å°çš„æ•°æ®é‡ï¼Œéé˜»å¡IOå°±ç«‹å³é€šè¡Œã€‚æ¯”å¦‚ï¼Œå·²çŸ¥åé¢ä¼šæœ‰10ä¸ªå­—èŠ‚çš„æ•°æ®å‘è¿‡æ¥ï¼Œä½†æ˜¯æˆ‘ç°åœ¨åªæ”¶åˆ°8ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±è¯»å–è¿™8ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œè¯»å®Œåå°±ç«‹å³è¿”å›ï¼Œç­‰å¦å¤–ä¸¤ä¸ªå­—èŠ‚å†æ¥çš„æ—¶å€™å†å»è¯»å–ã€‚</p><p>ã€€ã€€ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œé˜»å¡IOåœ¨æ€§èƒ½æ–¹é¢æ˜¯å¾ˆä½ä¸‹çš„ï¼Œå¦‚æœè¦ä½¿ç”¨é˜»å¡IOå®Œæˆä¸€ä¸ªWebæœåŠ¡å™¨çš„è¯ï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚éƒ½å¿…é¡»å¯ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚è€Œä½¿ç”¨éé˜»å¡IOçš„è¯ï¼Œä¸€åˆ°ä¸¤ä¸ªçº¿ç¨‹åŸºæœ¬ä¸Šå°±å¤Ÿäº†ï¼Œå› ä¸ºçº¿ç¨‹ä¸ä¼šäº§ç”Ÿé˜»å¡ï¼Œå¥½æ¯”ä¸€ä¸‹æ¥æ”¶Aè¯·æ±‚çš„æ•°æ®ï¼Œå¦ä¸€ä¸‹æ¥æ”¶Bè¯·æ±‚çš„æ•°æ®ï¼Œç­‰ç­‰ï¼Œå°±æ˜¯ä¸åœåœ°ä¸œå¥”è¥¿è·‘ï¼Œç›´æ¥åˆ°æŠŠæ•°æ®æ¥æ”¶å®Œäº†ã€‚</p><p><strong>é˜»å¡IOå’Œéé˜»å¡IOçš„åŒºåˆ«å°±åœ¨äºï¼šåº”ç”¨ç¨‹åºçš„è°ƒç”¨æ˜¯å¦ç«‹å³è¿”å›ï¼</strong></p><p><strong><strong>æ³¨æ„ï¼›éé˜»å¡æ¨¡å¼çš„ä½¿ç”¨å¹¶ä¸æ™®éï¼Œå› ä¸ºéé˜»å¡æ¨¡å¼ä¼šæµªè´¹å¤§é‡çš„CPUèµ„æºã€‚</strong></strong></p><p>Â </p><p><strong>I&#x2F;O å¤šè·¯å¤ç”¨ï¼ˆ IO multiplexingï¼‰</strong></p><p>ã€€ã€€å¤šè·¯å¤ç”¨çš„æœ¬è´¨æ˜¯åŒæ­¥éé˜»å¡I&#x2F;Oï¼Œå¤šè·¯å¤ç”¨çš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å•ä¸ªè¿æ¥å¤„ç†çš„æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚</p><p>ã€€ã€€I&#x2F;Oç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œéœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯æ¥å…¥è¯·æ±‚æ—¶ï¼Œå¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹æˆ–è€…I&#x2F;Oå¤šè·¯å¤ç”¨æŠ€æœ¯è¿›è¡Œå¤„ç†ã€‚ I&#x2F;Oå¤šè·¯å¤ç”¨æŠ€æœ¯é€šè¿‡æŠŠå¤šä¸ªI&#x2F;Oçš„é˜»å¡å¤ç”¨åˆ°åŒä¸€ä¸ªselecté˜»å¡ä¸Šï¼Œä¸€ä¸ªè¿›ç¨‹ç›‘è§†å¤šä¸ªæè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ä½ï¼Œ èƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œè¯»å†™æ“ä½œã€‚å› ä¸ºå¤šè·¯å¤ç”¨æœ¬è´¨ä¸Šæ˜¯åŒæ­¥I&#x2F;Oï¼Œéƒ½éœ€è¦åº”ç”¨ç¨‹åºåœ¨è¯»å†™äº‹ä»¶å°±ç»ªåè‡ªå·±è´Ÿè´£è¯»å†™ã€‚ ä¸ä¼ ç»Ÿçš„å¤šçº¿ç¨‹&#x2F;å¤šè¿›ç¨‹æ¨¡å‹æ¯”ï¼ŒI&#x2F;Oå¤šè·¯å¤ç”¨çš„æœ€å¤§ä¼˜åŠ¿æ˜¯ç³»ç»Ÿå¼€é”€å°ï¼Œç³»ç»Ÿä¸éœ€è¦åˆ›å»ºæ–°çš„é¢å¤–è¿›ç¨‹æˆ–è€…çº¿ç¨‹ã€‚</p><ul><li>åº”ç”¨åœºæ™¯<ul><li>æœåŠ¡å™¨éœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªå¤„äºç›‘å¬çŠ¶æ€æˆ–è€…å¤šä¸ªè¿æ¥çŠ¶æ€çš„å¥—æ¥å­—</li><li>éœ€è¦åŒæ—¶å¤„ç†å¤šç§ç½‘ç»œåè®®çš„å¥—æ¥å­—</li><li>ä¸€ä¸ªæœåŠ¡å™¨å¤„ç†å¤šä¸ªæœåŠ¡æˆ–åè®®</li></ul></li></ul><p>ç›®å‰æ”¯æŒå¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨æœ‰Â <code>select</code>Â ,Â <code>poll</code>Â ,Â <code>epoll</code>Â ã€‚</p><p>ã€€ã€€IO multiplexingå°±æ˜¯æˆ‘ä»¬è¯´çš„selectï¼Œpollï¼Œepollï¼Œæœ‰äº›åœ°æ–¹ä¹Ÿç§°è¿™ç§IOæ–¹å¼ä¸ºevent driven IOã€‚select&#x2F;epollçš„å¥½å¤„å°±åœ¨äºå•ä¸ªprocesså°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥çš„IOã€‚å®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯selectï¼Œpollï¼Œepollè¿™ä¸ªfunctionä¼šä¸æ–­çš„è½®è¯¢æ‰€è´Ÿè´£çš„æ‰€æœ‰socketï¼Œå½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTA1MDM5My8yMDE3MDMvMTA1MDM5My0yMDE3MDMwODE5MDMzMTQ2OS0xMzk0OTM5NzY2LnBuZw?x-oss-process=image/format,png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTA1MDM5My8yMDE3MDMvMTA1MDM5My0yMDE3MDMwODE5MDMzMTQ2OS0xMzk0OTM5NzY2LnBuZw?x-oss-process=image/format,png"></p><p>**<code>ã€€ã€€å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šè¢«block</code>**ï¼Œè€ŒåŒæ—¶ï¼Œkernelä¼šâ€œç›‘è§†â€æ‰€æœ‰selectè´Ÿè´£çš„socketï¼Œå½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›ã€‚è¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿›ç¨‹å†è°ƒç”¨readæ“ä½œï¼Œå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚</p><p>ã€€ã€€<strong>æ‰€ä»¥ï¼ŒI&#x2F;O å¤šè·¯å¤ç”¨çš„ç‰¹ç‚¹æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥—æ¥å­—æè¿°ç¬¦ï¼‰å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªè¿›å…¥è¯»å°±ç»ªçŠ¶æ€ï¼Œselect()å‡½æ•°å°±å¯ä»¥è¿”å›ã€‚</strong></p><p>ã€€ã€€è¿™ä¸ªå›¾å’Œblocking IOçš„å›¾å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œäº‹å®ä¸Šï¼Œè¿˜æ›´å·®ä¸€äº›ã€‚å› ä¸ºè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªsystem call (select å’Œ recvfrom)ï¼Œè€Œblocking IOåªè°ƒç”¨äº†ä¸€ä¸ªsystem call (recvfrom)ã€‚ä½†æ˜¯ï¼Œç”¨selectçš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªconnectionã€‚</p><p>ã€€ã€€æ‰€ä»¥ï¼Œå¦‚æœå¤„ç†çš„è¿æ¥æ•°ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½¿ç”¨select&#x2F;epollçš„web serverä¸ä¸€å®šæ¯”ä½¿ç”¨multi-threading + blocking IOçš„web serveræ€§èƒ½æ›´å¥½ï¼Œå¯èƒ½å»¶è¿Ÿè¿˜æ›´å¤§ã€‚select&#x2F;epollçš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºå•ä¸ªè¿æ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚ï¼‰</p><p>ã€€ã€€åœ¨IO multiplexing Modelä¸­ï¼Œå®é™…ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªsocketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingï¼Œä½†æ˜¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªç”¨æˆ·çš„processå…¶å®æ˜¯ä¸€ç›´è¢«blockçš„ã€‚åªä¸è¿‡processæ˜¯è¢«selectè¿™ä¸ªå‡½æ•°blockï¼Œè€Œä¸æ˜¯è¢«socket IOç»™blockã€‚</p><p>Â </p><p><strong>å¼‚æ­¥ I&#x2F;Oï¼ˆasynchronous IOï¼‰</strong></p><p>ã€€ã€€ç›¸æ¯”äºIOå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œå¼‚æ­¥IOå¹¶ä¸ååˆ†å¸¸ç”¨ï¼Œä¸å°‘é«˜æ€§èƒ½å¹¶å‘æœåŠ¡ç¨‹åºä½¿ç”¨IOå¤šè·¯å¤ç”¨æ¨¡å‹+å¤šçº¿ç¨‹ä»»åŠ¡å¤„ç†çš„<a href="http://lib.csdn.net/base/architecture">æ¶æ„</a>åŸºæœ¬å¯ä»¥æ»¡è¶³éœ€æ±‚</p><p>linuxä¸‹çš„asynchronous IOå…¶å®ç”¨å¾—å¾ˆå°‘ã€‚å…ˆçœ‹ä¸€ä¸‹å®ƒçš„æµç¨‹ï¼š</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTA1MDM5My8yMDE3MDMvMTA1MDM5My0yMDE3MDMwODE5MDUxOTczNC0yNjMyNDAxNDkucG5n?x-oss-process=image/format,png"></p><p>ã€€ã€€ç”¨æˆ·è¿›ç¨‹å‘èµ·readæ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œä»kernelçš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ªasynchronous readä¹‹åï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½•blockã€‚ç„¶åï¼Œkernelä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œkernelä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ªsignalï¼Œå‘Šè¯‰å®ƒreadæ“ä½œå®Œæˆäº†ã€‚</p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p><em>æµ…æ I&#x2F;O æ¨¡å‹åŠå…¶è®¾è®¡æ¨¡å¼<a href="http://blog.jobbole.com/104638/">http://blog.jobbole.com/104638/</a></em></p><p>blockingå’Œnon-blockingçš„åŒºåˆ«</p><p>è°ƒç”¨blocking IOä¼šä¸€ç›´blockä½å¯¹åº”çš„è¿›ç¨‹ç›´åˆ°æ“ä½œå®Œæˆï¼Œè€Œnon-blocking IOåœ¨kernelè¿˜å‡†å¤‡æ•°æ®çš„æƒ…å†µä¸‹ä¼šç«‹åˆ»è¿”å›ã€‚</p><p>synchronous IOå’Œasynchronous IOçš„åŒºåˆ«</p><p><strong>åŒæ­¥IOå’Œå¼‚æ­¥IOçš„åŒºåˆ«å°±åœ¨äºï¼šæ•°æ®è®¿é—®çš„æ—¶å€™è¿›ç¨‹æ˜¯å¦é˜»å¡ï¼</strong></p><p>åœ¨è¯´æ˜synchronous IOå’Œasynchronous IOçš„åŒºåˆ«ä¹‹å‰ï¼Œéœ€è¦å…ˆç»™å‡ºä¸¤è€…çš„å®šä¹‰ã€‚POSIXçš„å®šä¹‰æ˜¯è¿™æ ·å­çš„ï¼š<br>ã€€ - A synchronous I&#x2F;O operation causes the requesting process to be blocked until that I&#x2F;O operation completes;<br>ã€€ - An asynchronous I&#x2F;O operation does not cause the requesting process to be blocked;</p><p>ã€€ã€€ä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºsynchronous IOåšâ€IO operationâ€çš„æ—¶å€™ä¼šå°†processé˜»å¡ã€‚æŒ‰ç…§è¿™ä¸ªå®šä¹‰ï¼Œä¹‹å‰æ‰€è¿°çš„blocking IOï¼Œnon-blocking IOï¼ŒIO multiplexingéƒ½å±äºsynchronous IOã€‚</p><p>ã€€ã€€æœ‰äººä¼šè¯´ï¼Œnon-blocking IOå¹¶æ²¡æœ‰è¢«blockå•Šã€‚è¿™é‡Œæœ‰ä¸ªéå¸¸â€œç‹¡çŒ¾â€çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸­æ‰€æŒ‡çš„â€IO operationâ€æ˜¯æŒ‡çœŸå®çš„IOæ“ä½œï¼Œå°±æ˜¯ä¾‹å­ä¸­çš„recvfromè¿™ä¸ªsystem callã€‚non-blocking IOåœ¨æ‰§è¡Œrecvfromè¿™ä¸ªsystem callçš„æ—¶å€™ï¼Œå¦‚æœkernelçš„æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¿™æ—¶å€™ä¸ä¼šblockè¿›ç¨‹ã€‚ä½†æ˜¯ï¼Œå½“kernelä¸­æ•°æ®å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œrecvfromä¼šå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·å†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™è¿›ç¨‹æ˜¯è¢«blockäº†ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹æ˜¯è¢«blockçš„ã€‚</p><p>ã€€ã€€è€Œasynchronous IOåˆ™ä¸ä¸€æ ·ï¼Œå½“è¿›ç¨‹å‘èµ·IO æ“ä½œä¹‹åï¼Œå°±ç›´æ¥è¿”å›å†ä¹Ÿä¸ç†ç¬äº†ï¼Œç›´åˆ°kernelå‘é€ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰è¿›ç¨‹è¯´IOå®Œæˆã€‚åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹å®Œå…¨æ²¡æœ‰è¢«blockã€‚</p><p>Â </p><p>å„ä¸ªIO Modelçš„æ¯”è¾ƒå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvMTA1MDM5My8yMDE3MDMvMTA1MDM5My0yMDE3MDMwODE5MDcyMjg5MS0xMjc5Nzk2NzE5LnBuZw?x-oss-process=image/format,png"></p><p>ã€€ã€€é€šè¿‡ä¸Šé¢çš„å›¾ç‰‡ï¼Œå¯ä»¥å‘ç°non-blocking IOå’Œasynchronous IOçš„åŒºåˆ«è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚åœ¨non-blocking IOä¸­ï¼Œè™½ç„¶è¿›ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸ä¼šè¢«blockï¼Œä½†æ˜¯å®ƒä»ç„¶è¦æ±‚è¿›ç¨‹å»ä¸»åŠ¨çš„checkï¼Œå¹¶ä¸”å½“æ•°æ®å‡†å¤‡å®Œæˆä»¥åï¼Œä¹Ÿéœ€è¦è¿›ç¨‹ä¸»åŠ¨çš„å†æ¬¡è°ƒç”¨recvfromæ¥å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ã€‚è€Œasynchronous IOåˆ™å®Œå…¨ä¸åŒã€‚å®ƒå°±åƒæ˜¯ç”¨æˆ·è¿›ç¨‹å°†æ•´ä¸ªIOæ“ä½œäº¤ç»™äº†ä»–äººï¼ˆkernelï¼‰å®Œæˆï¼Œç„¶åä»–äººåšå®Œåå‘ä¿¡å·é€šçŸ¥ã€‚åœ¨æ­¤æœŸé—´ï¼Œç”¨æˆ·è¿›ç¨‹ä¸éœ€è¦å»æ£€æŸ¥IOæ“ä½œçš„çŠ¶æ€ï¼Œä¹Ÿä¸éœ€è¦ä¸»åŠ¨çš„å»æ‹·è´æ•°æ®ã€‚</p><h2 id="IOå¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epoll"><a href="#IOå¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epoll" class="headerlink" title="IOå¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epoll"></a>IOå¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epoll</h2><p>ã€€ã€€selectï¼Œpollï¼Œepolléƒ½æ˜¯IOå¤šè·¯å¤ç”¨çš„æœºåˆ¶ã€‚I&#x2F;Oå¤šè·¯å¤ç”¨å°±æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚ä½†selectï¼Œpollï¼Œepollæœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I&#x2F;Oï¼Œå› ä¸ºä»–ä»¬éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåè‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œè€Œå¼‚æ­¥I&#x2F;Oåˆ™æ— éœ€è‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œå¼‚æ­¥I&#x2F;Oçš„å®ç°ä¼šè´Ÿè´£æŠŠæ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p><p><strong>select</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">select(rlist, wlist, xlist, timeout=None)<br></code></pre></td></tr></table></figure><p>ã€€ã€€select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯writefdsã€readfdsã€å’Œexceptfdsã€‚è°ƒç”¨åselectå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°å‰¯å°±ç»ªï¼ˆæœ‰æ•°æ® å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeoutæŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸ºnullå³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥ é€šè¿‡éå†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚</p><p>ã€€ã€€selectç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„å¹³å°ä¸Šæ”¯æŒï¼Œå…¶è‰¯å¥½è·¨å¹³å°æ”¯æŒä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªä¼˜ç‚¹ã€‚selectçš„ä¸€ ä¸ªç¼ºç‚¹åœ¨äºå•ä¸ªè¿›ç¨‹èƒ½å¤Ÿç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œåœ¨Linuxä¸Šä¸€èˆ¬ä¸º1024ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å®å®šä¹‰ç”šè‡³é‡æ–°ç¼–è¯‘å†…æ ¸çš„æ–¹å¼æå‡è¿™ä¸€é™åˆ¶ï¼Œä½† æ˜¯è¿™æ ·ä¹Ÿä¼šé€ æˆæ•ˆç‡çš„é™ä½ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html">ã€€ã€€ä½¿ç”¨selectåº“çš„ä¸€èˆ¬æ­¥éª¤ï¼šåˆ›å»ºæ‰€å…³æ³¨äº‹ä»¶çš„æè¿°é›†åˆã€‚å¯¹äºä¸€ä¸ªæè¿°ç¬¦ï¼Œå¯ä»¥å…³æ³¨å…¶ä¸Šé¢çš„è¯»äº‹ä»¶ã€å†™äº‹ä»¶ä»¥åŠå¼‚å¸¸å‘ç”Ÿäº‹ä»¶ï¼Œæ‰€ä»¥è¦åˆ›å»ºä¸‰ç±»äº‹ä»¶æè¿°ç¬¦é›†åˆï¼Œåˆ†åˆ«ç”¨æ¥æ”¶é›†è¯»äº‹ä»¶çš„æè¿°ç¬¦ã€å†™äº‹ä»¶çš„æè¿°ç¬¦å’Œå¼‚å¸¸äº‹ä»¶çš„æè¿°ç¬¦ã€‚<br>ã€€ã€€å…¶æ¬¡ï¼Œè°ƒç”¨åº•å±‚æä¾›çš„selectï¼ˆï¼‰å‡½æ•°ï¼Œç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿã€‚selectçš„é˜»å¡ä¸æ˜¯å¦è®¾ç½®éé˜»å¡çš„IOæ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚<br>ã€€ã€€ç„¶åï¼Œè½®è¯¢æ‰€æœ‰äº‹ä»¶æè¿°ç¬¦é›†åˆä¸­çš„æ¯ä¸€ä¸ªäº‹ä»¶æè¿°ç¬¦ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å“åº”çš„æ—¶é—´å‘ç”Ÿï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿›è¡Œå¤„ç†ã€‚<br>ã€€ã€€nginxæœåŠ¡å™¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å¦‚æœæ²¡æœ‰ä¸ºå…¶æŒ‡å®šå…¶ä»–é«˜æ€§èƒ½äº‹ä»¶é©±åŠ¨æ¨¡å‹åº“ï¼Œå®ƒå°†è‡ªåŠ¨ç¼–è¯‘è¯¥åº“ã€‚<br>ã€€ã€€å¯ä»¥ä½¿ç”¨--with-select_moduleå’Œ--without-select_moduleä¸¤ä¸ªå‚æ•°ï¼Œå¼ºåˆ¶nginxæ˜¯å¦ç¼–è¯‘è¯¥åº“ã€‚<br><br>å®ä¾‹ï¼š<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">åˆ©ç”¨selecté€šè¿‡å•è¿›ç¨‹å®ç°åŒæ—¶å¤„ç†å¤šä¸ªéé˜»å¡çš„socketè¿æ¥:<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># _*_coding:utf-8_*_</span><br><br><span class="hljs-keyword">import</span> select<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> queue<br><br><span class="hljs-comment"># Create a TCP/IP socket</span><br>server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>server.setblocking(<span class="hljs-literal">False</span>)<br><br><span class="hljs-comment"># Bind the socket to the port</span><br>server_address = (<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-number">6666</span>)<br><span class="hljs-built_in">print</span>(sys.stderr, <span class="hljs-string">&#x27;starting up on %s port %s&#x27;</span> % server_address)<br>server.bind(server_address)<br><br><span class="hljs-comment"># Listen for incoming connections</span><br>server.listen(<span class="hljs-number">5</span>)<br><br><span class="hljs-comment"># Sockets from which we expect to read</span><br>inputs = [server]<br><br><span class="hljs-comment"># Sockets to which we expect to write</span><br>outputs = []<br><br>message_queues = &#123;&#125;<br><span class="hljs-keyword">while</span> inputs:<br>    <span class="hljs-comment"># Wait for at least one of the sockets to be ready for processing</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\nwaiting for the next event&#x27;</span>)<br>    readable, writable, exceptional = select.select(inputs, outputs, inputs)<br>    <span class="hljs-comment"># Handle inputs</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> readable:<br>        <span class="hljs-keyword">if</span> s <span class="hljs-keyword">is</span> server:<br>            <span class="hljs-comment"># A &quot;readable&quot; server socket is ready to accept a connection</span><br>            connection, client_address = s.accept()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;new connection from&#x27;</span>, client_address)<br>            connection.setblocking(<span class="hljs-literal">False</span>)<br>            inputs.append(connection)<br><br>            <span class="hljs-comment"># Give the connection a queue for data we want to send</span><br>            message_queues[connection] = queue.Queue()<br>        <span class="hljs-keyword">else</span>:<br>            data = s.recv(<span class="hljs-number">1024</span>)<br>            <span class="hljs-keyword">if</span> data:<br>                <span class="hljs-comment"># A readable client socket has data</span><br>                <span class="hljs-built_in">print</span>(sys.stderr, <span class="hljs-string">&#x27;received &quot;%s&quot; from %s&#x27;</span> % (data, s.getpeername()))<br>                message_queues[s].put(data)<br>                <span class="hljs-comment"># Add output channel for response</span><br>                <span class="hljs-keyword">if</span> s <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> outputs:<br>                    outputs.append(s)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># Interpret empty result as closed connection</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;closing&#x27;</span>, client_address, <span class="hljs-string">&#x27;after reading no data&#x27;</span>)<br>                <span class="hljs-comment"># Stop listening for input on the connection</span><br>                <span class="hljs-keyword">if</span> s <span class="hljs-keyword">in</span> outputs:<br>                    outputs.remove(s)  <span class="hljs-comment"># æ—¢ç„¶å®¢æˆ·ç«¯éƒ½æ–­å¼€äº†ï¼Œæˆ‘å°±ä¸ç”¨å†ç»™å®ƒè¿”å›æ•°æ®äº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™å¦‚æœè¿™ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥å¯¹è±¡è¿˜åœ¨outputsåˆ—è¡¨ä¸­ï¼Œå°±æŠŠå®ƒåˆ æ‰</span><br>                inputs.remove(s)  <span class="hljs-comment"># inputsä¸­ä¹Ÿåˆ é™¤æ‰</span><br>                s.close()  <span class="hljs-comment"># æŠŠè¿™ä¸ªè¿æ¥å…³é—­æ‰</span><br><br>                <span class="hljs-comment"># Remove message queue</span><br>                <span class="hljs-keyword">del</span> message_queues[s]<br>    <span class="hljs-comment"># Handle outputs</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> writable:<br>        <span class="hljs-keyword">try</span>:<br>            next_msg = message_queues[s].get_nowait()<br>        <span class="hljs-keyword">except</span> queue.Empty:<br>            <span class="hljs-comment"># No messages waiting so stop checking for writability.</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;output queue for&#x27;</span>, s.getpeername(), <span class="hljs-string">&#x27;is empty&#x27;</span>)<br>            outputs.remove(s)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;sending &quot;%s&quot; to %s&#x27;</span> % (next_msg, s.getpeername()))<br>            s.send(next_msg)<br>    <span class="hljs-comment"># Handle &quot;exceptional conditions&quot;</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> exceptional:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;handling exceptional condition for&#x27;</span>, s.getpeername())<br>        <span class="hljs-comment"># Stop listening for input on the connection</span><br>        inputs.remove(s)<br>        <span class="hljs-keyword">if</span> s <span class="hljs-keyword">in</span> outputs:<br>            outputs.remove(s)<br>        s.close()<br><br>        <span class="hljs-comment"># Remove message queue</span><br>        <span class="hljs-keyword">del</span> message_queues[s]<br></code></pre></td></tr></table></figure><p>Â </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env/ python</span><br><span class="hljs-comment"># -*-coding:utf-8 -*-</span><br><span class="hljs-keyword">import</span> socket,select,queue<br><span class="hljs-keyword">import</span> sys<br><br>server=socket.socket()<br>server.bind((<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-number">8080</span>))<br><br>server.listen(<span class="hljs-number">1000</span>)<br><br>server.setblocking(<span class="hljs-literal">False</span>)<span class="hljs-comment">#è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œsocketå¿…é¡»åœ¨éé˜»å¡æƒ…å†µä¸‹æ‰èƒ½å®ç°IOå¤šè·¯å¤ç”¨ã€‚</span><br><br><span class="hljs-comment">#éœ€è¦ç›‘å¬çš„å¯è¯»å¯¹è±¡</span><br>inputs=[server,]<span class="hljs-comment">#å­˜æ”¾selcctè¦ç›‘æµ‹çš„é“¾æ¥,ä¸€å¼€å§‹ç›‘æµ‹è‡ªå·±ï¼Œæœ‰æ´»åŠ¨å°±è¡¨ç¤ºæœ‰é“¾æ¥è¿›æ¥</span><br>outputs=[]<span class="hljs-comment">#è¿™é‡Œå­˜æ”¾çš„æ˜¯å†…æ ¸è¿”å›çš„æ´»è·ƒçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±æ˜¯æœåŠ¡å™¨éœ€ç»™send dataçš„å®¢æˆ·ç«¯è¿æ¥</span><br><br>message_queues=&#123;&#125;<br><span class="hljs-keyword">while</span> inputs:<br>    <span class="hljs-comment"># Wait for at least one of the sockets to be ready for processing</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\nwaiting for the next event&#x27;</span>)<br>    readable,writeable,exceptionable=select.select(inputs,outputs,inputs) <span class="hljs-comment">#æ­¤å¤„ä¼šè¢«selectæ¨¡å—é˜»å¡ï¼Œåªæœ‰å½“ç›‘å¬çš„ä¸‰ä¸ªå‚æ•°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œselectæ‰ä¼šè¿”,</span><br><br>    <span class="hljs-comment"># print(readable,writeable,exceptionable)</span><br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> readable:<br>        <span class="hljs-keyword">if</span> r <span class="hljs-keyword">is</span> server:<span class="hljs-comment">#ä»£è¡¨æ¥äº†ä¸€ä¸ªæ–°è¿æ¥</span><br>            conn,addr=server.accept()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¥äº†ä¸€ä¸ªæ–°è¿æ¥&quot;</span>,addr)<br>            inputs.append(conn)<span class="hljs-comment">#å› ä¸ºè¿™ä¸ªæ–°å»ºç«‹çš„è¿æ¥è¿˜æ²¡å‘æ•°æ®è¿‡æ¥ï¼Œç°åœ¨å°±æ¥æ”¶çš„è¯ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¦æƒ³å®¢æˆ·ç«¯å‘æ•°æ®è¿‡æ¥æ—¶serverç«¯èƒ½çŸ¥é“ï¼Œå°±è¦selectç›‘æµ‹è¿™ä¸ªè¿æ¥ã€‚</span><br>            message_queues[conn]=queue.Queue()<span class="hljs-comment">#æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®å,ä¸ç«‹åˆ»è¿”å› ,æš‚å­˜åœ¨é˜Ÿåˆ—é‡Œ,ä»¥åå‘é€</span><br>        <span class="hljs-keyword">else</span>:<br>            data = r.recv(<span class="hljs-number">1024</span>) <span class="hljs-comment"># æ³¨æ„è¿™é‡Œæ˜¯rï¼Œè€Œä¸æ˜¯connï¼Œå¤šä¸ªè¿æ¥çš„æƒ…å†µ</span><br>            <span class="hljs-keyword">if</span> data:<br>                <span class="hljs-comment"># A readable client socket has data</span><br>                <span class="hljs-built_in">print</span>(sys.stderr, <span class="hljs-string">&#x27;received &quot;%s&quot; from %s&#x27;</span> % (data, r.getpeername()))<br>                <span class="hljs-comment"># r.send(data) # å…ˆä¸å‘ï¼Œæ”¾åˆ°ä¸€ä¸ªå¯¹åˆ—é‡Œï¼Œä¹‹åå†å‘</span><br>                message_queues[r].put(data)<span class="hljs-comment"># å¾€é‡Œé¢æ”¾æ•°æ®</span><br>                <span class="hljs-comment"># Add output channel for response</span><br>                <span class="hljs-keyword">if</span> r <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> outputs:<br>                    outputs.append(r)  <span class="hljs-comment">#æ”¾å…¥è¿”å›çš„è¿æ¥é˜Ÿåˆ—é‡Œ</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># Interpret empty result as closed connection</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;closing&#x27;</span>, addr, <span class="hljs-string">&#x27;after reading no data&#x27;</span>)<br>                <span class="hljs-comment"># Stop listening for input on the connection</span><br>                <span class="hljs-keyword">if</span> r <span class="hljs-keyword">in</span> outputs:<br>                    outputs.remove(r)  <span class="hljs-comment"># æ—¢ç„¶å®¢æˆ·ç«¯éƒ½æ–­å¼€äº†ï¼Œæˆ‘å°±ä¸ç”¨å†ç»™å®ƒè¿”å›æ•°æ®äº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™å¦‚æœè¿™ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥å¯¹è±¡è¿˜åœ¨outputsåˆ—è¡¨ä¸­ï¼Œå°±æŠŠå®ƒåˆ æ‰</span><br>                inputs.remove(r)  <span class="hljs-comment"># inputsä¸­ä¹Ÿåˆ é™¤æ‰</span><br>                r.close()  <span class="hljs-comment"># æŠŠè¿™ä¸ªè¿æ¥å…³é—­æ‰</span><br><br>                <span class="hljs-comment"># Remove message queue</span><br>                <span class="hljs-keyword">del</span> message_queues[r]<br><br>    <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> writeable:  <span class="hljs-comment"># è¦è¿”å›ç»™å®¢æˆ·ç«¯çš„è¿æ¥åˆ—è¡¨</span><br>        data_to_client = message_queues[w].get()  <span class="hljs-comment"># åœ¨å­—å…¸é‡Œå–æ•°æ®</span><br>        w.send(data_to_client)  <span class="hljs-comment"># è¿”å›ç»™å®¢æˆ·ç«¯</span><br>        outputs.remove(w)  <span class="hljs-comment"># åˆ é™¤è¿™ä¸ªæ•°æ®ï¼Œç¡®ä¿ä¸‹æ¬¡å¾ªç¯çš„æ—¶å€™ä¸è¿”å›è¿™ä¸ªå·²ç»å¤„ç†å®Œçš„è¿æ¥äº†ã€‚</span><br><br>    <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> exceptionable:  <span class="hljs-comment"># å¦‚æœè¿æ¥æ–­å¼€ï¼Œåˆ é™¤è¿æ¥ç›¸å…³æ•°æ®</span><br>        <span class="hljs-keyword">if</span> e <span class="hljs-keyword">in</span> outputs:<br>            outputs.remove(e)<br>        inputs.remove(e)<br>        <span class="hljs-keyword">del</span> message_queues[e]<br></code></pre></td></tr></table></figure><p><strong>poll</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">ã€€ã€€pollåº“ï¼Œä½œä¸ºlinuxå¹³å°ä¸Šçš„åŸºæœ¬äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼ŒWindowså¹³å°ä¸æ”¯æŒpollåº“ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">ã€€ã€€ä½¿ç”¨pollåº“çš„ä¸€èˆ¬è¿‡ç¨‹æ˜¯ï¼šä¸selectçš„åŸºæœ¬å·¥ä½œæ–¹å¼æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªå…³æ³¨äº‹ä»¶çš„æè¿°ç¬¦é›†åˆï¼Œå†å»ç­‰å¾…è¿™äº›äº‹ä»¶çš„å‘ç”Ÿï¼Œç„¶ååœ¨è½®è¯¢æè¿°ç¬¦é›†åˆï¼Œæ£€æŸ¥æœ‰æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå¦‚æœæœ‰ï¼Œå°±è¿›è¡Œå¤„ç†ã€‚<br>ã€€ã€€ä¸selectçš„ä¸»è¦åŒºåˆ«æ˜¯selectéœ€è¦ä¸ºè¯»äº‹ä»¶ã€å†™äº‹ä»¶ã€å¼‚å¸¸äº‹ä»¶åˆ†åˆ«åˆ›å»ºä¸€ä¸ªæè¿°ç¬¦çš„é›†åˆï¼Œå› æ­¤åœ¨è½®è¯¢çš„æ—¶å€™ï¼Œéœ€è¦åˆ†åˆ«è½®è¯¢è¿™ä¸‰ä¸ªé›†åˆã€‚è€Œpollåº“åªéœ€åˆ›å»ºä¸€ä¸ªé›†åˆï¼Œåœ¨æ¯ä¸ªæè¿°ç¬¦å¯¹åº”çš„ç»“æ„ä¸Šåˆ†åˆ«è®¾ç½®è¯»äº‹ä»¶ï¼Œå†™äº‹ä»¶å’Œå¼‚å¸¸äº‹ä»¶ï¼Œæœ€åè½®è¯¢çš„æ—¶å€™å¯ä»¥åŒæ—¶æ£€æŸ¥è¿™ä¸‰ç§äº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚æ˜¯selectåº“ä¼˜åŒ–çš„å®ç°ã€‚<br>nginxæœåŠ¡å™¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å¦‚æœæ²¡æœ‰ä¸ºå…¶æŒ‡å®šå…¶ä»–é«˜æ€§èƒ½äº‹ä»¶é©±åŠ¨æ¨¡å‹åº“ï¼Œå®ƒå°†è‡ªåŠ¨ç¼–è¯‘è¯¥åº“ã€‚å¯ä»¥ä½¿ç”¨--with-poll_moduleå’Œ--without-poll_moduleä¸¤ä¸ªå‚æ•°ï¼Œå¼ºåˆ¶nginxæ˜¯å¦ç¼–è¯‘è¯¥åº“ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">int poll (struct pollfd *fds, unsigned int nfds, int timeout);<br></code></pre></td></tr></table></figure><p>ã€€ä¸åŒä¸selectä½¿ç”¨ä¸‰ä¸ªä½å›¾æ¥è¡¨ç¤ºä¸‰ä¸ªfdsetçš„æ–¹å¼ï¼Œpollä½¿ç”¨ä¸€ä¸ª pollfdçš„æŒ‡é’ˆå®ç°ã€‚ã€€</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">struct pollfd &#123;<br>    int fd; /* file descriptor */<br>    short events; /* requested events to watch */<br>    short revents; /* returned events witnessed */<br>&#125;;<br></code></pre></td></tr></table></figure><p>ã€€ã€€pollfdç»“æ„åŒ…å«äº†è¦ç›‘è§†çš„eventå’Œå‘ç”Ÿçš„eventï¼Œä¸å†ä½¿ç”¨selectâ€œå‚æ•°-å€¼â€ä¼ é€’çš„æ–¹å¼ã€‚åŒæ—¶ï¼Œpollfdå¹¶æ²¡æœ‰æœ€å¤§æ•°é‡é™åˆ¶ï¼ˆä½†æ˜¯æ•°é‡è¿‡å¤§åæ€§èƒ½ä¹Ÿæ˜¯ä¼šä¸‹é™ï¼‰ã€‚ å’Œselectå‡½æ•°ä¸€æ ·ï¼Œpollè¿”å›åï¼Œéœ€è¦è½®è¯¢pollfdæ¥è·å–å°±ç»ªçš„æè¿°ç¬¦ã€‚</p><p>ã€€ã€€ä»ä¸Šé¢çœ‹ï¼Œselectå’Œpolléƒ½éœ€è¦åœ¨è¿”å›åï¼Œ<code>é€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦æ¥è·å–å·²ç»å°±ç»ªçš„socket</code>ã€‚äº‹å®ä¸Šï¼ŒåŒæ—¶è¿æ¥çš„å¤§é‡å®¢æˆ·ç«¯åœ¨ä¸€æ—¶åˆ»å¯èƒ½åªæœ‰å¾ˆå°‘çš„å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå› æ­¤éšç€ç›‘è§†çš„æè¿°ç¬¦æ•°é‡çš„å¢é•¿ï¼Œå…¶æ•ˆç‡ä¹Ÿä¼šçº¿æ€§ä¸‹é™ã€‚</p><p><strong>epoll</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">ã€€ã€€epollæ˜¯åœ¨2.6å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯ä¹‹å‰çš„selectå’Œpollçš„å¢å¼ºç‰ˆæœ¬ã€‚ç›¸å¯¹äºselectå’Œpollæ¥è¯´ï¼Œepollæ›´åŠ çµæ´»ï¼Œæ²¡æœ‰æè¿°ç¬¦é™åˆ¶ã€‚epollä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³ç³»çš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„copyåªéœ€ä¸€æ¬¡ã€‚ã€€  <br>ã€€ã€€epollåº“æ˜¯NginxæœåŠ¡å™¨æ”¯æŒçš„é«˜æ€§èƒ½äº‹ä»¶ä¹‹ä¸€ï¼Œå®ƒæ˜¯å…¬è®¤çš„éå¸¸ä¼˜ç§€çš„æ—¶é—´é©±åŠ¨æ¨¡å‹ï¼Œå’Œpollå’Œselectæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå±äºpollåº“çš„ä¸€ä¸ªå˜ç§ï¼Œä»–ä»¬çš„å¤„ç†æ–¹å¼éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªå¾…å¤„ç†äº‹ä»¶åˆ—è¡¨ï¼Œç„¶åæŠŠè¿™ä¸ªäº‹ä»¶åˆ—è¡¨å‘é€ç»™å†…æ ¸ï¼Œè¿”å›çš„æ—¶å€™ï¼Œå†å»è½®è¯¢æ£€æŸ¥è¿™ä¸ªåˆ—è¡¨ï¼Œä»¥åˆ¤æ–­äº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚å¦‚æœè¿™æ ·çš„æè¿°ç¬¦åœ¨æ¯”è¾ƒå¤šçš„åº”ç”¨ä¸­ï¼Œæ•ˆç‡å°±æ˜¾å¾—ä½ä¸‹äº†ï¼Œepollæ˜¯æè¿°ç¬¦åˆ—è¡¨çš„ç®¡ç†äº¤ç»™å†…æ ¸è´Ÿè´£ï¼Œä¸€æ—¦æŸç§äº‹ä»¶å‘ç”Ÿï¼Œå†…æ ¸ä¼šæŠŠå‘ç”Ÿäº‹ä»¶çš„æè¿°ç¬¦åˆ—è¡¨é€šçŸ¥ç»™è¿›ç¨‹ï¼Œè¿™æ ·å°±é¿å…äº†è½®è¯¢æ•´ä¸ªæè¿°ç¬¦åˆ—è¡¨ï¼Œepollåº“å¾—åˆ°äº‹ä»¶åˆ—è¡¨ï¼Œå°±å¼€å§‹è¿›è¡Œäº‹ä»¶å¤„ç†äº†ã€‚<br>ã€€ æ³¨æ„ï¼šselectå’Œepollæœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼šselectåªæ˜¯å‘Šè¯‰ä½ ä¸€å®šæ•°ç›®çš„æµæœ‰äº‹ä»¶äº†ï¼Œè‡³äºå“ªä¸ªæµæœ‰äº‹ä»¶ï¼Œè¿˜å¾—ä½ ä¸€ä¸ªä¸€ä¸ªåœ°å»è½®è¯¢ï¼Œè€Œ epollä¼šæŠŠå‘ç”Ÿçš„äº‹ä»¶å‘Šè¯‰ä½ ï¼Œé€šè¿‡å‘ç”Ÿçš„äº‹ä»¶ï¼Œå°±è‡ªç„¶è€Œç„¶å®šä½åˆ°å“ªä¸ªæµäº†<br></code></pre></td></tr></table></figure><p>ä¸€ epollæ“ä½œè¿‡ç¨‹</p><p>epollæ“ä½œè¿‡ç¨‹éœ€è¦ä¸‰ä¸ªæ¥å£ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">int epoll_create(int size)ï¼›//åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§<br>int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›<br>int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);<br></code></pre></td></tr></table></figure><p>1. int epoll_create(int size);<br>ã€€ã€€åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§ï¼Œè¿™ä¸ªå‚æ•°ä¸åŒäºselect()ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç»™å‡ºæœ€å¤§ç›‘å¬çš„fd+1çš„å€¼ï¼Œ<code>å‚æ•°sizeå¹¶ä¸æ˜¯é™åˆ¶äº†epollæ‰€èƒ½ç›‘å¬çš„æè¿°ç¬¦æœ€å¤§ä¸ªæ•°ï¼Œåªæ˜¯å¯¹å†…æ ¸åˆå§‹åˆ†é…å†…éƒ¨æ•°æ®ç»“æ„çš„ä¸€ä¸ªå»ºè®®</code>ã€‚<br>å½“åˆ›å»ºå¥½epollå¥æŸ„åï¼Œå®ƒå°±ä¼šå ç”¨ä¸€ä¸ªfdå€¼ï¼Œåœ¨linuxä¸‹å¦‚æœæŸ¥çœ‹&#x2F;proc&#x2F;è¿›ç¨‹id&#x2F;fd&#x2F;ï¼Œæ˜¯èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸ªfdçš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å®Œepollåï¼Œå¿…é¡»è°ƒç”¨close()å…³é—­ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´fdè¢«è€—å°½ã€‚</p><p>2. int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›<br>ã€€ã€€å‡½æ•°æ˜¯å¯¹æŒ‡å®šæè¿°ç¬¦fdæ‰§è¡Œopæ“ä½œã€‚<br>ã€€ - epfdï¼šæ˜¯epoll_create()çš„è¿”å›å€¼ã€‚<br>ã€€ - opï¼šè¡¨ç¤ºopæ“ä½œï¼Œç”¨ä¸‰ä¸ªå®æ¥è¡¨ç¤ºï¼šæ·»åŠ EPOLL_CTL_ADDï¼Œåˆ é™¤EPOLL_CTL_DELï¼Œä¿®æ”¹EPOLL_CTL_MODã€‚åˆ†åˆ«æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹å¯¹fdçš„ç›‘å¬äº‹ä»¶ã€‚<br>ã€€ - fdï¼šæ˜¯éœ€è¦ç›‘å¬çš„fdï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰<br>ã€€ - epoll_eventï¼šæ˜¯å‘Šè¯‰å†…æ ¸éœ€è¦ç›‘å¬ä»€ä¹ˆäº‹</p><p>3. int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);<br>ã€€ã€€ç­‰å¾…epfdä¸Šçš„ioäº‹ä»¶ï¼Œæœ€å¤šè¿”å›maxeventsä¸ªäº‹ä»¶ã€‚<br>å‚æ•°eventsç”¨æ¥ä»å†…æ ¸å¾—åˆ°äº‹ä»¶çš„é›†åˆï¼Œmaxeventså‘Šä¹‹å†…æ ¸è¿™ä¸ªeventsæœ‰å¤šå¤§ï¼Œè¿™ä¸ªmaxeventsçš„å€¼ä¸èƒ½å¤§äºåˆ›å»ºepoll_create()æ—¶çš„sizeï¼Œå‚æ•°timeoutæ˜¯è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ0ä¼šç«‹å³è¿”å›ï¼Œ-1å°†ä¸ç¡®å®šï¼Œä¹Ÿæœ‰è¯´æ³•è¯´æ˜¯æ°¸ä¹…é˜»å¡ï¼‰ã€‚è¯¥å‡½æ•°è¿”å›éœ€è¦å¤„ç†çš„äº‹ä»¶æ•°ç›®ï¼Œå¦‚è¿”å›0è¡¨ç¤ºå·²è¶…æ—¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket, logging<br><span class="hljs-keyword">import</span> select, errno<br><br>logger = logging.getLogger(<span class="hljs-string">&quot;network-server&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">InitLog</span>():<br>    logger.setLevel(logging.DEBUG)<br><br>    fh = logging.FileHandler(<span class="hljs-string">&quot;network-server.log&quot;</span>)<br>    fh.setLevel(logging.DEBUG)<br>    ch = logging.StreamHandler()<br>    ch.setLevel(logging.ERROR)<br><br>    formatter = logging.Formatter(<span class="hljs-string">&quot;%(asctime)s - %(name)s - %(levelname)s - %(message)s&quot;</span>)<br>    ch.setFormatter(formatter)<br>    fh.setFormatter(formatter)<br><br>    logger.addHandler(fh)<br>    logger.addHandler(ch)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    InitLog()<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># åˆ›å»º TCP socket ä½œä¸ºç›‘å¬ socket</span><br>        listen_fd = socket.socket(socket.AF_INET, socket.SOCK_STREAM, <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(<span class="hljs-string">&quot;create socket failed&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># è®¾ç½® SO_REUSEADDR é€‰é¡¹</span><br>        listen_fd.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(<span class="hljs-string">&quot;setsocketopt SO_REUSEADDR failed&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># è¿›è¡Œ bind -- æ­¤å¤„æœªæŒ‡å®š ip åœ°å€ï¼Œå³ bind äº†å…¨éƒ¨ç½‘å¡ ip ä¸Š</span><br>        listen_fd.bind((<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-number">2003</span>))<br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(<span class="hljs-string">&quot;bind failed&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># è®¾ç½® listen çš„ backlog æ•°</span><br>        listen_fd.listen(<span class="hljs-number">10</span>)<br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(msg)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># åˆ›å»º epoll å¥æŸ„</span><br>        epoll_fd = select.epoll()<br>        <span class="hljs-comment"># å‘ epoll å¥æŸ„ä¸­æ³¨å†Œ ç›‘å¬ socket çš„ å¯è¯» äº‹ä»¶</span><br>        epoll_fd.register(listen_fd.fileno(), select.EPOLLIN)<br>    <span class="hljs-keyword">except</span> select.error <span class="hljs-keyword">as</span>  msg:<br>        logger.error(msg)<br><br>    connections = &#123;&#125;<br>    addresses = &#123;&#125;<br>    datalist = &#123;&#125;<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># epoll è¿›è¡Œ fd æ‰«æçš„åœ°æ–¹ -- æœªæŒ‡å®šè¶…æ—¶æ—¶é—´åˆ™ä¸ºé˜»å¡ç­‰å¾…</span><br>        epoll_list = epoll_fd.poll()<br><br>        <span class="hljs-keyword">for</span> fd, events <span class="hljs-keyword">in</span> epoll_list:<br>            <span class="hljs-comment"># è‹¥ä¸ºç›‘å¬ fd è¢«æ¿€æ´»</span><br>            <span class="hljs-keyword">if</span> fd == listen_fd.fileno():<br>                <span class="hljs-comment"># è¿›è¡Œ accept -- è·å¾—è¿æ¥ä¸Šæ¥ client çš„ ip å’Œ portï¼Œä»¥åŠ socket å¥æŸ„</span><br>                conn, addr = listen_fd.accept()<br>                logger.debug(<span class="hljs-string">&quot;accept connection from %s, %d, fd = %d&quot;</span> % (addr[<span class="hljs-number">0</span>], addr[<span class="hljs-number">1</span>], conn.fileno()))<br>                <span class="hljs-comment"># å°†è¿æ¥ socket è®¾ç½®ä¸º éé˜»å¡</span><br>                conn.setblocking(<span class="hljs-number">0</span>)<br>                <span class="hljs-comment"># å‘ epoll å¥æŸ„ä¸­æ³¨å†Œ è¿æ¥ socket çš„ å¯è¯» äº‹ä»¶</span><br>                epoll_fd.register(conn.fileno(), select.EPOLLIN | select.EPOLLET)<br>                <span class="hljs-comment"># å°† conn å’Œ addr ä¿¡æ¯åˆ†åˆ«ä¿å­˜èµ·æ¥</span><br>                connections[conn.fileno()] = conn<br>                addresses[conn.fileno()] = addr<br>            <span class="hljs-keyword">elif</span> select.EPOLLIN &amp; events:<br>                <span class="hljs-comment"># æœ‰ å¯è¯» äº‹ä»¶æ¿€æ´»</span><br>                datas = <span class="hljs-string">&#x27;&#x27;</span><br>                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                    <span class="hljs-keyword">try</span>:<br>                        <span class="hljs-comment"># ä»æ¿€æ´» fd ä¸Š recv 10 å­—èŠ‚æ•°æ®</span><br>                        data = connections[fd].recv(<span class="hljs-number">10</span>)<br>                        <span class="hljs-comment"># è‹¥å½“å‰æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®ï¼Œå¹¶ä¸”ä¹‹å‰çš„ç´¯è®¡æ•°æ®ä¹Ÿæ²¡æœ‰</span><br>                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> datas:<br>                            <span class="hljs-comment"># ä» epoll å¥æŸ„ä¸­ç§»é™¤è¯¥ è¿æ¥ fd</span><br>                            epoll_fd.unregister(fd)<br>                            <span class="hljs-comment"># server ä¾§ä¸»åŠ¨å…³é—­è¯¥ è¿æ¥ fd</span><br>                            connections[fd].close()<br>                            logger.debug(<span class="hljs-string">&quot;%s, %d closed&quot;</span> % (addresses[fd][<span class="hljs-number">0</span>], addresses[fd][<span class="hljs-number">1</span>]))<br>                            <span class="hljs-keyword">break</span><br>                        <span class="hljs-keyword">else</span>:<br>                            <span class="hljs-comment"># å°†æ¥æ”¶åˆ°çš„æ•°æ®æ‹¼æ¥ä¿å­˜åœ¨ datas ä¸­</span><br>                            datas += data<br>                    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span>  msg:<br>                        <span class="hljs-comment"># åœ¨ éé˜»å¡ socket ä¸Šè¿›è¡Œ recv éœ€è¦å¤„ç† è¯»ç©¿ çš„æƒ…å†µ</span><br>                        <span class="hljs-comment"># è¿™é‡Œå®é™…ä¸Šæ˜¯åˆ©ç”¨ è¯»ç©¿ å‡º å¼‚å¸¸ çš„æ–¹å¼è·³åˆ°è¿™é‡Œè¿›è¡Œåç»­å¤„ç†</span><br>                        <span class="hljs-keyword">if</span> msg.errno == errno.EAGAIN:<br>                            logger.debug(<span class="hljs-string">&quot;%s receive %s&quot;</span> % (fd, datas))<br>                            <span class="hljs-comment"># å°†å·²æ¥æ”¶æ•°æ®ä¿å­˜èµ·æ¥</span><br>                            datalist[fd] = datas<br>                            <span class="hljs-comment"># æ›´æ–° epoll å¥æŸ„ä¸­è¿æ¥d æ³¨å†Œäº‹ä»¶ä¸º å¯å†™</span><br>                            epoll_fd.modify(fd, select.EPOLLET | select.EPOLLOUT)<br>                            <span class="hljs-keyword">break</span><br>                        <span class="hljs-keyword">else</span>:<br>                            <span class="hljs-comment"># å‡ºé”™å¤„ç†</span><br>                            epoll_fd.unregister(fd)<br>                            connections[fd].close()<br>                            logger.error(msg)<br>                            <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">elif</span> select.EPOLLHUP &amp; events:<br>                <span class="hljs-comment"># æœ‰ HUP äº‹ä»¶æ¿€æ´»</span><br>                epoll_fd.unregister(fd)<br>                connections[fd].close()<br>                logger.debug(<span class="hljs-string">&quot;%s, %d closed&quot;</span> % (addresses[fd][<span class="hljs-number">0</span>], addresses[fd][<span class="hljs-number">1</span>]))<br>            <span class="hljs-keyword">elif</span> select.EPOLLOUT &amp; events:<br>                <span class="hljs-comment"># æœ‰ å¯å†™ äº‹ä»¶æ¿€æ´»</span><br>                sendLen = <span class="hljs-number">0</span><br>                <span class="hljs-comment"># é€šè¿‡ while å¾ªç¯ç¡®ä¿å°† buf ä¸­çš„æ•°æ®å…¨éƒ¨å‘é€å‡ºå»</span><br>                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                    <span class="hljs-comment"># å°†ä¹‹å‰æ”¶åˆ°çš„æ•°æ®å‘å› client -- é€šè¿‡ sendLen æ¥æ§åˆ¶å‘é€ä½ç½®</span><br>                    sendLen += connections[fd].send(datalist[fd][sendLen:])<br>                    <span class="hljs-comment"># åœ¨å…¨éƒ¨å‘é€å®Œæ¯•åé€€å‡º while å¾ªç¯</span><br>                    <span class="hljs-keyword">if</span> sendLen == <span class="hljs-built_in">len</span>(datalist[fd]):<br>                        <span class="hljs-keyword">break</span><br>                <span class="hljs-comment"># æ›´æ–° epoll å¥æŸ„ä¸­è¿æ¥ fd æ³¨å†Œäº‹ä»¶ä¸º å¯è¯»</span><br>                epoll_fd.modify(fd, select.EPOLLIN | select.EPOLLET)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># å…¶ä»– epoll äº‹ä»¶ä¸è¿›è¡Œå¤„ç†</span><br>                <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><hr><h3 id="select-amp-poll-amp-epollæ¯”è¾ƒ"><a href="#select-amp-poll-amp-epollæ¯”è¾ƒ" class="headerlink" title="select &amp; poll &amp; epollæ¯”è¾ƒ"></a>select &amp; poll &amp; epollæ¯”è¾ƒ</h3><ul><li>æ¯æ¬¡è°ƒç”¨Â <code>select</code>Â éƒ½éœ€è¦æŠŠæ‰€æœ‰è¦ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦æ‹·è´åˆ°å†…æ ¸ç©ºé—´ä¸€æ¬¡ï¼Œfdå¾ˆå¤§æ—¶å¼€é”€ä¼šå¾ˆå¤§ã€‚Â <code>epoll</code>Â ä¼šåœ¨epoll_ctl()ä¸­æ³¨å†Œï¼Œåªéœ€è¦å°†æ‰€æœ‰çš„fdæ‹·è´åˆ°å†…æ ¸äº‹ä»¶è¡¨ä¸€æ¬¡ï¼Œä¸ç”¨å†æ¯æ¬¡epoll_wait()æ—¶é‡å¤æ‹·è´</li><li>æ¯æ¬¡Â <code>select</code>Â éœ€è¦åœ¨å†…æ ¸ä¸­éå†æ‰€æœ‰ç›‘å¬çš„fdï¼Œç›´åˆ°è®¾å¤‡å°±ç»ªï¼›Â <code>epoll</code>Â é€šè¿‡Â <code>epoll_ctl</code>Â æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œä¹Ÿéœ€è¦ä¸æ–­è°ƒç”¨Â <code>epoll_wait</code>Â è½®è¯¢å°±ç»ªé“¾è¡¨ï¼Œå½“fdæˆ–è€…äº‹ä»¶å°±ç»ªæ—¶ï¼Œä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå°†å°±ç»ªç»“æœåŠ å…¥åˆ°å°±ç»ªé“¾è¡¨ã€‚</li><li><code>select</code>Â èƒ½ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡æœ‰é™ï¼Œé»˜è®¤æ˜¯1024ï¼›Â <code>epoll</code>Â èƒ½æ”¯æŒçš„fdæ•°é‡æ˜¯æœ€å¤§å¯ä»¥æ‰“å¼€æ–‡ä»¶çš„æ•°ç›®ï¼Œå…·ä½“æ•°ç›®å¯ä»¥åœ¨&#x2F;proc&#x2F;sys&#x2F;fs&#x2F;file-maxæŸ¥çœ‹</li><li><code>select</code>Â ,Â <code>poll</code>Â åœ¨å‡½æ•°è¿”å›åéœ€è¦æŸ¥çœ‹æ‰€æœ‰ç›‘å¬çš„fdï¼Œçœ‹å“ªäº›å°±ç»ªï¼Œè€Œepollåªè¿”å›å°±ç»ªçš„æè¿°ç¬¦ï¼Œæ‰€ä»¥åº”ç”¨ç¨‹åºåªéœ€è¦å°±ç»ªfdçš„å‘½ä¸­ç‡æ˜¯ç™¾åˆ†ç™¾ã€‚</li></ul><p>è¡¨é¢ä¸Šçœ‹epollçš„æ€§èƒ½æœ€å¥½ï¼Œä½†æ˜¯åœ¨è¿æ¥æ•°å°‘å¹¶ä¸”é“¾æ¥éƒ½ååˆ†æ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œselectå’Œpollçš„æ€§èƒ½å¯èƒ½æ¯”epollå¥½ï¼Œæ¯•ç«Ÿepollçš„é€šçŸ¥æœºåˆ¶éœ€è¦å¾ˆå¤šå‡½æ•°å›è°ƒã€‚</p><p>selectæ•ˆç‡ä½æ˜¯ä¸€ä½æ¯æ¬¡éƒ½éœ€è¦è½®è¯¢ï¼Œä½†æ•ˆç‡ä½ä¹Ÿæ˜¯ç›¸å¯¹çš„ï¼Œä¹Ÿå¯é€šè¿‡è‰¯å¥½çš„è®¾è®¡æ”¹å–„</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/freely/p/6522432.html">https://www.cnblogs.com/freely/p/6522432.html</a></p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>epoll python linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu16.04 å…³é—­é˜²ç«å¢™</title>
    <link href="/2020/04/17/Ubuntu16.04%20%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99/"/>
    <url>/2020/04/17/Ubuntu16.04%20%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p>Ubuntu16.04 å…³é—­é˜²ç«å¢™](<a href="https://blog.csdn.net/weixin_42474540">https://blog.csdn.net/weixin_42474540</a>)</p><p>ä¸€ã€å…³é—­é˜²ç«å¢™</p><p>1. å…ˆæŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</p><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><p>1</p></td><td><p><code>systemctl&nbsp;status&nbsp;firewalld</code></p></td></tr></tbody></table><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs awk">firewalld.service - firewalld - dynamic firewall daemon<br><br>Â  Â Loaded: loaded (<span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/firewalld.service; enabled)<br><br>Â Â Â Active:Â active (running)Â since<br><br>Â Main PID: <span class="hljs-number">979</span> (firewalld)<br><br>Â  Â CGroup: <span class="hljs-regexp">/system.slice/</span>firewalld.service<br><br>Â  Â  Â  Â  Â  Â â””â”€<span class="hljs-number">979</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python -Es /u</span>sr<span class="hljs-regexp">/sbin/</span>firewalld --nofork --nopid<br><br><span class="hljs-number">5</span>æœˆ <span class="hljs-number">25</span> <span class="hljs-number">22</span>:<span class="hljs-number">53</span>:<span class="hljs-number">54</span> localhost.localdomain systemd[<span class="hljs-number">1</span>]: Started firewalld - dynami...<br><br>Hint: Some lines were ellipsized, use -l to show <span class="hljs-keyword">in</span> full.<br></code></pre></td></tr></table></figure><p>2. å…³é—­é˜²ç«å¢™</p><p>Â </p><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><p>1</p></td><td><p><code>systemctl&nbsp;stop&nbsp;firewalld</code></p></td></tr></tbody></table><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><p>1</p></td><td><p><code>systemctl&nbsp;status&nbsp;firewalld</code></p></td></tr></tbody></table><p>3. æŸ¥çœ‹é˜²ç«å¢™æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</p><p>Â </p><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><p>1</p></td><td><p><code>systemctl&nbsp;is-enabled&nbsp;firewalld</code></p></td></tr></tbody></table><p>enabled Â #å¼€å¯</p><p>4. å…³é—­é˜²ç«å¢™å¼€æœºå¯åŠ¨</p><p>Â </p><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><p>1</p></td><td><p><code>systemctl&nbsp;disable&nbsp;firewalld</code></p></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> <span class="hljs-string">&#x27;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&#x27;</span><br><br><span class="hljs-built_in">rm</span> <span class="hljs-string">&#x27;/etc/systemd/system/basic.target.wants/firewalld.service&#x27;</span><br></code></pre></td></tr></table></figure><p>Â </p><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><p>1</p></td><td><p><code>systemctl&nbsp;is-enabled&nbsp;firewalld</code></p></td></tr></tbody></table><p>disabled</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>systemd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºPython Flask è¯¦è§£ OAuth 2.0 (ä»¥githubä¸ºä¾‹)</title>
    <link href="/2020/04/16/%E5%9F%BA%E4%BA%8EPython%20Flask%20%E8%AF%A6%E8%A7%A3%20OAuth%202.0%20(%E4%BB%A5github%E4%B8%BA%E4%BE%8B)/"/>
    <url>/2020/04/16/%E5%9F%BA%E4%BA%8EPython%20Flask%20%E8%AF%A6%E8%A7%A3%20OAuth%202.0%20(%E4%BB%A5github%E4%B8%BA%E4%BE%8B)/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcubWVpd2VuLmNvbS5jbi9pMTcwODkxMS8zNTBlODg5ZDQxYTc0YmM1LmpwZWc?x-oss-process=image/format,png"></p><p><em>OAuth2æµç¨‹å›¾</em></p><p>OAuth2 å¯¹äºæˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªç¥ç§˜çš„ä¸œè¥¿ï¼Œæˆ‘æƒ³åˆæ­¥çš„å¼„æ‡‚ä¸­é—´çš„æ•´ä¸ªæµç¨‹ï¼Œäºæ˜¯å°±å»googleæœç´¢ç›¸å…³çš„æ–‡æ¡£èµ„æ–™ã€‚</p><p>åœ¨æµè§ˆäº†å‚å·®ä¸é½çš„å„ç§æ–‡ç« åï¼Œ<a href="https://www.barretlee.com/blog/2016/01/10/oauth2-introduce/">ç®€è¿° OAuth 2.0 çš„è¿ä½œæµç¨‹</a>Â åŸºæœ¬å¯¹äºå°ç™½æ¥è¯´æ˜¯æœ€æµ…æ˜¾æ˜äº†çš„ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä»¥ç”¨æˆ·ä½¿ç”¨ github ç™»å½•ç½‘ç«™ç•™è¨€ä¸ºä¾‹ï¼Œè¯¦è¿° OAuth 2.0 çš„è¿ä½œæµç¨‹ã€‚</p><p>æ•´ä¸ªOAuth2 çš„æµç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li>ç½‘ç«™å’Œ Github ä¹‹é—´çš„åå•†</li><li>ç”¨æˆ·å’Œ Github ä¹‹é—´çš„åå•†</li><li>ç½‘ç«™å’Œ Github ç”¨æˆ·æ•°æ®ä¹‹é—´çš„åå•†</li></ol><p>ç”±äºè¿™ç¯‡æ–‡ç« æ˜¯ç®€è¿°ï¼Œæ‰€ä»¥å¹¶ä¸æ¶‰åŠä»£ç ç›¸å…³çš„ä¸œè¥¿ï¼Œæˆ‘åœ¨åŸæ¥çš„æ–‡ç« åŸºç¡€ä¸Šæ·»åŠ äº†ä»£ç ç›¸å…³çš„å…·ä½“å®ç°å’Œä¸€äº›å…³é”®ç½‘ç»œäº¤äº’æˆªå›¾è¯´æ˜æ–¹ä¾¿ç†è§£ã€‚å¯¹äºä¸€äº›æ–‡å­—ï¼Œç”±äºåŸæ–‡å·²ç»å†™çš„å¾ˆæµç•…ä¸¥è°¨ï¼Œæˆ‘ç›´æ¥å°±ä»åŸæ¥çš„åšæ–‡ä¸­å¤åˆ¶è¿‡æ¥äº†ã€‚</p><hr><p>å‡å¦‚æˆ‘æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œä½ æ˜¯æˆ‘ç½‘ç«™ä¸Šçš„è®¿å®¢ï¼Œçœ‹äº†æ–‡ç« æƒ³ç•™è¨€è¡¨ç¤ºã€Œæœ•å·²é˜…ã€ï¼Œç•™è¨€æ—¶å‘ç°æœ‰è¿™ä¸ªç½‘ç«™çš„å¸å·æ‰èƒ½å¤Ÿç•™è¨€ï¼Œæ­¤æ—¶ç»™äº†ä½ ä¸¤ä¸ªé€‰æ‹©ï¼šä¸€ä¸ªæ˜¯åœ¨æˆ‘çš„ç½‘ç«™ä¸Šæ³¨å†Œæ‹¥æœ‰ä¸€ä¸ªæ–°è´¦æˆ·ï¼Œç„¶åç”¨æ³¨å†Œçš„ç”¨æˆ·åæ¥ç•™è¨€ï¼›ä¸€ä¸ªæ˜¯ä½¿ç”¨ github å¸å·ç™»å½•ï¼Œä½¿ç”¨ä½ çš„ github ç”¨æˆ·åæ¥ç•™è¨€ã€‚å‰è€…ä½ è§‰å¾—è¿‡äºç¹çï¼Œäºæ˜¯æƒ¯æ€§åœ°ç‚¹å‡»äº† github ç™»å½•æŒ‰é’®ï¼Œæ­¤æ—¶ OAuth è®¤è¯æµç¨‹å°±å¼€å§‹äº†ã€‚</p><p>éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œå³ä½¿ç”¨æˆ·åˆšç™»å½•è¿‡ githubï¼Œæˆ‘çš„ç½‘ç«™ä¹Ÿä¸å¯èƒ½å‘ github å‘ä¸€ä¸ªä»€ä¹ˆè¯·æ±‚ä¾¿èƒ½å¤Ÿæ‹¿åˆ°è®¿å®¢ä¿¡æ¯ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å®‰å…¨çš„ã€‚å°±ç®—ç”¨æˆ·å…è®¸ä½ è·å–ä»–åœ¨ github ä¸Šçš„ä¿¡æ¯ï¼Œgithub ä¸ºäº†ä¿éšœç”¨æˆ·ä¿¡æ¯å®‰å…¨ï¼Œä¹Ÿä¸ä¼šè®©ä½ éšæ„è·å–ã€‚æ‰€ä»¥æ“ä½œä¹‹å‰ï¼Œæˆ‘çš„ç½‘ç«™ä¸ github ä¹‹é—´éœ€è¦è¦æœ‰ä¸€ä¸ªåå•†ã€‚</p><p>1. ç½‘ç«™å’Œ Github ä¹‹é—´çš„åå•†</p><p>Github ä¼šå¯¹ç”¨æˆ·çš„æƒé™åšåˆ†ç±»ï¼Œæ¯”å¦‚è¯»å–ä»“åº“ä¿¡æ¯çš„æƒé™ã€å†™å…¥ä»“åº“çš„æƒé™ã€è¯»å–ç”¨æˆ·ä¿¡æ¯çš„æƒé™ã€ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯çš„æƒé™ç­‰ç­‰ã€‚å¦‚æœæˆ‘æƒ³è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼ŒGithub ä¼šè¦æ±‚æˆ‘ï¼Œå…ˆåœ¨å®ƒçš„å¹³å°ä¸Šæ³¨å†Œä¸€ä¸ªåº”ç”¨ï¼Œåœ¨ç”³è¯·çš„æ—¶å€™æ ‡æ˜éœ€è¦è·å–ç”¨æˆ·ä¿¡æ¯çš„å“ªäº›æƒé™ï¼Œç”¨å¤šå°‘å°±ç”³è¯·å¤šå°‘ï¼Œå¹¶ä¸”åœ¨ç”³è¯·çš„æ—¶å€™å¡«å†™ä½ çš„ç½‘ç«™åŸŸåï¼ŒGithub åªå…è®¸åœ¨è¿™ä¸ªåŸŸåä¸­è·å–ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>æ­¤æ—¶æˆ‘çš„ç½‘ç«™å·²ç»å’Œ Github ä¹‹é—´è¾¾æˆäº†å…±è¯†ï¼ŒGithub ä¹Ÿç»™æˆ‘å‘äº†ä¸¤å¼ é—¨ç¥¨ï¼Œä¸€å¼ é—¨ç¥¨å«åš Client Idï¼Œå¦ä¸€å¼ é—¨ç¥¨å«åš Client Secretã€‚</p><p>æˆ‘å…ˆå»é˜…è¯»äº†ä¸€ä¸‹githubä¸Šç›¸å…³OAuth2çš„èµ„æ–™ï¼Œç„¶ååœ¨<a href="https://github.com/settings/developers">è¿™é‡Œ</a>æ³¨å†Œäº†ä¸€ä¸ªåº”ç”¨ã€‚</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcubWVpd2VuLmNvbS5jbi9pMTcwODkxMS8wYWI5ZTRjMWYxMDBlZmI4LnBuZw?x-oss-process=image/format,png"><img src="https://img-blog.csdnimg.cn/20200416170217566.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQ3NDU0MA==,size_16,color_FFFFFF,t_70"></p><p>å…¶ä¸­æœ€åä¸€ä¸ªcallback URLè¡¨ç¤ºç”¨æˆ·æˆæƒä¹‹ågithubé»˜è®¤è¦è·³è½¬çš„urlåœ°å€ï¼Œåœ¨ä»£ç ä¸­éœ€è¦æ·»åŠ ä¸€ä¸ªè·¯ç”±æ¥å¤„ç†é’ˆå¯¹è¿™ä¸ªåœ°å€çš„è¯·æ±‚ã€‚</p><p>åˆ›å»ºå¥½ä¹‹åå°±ä¼šæ˜¾ç¤ºåœ¨OAuth Appsçš„åˆ—è¡¨ä¸­ã€‚</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcubWVpd2VuLmNvbS5jbi9pMTcwODkxMS80ZTA4MWY5OTkxYzZhNzNhLnBuZw?x-oss-process=image/format,png"></p><p>è¿™ä¸€æ­¥éå¸¸ç®€å•ï¼Œgithubç”Ÿæˆäº†ä¸¤ä¸ªé’¥åŒ™ï¼ŒClient IDå’ŒClient Secretã€‚ç°åœ¨æˆ‘çš„ç½‘ç«™å°±å¯ä»¥ä½¿ç”¨åˆæ³•çš„ä½¿ç”¨githubæä¾›çš„OAuthç™»é™†æœºåˆ¶äº†ã€‚</p><p>2. ç”¨æˆ·å’Œ Github ä¹‹é—´çš„åå•†</p><p>ç”¨æˆ·è¿›å…¥æˆ‘çš„ç½‘ç«™ï¼Œç‚¹å‡» github ç™»å½•æŒ‰é’®çš„æ—¶å€™ï¼Œæˆ‘çš„ç½‘ç«™ä¼šæŠŠä¸Šé¢æ‹¿åˆ°çš„ Client Id äº¤ç»™ç”¨æˆ·ï¼Œè®©ä»–è¿›å…¥åˆ° Github çš„æˆæƒé¡µé¢ï¼ŒGithub çœ‹åˆ°äº†ç”¨æˆ·æ‰‹ä¸­çš„é—¨ç¥¨ï¼Œå°±çŸ¥é“è¿™æ˜¯æˆ‘çš„ç½‘ç«™è®©ä»–è¿‡æ¥çš„ï¼Œäºæ˜¯å®ƒå°±æŠŠæˆ‘çš„ç½‘ç«™æƒ³è¦è·å–çš„æƒé™æ‘†å‡ºæ¥ï¼Œå¹¶è¯¢é—®ç”¨æˆ·æ˜¯å¦å…è®¸æˆ‘è·å–è¿™äº›æƒé™ã€‚</p><p>å¦‚æœç”¨æˆ·è§‰å¾—æˆ‘çš„ç½‘ç«™è¦çš„æƒé™å¤ªå¤šï¼Œæˆ–è€…å‹æ ¹å°±ä¸æƒ³æˆ‘çŸ¥é“ä»–è¿™äº›ä¿¡æ¯ï¼Œé€‰æ‹©äº†æ‹’ç»çš„è¯ï¼Œæ•´ä¸ª OAuth 2.0 çš„è®¤è¯å°±ç»“æŸäº†ï¼Œè®¤è¯ä¹Ÿä»¥å¤±è´¥å‘Šç»ˆã€‚å¦‚æœç”¨æˆ·è§‰å¾— OKï¼Œåœ¨æˆæƒé¡µé¢ç‚¹å‡»äº†ç¡®è®¤æˆæƒåï¼Œé¡µé¢ä¼šè·³è½¬åˆ°æˆ‘é¢„å…ˆè®¾å®šçš„Â <code>redirect_uri</code>Â å¹¶é™„å¸¦ä¸€ä¸ªç›–äº†ç« çš„é—¨ç¥¨ codeã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œç”¨æˆ·å’Œ Github ä¹‹é—´çš„åå•†å°±å·²ç»å®Œæˆï¼ŒGithub ä¹Ÿä¼šåœ¨è‡ªå·±çš„ç³»ç»Ÿä¸­è®°å½•è¿™æ¬¡åå•†ï¼Œè¡¨ç¤ºè¯¥ç”¨æˆ·å·²ç»å…è®¸åœ¨æˆ‘çš„ç½‘ç«™è®¿é—®ä¸Šç›´æ¥æ“ä½œå’Œä½¿ç”¨ä»–çš„éƒ¨åˆ†èµ„æºã€‚</p><p>è¿™ä¸ªä¸­é—´ä¼šæ¶‰åŠåˆ°éå¸¸å¤šçš„æµç¨‹ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨pythonåŸºäºflaskæ¥æ¼”ç¤ºæ•´ä¸ªæµç¨‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># githubç”Ÿæˆçš„ä¸¤æŠŠé’¥åŒ™</span><br>client_id = <span class="hljs-string">&#x27;1f93ab8ba338b032b8e7&#x27;</span><br>client_secret = <span class="hljs-string">&#x27;f0cf5600d2749d1651f2d5f7225c81f562******&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    url = <span class="hljs-string">&#x27;https://github.com/login/oauth/authorize&#x27;</span><br>    params = &#123;<br>        <span class="hljs-string">&#x27;client_id&#x27;</span>: client_id,<br>        <span class="hljs-comment"># å¦‚æœä¸å¡«å†™redirect_urié‚£ä¹ˆé»˜è®¤è·³è½¬åˆ°oauthä¸­é…ç½®çš„callback urlã€‚</span><br>        <span class="hljs-comment"># &#x27;redirect_uri&#x27;: &#x27;http://dig404.com/oauth2/github/callback&#x27;,</span><br>        <span class="hljs-string">&#x27;scope&#x27;</span>: <span class="hljs-string">&#x27;read:user&#x27;</span>,<br>        <span class="hljs-comment"># éšæœºå­—ç¬¦ä¸²ï¼Œé˜²æ­¢csrfæ”»å‡»</span><br>        <span class="hljs-string">&#x27;state&#x27;</span>: <span class="hljs-string">&#x27;An unguessable random string.&#x27;</span>,<br>        <span class="hljs-string">&#x27;allow_signup&#x27;</span>: <span class="hljs-string">&#x27;true&#x27;</span><br>    &#125;<br>    url = furl(url).<span class="hljs-built_in">set</span>(params)<br>    <span class="hljs-keyword">return</span> redirect(url, <span class="hljs-number">302</span>)<br></code></pre></td></tr></table></figure><p>å½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è®¿é—®127.0.0.1:5000çš„æ—¶å€™ï¼Œflaskä¼šå°†è¯·æ±‚é‡å®šå‘åˆ°githubçš„oauthæœåŠ¡é¡µé¢ï¼Œé‡å®šå‘çš„urlä¼šæºå¸¦ä¸Šä¸¤ä¸ªä¸»è¦çš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯client_idï¼Œä¸€ä¸ªæ˜¯scopeï¼Œè¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥è®©githubçŸ¥é“è¿™ä¸ªè¯·æ±‚æ˜¯ä»å“ªé‡Œè¿‡æ¥çš„ï¼Œå¹¶ä¸”æƒ³è¦è·å–çš„æƒé™ã€‚</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcubWVpd2VuLmNvbS5jbi9pMTcwODkxMS9lZWRjNzZmMjY0ODE1OWU0LnBuZw?x-oss-process=image/format,png"></p><p>è®¿é—®125.0.0.1:5000åflaské‡å®šå‘åˆ°githubæˆæƒé¡µé¢<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcubWVpd2VuLmNvbS5jbi9pMTcwODkxMS84ZjM3NWVkN2VkZmNiNzJiLnBuZw?x-oss-process=image/format,png"></p><p>å¦‚æœæ²¡æœ‰ç™»é™†githubé‚£ä¹ˆé¦–å…ˆgithubä¼šå…ˆè·³è½¬åˆ°ç”¨æˆ·çš„ç™»é™†é¡µé¢<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcubWVpd2VuLmNvbS5jbi9pMTcwODkxMS8yYTExNDhjNjc0N2JmNDA4LnBuZw?x-oss-process=image/format,png"></p><p>ç”¨æˆ·ç™»é™†è‡ªå·±çš„githubè´¦å·</p><p><img src="https://img-blog.csdnimg.cn/20200416165941162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQ3NDU0MA==,size_16,color_FFFFFF,t_70"></p><p>ç™»é™†æˆåŠŸåè·³è½¬åˆ°æˆæƒé¡µé¢</p><p><img src="https://img-blog.csdnimg.cn/20200416165956689.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQ3NDU0MA==,size_16,color_FFFFFF,t_70"></p><p>ç‚¹å‡»æˆæƒågithubè·³è½¬åˆ°ä¹‹å‰è®¾ç½®çš„callbacké¡µé¢</p><p>å…¶ä¸­æœ€ç»ˆé‡å®šå‘urlä¸­çš„codeå‚æ•°å°±æ˜¯githubåˆ†é…çš„é’ˆå¯¹å½“å‰ç™»é™†ç”¨æˆ·çš„æˆæƒç ï¼Œä¹Ÿå°±æ˜¯ä¸€å¼ é—¨ç¥¨ã€‚åœ¨githubçš„åå°ï¼Œè¿™ä¸ªcodeå’Œclient_idï¼Œuseræ˜¯å¯¹åº”çš„ã€‚</p><p>åˆ°è¿™é‡Œç”¨æˆ·å’Œgithubä¹‹é—´çš„åå•†å°±å®Œæˆäº†ï¼Œå‰©ä¸‹çš„äº‹æƒ…å°±æ˜¯ç½‘ç«™å’Œgithubä¹‹é—´çš„äº‹æƒ…äº†ã€‚</p><p>3. ä» Github è·å–ç”¨æˆ·çš„ä¿¡æ¯</p><p>ç¬¬äºŒæ­¥ä¸­ï¼Œå·²ç»æ‹¿åˆ°äº†ç›–è¿‡ç« çš„é—¨ç¥¨ codeï¼Œä½†è¿™ä¸ª code åªèƒ½è¡¨æ˜ï¼Œç”¨æˆ·å…è®¸æˆ‘çš„ç½‘ç«™ä» github ä¸Šè·å–è¯¥ç”¨æˆ·çš„æ•°æ®ï¼Œå¦‚æœæˆ‘ç›´æ¥æ‹¿è¿™ä¸ª code å» github è®¿é—®æ•°æ®ä¸€å®šä¼šè¢«æ‹’ç»ï¼Œå› ä¸ºä»»ä½•äººéƒ½å¯ä»¥æŒæœ‰ codeï¼Œgithub å¹¶ä¸çŸ¥é“ code æŒæœ‰æ–¹å°±æ˜¯æˆ‘æœ¬äººã€‚</p><p>è¿˜è®°å¾—ä¹‹å‰ç”³è¯·åº”ç”¨çš„æ—¶å€™ github ç»™æˆ‘çš„ä¸¤å¼ é—¨ç¥¨ä¹ˆï¼ŒClient Id åœ¨ä¸Šä¸€æ­¥ä¸­å·²ç»ç”¨è¿‡äº†ï¼Œæ¥ä¸‹æ¥è½®åˆ°å¦ä¸€å¼ é—¨ç¥¨ Client Secretã€‚</p><p>åˆ›å»ºä¸€ä¸ªå¤„ç†callbackè·¯ç”±çš„å¤„ç†å‡½æ•°ï¼Œé¦–å…ˆæ˜¯è·å–githubè¿”å›çš„codeã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/oauth2/&lt;service&gt;/callback&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">oauth2_callback</span>(<span class="hljs-params">service</span>):<br>    <span class="hljs-built_in">print</span>(service)<br><br>    code = request.args.get(<span class="hljs-string">&#x27;code&#x27;</span>)<br>    <span class="hljs-comment"># æ ¹æ®è¿”å›çš„codeè·å–access token</span><br>    access_token_url = <span class="hljs-string">&#x27;https://github.com/login/oauth/access_token&#x27;</span><br>    payload = &#123;<br>        <span class="hljs-string">&#x27;client_id&#x27;</span>: client_id,<br>        <span class="hljs-string">&#x27;client_secret&#x27;</span>: client_secret,<br>        <span class="hljs-string">&#x27;code&#x27;</span>: code,<br>        <span class="hljs-comment"># &#x27;redirect_uri&#x27;:</span><br>        <span class="hljs-string">&#x27;state&#x27;</span>: <span class="hljs-string">&#x27;An unguessable random string.&#x27;</span><br>    &#125;<br>    r = requests.post(access_token_url, json=payload, headers=&#123;<span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>&#125;)<br>    access_token = json.loads(r.text).get(<span class="hljs-string">&#x27;access_token&#x27;</span>)<br>    <span class="hljs-comment"># æ‹¿åˆ°access tokenä¹‹åå°±å¯ä»¥å»è¯»å–ç”¨æˆ·çš„ä¿¡æ¯äº†</span><br>    access_user_url = <span class="hljs-string">&#x27;https://api.github.com/user&#x27;</span><br>    r = requests.get(access_user_url, headers=&#123;<span class="hljs-string">&#x27;Authorization&#x27;</span>: <span class="hljs-string">&#x27;token &#x27;</span> + access_token&#125;)<br>    <span class="hljs-keyword">return</span> jsonify(&#123;<br>        <span class="hljs-string">&#x27;status&#x27;</span>: <span class="hljs-string">&#x27;success&#x27;</span>,<br>        <span class="hljs-string">&#x27;data&#x27;</span>: json.loads(r.text)<br>    &#125;)<br></code></pre></td></tr></table></figure><p>æ‹¿ç€ç”¨æˆ·ç›–è¿‡ç« çš„ code å’Œèƒ½å¤Ÿæ ‡è¯†ä¸ªäººèº«ä»½çš„ client_idã€client_secret å»æ‹œè®¿ githubï¼Œæ‹¿åˆ°æœ€åçš„ç»¿å¡ access_tokenã€‚</p><p>æœ‰äº†access_tokenä¹‹åå°±å¯ä»¥è¯»å–ç”¨æˆ·æˆæƒçš„ä¿¡æ¯äº†ï¼Œæœ€åä¸ºäº†æ¼”ç¤ºæˆ‘æŠŠè¯»å–åˆ°çš„ä¿¡æ¯å›æ˜¾åˆ°äº†ç½‘é¡µä¸Šã€‚<br>è¿™å…¶ä¸­çš„è¿‡ç¨‹å¯¹äºç”¨æˆ·æ¥è¯´ä¸å¯è§çš„ï¼Œç”¨æˆ·æœ€ç»ˆåœ¨æµè§ˆå™¨ä¸­çš„urlè¿˜æ˜¯ç¬¬äºŒæ­¥é‡å®šå‘çš„urlã€‚</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcubWVpd2VuLmNvbS5jbi9pMTcwODkxMS80NzlhZTllYzRiMGZkMTY4LnBuZw?x-oss-process=image/format,png"></p><p>è¯»å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯</p><p>æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯åå…¶å®å°±ç›¸å½“äºç”¨æˆ·å·²ç»ç™»é™†äº†ï¼Œä¸‹ä¸€æ­¥å°±å¯ä»¥åŸºäºè·å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯å¯¹ç”¨æˆ·åšä¸€äº›ä¸šåŠ¡ç›¸å…³çš„å¤„ç†äº†ã€‚</p><hr><p>æ•´ä¸ª OAuth2 æµç¨‹åœ¨è¿™é‡Œä¹ŸåŸºæœ¬å®Œæˆäº†ï¼Œæ–‡ç« ä¸­çš„è¡¨è¿°å¾ˆç²—ç³™ï¼Œæ¯”å¦‚ access_token è¿™ä¸ªç»¿å¡æ˜¯æœ‰è¿‡æœŸæ—¶é—´çš„ï¼Œå¦‚æœè¿‡æœŸäº†éœ€è¦ä½¿ç”¨ refresh_token é‡æ–°ç­¾è¯ã€‚é‡ç‚¹æ˜¯è®©è¯»è€…ç†è§£æ•´ä¸ªæµç¨‹ï¼Œç»†èŠ‚éƒ¨åˆ†å¯ä»¥é˜…è¯»Â <a href="http://www.rfcreader.com/#rfc6749">RFC6749 æ–‡æ¡£</a>ã€‚</p><p>å¸Œæœ›å¯¹ä½ ç†è§£ OAuth 2.0 æœ‰å¸®åŠ©ã€‚</p><p>è½¬è‡ªï¼š<a href="https://www.meiwen.com.cn/subject/iqncpftx.html">https://www.meiwen.com.cn/subject/iqncpftx.html</a></p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python jwt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python å¸¸ç”¨åº“ æ¨¡å— æ’ä»¶ å¤§å…¨</title>
    <link href="/2020/04/16/Python%20%E5%B8%B8%E7%94%A8%E5%BA%93%20%E6%A8%A1%E5%9D%97%20%E6%8F%92%E4%BB%B6%20%E5%A4%A7%E5%85%A8/"/>
    <url>/2020/04/16/Python%20%E5%B8%B8%E7%94%A8%E5%BA%93%20%E6%A8%A1%E5%9D%97%20%E6%8F%92%E4%BB%B6%20%E5%A4%A7%E5%85%A8/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p><strong><a href="https://www.jianshu.com/p/3a299e7beefd">python å¸¸ç”¨åº“å¤§å…¨ æ•´ç†ç‰ˆ</a></strong></p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python ç¼–ç¨‹è¯­è¨€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åº[object,object]è¿™æ ·çš„æ•°æ®å¦‚ä½•æ‰“å°å‡ºæ¥ æ–¹ä¾¿è°ƒè¯•~</title>
    <link href="/2020/04/15/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%5Bobject,object%5D%E8%BF%99%E6%A0%B7%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A6%82%E4%BD%95%E6%89%93%E5%8D%B0%E5%87%BA%E6%9D%A5%20%E6%96%B9%E4%BE%BF%E8%B0%83%E8%AF%95~/"/>
    <url>/2020/04/15/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%5Bobject,object%5D%E8%BF%99%E6%A0%B7%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A6%82%E4%BD%95%E6%89%93%E5%8D%B0%E5%87%BA%E6%9D%A5%20%E6%96%B9%E4%BE%BF%E8%B0%83%E8%AF%95~/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><blockquote><p>ä½ è‚¯å®šä¼šé‡åˆ°è¿‡æ‰“å°jsonæ•°æ®æˆ–è€…objectç±»å‹çš„æ•°æ®çš„æ—¶å€™ï¼Œçœ‹ä¸åˆ°æ•°æ®å†…å®¹çš„æƒ…å†µï¼Œé‚£ä¹ˆä½ å¯ä»¥å¾€ä¸‹çœ‹ã€‚</p></blockquote><p>å…ˆä¸Šæ¥å£è·å–æ•°æ®çš„ç›¸å…³ä»£ç </p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">// è·å–ç¤¾ä¿ç¼´è´¹å¹´ä»½åˆ—è¡¨. å‚æ•°ä¸ºè¢«æŸ¥è¯¢äººçš„id</span><br>  insurance_YearInfo(userId) &#123;<br>    <span class="hljs-keyword">var</span> that = this<br>    api.post(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;wxapp/chaxun/get_detail_year&#x27;</span>,<br>      <span class="hljs-attr">data</span>: &#123;<br>        <span class="hljs-attr">userid</span>: userId,<br>        <span class="hljs-attr">account</span>:that.data.idCard,<br>      &#125;,<br>      <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (data.code == <span class="hljs-number">1</span>) &#123; <br>         <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(data);<br>         <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;get_detail_yearæ¥å£ä¸­dataæ•°æ®å¦‚ä¸‹&#x27;</span>+data);<br>         <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;get_detail_yearæ¥å£ä¸­dataæ•°æ®å¦‚ä¸‹&#x27;</span>,data);<br>          <br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> item in data.data)&#123;<br>          data.data[item].isHidden = <span class="hljs-literal">true</span>;<br>          data.data[item].yearisClick = <span class="hljs-literal">false</span>;<br>        &#125;<br>          <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(data);<br><br>          this.setData(&#123; <span class="hljs-comment">// è®¾ç½®æ•°æ®åˆ°UIä¸Š</span><br>            insurance_yearList: data.data<br>          &#125;);<br><br><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-comment">// éšè—åŠ è½½æ¡†</span><br>          <span class="hljs-comment">// wx.hideLoading();</span><br>          api.show_toast(data.msg, <span class="hljs-number">2000</span>);<br>        &#125;<br><br>      &#125;,<br>      <span class="hljs-attr">fail</span>: <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br><br>      &#125;<br>    &#125;);<br>  &#125;,<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœå¦‚ä¸‹</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8yMzY0OTQwLTZhNzUxMzVkY2IxZDAzOTAucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png"></p><p>Â </p><p>ç¬¬1ä¸ªlogçš„å¼Šç«¯:è™½ç„¶èƒ½çœ‹åˆ°æ•°æ®çš„å†…å®¹ï¼Œä½†æ˜¯å‰é¢æ²¡æœ‰æ–‡å­—æè¿°ï¼Œå½“æœ‰å¾ˆå¤šlogè¦æ‰“å°æ—¶å€™ï¼Œå“ªä¸ªlogæ˜¯è‡ªå·±éœ€è¦çš„logéœ€è¦æ‰¾å¾ˆé•¿æ—¶é—´ã€‚</p><p>ç¬¬2ä¸ªlogçš„å¼Šç«¯:è™½ç„¶å‰é¢æœ‰æ–‡å­—æè¿°å…·ä½“æ˜¯å“ªä¸ªæ¥å£çš„logï¼Œä½†æ˜¯æ•°æ®çš„å†…å®¹å±•ç¤ºä¸å‡ºæ¥ã€‚<code>ï¼ˆ+ çš„æ–¹å¼ï¼‰</code></p><p>ç¬¬3ä¸ªlogï¼šæ—¢å¯ä»¥çœ‹åˆ°æ˜¯å“ªä¸ªæ¥å£çš„logï¼Œè€Œä¸”ä¹Ÿçœ‹åˆ°æ•°æ®çš„å†…å®¹ã€‚<code>ï¼ˆ,çš„æ–¹å¼ï¼‰</code></p><h2 id="æ€»ç»“ï¼šå°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ç¬¬3ä¸ªlogçš„æ–¹å¼-æ‰“å°ä½ çš„log"><a href="#æ€»ç»“ï¼šå°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ç¬¬3ä¸ªlogçš„æ–¹å¼-æ‰“å°ä½ çš„log" class="headerlink" title="æ€»ç»“ï¼šå°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ç¬¬3ä¸ªlogçš„æ–¹å¼ æ‰“å°ä½ çš„log"></a>æ€»ç»“ï¼šå°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ç¬¬3ä¸ªlogçš„æ–¹å¼ æ‰“å°ä½ çš„log</h2><p>ä½œè€…ï¼šCoderZb<br>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/342478e4bf54">https://www.jianshu.com/p/342478e4bf54</a><br>æ¥æºï¼šç®€ä¹¦</p>]]></content>
    
    
    <categories>
      
      <category>wechat å°ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javascript å¾®ä¿¡æ¸¸æˆ å°ç¨‹åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flask+ nginx + gunicorn + supervisor éƒ¨ç½²é¡¹ç›®</title>
    <link href="/2020/04/07/Flask+%20nginx%20+%20gunicorn%20+%20supervisor%20%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/"/>
    <url>/2020/04/07/Flask+%20nginx%20+%20gunicorn%20+%20supervisor%20%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h5 id="ç¼–è¾‘manage-py-æ–‡ä»¶-ä½œä¸ºå¯åŠ¨æ–‡ä»¶æ¥ç®¡ç†Flask-app"><a href="#ç¼–è¾‘manage-py-æ–‡ä»¶-ä½œä¸ºå¯åŠ¨æ–‡ä»¶æ¥ç®¡ç†Flask-app" class="headerlink" title="ç¼–è¾‘manage.py æ–‡ä»¶ ä½œä¸ºå¯åŠ¨æ–‡ä»¶æ¥ç®¡ç†Flask app"></a>ç¼–è¾‘manage.py æ–‡ä»¶ ä½œä¸ºå¯åŠ¨æ–‡ä»¶æ¥ç®¡ç†Flask app</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_script <span class="hljs-keyword">import</span> Manager<br><span class="hljs-keyword">from</span> flask_migrate <span class="hljs-keyword">import</span> Migrate, MigrateCommand<br><br>app = Flask(__name__)<br>manager = Manager(app)<br><span class="hljs-comment"># æ•°æ®åº“è¿ç§»åˆå§‹åŒ–</span><br>Migrate(app, db)<br><span class="hljs-comment"># æ·»åŠ è¿ç§»å‘½ä»¤</span><br>manager.add_command(<span class="hljs-string">&quot;db&quot;</span>, MigrateCommand)<br><br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># ä½¿ç”¨managerå¯¹è±¡å¯åŠ¨flaské¡¹ç›®ï¼Œä»£æ›¿app.run()</span><br>    manager.run()<br><br></code></pre></td></tr></table></figure><h5 id="åœ¨supervisor-conf-æ–‡ä»¶ä¸­å¢åŠ -ä»¥ä¸‹program"><a href="#åœ¨supervisor-conf-æ–‡ä»¶ä¸­å¢åŠ -ä»¥ä¸‹program" class="headerlink" title="åœ¨supervisor.conf æ–‡ä»¶ä¸­å¢åŠ  ä»¥ä¸‹program"></a>åœ¨supervisor.conf æ–‡ä»¶ä¸­å¢åŠ  ä»¥ä¸‹program</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">[program:projects]<br>command=/usr/local/<span class="hljs-built_in">bin</span>/gunicorn -w <span class="hljs-number">4</span> -b <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">2020</span> -k gevent manage:app<br>directory=/home/zzz/projects/<br>autostart=true<br>redirect_stderr=true<br>stdout_logfile=/home/server_log/projects.log<br></code></pre></td></tr></table></figure><blockquote><p>directory è¿™é‡Œå¡«å†™é¡¹ç›®çš„è·¯å¾„</p></blockquote><p>å¦‚æœæ²¡æœ‰å†™manage.pyæ–‡ä»¶çš„è¯ commandä¸­ åé¢ä¹Ÿå¯ä»¥ç›´æ¥å†™åˆ›å»ºäº† flask app çš„æ–‡ä»¶<br>å³ åˆå§‹åŒ–äº†è¿™å¥è¯çš„æ–‡ä»¶ app &#x3D; Flask(<strong>name</strong>)</p><h4 id="è¿™æ˜¯gunicorn-çš„ä¸€äº›å¸¸ç”¨å‚æ•°"><a href="#è¿™æ˜¯gunicorn-çš„ä¸€äº›å¸¸ç”¨å‚æ•°" class="headerlink" title="è¿™æ˜¯gunicorn çš„ä¸€äº›å¸¸ç”¨å‚æ•°"></a>è¿™æ˜¯gunicorn çš„ä¸€äº›å¸¸ç”¨å‚æ•°</h4><blockquote><p>-w: æŒ‡å®šworkerçš„æ•°é‡ï¼ˆæ ¹æ®å®é™…æƒ…å†µè®¾å®šï¼‰<br>-bï¼šæŒ‡å®šç»‘å®šçš„åœ°å€å’Œç«¯å£å·<br>-k: æŒ‡å®šworker-classæ¨¡å¼ï¼Œé»˜è®¤ä¸ºsyncï¼Œè¿™é‡Œç”¨geventä½¿ä¹‹å˜ä¸ºå¼‚æ­¥åç¨‹ï¼Œæé«˜æ€§èƒ½ã€‚<br>æœ€åæŒ‡å®šappçš„ä½ç½®ã€‚</p></blockquote><h4 id="nginxçš„ç®€å•é…ç½®"><a href="#nginxçš„ç®€å•é…ç½®" class="headerlink" title="nginxçš„ç®€å•é…ç½®"></a>nginxçš„ç®€å•é…ç½®</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">server &#123;<br>    listen <span class="hljs-number">80</span>(ç›‘å¬çš„ç«¯å£);<br>    server_name ipåœ°å€æˆ–è€…åŸŸå;<br>    <br>    location / &#123;<br>  proxy_pass http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">2020</span>(è½¬å‘è‡³çš„ç«¯å£);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>nginx çš„è¯¦ç»†é…ç½®å¯ä»¥å‚è€ƒï¼š</strong><br><a href="https://blog.csdn.net/qq_40036754/article/details/102463099">nginx è¯¦è§£</a></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx linux python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQL è¯­å¥å¤§å…¨(æ”¶è—)</title>
    <link href="/2020/04/07/SQL%20%E8%AF%AD%E5%8F%A5%E5%A4%A7%E5%85%A8(%E6%94%B6%E8%97%8F)/"/>
    <url>/2020/04/07/SQL%20%E8%AF%AD%E5%8F%A5%E5%A4%A7%E5%85%A8(%E6%94%B6%E8%97%8F)/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h3 id="ä¸€ã€åŸºç¡€"><a href="#ä¸€ã€åŸºç¡€" class="headerlink" title="ä¸€ã€åŸºç¡€"></a>ä¸€<strong>ã€åŸºç¡€</strong></h3><p><strong>1ã€è¯´æ˜ï¼šåˆ›å»ºæ•°æ®åº“<br>CREATE DATABASE database-name CHARACTER SET utf8 COLLATE utf8_general_ci</strong><br><strong>2****ã€è¯´æ˜ï¼šåˆ é™¤æ•°æ®åº“<br>drop database dbname</strong><br><strong>3ã€è¯´æ˜ï¼šåˆ›å»ºæ–°è¡¨<br>create table tabname(col1 type1 [not null] [primary key],col2 type2 [not null],..)</strong></p><p><strong>æ ¹æ®å·²æœ‰çš„è¡¨åˆ›å»ºæ–°è¡¨ï¼šÂ **<br><strong>Aï¼šcreate table tab_new like tab_old (ä½¿ç”¨æ—§è¡¨åˆ›å»ºæ–°è¡¨)</strong><br><strong>B<strong><strong>ï¼šcreate table tab_new as select col1,col2â€¦ from tab_old definition only</strong></strong>5ã€è¯´æ˜ï¼šåˆ é™¤æ–°è¡¨<br>drop table tabname</strong>Â <br><strong>6ã€è¯´æ˜ï¼šå¢åŠ ä¸€ä¸ªåˆ—<br>Alter table tabname add column col type****æ³¨</strong>ï¼šåˆ—å¢åŠ åå°†ä¸èƒ½åˆ é™¤ã€‚DB2ä¸­åˆ—åŠ ä¸Šåæ•°æ®ç±»å‹ä¹Ÿä¸èƒ½æ”¹å˜ï¼Œå”¯ä¸€èƒ½æ”¹å˜çš„æ˜¯å¢åŠ varcharç±»å‹çš„é•¿åº¦ã€‚<br><strong>7ã€è¯´æ˜ï¼šæ·»åŠ ä¸»é”®</strong>ï¼šÂ <strong>Alter table tabname add primary key(col)Â **<br>è¯´æ˜ï¼šåˆ é™¤ä¸»é”®ï¼š</strong>Â Alter table tabname drop primary key(col)Â *<em><strong>8ã€è¯´æ˜ï¼šåˆ›å»ºç´¢å¼•</strong>ï¼š</em>*create [unique] index idxname on tabname(colâ€¦.)Â **<br>åˆ é™¤ç´¢å¼•ï¼š</strong>drop index idxname**<br>æ³¨ï¼šç´¢å¼•æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œæƒ³æ›´æ”¹å¿…é¡»åˆ é™¤é‡æ–°å»ºã€‚<br><strong>9****ã€è¯´æ˜ï¼šåˆ›å»ºè§†å›¾</strong>ï¼šcreate view viewname as select statementÂ <br><strong>åˆ é™¤è§†å›¾</strong>ï¼šdrop view viewname<br><strong>10****ã€è¯´æ˜ï¼šå‡ ä¸ªç®€å•çš„åŸºæœ¬çš„sqlè¯­å¥<br>é€‰æ‹©ï¼š</strong>select * from table1 whereÂ èŒƒå›´<br><strong>æ’å…¥ï¼š</strong>insert into table1(field1,field2) values(value1,value2)<br><strong>åˆ é™¤ï¼š</strong>delete from table1 whereÂ èŒƒå›´<strong>æ›´æ–°</strong>ï¼šupdate table1 set field1&#x3D;value1 whereÂ èŒƒå›´<br><strong>æŸ¥æ‰¾</strong>ï¼šselect * from table1 where field1 like â€™%value1%â€™ -â€“likeçš„è¯­æ³•å¾ˆç²¾å¦™ï¼ŒæŸ¥èµ„æ–™!<br><strong>æ’åº</strong>ï¼šselect * from table1 order by field1,field2 [desc]<br><strong>æ€»æ•°</strong>ï¼šselect count as totalcount from table1<br><strong>æ±‚å’Œ</strong>ï¼šselect sum(field1) as sumvalue from table1<br><strong>å¹³å‡</strong>ï¼šselect avg(field1) as avgvalue from table1<br><strong>æœ€å¤§</strong>ï¼šselect max(field1) as maxvalue from table1<br><strong>æœ€å°</strong>ï¼šselect min(field1) as minvalue from table1<br><strong>11ã€è¯´æ˜ï¼šå‡ ä¸ªé«˜çº§æŸ¥è¯¢è¿ç®—è¯<br>Aï¼šÂ UNIONÂ è¿ç®—ç¬¦</strong>Â <br>UNIONÂ è¿ç®—ç¬¦é€šè¿‡ç»„åˆå…¶ä»–ä¸¤ä¸ªç»“æœè¡¨ï¼ˆä¾‹å¦‚Â TABLE1Â å’ŒÂ TABLE2ï¼‰å¹¶æ¶ˆå»è¡¨ä¸­ä»»ä½•é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“Â ALLÂ éšÂ UNIONÂ ä¸€èµ·ä½¿ç”¨æ—¶ï¼ˆå³Â UNION ALLï¼‰ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ´¾ç”Ÿè¡¨çš„æ¯ä¸€è¡Œä¸æ˜¯æ¥è‡ªÂ TABLE1Â å°±æ˜¯æ¥è‡ªÂ TABLE2ã€‚Â <br><strong>Bï¼šÂ EXCEPTÂ è¿ç®—ç¬¦Â <br>EXCEPT</strong>è¿ç®—ç¬¦é€šè¿‡åŒ…æ‹¬æ‰€æœ‰åœ¨Â TABLE1Â ä¸­ä½†ä¸åœ¨Â TABLE2Â ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“Â ALLÂ éšÂ EXCEPTÂ ä¸€èµ·ä½¿ç”¨æ—¶Â (EXCEPT ALL)ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚<br><strong>Cï¼šÂ INTERSECTÂ è¿ç®—ç¬¦<br>INTERSECT</strong>è¿ç®—ç¬¦é€šè¿‡åªåŒ…æ‹¬Â TABLE1Â å’ŒÂ TABLE2Â ä¸­éƒ½æœ‰çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“Â <strong>ALL</strong>éšÂ INTERSECTÂ ä¸€èµ·ä½¿ç”¨æ—¶Â (INTERSECT ALL)ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚Â <br><strong>æ³¨ï¼š</strong>ä½¿ç”¨è¿ç®—è¯çš„å‡ ä¸ªæŸ¥è¯¢ç»“æœè¡Œå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚Â <br><strong>12****ã€è¯´æ˜ï¼šä½¿ç”¨å¤–è¿æ¥Â **<br>Aã€</strong>leftÂ ï¼ˆouterï¼‰Â join<strong>ï¼šÂ <br>å·¦å¤–è¿æ¥ï¼ˆå·¦è¿æ¥ï¼‰ï¼šç»“æœé›†å‡ åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œä¹ŸåŒ…æ‹¬å·¦è¿æ¥è¡¨çš„æ‰€æœ‰è¡Œã€‚Â <br>SQL: select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a &#x3D; b.c<br><strong>Bï¼šrightÂ ï¼ˆouterï¼‰Â join:Â **<br>å³å¤–è¿æ¥(å³è¿æ¥)ï¼šç»“æœé›†æ—¢åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¿æ¥è¡Œï¼Œä¹ŸåŒ…æ‹¬å³è¿æ¥è¡¨çš„æ‰€æœ‰è¡Œã€‚Â <br><strong>Cï¼šfull&#x2F;crossÂ ï¼ˆouterï¼‰Â join</strong>ï¼šÂ <br>å…¨å¤–è¿æ¥ï¼šä¸ä»…åŒ…æ‹¬ç¬¦å·è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œè¿˜åŒ…æ‹¬ä¸¤ä¸ªè¿æ¥è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚<br><strong>12****ã€åˆ†ç»„:Group by:</strong><br>Â Â Â ä¸€å¼ è¡¨ï¼Œä¸€æ—¦åˆ†ç»„ å®Œæˆåï¼ŒæŸ¥è¯¢ååªèƒ½å¾—åˆ°ç»„ç›¸å…³çš„ä¿¡æ¯ã€‚<br>Â Â Â Â ç»„ç›¸å…³çš„ä¿¡æ¯ï¼šï¼ˆç»Ÿè®¡ä¿¡æ¯ï¼‰Â count,sum,max,min,avgÂ Â åˆ†ç»„çš„æ ‡å‡†)<br>Â Â Â Â åœ¨SQLServerä¸­åˆ†ç»„æ—¶ï¼šä¸èƒ½ä»¥text,ntext,imageç±»å‹çš„å­—æ®µä½œä¸ºåˆ†ç»„ä¾æ®<br>Â Â Â åœ¨selecteç»Ÿè®¡å‡½æ•°ä¸­çš„å­—æ®µï¼Œä¸èƒ½å’Œæ™®é€šçš„å­—æ®µæ”¾åœ¨ä¸€èµ·</strong>ï¼›</strong></p><p><strong>13ã€å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼š<br>Â Â Â åˆ†ç¦»æ•°æ®åº“</strong>ï¼š**Â sp_detach_db;é™„åŠ æ•°æ®åº“<strong>ï¼š</strong>sp_attach_dbÂ **åæ¥è¡¨æ˜ï¼Œé™„åŠ éœ€è¦å®Œæ•´çš„è·¯å¾„å<br>**14.**<strong>å¦‚ä½•ä¿®æ”¹æ•°æ®åº“çš„åç§°:</strong><br>Â  Â  sp_renamedb â€˜old_nameâ€™, â€˜new_nameâ€™</p><h3 id="äºŒã€æå‡"><a href="#äºŒã€æå‡" class="headerlink" title="äºŒã€æå‡"></a><strong>äºŒã€æå‡</strong></h3><p><strong>1ã€è¯´æ˜ï¼šå¤åˆ¶è¡¨(åªå¤åˆ¶ç»“æ„,æºè¡¨åï¼šaÂ æ–°è¡¨åï¼šb) (Accesså¯ç”¨)<br>æ³•ä¸€ï¼š</strong>select * into b from a where 1&lt;&gt;1ï¼ˆä»…ç”¨äºSQlServerï¼‰<strong>æ³•äºŒï¼š</strong>select top 0 * into b from a<br><strong>2ã€è¯´æ˜ï¼šæ‹·è´è¡¨(æ‹·è´æ•°æ®,æºè¡¨åï¼šaÂ ç›®æ ‡è¡¨åï¼šb) (Accesså¯ç”¨)</strong><br>insert into b(a, b, c) select d,e,f from b;</p><p><strong>3ã€è¯´æ˜ï¼šè·¨æ•°æ®åº“ä¹‹é—´è¡¨çš„æ‹·è´(å…·ä½“æ•°æ®ä½¿ç”¨ç»å¯¹è·¯å¾„) (Accesså¯ç”¨)</strong><br>insert into b(a, b, c) select d,e,f from b in â€˜å…·ä½“æ•°æ®åº“â€™ whereÂ æ¡ä»¶<br>ä¾‹å­ï¼š..from b in â€˜â€œ&amp;Server.MapPath(â€œ.â€)&amp;â€œ\data.mdbâ€ &amp;â€œâ€˜ where..</p><p><strong>4ã€è¯´æ˜ï¼šå­æŸ¥è¯¢(è¡¨å1ï¼šaÂ è¡¨å2ï¼šb)</strong><br>select a,b,c from a where a IN (select d from b )Â æˆ–è€…: select a,b,c from a where a IN (1,2,3)</p><p><strong>5ã€è¯´æ˜ï¼šæ˜¾ç¤ºæ–‡ç« ã€æäº¤äººå’Œæœ€åå›å¤æ—¶é—´</strong><br>select a.title,a.username,b.adddate from table a,(select max(adddate) adddate from table where table.title&#x3D;a.title) b</p><p><strong>6ã€è¯´æ˜ï¼šå¤–è¿æ¥æŸ¥è¯¢(è¡¨å1ï¼šaÂ è¡¨å2ï¼šb)</strong><br>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a &#x3D; b.c</p><p><strong>7ã€è¯´æ˜ï¼šåœ¨çº¿è§†å›¾æŸ¥è¯¢(è¡¨å1ï¼ša )</strong><br>select * from (SELECT a,b,c FROM a) T where t.a &gt; 1;</p><p><strong>8ã€è¯´æ˜ï¼šbetweençš„ç”¨æ³•,betweené™åˆ¶æŸ¥è¯¢æ•°æ®èŒƒå›´æ—¶åŒ…æ‹¬äº†è¾¹ç•Œå€¼,not betweenä¸åŒ…æ‹¬</strong><br>select * from table1 where time between time1 and time2<br>select a,b,c, from table1 where a not betweenÂ æ•°å€¼1 andÂ æ•°å€¼2</p><p><strong>9ã€è¯´æ˜ï¼šinÂ çš„ä½¿ç”¨æ–¹æ³•</strong><br>select * from table1 where a [not] in (â€˜å€¼1â€™,â€™å€¼2â€™,â€™å€¼4â€™,â€™å€¼6â€™)</p><p>**10ã€è¯´æ˜ï¼šä¸¤å¼ å…³è”è¡¨ï¼Œåˆ é™¤ä¸»è¡¨ä¸­å·²ç»åœ¨å‰¯è¡¨ä¸­æ²¡æœ‰çš„ä¿¡æ¯Â **<br>delete from table1 where not exists ( select * from table2 where table1.field1&#x3D;table2.field1 )</p><p><strong>11ã€è¯´æ˜ï¼šå››è¡¨è”æŸ¥é—®é¢˜ï¼š</strong><br>select * from a left inner join b on a.a&#x3D;b.b right inner join c on a.a&#x3D;c.c inner join d on a.a&#x3D;d.d whereÂ â€¦..</p><p>**12ã€è¯´æ˜ï¼šæ—¥ç¨‹å®‰æ’æå‰äº”åˆ†é’Ÿæé†’Â **<br>SQL: select * fromÂ æ—¥ç¨‹å®‰æ’Â where datediff(â€˜minuteâ€™,få¼€å§‹æ—¶é—´,getdate())&gt;5</p><p><strong>13<strong><strong>ã€è¯´æ˜ï¼šä¸€æ¡</strong></strong>sqlÂ *<em><strong>è¯­å¥æå®šæ•°æ®åº“åˆ†é¡µ</strong>select top 10 b.* from (select top 20Â ä¸»é”®å­—æ®µ,æ’åºå­—æ®µÂ fromÂ è¡¨åÂ order byÂ æ’åºå­—æ®µÂ desc) a,è¡¨åÂ b where b.ä¸»é”®å­—æ®µÂ &#x3D; a.ä¸»é”®å­—æ®µÂ order by a.æ’åºå­—æ®µ</em>*å…·ä½“å®ç°ï¼š</strong>å…³äºæ•°æ®åº“åˆ†é¡µï¼š</p><p>Â Â declare @start int,@end int</p><p>Â Â @sqlÂ Â nvarchar(600)</p><p>Â Â set @sql&#x3D;â€™select topâ€™+str(@end-@start+1)+â€™+from T where rid not in(select topâ€™+str(@str-1)+â€™Rid from T where Rid&gt;-1)â€™</p><p>Â Â exec sp_executesql @sql</p><p><strong>æ³¨æ„ï¼šåœ¨<strong><strong>top</strong></strong>åä¸èƒ½ç›´æ¥è·Ÿä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥åœ¨å®é™…åº”ç”¨ä¸­åªæœ‰è¿™æ ·çš„è¿›è¡Œç‰¹æ®Šçš„å¤„ç†ã€‚<strong><strong>Rid</strong></strong>ä¸ºä¸€ä¸ªæ ‡è¯†åˆ—ï¼Œå¦‚æœ<strong><strong>top</strong></strong>åè¿˜æœ‰å…·ä½“çš„å­—æ®µï¼Œè¿™æ ·åšæ˜¯éå¸¸æœ‰å¥½å¤„çš„ã€‚å› ä¸ºè¿™æ ·å¯ä»¥é¿å…**</strong>Â top<strong><strong>çš„å­—æ®µå¦‚æœæ˜¯é€»è¾‘ç´¢å¼•çš„ï¼ŒæŸ¥è¯¢çš„ç»“æœåå®é™…è¡¨ä¸­çš„ä¸ä¸€è‡´ï¼ˆ</strong></strong>é€»è¾‘ç´¢å¼•ä¸­çš„æ•°æ®æœ‰å¯èƒ½å’Œæ•°æ®è¡¨ä¸­çš„ä¸ä¸€è‡´ï¼Œè€ŒæŸ¥è¯¢æ—¶å¦‚æœå¤„åœ¨ç´¢å¼•åˆ™é¦–å…ˆæŸ¥è¯¢ç´¢å¼•**<strong>ï¼‰</strong></p><p><strong>14ã€è¯´æ˜ï¼šå‰10æ¡è®°å½•</strong><br>select top 10 * form table1 whereÂ èŒƒå›´</p><p><strong>15ã€è¯´æ˜ï¼šé€‰æ‹©åœ¨æ¯ä¸€ç»„bå€¼ç›¸åŒçš„æ•°æ®ä¸­å¯¹åº”çš„aæœ€å¤§çš„è®°å½•çš„æ‰€æœ‰ä¿¡æ¯(ç±»ä¼¼è¿™æ ·çš„ç”¨æ³•å¯ä»¥ç”¨äºè®ºå›æ¯æœˆæ’è¡Œæ¦œ,æ¯æœˆçƒ­é”€äº§å“åˆ†æ,æŒ‰ç§‘ç›®æˆç»©æ’å,ç­‰ç­‰.)</strong><br>selectÂ a,b,cÂ fromÂ tablename taÂ where a&#x3D;(select max(a) from tablename tb where tb.b&#x3D;ta.b)</p><p><strong>16ã€è¯´æ˜ï¼šåŒ…æ‹¬æ‰€æœ‰åœ¨Â TableAä¸­ä½†ä¸åœ¨Â TableBå’ŒTableCä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨</strong><br>(select a from tableA ) except (select a from tableB) except (select a from tableC)</p><p><strong>17ã€è¯´æ˜ï¼šéšæœºå–å‡º10æ¡æ•°æ®</strong><br>select top 10 * fromÂ tablenameÂ order byÂ <strong>newid()</strong></p><p><strong>18ã€è¯´æ˜ï¼šéšæœºé€‰æ‹©è®°å½•</strong><br>select newid()</p><p>**19ã€è¯´æ˜ï¼šåˆ é™¤é‡å¤è®°å½•<br>1),**delete from tablename where id not in (select max(id) from tablename group by col1,col2,â€¦)<br><strong>2)</strong>,select distinct * into temp fromÂ tablename<br>Â Â delete fromÂ tablename<br>Â Â insert intoÂ tablenameÂ select * from temp<br><strong>è¯„ä»·ï¼š è¿™ç§æ“ä½œç‰µè¿å¤§é‡çš„æ•°æ®çš„ç§»åŠ¨ï¼Œè¿™ç§åšæ³•ä¸é€‚åˆå¤§å®¹é‡ä½†æ•°æ®æ“ä½œ3),ä¾‹å¦‚ï¼šåœ¨ä¸€ä¸ªå¤–éƒ¨è¡¨ä¸­å¯¼å…¥æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ç¬¬ä¸€æ¬¡åªå¯¼å…¥äº†ä¸€éƒ¨åˆ†ï¼Œä½†å¾ˆéš¾åˆ¤æ–­å…·ä½“ä½ç½®ï¼Œè¿™æ ·åªæœ‰åœ¨ä¸‹ä¸€æ¬¡å…¨éƒ¨å¯¼å…¥ï¼Œè¿™æ ·ä¹Ÿå°±äº§ç”Ÿå¥½å¤šé‡å¤çš„å­—æ®µï¼Œæ€æ ·åˆ é™¤é‡å¤å­—æ®µ</strong></p><p>alter tableÂ tablename<br>--æ·»åŠ ä¸€ä¸ªè‡ªå¢åˆ—<br>addÂ Â column_bÂ int identity(1,1)<br>Â delete fromÂ tablenameÂ where column_b not in(<br>selectÂ max(column_b)Â Â fromÂ tablenameÂ group byÂ column1,column2,â€¦)<br>alter tableÂ tablenameÂ drop columnÂ column_b</p><p><strong>20ã€è¯´æ˜ï¼šåˆ—å‡ºæ•°æ®åº“é‡Œæ‰€æœ‰çš„è¡¨å</strong><br>select name from sysobjects where type&#x3D;â€™Uâ€™ &#x2F;&#x2F; Uä»£è¡¨ç”¨æˆ·</p><p><strong>21ã€è¯´æ˜ï¼šåˆ—å‡ºè¡¨é‡Œçš„æ‰€æœ‰çš„åˆ—å</strong><br>select name from syscolumns where id&#x3D;object_id(â€˜TableNameâ€™)</p><p><strong>22ã€è¯´æ˜ï¼šåˆ—ç¤ºtypeã€venderã€pcså­—æ®µï¼Œä»¥typeå­—æ®µæ’åˆ—ï¼Œcaseå¯ä»¥æ–¹ä¾¿åœ°å®ç°å¤šé‡é€‰æ‹©ï¼Œç±»ä¼¼selectÂ ä¸­çš„caseã€‚</strong><br>select type,sum(case vender when â€˜Aâ€™ then pcs else 0 end),sum(case vender when â€˜Câ€™ then pcs else 0 end),sum(case vender when â€˜Bâ€™ then pcs else 0 end) FROM tablename group by type<br><strong>æ˜¾ç¤ºç»“æœï¼š<br>type vender pcs</strong><br>ç”µè„‘Â A 1<br>ç”µè„‘Â A 1<br>å…‰ç›˜Â B 2<br>å…‰ç›˜Â A 2<br>æ‰‹æœºÂ B 3<br>æ‰‹æœºÂ C 3</p><p><strong>23ã€è¯´æ˜ï¼šåˆå§‹åŒ–è¡¨table1</strong></p><p>TRUNCATE TABLE table1</p><p><strong>24ã€è¯´æ˜ï¼šé€‰æ‹©ä»10åˆ°15çš„è®°å½•</strong><br>select top 5 * from (select top 15 * from table order by id asc) table_åˆ«åÂ order by id desc</p>]]></content>
    
    
    <categories>
      
      <category>SQL</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>No application found. Either work inside a view function or push an application context. ï¼ˆFlaskæŠ¥é”™è§£å†³ï¼‰</title>
    <link href="/2020/04/03/No%20application%20found.%20Either%20work%20inside%20a%20view%20function%20or%20push%20an%20application%20context.%20%EF%BC%88Flask%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%EF%BC%89/"/>
    <url>/2020/04/03/No%20application%20found.%20Either%20work%20inside%20a%20view%20function%20or%20push%20an%20application%20context.%20%EF%BC%88Flask%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p><strong>No application found. Either work inside a view function or push an application context.</strong></p><p>flask æŠ¥äº†è¿™ä¸ªé”™,å­—é¢æ„æ€æ˜¯è¯´æ²¡æœ‰åº”ç”¨ä¸Šä¸‹æ–‡,å­—é¢ç»™çš„è§£å†³æ„è§æ˜¯è¦ä¹ˆæ”¾ç½®åœ¨ä¸€ä¸ªè§†å›¾å†…,è¦ä¹ˆæä¾›ä¸€ä¸ªåº”ç”¨(flask)ä¸Šä¸‹æ–‡.</p><p>è¿™æ˜¯é‡‡ç”¨crate_app()æ¥åˆ›å»ºFlask app çš„ä¸€ç§é”™è¯¯</p><p>å¯ä»¥é‡‡ç”¨è£…é¥°å™¨æ¥è§£å†³ï¼Œé€šè¿‡app.app_context().push()æ¥æ¨å…¥ä¸€ä¸ªä¸Šä¸‹æ–‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">sqlalchemy_context</span>(<span class="hljs-params">app</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_context</span>(<span class="hljs-params">func</span>):<br><span class="hljs-meta">        @wraps(<span class="hljs-params">func</span>)</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">do_job</span>(<span class="hljs-params">*args, **kwargs</span>):<br>            app.app_context().push()<br>            result = func(*args,**kwargs)<br>            <span class="hljs-keyword">return</span> result<br>        <span class="hljs-keyword">return</span> do_job<br>    <span class="hljs-keyword">return</span> add_context<br></code></pre></td></tr></table></figure><p><strong>å®˜æ–¹è§£é‡Š</strong><br>åº”ç”¨ä¸Šä¸‹æ–‡ç›®çš„<br>åº”ç”¨ä¸Šä¸‹æ–‡å­˜åœ¨çš„ä¸»è¦åŸå› æ˜¯ï¼Œåœ¨è¿‡å»ï¼Œæ²¡æœ‰æ›´å¥½çš„æ–¹å¼æ¥åœ¨è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­é™„åŠ ä¸€å †å‡½æ•°ï¼Œ å› ä¸º Flask è®¾è®¡çš„æ”¯æŸ±ä¹‹ä¸€æ˜¯ä½ å¯ä»¥åœ¨ä¸€ä¸ª Python è¿›ç¨‹ä¸­æ‹¥æœ‰å¤šä¸ªåº”ç”¨ã€‚</p><p>é‚£ä¹ˆä»£ç å¦‚ä½•æ‰¾åˆ°â€œæ­£ç¡®çš„â€åº”ç”¨ï¼Ÿåœ¨è¿‡å»ï¼Œæˆ‘ä»¬æ¨èæ˜¾å¼åœ°åˆ°å¤„ä¼ é€’åº”ç”¨ï¼Œä½†æ˜¯è¿™å¯¼è‡´æ²¡æœ‰ç”¨è¿™ç§æƒ³æ³•è®¾è®¡çš„åº“çš„é—®é¢˜ï¼Œå› ä¸ºè®©åº“å®ç°è¿™ç§æƒ³æ³•å¤ªä¸æ–¹ä¾¿ã€‚</p><p>è§£å†³ä¸Šè¿°é—®é¢˜çš„å¸¸ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨åé¢å°†ä¼šæåˆ°çš„ current_app ä»£ç†ï¼Œå®ƒè¢«é™åˆ¶åœ¨å½“å‰è¯·æ±‚çš„åº”ç”¨å¼•ç”¨ã€‚ æ—¢ç„¶æ— è®ºå¦‚ä½•åœ¨æ²¡æœ‰è¯·æ±‚æ—¶åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„è¯·æ±‚ä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªæ²¡æœ‰å¿…è¦çš„æ˜‚è´µæ“ä½œï¼Œé‚£ä¹ˆå°±å¼•å…¥äº†åº”ç”¨ä¸Šä¸‹æ–‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python å„ç§è¿›åˆ¶ç›¸äº’è½¬æ¢ 16è¿›åˆ¶è½¬æ¢æˆ2è¿›åˆ¶ ä¸å¤Ÿç”¨0è¡¥é½ å‰é¢è¡¥0</title>
    <link href="/2020/03/27/Python%20%E5%90%84%E7%A7%8D%E8%BF%9B%E5%88%B6%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2%2016%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E6%88%902%E8%BF%9B%E5%88%B6%20%E4%B8%8D%E5%A4%9F%E7%94%A80%E8%A1%A5%E9%BD%90%20%E5%89%8D%E9%9D%A2%E8%A1%A50/"/>
    <url>/2020/03/27/Python%20%E5%90%84%E7%A7%8D%E8%BF%9B%E5%88%B6%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2%2016%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E6%88%902%E8%BF%9B%E5%88%B6%20%E4%B8%8D%E5%A4%9F%E7%94%A80%E8%A1%A5%E9%BD%90%20%E5%89%8D%E9%9D%A2%E8%A1%A50/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><table border="2" cellpadding="2" cellspacing="2"><tbody><tr><td>&nbsp;</td><td>2è¿›åˆ¶</td><td>8è¿›åˆ¶</td><td>10è¿›åˆ¶</td><td>16è¿›åˆ¶</td></tr><tr><td>2è¿›åˆ¶</td><td>-</td><td>bin(int(x, 8))</td><td>bin(int(x, 10))</td><td>bin(int(x, 16))</td></tr><tr><td>8è¿›åˆ¶</td><td>oct(int(x, 2))</td><td>-</td><td>oct(int(x, 10))</td><td>oct(int(x, 16))</td></tr><tr><td>10è¿›åˆ¶</td><td>int(x, 2)</td><td>int(x, 8)</td><td>-</td><td>int(x, 16)</td></tr><tr><td>16è¿›åˆ¶</td><td>hex(int(x, 2))</td><td>hex(int(x, 8))</td><td>hex(int(x, 10))</td><td>-</td></tr></tbody></table><p>bin()ã€oct()ã€hex()çš„è¿”å›å€¼å‡ä¸ºå­—ç¬¦ä¸²ï¼Œä¸”åˆ†åˆ«å¸¦æœ‰0bã€0oã€0xå‰ç¼€ã€‚</p><p>æ¯”å¦‚ï¼š2è¿›åˆ¶è½¬æ¢æˆ8è¿›åˆ¶ æ‰§è¡Œ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">oct</span><span class="hljs-params">(int(x, <span class="hljs-number">2</span>)</span></span>)Â  <br></code></pre></td></tr></table></figure><p>ä»¥æ­¤ç±»æ¨</p><p>è¿˜å¯ä»¥é€šè¿‡formatæ–¹æ³•æ¥å®ç°</p><p>10è¿›è¡Œåè¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼ŒäºŒè¿›åˆ¶çš„è½¬æ¢ï¼š<br>(#ï¼šä¿ç•™è¿›åˆ¶å‰ç¼€)</p><p><img src="https://img-blog.csdnimg.cn/20190518151155582.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>Â 16è¿›åˆ¶è½¬æ¢æˆ2è¿›åˆ¶ æƒ³ä¿ç•™8ä½ï¼Œå‰é¢ç”¨0è¡¥é½ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">state_16</span> = <span class="hljs-string">&quot;1C&quot;</span><br><span class="hljs-attr">state_10</span> = int(state_16,<span class="hljs-number">16</span>)<br><span class="hljs-attr">state_2</span> = <span class="hljs-string">&#x27;&#123;:08b&#125;&#x27;</span>.format(state_10)<br></code></pre></td></tr></table></figure><p>Â <img src="https://img-blog.csdnimg.cn/20200327153344141.png"></p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­—ç¬¦ä¸² python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQLAlchemy ä¸­çš„ Session,sessionmaker,scoped_sessionè¯¦è§£</title>
    <link href="/2020/03/25/SQLAlchemy%20%E4%B8%AD%E7%9A%84%20Session,sessionmaker,scoped_session%E8%AF%A6%E8%A7%A3/"/>
    <url>/2020/03/25/SQLAlchemy%20%E4%B8%AD%E7%9A%84%20Session,sessionmaker,scoped_session%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="ä¸€ã€å…³äº-SQLAlchemy"><a href="#ä¸€ã€å…³äº-SQLAlchemy" class="headerlink" title="ä¸€ã€å…³äºÂ SQLAlchemy"></a>ä¸€ã€å…³äºÂ SQLAlchemy</h2><p>ä»€ä¹ˆæ˜¯SQLAlchemyï¼Ÿ</p><p>ç­”ï¼šSQLAlchemyæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“æ¡†æ¶ï¼Œå®ƒæä¾›äº†é«˜å±‚çš„ ORM å’Œåº•å±‚çš„åŸç”Ÿæ•°æ®åº“çš„æ“ä½œï¼Œè®©å¼€å‘è€…ä¸ç”¨ç›´æ¥å’Œ SQL è¯­å¥æ‰“äº¤é“ï¼Œè€Œæ˜¯é€šè¿‡ Python å¯¹è±¡æ¥æ“ä½œæ•°æ®åº“ï¼Œåœ¨èˆå¼ƒä¸€äº›æ€§èƒ½å¼€é”€çš„åŒæ—¶ï¼Œæ¢æ¥çš„æ˜¯å¼€å‘æ•ˆç‡çš„è¾ƒå¤§æå‡ã€‚</p><p>ä¸€å¥è¯ï¼šå°±æ˜¯å¯¹æ•°æ®åº“çš„æŠ½è±¡ï¼</p><hr><p>Session å…¶å® å°±æ˜¯ä¸€ä¸ªä¼šè¯, å¯ä»¥å’Œæ•°æ®åº“æ‰“äº¤é“çš„ä¸€ä¸ªä¼šè¯</p><p>åœ¨ä¸€èˆ¬çš„æ„ä¹‰ä¸Šï¼Œ ä¼šè¯å»ºç«‹ä¸æ•°æ®åº“çš„æ‰€æœ‰å¯¹è¯ï¼Œå¹¶ä¸ºä½ åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­åŠ è½½æˆ–å…³è”çš„æ‰€æœ‰å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªâ€œç­‰å¾…åŒºâ€ã€‚ä»–æä¾›äº†ä¸€ä¸ªå…¥å£ç‚¹è·å¾—æŸ¥è¯¢å¯¹è±¡ï¼Œ å‘æ•°æ®åº“å‘é€æŸ¥è¯¢ï¼Œä½¿ç”¨ä¼šè¯å¯¹è±¡çš„å½“å‰æ•°æ®åº“è¿æ¥ï¼Œ å°†ç»“æœè¡Œå¡«å……åœ¨å¯¹è±¡ä¸­ï¼Œ ç„¶åå­˜å‚¨åœ¨ä¼šè¯ä¸­ï¼Œ åœ¨è¿™ç§ç»“æ„ä¸­ç§°ä¸ºèº«ä»½æ˜ å°„ â€“ è¿™ç§æ•°æ®ç»“æ„ç»´æŠ¤äº†æ¯ä¸€ä¸ªå‰¯æœ¬çš„å”¯ä¸€ï¼Œ è¿™ç§å”¯ä¸€æ„å‘³ç€ä¸€ä¸ªå¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å”¯ä¸€ä¸»é”®ã€‚</p><p>ä¼šè¯ä»¥åŸºæœ¬æ— çŠ¶æ€çš„å½¢å¼å¼€å§‹ï¼Œä¸€æ—¦å‘å‡ºæŸ¥è¯¢æˆ–å…¶ä»–å¯¹è±¡è¢«æŒä¹…åŒ–ï¼Œå®ƒå°±ä¼šä»ä¸€ä¸ªå¼•æ“ç”³è¯·è¿æ¥èµ„æºï¼Œè¯¥å¼•æ“è¦ä¹ˆä¸ä¼šè¯æœ¬èº«ç›¸å…³è”ï¼Œè¦ä¹ˆä¸æ­£åœ¨æ“ä½œçš„æ˜ å°„å¯¹è±¡ç›¸å…³è”ã€‚æ­¤è¿æ¥æ ‡è¯†æ­£åœ¨è¿›è¡Œçš„äº‹åŠ¡ï¼Œ åœ¨ä¼šè¯æäº¤æˆ–å›æ»šå…¶æŒ‚èµ·çŠ¶æ€ä¹‹å‰ï¼Œè¯¥äº‹åŠ¡ä¸€ç›´æœ‰æ•ˆã€‚</p><p>ä¼šè¯ä¸­ç»´æŠ¤çš„æ‰€æœ‰å˜åŒ–çš„å¯¹è±¡éƒ½ä¼šè¢«è·Ÿè¸ª - åœ¨å†æ¬¡æŸ¥è¯¢æ•°æ®åº“æˆ–æäº¤å½“å‰äº‹åŠ¡ä¹‹å‰ï¼Œ å®ƒå°†åˆ·æ–°å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ›´æ”¹ï¼Œ è¿™è¢«ç§°ä¸ºå·¥ä½œæ¨¡å¼å•å…ƒã€‚</p><p>åœ¨ä½¿ç”¨ä¼šè¯æ—¶å€™ï¼Œæœ€é‡è¦çš„æ˜¯è¦æ³¨æ„ä¸å®ƒç›¸å…³è”çš„å¯¹è±¡æ˜¯ä¼šè¯æ‰€æŒæœ‰çš„äº‹åŠ¡çš„ä»£ç†å¯¹è±¡ - ä¸ºäº†ä¿æŒåŒæ­¥ï¼Œæœ‰å„ç§å„æ ·çš„äº‹ä»¶ä¼šå¯¼è‡´å¯¹è±¡é‡æ–°è®¿é—®æ•°æ®åº“ã€‚å¯èƒ½ä»ä¼šè¯ä¸­åˆ†ç¦»å¯¹è±¡å¹¶ç»§ç»­ä½¿ç”¨ä»–ä»¬ï¼Œå°½ç®¡è¿™ç§åšæ³•æœ‰å…¶å±€é™æ€§ã€‚ä½†æ˜¯é€šå¸¸æ¥è¯´ï¼Œå½“ä½ å¸Œæœ›å†æ¬¡ä½¿ç”¨åˆ†ç¦»çš„å¯¹è±¡æ—¶å€™ï¼Œä½ ä¼šå°†ä»–ä»¬ä¸å¦ä¸€ä¸ªä¼šè¯é‡æ–°å…³è”èµ·æ¥ï¼Œ ä»¥ä¾¿ä»–ä»¬èƒ½å¤Ÿæ¢å¤è¡¨ç¤ºæ•°æ®åº“çŠ¶æ€çš„æ­£å¸¸ä»»åŠ¡</p><h3 id="1-Sessionæ˜¯ç¼“å­˜å—ï¼Ÿ"><a href="#1-Sessionæ˜¯ç¼“å­˜å—ï¼Ÿ" class="headerlink" title="1. Sessionæ˜¯ç¼“å­˜å—ï¼Ÿ"></a>1. Sessionæ˜¯ç¼“å­˜å—ï¼Ÿ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">å¯èƒ½ä¼šå°†è¿™é‡Œçš„sessionä¸httpä¸­çš„sessionææ··ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒæœ‰ç‚¹ç”¨ä½œç¼“å­˜ï¼Œå› ä¸ºå®ƒå®ç°äº† èº«ä»½æ˜ å°„ æ¨¡å¼ï¼Œå¹¶å­˜å‚¨äº†é”®å…¥å…¶ä¸»é”®çš„å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå®ƒä¸æ‰§è¡Œä»»ä½•ç±»å‹çš„æŸ¥è¯¢ç¼“å­˜ã€‚<br>æ­¤å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSessionä½¿ç”¨å¼±å¼•ç”¨å­˜å‚¨å¯¹è±¡å®ä¾‹ã€‚è¿™ä¹Ÿè¿èƒŒäº†å°†Sessionç”¨ä½œç¼“å­˜çš„ç›®çš„ã€‚å…³äºsessionå¼ºåº”ç”¨ä¸‹æ¬¡å†è®¨è®ºã€‚<br></code></pre></td></tr></table></figure><h3 id="2-Sessionä½œç”¨ï¼š"><a href="#2-Sessionä½œç”¨ï¼š" class="headerlink" title="2. Sessionä½œç”¨ï¼š"></a>2. Sessionä½œç”¨ï¼š</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1.</span> <span class="hljs-keyword">session</span>åˆ›å»ºå’Œç®¡ç†æ•°æ®åº“è¿æ¥çš„ä¼šè¯<br><span class="hljs-number">2.</span> model <span class="hljs-keyword">object</span> é€šè¿‡<span class="hljs-keyword">session</span>å¯¹è±¡è®¿é—®æ•°æ®åº“ï¼Œå¹¶æŠŠè®¿é—®åˆ°çš„æ•°æ®ä»¥ <span class="hljs-keyword">Identity</span> Mapçš„æ–¹å¼ï¼Œæ˜ å°„åˆ°Model <span class="hljs-keyword">object</span>ä¸­<br></code></pre></td></tr></table></figure><h3 id="3-Sessionç”Ÿå‘½å‘¨æœŸï¼š"><a href="#3-Sessionç”Ÿå‘½å‘¨æœŸï¼š" class="headerlink" title="3. Sessionç”Ÿå‘½å‘¨æœŸï¼š"></a>3. Sessionç”Ÿå‘½å‘¨æœŸï¼š</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1.</span> <span class="hljs-keyword">session</span>åœ¨åˆšè¢«åˆ›å»ºçš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰å’Œä»»ä½•model <span class="hljs-keyword">object</span> ç»‘å®šï¼Œå¯è®¤ä¸ºæ˜¯æ— çŠ¶æ€çš„<br><span class="hljs-number">2.</span> <span class="hljs-keyword">session</span> æ¥å—åˆ°queryæŸ¥è¯¢è¯­å¥, æ‰§è¡Œçš„ç»“æœæˆ–ä¿æŒæˆ–è€…å…³è”åˆ°<span class="hljs-keyword">session</span>ä¸­<br><span class="hljs-number">3.</span> ä»»æ„æ•°é‡çš„model <span class="hljs-keyword">object</span>è¢«åˆ›å»ºï¼Œå¹¶ç»‘å®šåˆ°<span class="hljs-keyword">session</span>ä¸­ï¼Œ<span class="hljs-keyword">session</span>ä¼šç®¡ç†è¿™äº›å¯¹è±¡<br><span class="hljs-number">4.</span> ä¸€æ—¦<span class="hljs-keyword">session</span> é‡Œé¢çš„objects æœ‰å˜åŒ–ï¼Œé‚£å¯æ˜¯è¦<span class="hljs-keyword">commit</span>/<span class="hljs-keyword">rollback</span>æäº¤æˆ–è€…æ”¾å¼ƒchangs<br></code></pre></td></tr></table></figure><h3 id="4-Sessionä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Œæäº¤ï¼Œå…³é—­ï¼Ÿ"><a href="#4-Sessionä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Œæäº¤ï¼Œå…³é—­ï¼Ÿ" class="headerlink" title="4. Sessionä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Œæäº¤ï¼Œå…³é—­ï¼Ÿ"></a>4. Sessionä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Œæäº¤ï¼Œå…³é—­ï¼Ÿ</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ä¸€èˆ¬æ¥è¯´ï¼Œ<span class="hljs-keyword">session</span>åœ¨éœ€è¦è®¿é—®æ•°æ®åº“çš„æ—¶å€™åˆ›å»ºï¼Œåœ¨<span class="hljs-keyword">session</span>è®¿é—®æ•°æ®åº“çš„æ—¶å€™ï¼Œå‡†ç¡®æ¥è¯´ï¼Œåº”è¯¥æ˜¯â€œ<span class="hljs-keyword">add</span>/<span class="hljs-keyword">update</span>/<span class="hljs-keyword">delete</span>â€æ•°æ®åº“çš„æ—¶å€™ï¼Œä¼šå¼€å¯<span class="hljs-keyword">database</span> <span class="hljs-keyword">transaction</span>ã€‚<br><br>å‡è®¾æ²¡æœ‰ä¿®æ”¹autocommitçš„é»˜è®¤å€¼(<span class="hljs-keyword">False</span>), é‚£ä¹ˆï¼Œ<span class="hljs-keyword">database</span> <span class="hljs-keyword">transaction</span> ä¸€ç›´ä¼šä¿æŒï¼Œåªæœ‰ç­‰åˆ°<span class="hljs-keyword">session</span>å‘ç”Ÿrolled backã€<span class="hljs-keyword">committed</span>ã€æˆ–è€…closedçš„æ—¶å€™æ‰ç»“æŸï¼Œä¸€èˆ¬å»ºè®®ï¼Œå½“<span class="hljs-keyword">database</span> <span class="hljs-keyword">transaction</span>ç»“æŸçš„æ—¶å€™ï¼ŒåŒæ—¶<span class="hljs-keyword">close</span> <span class="hljs-keyword">session</span>,ä»¥ä¿è¯ï¼Œæ¯æ¬¡å‘èµ·è¯·æ±‚ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<span class="hljs-keyword">session</span><br><br>ç‰¹åˆ«æ˜¯å¯¹webåº”ç”¨æ¥è¯´ï¼Œå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè‹¥è¯·æ±‚ä½¿ç”¨åˆ°<span class="hljs-keyword">Session</span>è®¿é—®æ•°æ®åº“ï¼Œåˆ™åˆ›å»º<span class="hljs-keyword">session</span>ï¼Œå¤„ç†å®Œè¿™ä¸ªè¯·æ±‚åï¼Œå…³é—­<span class="hljs-keyword">session</span><br></code></pre></td></tr></table></figure><h3 id="4-è·å–ä¸€ä¸ªSessionï¼š"><a href="#4-è·å–ä¸€ä¸ªSessionï¼š" class="headerlink" title="4. è·å–ä¸€ä¸ªSessionï¼š"></a>4. è·å–ä¸€ä¸ªSessionï¼š</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Session</span> æ˜¯ä¸€ä¸ªç›´æ¥å®ä¾‹åŒ–çš„å¸¸è§„çš„Python ç±»ã€‚ç„¶è€Œï¼Œ ä¸ºäº†æ ‡å‡†ä¼šä¼šè¯çš„é…ç½®å’Œè·å–æ–¹å¼ï¼Œ sessionmaker ç±»é€šå¸¸ç”¨äºåˆ›å»ºé¡¶çº§ä¼šè¯é…ç½®ï¼Œ ç„¶åå¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒï¼Œ å°±ä¸éœ€è¦é‡å¤é…ç½®å‚æ•°ã€‚<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯sessionmaker çš„ä½¿ç”¨æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker<br><br><span class="hljs-comment"># åˆ›å»ºè¿æ¥æ•°æ®åº“çš„å¼•æ“ï¼Œsessionè¿æ¥æ•°æ®åº“éœ€è¦</span><br>my_engine = create_engine(<span class="hljs-string">&#x27;mysql+pymysql://root:123456@localhost/my_db&#x27;</span>)<br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªé…ç½®è¿‡çš„Sessionç±»</span><br>Session = sessionmaker(bind=my_engine)<br><br><span class="hljs-comment"># å®ä¾‹åŒ–ä¸€ä¸ªsession</span><br>db_session = Session()<br><br><span class="hljs-comment"># ä½¿ç”¨session</span><br>myobject = MyObject(<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>)<br>db_session.add(myobject)<br>db_session.commit()<br><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢ï¼Œè¯¥**sessionmaker()åˆ›å»ºäº†ä¸€ä¸ªå·¥å‚ç±»ï¼Œåœ¨åˆ›å»ºè¿™ä¸ªå·¥å‚ç±»æ—¶æˆ‘ä»¬é…ç½®äº†å‚æ•°ç»‘å®šäº†å¼•æ“ã€‚å°†å…¶èµ‹å€¼ç»™Sessionã€‚æ¯æ¬¡å®ä¾‹åŒ–Sessionéƒ½ä¼šåˆ›å»ºä¸€ä¸ªç»‘å®šäº†å¼•æ“çš„Sessionã€‚**è¿™æ ·è¿™ä¸ªsessionåœ¨è®¿é—®æ•°æ®åº“æ—¶éƒ½ä¼šé€šè¿‡è¿™ä¸ªç»‘å®šå¥½çš„å¼•æ“æ¥è·å–è¿æ¥èµ„æº<br>å½“ä½ ç¼–å†™åº”ç”¨ç¨‹åºæ—¶ï¼Œ è¯·å°†sessionmaker å·¥å‚æ”¾åœ¨å…¨å±€çº§åˆ«ï¼Œè§†ä½œåº”ç”¨ç¨‹åºé…ç½®çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šåº”ç”¨ç¨‹åºåŒ…ä¸­æœ‰ä¸‰ä¸ª.pyæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å°†è¯¥sessionmakerè¡Œæ”¾åœ¨__init__.pyæ–‡ä»¶ä¸­; åœ¨å…¶ä»–æ¨¡å—â€œfrom mypackage import Sessionâ€ã€‚è¿™æ ·ï¼Œæ‰€æœ‰çš„Session()çš„é…ç½®éƒ½ç”±è¯¥é…ç½®ä¸­å¿ƒæ§åˆ¶ã€‚</p><h3 id="5-å…³äºSQLAlchemy-çš„-create-engineï¼š"><a href="#5-å…³äºSQLAlchemy-çš„-create-engineï¼š" class="headerlink" title="5. å…³äºSQLAlchemy çš„ create_engineï¼š"></a>5. å…³äºSQLAlchemy çš„ create_engineï¼š</h3><p>ç›´æ¥åªç”¨ create_engine æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå¸¦è¿æ¥æ± çš„å¼•æ“ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">my_engine = create<span class="hljs-constructor">_engine(&#x27;<span class="hljs-params">mysql</span>+<span class="hljs-params">pymysql</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">root</span>:123456@<span class="hljs-params">localhost</span><span class="hljs-operator">/</span><span class="hljs-params">my_db</span>&#x27;)</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªsessionï¼Œè¿æ¥æ± ä¼šåˆ†é…ä¸€ä¸ªconnectionã€‚å½“sessionåœ¨ä½¿ç”¨åæ˜¾ç¤ºåœ°è°ƒç”¨ session.close()ï¼Œä¹Ÿä¸èƒ½æŠŠè¿™ä¸ªè¿æ¥å…³é—­ï¼Œè€Œæ˜¯ç”±ç”±QueuePoolè¿æ¥æ± ç®¡ç†å¹¶å¤ç”¨è¿æ¥ã€‚</p><p>ç¡®ä¿ session åœ¨ä½¿ç”¨å®Œæˆåç”¨ session.closeã€session.commit æˆ– session.rollback æŠŠè¿æ¥è¿˜å› poolï¼Œè¿™æ˜¯ä¸€ä¸ªå¿…é¡»åœ¨æ„çš„ä¹ æƒ¯ã€‚</p><p><strong>å…³äºSQLAlchemy æ•°æ®åº“è¿æ¥æ± ï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">session</span> å’Œ <span class="hljs-keyword">connection</span> ä¸æ˜¯ç›¸åŒçš„ä¸œè¥¿ï¼Œ <span class="hljs-keyword">session</span> ä½¿ç”¨è¿æ¥æ¥æ“ä½œæ•°æ®åº“ï¼Œä¸€æ—¦ä»»åŠ¡å®Œæˆ <span class="hljs-keyword">session</span> ä¼šå°†æ•°æ®åº“ <span class="hljs-keyword">connection</span> äº¤è¿˜ç»™ poolã€‚<br><br>åœ¨ä½¿ç”¨ create_engine åˆ›å»ºå¼•æ“æ—¶ï¼Œå¦‚æœé»˜è®¤ä¸æŒ‡å®šè¿æ¥æ± è®¾ç½®çš„è¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSQLAlchemy ä¼šä½¿ç”¨ä¸€ä¸ª QueuePool ç»‘å®šåœ¨æ–°åˆ›å»ºçš„å¼•æ“ä¸Šã€‚å¹¶é™„ä¸Šåˆé€‚çš„è¿æ¥æ± å‚æ•°<br></code></pre></td></tr></table></figure><p>create_engine() å‡½æ•°å’Œè¿æ¥æ± ç›¸å…³çš„å‚æ•°æœ‰ï¼š</p><ul><li>pool_recycle, é»˜è®¤ä¸º -1, æ¨èè®¾ç½®ä¸º 7200, å³å¦‚æœ connection ç©ºé—²äº† 7200 ç§’ï¼Œè‡ªåŠ¨é‡æ–°è·å–ï¼Œä»¥é˜²æ­¢ connection è¢« db server å…³é—­ã€‚</li><li>pool_size&#x3D;5, è¿æ¥æ•°å¤§å°ï¼Œé»˜è®¤ä¸º 5ï¼Œæ­£å¼ç¯å¢ƒè¯¥æ•°å€¼å¤ªå°ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µè°ƒå¤§</li><li>max_overflow&#x3D;10, è¶…å‡º pool_size åå¯å…è®¸çš„æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º 10, è¿™ 10 ä¸ªè¿æ¥åœ¨ä½¿ç”¨è¿‡åï¼Œä¸æ”¾åœ¨ pool ä¸­ï¼Œè€Œæ˜¯è¢«çœŸæ­£å…³é—­çš„ã€‚</li><li>pool_timeout&#x3D;30, è·å–è¿æ¥çš„è¶…æ—¶é˜ˆå€¼ï¼Œé»˜è®¤ä¸º 30 ç§’</li></ul><p>SQLAlchemyä¸ä½¿ç”¨è¿æ¥æ± ï¼š<br>åœ¨åˆ›å»ºå¼•æ“æ—¶æŒ‡å®šå‚æ•° poolclass&#x3D;NullPool å³ç¦ç”¨äº†SQLAlchemyæä¾›çš„æ•°æ®åº“è¿æ¥æ± ã€‚SQLAlchemy å°±ä¼šåœ¨æ‰§è¡Œ session.close() åç«‹åˆ»æ–­å¼€æ•°æ®åº“è¿æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæ²¡æœ‰è¢«è°ƒç”¨ session.close()ï¼Œåˆ™æ•°æ®åº“è¿æ¥ä¸ä¼šè¢«æ–­å¼€ï¼Œç›´åˆ°ç¨‹åºç»ˆæ­¢ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">my_engine = create<span class="hljs-constructor">_engine(&#x27;<span class="hljs-params">mysql</span>+<span class="hljs-params">pymysql</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">root</span>:123456@<span class="hljs-params">localhost</span><span class="hljs-operator">/</span><span class="hljs-params">my_db</span>&#x27;ï¼Œ<span class="hljs-params">poolclass</span>=NullPool)</span><br></code></pre></td></tr></table></figure><p>å…³äº SQLAlchemy çš„ engine ,è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« å†™çš„å¾ˆå¥½ï¼š<a href="http://sunnyingit.github.io/book/section_python/SQLalchemy-engine.html">http://sunnyingit.github.io/book/section_python/SQLalchemy-engine.html</a></p><h3 id="6-å…³äºçº¿ç¨‹å®‰å…¨ï¼š"><a href="#6-å…³äºçº¿ç¨‹å®‰å…¨ï¼š" class="headerlink" title="6. å…³äºçº¿ç¨‹å®‰å…¨ï¼š"></a>6. å…³äºçº¿ç¨‹å®‰å…¨ï¼š</h3><p>sessionä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å°†ä¼šå…±äº«åŒä¸€ä¸ªsessionã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå‡è®¾Açº¿ç¨‹æ­£åœ¨ä½¿ç”¨sessionå¤„ç†æ•°æ®åº“ï¼ŒBçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæˆï¼ŒæŠŠsessionç»™closeäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶Aåœ¨ä½¿ç”¨sessionå°±ä¼šæŠ¥é”™ï¼Œæ€ä¹ˆé¿å…è¿™ä¸ªé—®é¢˜ï¼Ÿ</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1.</span> å¯ä»¥è€ƒè™‘åœ¨è¿™äº›çº¿ç¨‹ä¹‹é—´å…±äº«<span class="hljs-keyword">Session</span>åŠå…¶å¯¹è±¡ã€‚ä½†æ˜¯åº”ç”¨ç¨‹åºéœ€è¦ç¡®ä¿å®ç°æ­£ç¡®çš„é”å®šæ–¹æ¡ˆï¼Œä»¥ä¾¿å¤šä¸ªçº¿ç¨‹ä¸ä¼šåŒæ—¶è®¿é—®<span class="hljs-keyword">Session</span>æˆ–å…¶çŠ¶æ€ã€‚SQLAlchemy ä¸­çš„ scoped_session å°±å¯ä»¥è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸‹é¢ä¼šæœ‰è®¨è®ºã€‚<br><span class="hljs-number">2.</span> ä¸ºæ¯ä¸ªå¹¶å‘çº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªä¼šè¯ï¼Œè€Œä¸æ˜¯å°†å¯¹è±¡ä»ä¸€ä¸ª<span class="hljs-keyword">Session</span>å¤åˆ¶åˆ°å¦ä¸€ä¸ª<span class="hljs-keyword">Session</span>ï¼Œé€šå¸¸ä½¿ç”¨<span class="hljs-keyword">Session</span>.merge()æ–¹æ³•å°†å¯¹è±¡çš„çŠ¶æ€å¤åˆ¶åˆ°ä¸€ä¸ªä¸åŒ<span class="hljs-keyword">Session</span>çš„æ–°çš„æœ¬åœ°å¯¹è±¡ä¸­ã€‚<br></code></pre></td></tr></table></figure><hr><h2 id="äºŒã€å•çº¿ç¨‹ä¸‹-scoped-session-å¯¹åˆ›å»º-Session-çš„å½±å“"><a href="#äºŒã€å•çº¿ç¨‹ä¸‹-scoped-session-å¯¹åˆ›å»º-Session-çš„å½±å“" class="headerlink" title="äºŒã€å•çº¿ç¨‹ä¸‹ scoped_session å¯¹åˆ›å»º Session çš„å½±å“"></a>äºŒã€å•çº¿ç¨‹ä¸‹ scoped_session å¯¹åˆ›å»º Session çš„å½±å“</h2><p>ä¸Šé¢ç®€å•ä»‹ç»äº†sessionmakerçš„ä½œç”¨ï¼Œä¸‹é¢å¼€å§‹æ¢è®¨ scoped_session å¯¹åˆ›å»º Session çš„å½±å“ã€‚ç°åœ¨å…ˆæ¢è®¨å•çº¿ç¨‹æƒ…å†µã€‚</p><hr><p>å…ˆå£°æ˜å¾…ä¼šå®éªŒç”¨çš„æ¨¡å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base<br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> Column, Integer, String<br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine<br><br><br>Base = declarative_base<br>engine = create_engine(<span class="hljs-string">&quot;mysql+pymysql://root:123456@127.0.0.1:3306/my_db?charset=utf8mb4&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">Base</span>):<br>    __tablename__ = <span class="hljs-string">&#x27;Person&#x27;</span><br><br>    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, autoincrement=<span class="hljs-literal">True</span>)<br>    name = Column(String(length=<span class="hljs-number">64</span>), comment=<span class="hljs-string">&#x27;å§“å&#x27;</span>)<br>    mobile = Column(String(length=<span class="hljs-number">13</span>), comment=<span class="hljs-string">&#x27;æ‰‹æœºå·&#x27;</span>)<br>    id_card_number = Column(String(length=<span class="hljs-number">64</span>), comment=<span class="hljs-string">&#x27;èº«ä»½è¯&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;%s(name=%r,mobile=%r,id_card_number=%r)&#x27;</span> % (<br>            self.__class__.__name__,<br>            self.name,<br>            self.mobile,<br>            self.id_card_number<br>        )<br><br><span class="hljs-comment"># åœ¨æ•°æ®åº“ä¸­åˆ›å»ºæ¨¡å‹å¯¹è±¡çš„è¡¨</span><br>Base.metadata.create_all(engine)<br><br></code></pre></td></tr></table></figure><h3 id="1-ä¸¤ä¸ª-Session-æ·»åŠ åŒä¸€ä¸ªå¯¹è±¡"><a href="#1-ä¸¤ä¸ª-Session-æ·»åŠ åŒä¸€ä¸ªå¯¹è±¡" class="headerlink" title="1. ä¸¤ä¸ª Session æ·»åŠ åŒä¸€ä¸ªå¯¹è±¡"></a>1. ä¸¤ä¸ª Session æ·»åŠ åŒä¸€ä¸ªå¯¹è±¡</h3><p>1.1 åœ¨ commit ä¹‹å‰æ·»åŠ ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker, scoped_session<br><br><br>session_factory = sessionmaker(bind=engine)<br><span class="hljs-comment"># engine åœ¨ä¸Šé¢å·²ç»åˆ›å»ºå¥½äº†</span><br><br><br>person = Person(name=<span class="hljs-string">&#x27;frank-&#x27;</span> + <span class="hljs-string">&#x27;job3&#x27;</span>, mobile=<span class="hljs-string">&#x27;111111&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;123456789&#x27;</span>)<br><br>Session= session_factory()<br>s1= session_factory()<br><span class="hljs-comment"># s1 : &lt;sqlalchemy.orm.session.Session object at 0x107ec8c18&gt;</span><br><br>s2 = session_factory() <br><span class="hljs-comment"># s2 : &lt;sqlalchemy.orm.session.Session object at 0x107ee3ac8&gt;</span><br><br><span class="hljs-built_in">print</span>(s1 <span class="hljs-keyword">is</span> s2)<br><span class="hljs-comment"># False</span><br><br><span class="hljs-built_in">id</span>(s1),<span class="hljs-built_in">id</span>(s2)<br><span class="hljs-comment"># 4427910168, 4428020424</span><br><br>s1.add(person)<br>s2.add(person)<br><span class="hljs-comment"># ä¼šæŠ¥é”™ï¼</span><br><span class="hljs-comment"># sqlalchemy.exc.InvalidRequestError: Object &#x27;&lt;Person at 0x22beb14bf60&gt;&#x27; is already attached to session &#x27;2&#x27; (this is &#x27;3&#x27;)</span><br><br></code></pre></td></tr></table></figure><p><strong>ç»“è®ºï¼š</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm">é€šè¿‡ sessionmaker å·¥å‚åˆ›å»ºäº†ä¸¤ä¸ª Session ï¼Œè€Œä¸”å¯ä»¥çœ‹åˆ° <span class="hljs-built_in">s1</span> <span class="hljs-built_in">s2</span> æ˜¯ä¸¤ä¸ªä¸åŒçš„ Session ã€‚<br>åœ¨ <span class="hljs-built_in">s1</span> æ·»åŠ  person åï¼Œç»§ç»­ä½¿ç”¨ <span class="hljs-built_in">s2</span> æ·»åŠ  person æŠ¥é”™. è¯´ person è¿™ä¸ªå¯¹è±¡ å·²ç»å’Œ å¦ä¸€ä¸ª Session å…³è”ä¸€èµ·æ¥äº†, æ‰€ä»¥å†æ¬¡å…³è”å¦ä¸€ä¸ª Session å°±ä¼šæŠ¥é”™ã€‚<br></code></pre></td></tr></table></figure><p>1.2 åœ¨ commit ä¹‹åæ·»åŠ ï¼š</p><p>å³åœ¨ä¸Šé¢ä»£ç çš„ s1.add(person) ä¹‹åï¼Œ s1.commit() ,ç„¶åå† s2.add(persion)<br>è¿™é‡Œå°±æ²¡å¸–ä»£ç äº†ã€‚</p><p><strong>ç»“è®ºï¼š</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm">å³ä½¿åœ¨ <span class="hljs-built_in">s1</span> æäº¤ä¹‹åï¼Œ<span class="hljs-built_in">s2</span> å†å»æ·»åŠ  person ä¹Ÿä¼šå‘ç”Ÿé”™è¯¯,ä½† <span class="hljs-built_in">s1</span> çš„æäº¤æ˜¯æˆåŠŸäº†çš„ï¼Œæ•°æ® person å·²ç»å­˜æ”¾åœ¨æ•°æ®åº“äº†ã€‚<br>å½“ <span class="hljs-built_in">s1</span> æ·»åŠ  person å¹¶æäº¤ï¼Œç„¶åå…³é—­ <span class="hljs-built_in">s1</span> ,<span class="hljs-built_in">s2</span>å†å»æ·»åŠ å¹¶æäº¤ person æ•°æ®åº“,è¿™ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯æ•°æ®åº“ä¹Ÿä¸ä¼šå‡ºç°ä¸¤æ¡ person æ•°æ®ã€‚<br></code></pre></td></tr></table></figure><p>1.3 å† close ä¹‹åæ·»åŠ ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">p = Person(name=<span class="hljs-string">&#x27;frank&#x27;</span>, mobile=<span class="hljs-string">&#x27;11111111&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;123456789&#x27;</span>)<br><br>s1.add(p)<br>s1.commit()<br><br>s2.add(p)<br>s2.commit()<br><br><span class="hljs-comment"># ä¹Ÿä¼šæŠ¥é”™ï¼ï¼ï¼</span><br><span class="hljs-comment"># sqlalchemy.exc.InvalidRequestError: Object &#x27;&lt;Person at 0x21207e3e128&gt;&#x27; is already attached to session &#x27;2&#x27; (this is &#x27;3&#x27;)</span><br><br><br>p = Person(name=<span class="hljs-string">&#x27;frankcc&#x27;</span>, mobile=<span class="hljs-string">&#x27;1111111122&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;1234567890&#x27;</span>)<br><br>s1.add(p)<br>s1.commit()<br>s1.close()<br>s2.add(p)<br>s2.commit()<br><br><span class="hljs-comment"># ä¸ä¼šæŠ¥é”™</span><br><br></code></pre></td></tr></table></figure><p><strong>ç»“è®ºï¼š</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-built_in">s1</span> å…³é—­ä¹‹åï¼Œ <span class="hljs-built_in">s2</span>å†å»æ·»åŠ æäº¤åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯æ•°æ®åº“å€¼æœ‰ä¸€æ¡ person æ•°æ®ã€‚<br></code></pre></td></tr></table></figure><h3 id="2-ä¸åŒçš„-Session-æ·»åŠ ä¸åŒçš„å¯¹è±¡"><a href="#2-ä¸åŒçš„-Session-æ·»åŠ ä¸åŒçš„å¯¹è±¡" class="headerlink" title="2. ä¸åŒçš„ Session æ·»åŠ ä¸åŒçš„å¯¹è±¡"></a>2. ä¸åŒçš„ Session æ·»åŠ ä¸åŒçš„å¯¹è±¡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">person4 = Person(name=<span class="hljs-string">&#x27;frank-&#x27;</span> + <span class="hljs-string">&#x27;job4&#x27;</span>, mobile=<span class="hljs-string">&#x27;4444444444&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;123456789&#x27;</span>)<br>person1 = Person(name=<span class="hljs-string">&#x27;frank-&#x27;</span> + <span class="hljs-string">&#x27;job1&#x27;</span>, mobile=<span class="hljs-string">&#x27;111111&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;123456789&#x27;</span>)<br><br>s1.add(person1)<br>s2.add(person4)<br>s1.commit()  <span class="hljs-comment"># æäº¤æ•°æ®</span><br>s2.commit()  <span class="hljs-comment"># æäº¤æ•°æ®, å†™å…¥æ•°æ®åº“</span><br><br></code></pre></td></tr></table></figure><p><strong>ç»“è®ºï¼š</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">å½“ç„¶ï¼Œ<span class="hljs-built_in">s1</span> ,<span class="hljs-built_in">s2</span> æ·»åŠ æäº¤ä¸åŒçš„å¯¹è±¡ï¼Œä¸ä¼šå‡ºé”™ã€‚åœ¨æ•°æ®åº“æˆåŠŸæ–°å¢æ•°æ®ã€‚ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>mysql&gt; select * from person;<br>+----+------------+------------+----------------+<br>| <span class="hljs-built_in">id</span> | name       | mobile     | id_card_number |<br>+----+------------+------------+----------------+<br>|  1 | frank-job1 | 111111     | 123456789      |<br>|  2 | frank-job4 | 4444444444 | 123456789      |<br>+----+------------+------------+----------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br></code></pre></td></tr></table></figure><hr><p><strong>ä»¥ä¸Šè¯´æ˜ï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ä¸€ä¸ªå¯¹è±¡ä¸€æ—¦è¢«ä¸€ä¸ª <span class="hljs-keyword">Session</span> æ·»åŠ ï¼Œé™¤éå…³é—­è¿™ä¸ª <span class="hljs-keyword">Session</span> ï¼Œä¸ç„¶å…¶ä»–çš„ <span class="hljs-keyword">Session</span> æ— æ³•æ·»åŠ è¿™ä¸ªå¯¹è±¡ã€‚<br>ä¸€ä¸ª <span class="hljs-keyword">Session</span> æ·»åŠ å¹¶æäº¤ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åå…³é—­è¯¥ <span class="hljs-keyword">Session</span> ï¼Œå…¶ä»–çš„ <span class="hljs-keyword">Session</span> å¯ä»¥æ·»åŠ å¹¶æäº¤è¿™ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯æ•°æ®åº“å¹¶ä¸ä¼šæœ‰è¿™æ¡æ•°æ®ã€‚<br></code></pre></td></tr></table></figure><hr><h3 id="3-ç”¨-scoped-session-åˆ›å»º-Session"><a href="#3-ç”¨-scoped-session-åˆ›å»º-Session" class="headerlink" title="3. ç”¨ scoped_session åˆ›å»º Session"></a>3. ç”¨ scoped_session åˆ›å»º Session</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>session_factory = sessionmaker(bind=engine)<br>Session = scoped_session(session_factory)<br><br><br>s1 = Session()<br><span class="hljs-comment"># &lt;sqlalchemy.orm.session.Session object at 0x0000020E58690240&gt;</span><br><br>s2 = Session()<br><span class="hljs-comment"># &lt;sqlalchemy.orm.session.Session object at 0x0000020E58690240&gt;</span><br><br><span class="hljs-built_in">print</span>(s1 <span class="hljs-keyword">is</span> s2)<br><span class="hljs-comment"># True</span><br><br><br>p = Person(name=<span class="hljs-string">&#x27;frankaaabb&#x27;</span>, mobile=<span class="hljs-string">&#x27;1111111122233&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;12345678900099&#x27;</span>)<br><br>s1.add(p)<br>s2.add(p)<br>s2.commit()<br><br></code></pre></td></tr></table></figure><p><strong>ç»“è®ºï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡scoped_sessionå†å»åˆ›å»º <span class="hljs-keyword">Session</span> ï¼Œè¿”å›çš„æ˜¯åŒä¸€ä¸ª <span class="hljs-keyword">Session</span> ã€‚<br>scoped_sessionç±»ä¼¼å•ä¾‹æ¨¡å¼ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ä½¿ç”¨çš„æ—¶å€™ï¼Œä¼šå…ˆåœ¨Registryé‡Œæ‰¾æ‰¾ä¹‹å‰æ˜¯å¦å·²ç»åˆ›å»º<span class="hljs-keyword">Session</span>ï¼Œæœªåˆ›å»ºåˆ™åˆ›å»º <span class="hljs-keyword">Session</span> ï¼Œå·²åˆ›å»ºåˆ™ç›´æ¥è¿”å›ã€‚<br></code></pre></td></tr></table></figure><hr><h2 id="ä¸‰ã€å¤šçº¿ç¨‹ä¸‹-scoped-session-å¯¹åˆ›å»º-Session-çš„å½±å“"><a href="#ä¸‰ã€å¤šçº¿ç¨‹ä¸‹-scoped-session-å¯¹åˆ›å»º-Session-çš„å½±å“" class="headerlink" title="ä¸‰ã€å¤šçº¿ç¨‹ä¸‹ scoped_session å¯¹åˆ›å»º Session çš„å½±å“"></a>ä¸‰ã€å¤šçº¿ç¨‹ä¸‹ scoped_session å¯¹åˆ›å»º Session çš„å½±å“</h2><p>è¿™é‡Œæ¢è®¨åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ scoped_session ä¸ä¸ä½¿ç”¨ scoped_session çš„æƒ…å†µ</p><hr><h3 id="1-å½“ä¸ç”¨-scoped-session-æ—¶ï¼š"><a href="#1-å½“ä¸ç”¨-scoped-session-æ—¶ï¼š" class="headerlink" title="1. å½“ä¸ç”¨ scoped_session æ—¶ï¼š"></a>1. å½“ä¸ç”¨ scoped_session æ—¶ï¼š</h3><p>å½“ä¸ä½¿ç”¨ scoped_session æ—¶ï¼Œä¹Ÿåˆ†ä¸¤ç§æƒ…å†µï¼Œæ˜¯å¦åˆ›å»ºå…¨å±€æ€§ Session</p><p>1.1 å¤šçº¿ç¨‹ä¸‹ä¸è®¾ç½® Session ä¸ºå…¨å±€å˜é‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>session_factory = sessionmaker(bind=engine)<br>Session = session_factory<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">job</span>(<span class="hljs-params">name</span>):<br>    session = Session()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;id session:<span class="hljs-subst">&#123;<span class="hljs-built_in">id</span>(session)&#125;</span>&quot;</span>)<br><br>    person = Person(name=<span class="hljs-string">&#x27;frank-&#x27;</span> + name, mobile=<span class="hljs-string">&#x27;111111&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;123456789&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;name&#125;</span> person is add..&quot;</span>)<br>    session.add(person)<br><br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> name == <span class="hljs-string">&#x27;job3&#x27;</span>:<br>        <span class="hljs-comment"># çº¿ç¨‹3 æäº¤, å…¶ä»–çº¿ç¨‹ä¸æäº¤.</span><br>        session.commit()<br>        session.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    thread_list = []<br><br>    <span class="hljs-comment"># åˆ›å»º5ä¸ªçº¿ç¨‹</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        name = <span class="hljs-string">&#x27;job&#x27;</span> + <span class="hljs-built_in">str</span>(i)<br>        t = threading.Thread(target=job, name=name, args=(name,))<br><br>        thread_list.append(t)<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.join()<br><br></code></pre></td></tr></table></figure><p><strong>ç»“è®ºï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">æ¯ä¸ªçº¿ç¨‹ä¸‹çš„ <span class="hljs-keyword">Session</span> éƒ½æ˜¯ä¸åŒçš„ <span class="hljs-keyword">Session</span><br>æ•°æ®åº“æˆåŠŸæ–°å¢äº†çº¿ç¨‹<span class="hljs-number">3</span>æäº¤çš„æ•°æ®ï¼Œå…¶ä»–çš„çº¿ç¨‹ä¸­çš„æ•°æ®å¹¶æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­å»ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-built_in">id</span> session:2557871997392<br>job0 person is add..<br><span class="hljs-built_in">id</span> session:2557871998064<br>job1 person is add..<br><span class="hljs-built_in">id</span> session:2557871998568<br>job2 person is add..<br><span class="hljs-built_in">id</span> session:2557871999072<br>job3 person is add..<br><span class="hljs-built_in">id</span> session:2557871999688<br>job4 person is add..<br><br><br>mysql&gt; select * from person;<br>+----+------------+--------+----------------+<br>| <span class="hljs-built_in">id</span> | name       | mobile | id_card_number |<br>+----+------------+--------+----------------+<br>| 14 | frank-job3 | 111111 | 123456789      |<br>+----+------------+--------+----------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>1.2 åœ¨å¤šçº¿ç¨‹ä¸‹ç”¨å…¨å±€ Session</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>session_factory = sessionmaker(bind=engine)<br>Session = session_factory<br>session = Session()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">job</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-keyword">global</span> session<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;id session:<span class="hljs-subst">&#123;<span class="hljs-built_in">id</span>(session)&#125;</span>&quot;</span>)<br><br>    person = Person(name=<span class="hljs-string">&#x27;frank-&#x27;</span> + name, mobile=<span class="hljs-string">&#x27;111111&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;123456789&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;name&#125;</span> person is add..&quot;</span>)<br>    session.add(person)<br><br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> name == <span class="hljs-string">&#x27;job3&#x27;</span>:<br>        <span class="hljs-comment"># çº¿ç¨‹3 æäº¤, å…¶ä»–çº¿ç¨‹ä¸æäº¤.</span><br>        session.commit()<br>        session.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    thread_list = []<br><br>    <span class="hljs-comment"># åˆ›å»º5ä¸ªçº¿ç¨‹</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        name = <span class="hljs-string">&#x27;job&#x27;</span> + <span class="hljs-built_in">str</span>(i)<br>        t = threading.Thread(target=job, name=name, args=(name,))<br><br>        thread_list.append(t)<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.join()<br><br></code></pre></td></tr></table></figure><p><strong>ç»“è®ºï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">å…¨éƒ¨çº¿ç¨‹ä¸‹çš„ <span class="hljs-keyword">Session</span> éƒ½æ—¶åŒä¸€ä¸ª <span class="hljs-keyword">Session</span><br>æ¯ä¸ªçº¿ç¨‹ä¸‹çš„æ•°æ®éƒ½è¢«æäº¤åˆ°äº†æ•°æ®åº“<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-built_in">id</span> session:2737857674824<br>job0 person is add..<br><span class="hljs-built_in">id</span> session:2737857674824<br>job1 person is add..<br><span class="hljs-built_in">id</span> session:2737857674824<br>job2 person is add..<br><span class="hljs-built_in">id</span> session:2737857674824<br>job3 person is add..<br><span class="hljs-built_in">id</span> session:2737857674824<br>job4 person is add..<br><br><br>mysql&gt; select * from person;<br>+----+------------+--------+----------------+<br>| <span class="hljs-built_in">id</span> | name       | mobile | id_card_number |<br>+----+------------+--------+----------------+<br>| 15 | frank-job0 | 111111 | 123456789      |<br>| 16 | frank-job2 | 111111 | 123456789      |<br>| 17 | frank-job1 | 111111 | 123456789      |<br>| 18 | frank-job3 | 111111 | 123456789      |<br>| 19 | frank-job4 | 111111 | 123456789      |<br>+----+------------+--------+----------------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br></code></pre></td></tr></table></figure><h3 id="2-å½“ä½¿ç”¨-scoped-session-æ—¶ï¼š"><a href="#2-å½“ä½¿ç”¨-scoped-session-æ—¶ï¼š" class="headerlink" title="2. å½“ä½¿ç”¨ scoped_session æ—¶ï¼š"></a>2. å½“ä½¿ç”¨ scoped_session æ—¶ï¼š</h3><p>2.1 å¤šçº¿ç¨‹ä¸‹ä¸è®¾ç½® Session ä¸ºå…¨å±€å˜é‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>session_factory = sessionmaker(bind=engine)<br>Session = scoped_session(session_factory)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">job</span>(<span class="hljs-params">name</span>):<br>    session = Session()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;id session:<span class="hljs-subst">&#123;<span class="hljs-built_in">id</span>(session)&#125;</span>&quot;</span>)<br><br>    person = Person(name=<span class="hljs-string">&#x27;frank-&#x27;</span> + name, mobile=<span class="hljs-string">&#x27;111111&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;123456789&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;name&#125;</span> person is add..&quot;</span>)<br>    session.add(person)<br><br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> name == <span class="hljs-string">&#x27;job3&#x27;</span>:<br>        <span class="hljs-comment"># çº¿ç¨‹3 æäº¤, å…¶ä»–çº¿ç¨‹ä¸æäº¤.</span><br>        session.commit()<br>        session.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    thread_list = []<br><br>    <span class="hljs-comment"># åˆ›å»º5ä¸ªçº¿ç¨‹</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        name = <span class="hljs-string">&#x27;job&#x27;</span> + <span class="hljs-built_in">str</span>(i)<br>        t = threading.Thread(target=job, name=name, args=(name,))<br><br>        thread_list.append(t)<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.join()<br><br><br></code></pre></td></tr></table></figure><p><strong>ç»“è®ºï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">æ¯ä¸ªçº¿ç¨‹ä¸‹çš„ <span class="hljs-keyword">Session</span> éƒ½ä¸ç›¸åŒ<br>åªæœ‰çº¿ç¨‹<span class="hljs-number">3</span>ä¸‹çš„æ•°æ®è¢«æäº¤åˆ°äº†æ•°æ®åº“<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-built_in">id</span> session:2173841850832<br>job0 person is add..<br><span class="hljs-built_in">id</span> session:2173841851504<br>job1 person is add..<br><span class="hljs-built_in">id</span> session:2173841851896<br>job2 person is add..<br><span class="hljs-built_in">id</span> session:2173841852008<br>job3 person is add..<br><span class="hljs-built_in">id</span> session:2173841853128<br>job4 person is add..<br><br><br>mysql&gt; select * from person;<br>+----+------------+--------+----------------+<br>| <span class="hljs-built_in">id</span> | name       | mobile | id_card_number |<br>+----+------------+--------+----------------+<br>| 32 | frank-job3 | 111111 | 123456789      |<br>+----+------------+--------+----------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br><br></code></pre></td></tr></table></figure><p>2.2 å¤šçº¿ç¨‹ä¸‹è®¾ç½® Session ä¸ºå…¨å±€å˜é‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>session_factory = sessionmaker(bind=engine)<br>Session = scoped_session(session_factory)<br>session = Session()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">job</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-keyword">global</span> session<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;id session:<span class="hljs-subst">&#123;<span class="hljs-built_in">id</span>(session)&#125;</span>&quot;</span>)<br><br>    person = Person(name=<span class="hljs-string">&#x27;frank-&#x27;</span> + name, mobile=<span class="hljs-string">&#x27;111111&#x27;</span>, id_card_number=<span class="hljs-string">&#x27;123456789&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;name&#125;</span> person is add..&quot;</span>)<br>    session.add(person)<br><br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> name == <span class="hljs-string">&#x27;job3&#x27;</span>:<br>        <span class="hljs-comment"># çº¿ç¨‹3 æäº¤, å…¶ä»–çº¿ç¨‹ä¸æäº¤.</span><br>        session.commit()<br>        session.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    thread_list = []<br><br>    <span class="hljs-comment"># åˆ›å»º5ä¸ªçº¿ç¨‹</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        name = <span class="hljs-string">&#x27;job&#x27;</span> + <span class="hljs-built_in">str</span>(i)<br>        t = threading.Thread(target=job, name=name, args=(name,))<br><br>        thread_list.append(t)<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.join()<br><br><br></code></pre></td></tr></table></figure><p><strong>ç»“è®ºï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">æ¯ä¸ªçº¿ç¨‹ä¸‹çš„ <span class="hljs-keyword">Session</span> æ˜¯åŒä¸€ä¸ª <span class="hljs-keyword">Session</span><br>æ¯ä¸ªçº¿ç¨‹ä¸‹çš„æ•°æ®éƒ½æ²¡æäº¤åˆ°äº†æ•°æ®åº“<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-built_in">id</span> session:2810724382032<br>job0 person is add..<br><span class="hljs-built_in">id</span> session:2810724382032<br>job1 person is add..<br><span class="hljs-built_in">id</span> session:2810724382032<br>job2 person is add..<br><span class="hljs-built_in">id</span> session:2810724382032<br>job3 person is add..<br><span class="hljs-built_in">id</span> session:2810724382032<br>job4 person is add..<br><br><br>mysql&gt; select * from person;<br>+----+------------+--------+----------------+<br>| <span class="hljs-built_in">id</span> | name       | mobile | id_card_number |<br>+----+------------+--------+----------------+<br>| 33 | frank-job0 | 111111 | 123456789      |<br>| 34 | frank-job2 | 111111 | 123456789      |<br>| 35 | frank-job1 | 111111 | 123456789      |<br>| 36 | frank-job3 | 111111 | 123456789      |<br>| 37 | frank-job4 | 111111 | 123456789      |<br>+----+------------+--------+----------------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br></code></pre></td></tr></table></figure><hr><p><strong>ä»¥ä¸Šè¯´æ˜ï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œæœ‰ scoped_session çš„æ—¶å€™ï¼Œè¿”å›çš„æ˜¯åŒä¸€ä¸ª <span class="hljs-keyword">Session</span> å¯¹è±¡ã€‚<br>åœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œå³ä½¿é€šè¿‡  scoped_session åˆ›å»º<span class="hljs-keyword">Session</span>ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸‹çš„ <span class="hljs-keyword">Session</span> éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„ <span class="hljs-keyword">Session</span> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åªåœ¨æœ¬çº¿ç¨‹ä¸‹å…±äº«ã€‚ <br>scoped_session åªæœ‰åœ¨å•çº¿ç¨‹ä¸‹æ‰èƒ½å‘æŒ¥å…¶ä½œç”¨ã€‚åœ¨å¤šçº¿ç¨‹ä¸‹æ˜¾å¾—æ²¡æœ‰ä»€ä¹ˆä½œç”¨<br></code></pre></td></tr></table></figure><p>Â è½¬è‡ªï¼š<a href="https://www.cnblogs.com/ChangAn223/p/11277468.html">https://www.cnblogs.com/ChangAn223/p/11277468.html</a></p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python æ•°æ®åº“ mysql sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonä¹‹sqlalchemyè¯¦è§£</title>
    <link href="/2020/03/25/python%E4%B9%8Bsqlalchemy%E8%AF%A6%E8%A7%A3/"/>
    <url>/2020/03/25/python%E4%B9%8Bsqlalchemy%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="pythonä¹‹sqlalchemyè¯¦è§£"><a href="#pythonä¹‹sqlalchemyè¯¦è§£" class="headerlink" title="pythonä¹‹sqlalchemyè¯¦è§£"></a><strong>pythonä¹‹sqlalchemyè¯¦è§£</strong></h2><h2 id="SQLAlchemyè¿æ¥æ•°æ®åº“"><a href="#SQLAlchemyè¿æ¥æ•°æ®åº“" class="headerlink" title="SQLAlchemyè¿æ¥æ•°æ®åº“"></a><strong>SQLAlchemyè¿æ¥æ•°æ®åº“</strong></h2><h3 id="å¯ä»¥ä½¿ç”¨ORMæ¡†æ¶æ“ä½œæ•°æ®åº“"><a href="#å¯ä»¥ä½¿ç”¨ORMæ¡†æ¶æ“ä½œæ•°æ®åº“" class="headerlink" title="å¯ä»¥ä½¿ç”¨ORMæ¡†æ¶æ“ä½œæ•°æ®åº“"></a><strong>å¯ä»¥ä½¿ç”¨ORMæ¡†æ¶æ“ä½œæ•°æ®åº“</strong></h3><blockquote><p>ORMæ¡†æ¶ &#x3D; object relationship mappiy æ¡†æ¶</p></blockquote><h3 id="å­¦ä¹ å‰æï¼ˆè½¯ä»¶ï¼‰"><a href="#å­¦ä¹ å‰æï¼ˆè½¯ä»¶ï¼‰" class="headerlink" title="å­¦ä¹ å‰æï¼ˆè½¯ä»¶ï¼‰"></a><strong>å­¦ä¹ å‰æï¼ˆè½¯ä»¶ï¼‰</strong></h3><blockquote><p>mysqlã€pymysqlï¼ˆæˆ–è€…MySQLdbï¼‰ã€SQLAlchemy</p></blockquote><h3 id="SQLAlchemyè¿æ¥æ•°æ®åº“-1"><a href="#SQLAlchemyè¿æ¥æ•°æ®åº“-1" class="headerlink" title="SQLAlchemyè¿æ¥æ•°æ®åº“"></a><strong>SQLAlchemyè¿æ¥æ•°æ®åº“</strong></h3><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a><strong>æ­¥éª¤</strong></h3><ul><li>é¦–å…ˆå¯¼å…¥sqlalchemy.create_engine</li><li>è¾“å…¥é…ç½®ä¿¡æ¯ï¼ˆæœåŠ¡å™¨ipï¼Œç«¯å£å·ï¼Œæ•°æ®åº“åï¼Œè´¦æˆ·ï¼Œå¯†ç ï¼‰</li><li>ä¼ é€’ä¸€ä¸ªæ»¡è¶³æŸç§æ ¼å¼çš„å­—ç¬¦ä¸²<ul><li><p>dialect+driver:&#x2F;&#x2F;username:password@host:port&#x2F;database?charset&#x3D;utf8  </p><p>dialectï¼šæ•°æ®åº“çš„å®ç°ï¼Œæ¯”å¦‚MySQLã€PostgreSQLã€SQLiteï¼Œå¹¶ä¸”è½¬æ¢æˆå°å†™ã€‚<br>driverï¼šPythonå¯¹åº”çš„é©±åŠ¨ï¼Œpython3å¯¹åº”sqlalchemy,python2å¯¹åº”MySQLdbã€‚<br>usernameï¼šè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·å<br>passwordï¼šè¿æ¥æ•°æ®åº“çš„å¯†ç <br>hostï¼šè¿æ¥æ•°æ®åº“çš„åŸŸå</p></li></ul></li><li>åˆ›å»ºæ•°æ®åº“å¼•æ“</li><li>åˆ›å»ºè¿æ¥</li></ul><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a><strong>ä»£ç å®ç°</strong></h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine<br>â€‹<br><span class="hljs-comment">#å‡†å¤‡è¿æ¥æ•°æ®åº“åŸºæœ¬ä¿¡æ¯</span><br><span class="hljs-comment"># ä»£è¡¨å“ªä¸€å°è®¡ç®—æœºï¼Œipåœ°å€æ˜¯å¤šå°‘</span><br>HOSTNAME = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span><br><span class="hljs-comment"># ç«¯å£å·</span><br>PORT = <span class="hljs-string">&#x27;3306&#x27;</span><br><span class="hljs-comment"># æ•°æ®åº“çš„åå­—ï¼Œè¿æ¥é‚£ä¸ªæ•°æ®åº“</span><br>DATABASE = <span class="hljs-string">&#x27;first_sqlalchemy&#x27;</span><br><span class="hljs-comment"># æ•°æ®åº“çš„è´¦å·å’Œå¯†ç </span><br>USERNAME = <span class="hljs-string">&#x27;root&#x27;</span><br>PASSWORD = <span class="hljs-string">&#x27;root&#x27;</span><br><span class="hljs-comment"># æŒ‰ç…§è¦æ±‚ç»„ç»‡æˆä¸€å®šçš„å­—ç¬¦ä¸²</span><br>DB_URI = <span class="hljs-string">&#x27;mysql+pymysql://&#123;username&#125;:&#123;pwd&#125;@&#123;host&#125;:&#123;port&#125;/&#123;db&#125;?charset=utf8&#x27;</span><span class="hljs-string">\</span><br>    .format(username =USERNAME,pwd = PASSWORD,host = HOSTNAME,port=PORT,db = DATABASE)<br><span class="hljs-comment"># åˆ›å»ºæ•°æ®åº“å¼•æ“</span><br>engine = create_engine(DB_URI)<br><span class="hljs-comment"># åˆ›å»ºè¿æ¥,å¦‚æœè¿è¡Œä¹‹åï¼Œè¾“å…¥1åˆ™è¿æ¥æˆåŠŸ</span><br><span class="hljs-keyword">with</span> engine.connect()<span class="hljs-keyword">as</span> con:<br>    rs = con.execute(<span class="hljs-string">&#x27;SELECT 1&#x27;</span>)<br>    <span class="hljs-built_in">print</span> (rs.fetchone())<br></code></pre></td></tr></table></figure><h3 id="æ‹“å±•ï¼šç”¨SQLAlchemyæ‰§è¡ŒåŸç”ŸSQL"><a href="#æ‹“å±•ï¼šç”¨SQLAlchemyæ‰§è¡ŒåŸç”ŸSQL" class="headerlink" title="æ‹“å±•ï¼šç”¨SQLAlchemyæ‰§è¡ŒåŸç”ŸSQL"></a><strong>æ‹“å±•ï¼šç”¨SQLAlchemyæ‰§è¡ŒåŸç”ŸSQL</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">from</span> sqlalchemy import create_engine<br><span class="hljs-keyword">from</span> constants import DB_URI<br>#è¿æ¥æ•°æ®åº“<br>engine <span class="hljs-operator">=</span> create_engine(DB_URI,echo<span class="hljs-operator">=</span><span class="hljs-literal">True</span>)<br># ä½¿ç”¨<span class="hljs-keyword">with</span>è¯­å¥è¿æ¥æ•°æ®åº“ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ä¼šè¢«æ•è·<br><span class="hljs-keyword">with</span> engine.connect() <span class="hljs-keyword">as</span> con:<br>    # å…ˆåˆ é™¤usersè¡¨<br>    con.execute(<span class="hljs-string">&#x27;drop table if exists authors&#x27;</span>)<br>    # åˆ›å»ºä¸€ä¸ªusersè¡¨ï¼Œæœ‰è‡ªå¢é•¿çš„idå’Œname<br>    con.execute(<span class="hljs-string">&#x27;create table authors(id int primary key auto_increment,&#x27;</span>name <span class="hljs-type">varchar</span>(<span class="hljs-number">25</span>))<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">    # æ’å…¥ä¸¤æ¡æ•°æ®åˆ°è¡¨ä¸­</span><br><span class="hljs-string">    con.execute(&#x27;</span><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> persons(name) <span class="hljs-keyword">values</span>(&quot;abc&quot;)<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">    con.execute(&#x27;</span><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> persons(name) <span class="hljs-keyword">values</span>(&quot;xiaotuo&quot;)<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">    # æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ</span><br><span class="hljs-string">    results = con.execute(&#x27;</span><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> persons<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">    # ä»æŸ¥æ‰¾çš„ç»“æœä¸­éå†</span><br><span class="hljs-string">    for result in results:</span><br><span class="hljs-string">        print(result)</span><br></code></pre></td></tr></table></figure><h2 id="ORMæ¡†æ¶"><a href="#ORMæ¡†æ¶" class="headerlink" title="ORMæ¡†æ¶"></a><strong>ORMæ¡†æ¶</strong></h2><blockquote><p>ORMï¼šObject Relationship Mappingï¼ˆå¯¹è±¡æ¨¡å‹ä¸æ•°æ®åº“è¡¨çš„æ˜ å°„ï¼‰</p></blockquote><h3 id="Pythonä»£ç å’ŒSQLä»£ç çš„å¯¹åº”å…³ç³»"><a href="#Pythonä»£ç å’ŒSQLä»£ç çš„å¯¹åº”å…³ç³»" class="headerlink" title="Pythonä»£ç å’ŒSQLä»£ç çš„å¯¹åº”å…³ç³»"></a><strong>Pythonä»£ç å’ŒSQLä»£ç çš„å¯¹åº”å…³ç³»</strong></h3><blockquote><p><strong>pyä»£ç ï¼š</strong><br>class Person(object):<br>name &#x3D; â€˜xxâ€™<br>age &#x3D; 18<br>country &#x3D;â€™xx<br>å¯¹åº”å…³ç³»ï¼š<br>Personç±» -&gt; æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨<br>Personç±»ä¸­çš„å±æ€§ -&gt; æ•°æ®åº“ä¸­ä¸€å¼ è¡¨å­—æ®µ<br>Personç±»çš„ä¸€ä¸ªå¯¹è±¡ -&gt; æ•°æ®åº“ä¸­è¡¨çš„ä¸€æ¡æ•°æ®</p></blockquote><h3 id="ä½¿ç”¨åŸç”Ÿsqlè¯­å¥çš„ç¼ºç‚¹"><a href="#ä½¿ç”¨åŸç”Ÿsqlè¯­å¥çš„ç¼ºç‚¹" class="headerlink" title="ä½¿ç”¨åŸç”Ÿsqlè¯­å¥çš„ç¼ºç‚¹"></a><strong>ä½¿ç”¨åŸç”Ÿsqlè¯­å¥çš„ç¼ºç‚¹</strong></h3><ol><li>SQLè¯­å¥é‡å¤åˆ©ç”¨ç‡ä¸é«˜ï¼Œè¶Šå¤æ‚çš„SQLè¯­å¥æ¡ä»¶è¶Šå¤šï¼Œä»£ç è¶Šé•¿ï¼Œä¼šå‡ºç°å¾ˆå¤šç›¸è¿‘çš„SQLè¯­å¥ã€‚</li><li>å¤§å‹çš„é¡¹ç›®æ˜¯åœ¨ä¸šåŠ¡é€»è¾‘ä¸­æ‹¼æ¥å‡ºæ¥çš„ï¼Œå¦‚æœæ•°æ®åº“éœ€è¦æ›´æ”¹ï¼Œå°±è¦å»ä¿®æ”¹è¿™äº›é€»è¾‘ï¼Œè¿™ä¼šå¾ˆå®¹æ˜“æ¼æ‰å¯¹æŸäº›SQLè¯­å¥çš„ä¿®æ”¹ã€‚</li><li>å†™SQLæ—¶å®¹æ˜“å¿½ç•¥webå®‰å…¨é—®é¢˜ï¼Œé€ æˆéšæ‚£ã€‚</li></ol><h3 id="SQLAlchemyçš„ä¼˜åŠ¿"><a href="#SQLAlchemyçš„ä¼˜åŠ¿" class="headerlink" title="SQLAlchemyçš„ä¼˜åŠ¿"></a><strong>SQLAlchemyçš„ä¼˜åŠ¿</strong></h3><ul><li>æ˜“ç”¨æ€§ï¼šä½¿ç”¨ORMåšæ•°æ®åº“å¼€å‘å¯ä»¥æœ‰æ•ˆå‡å°‘é‡å¤SQLè¯­å¥çš„æ¦‚ç‡ï¼Œå†™å‡ºæ¥çš„æ¨¡å‹ä¹Ÿæ›´åŠ ç›´è§‚ã€æ¸…æ™°</li><li>æ€§èƒ½æŸè€—å°ï¼šä»»ä½•æ“ä½œéƒ½è¦é€šè¿‡ORMè½¬åŒ–ï¼Œç¡®å®ä¼šæŸè€—æ€§èƒ½ï¼Œä½†ç»¼åˆè€ƒè™‘å¼€å‘æ•ˆç‡ã€ä»£ç é˜…è¯»æ€§ï¼Œå¸¦æ¥çš„å¥½å¤„è¿œå¤§äºæ€§èƒ½æŸè€—ï¼Œè€Œä¸”é¡¹ç›®è¶Šå¤§ä½œç”¨è¶Šæ˜æ˜¾ã€‚</li><li>è®¾è®¡çµæ´»ï¼šå¯ä»¥è½»æ¾çš„å†™å‡ºå¤æ‚çš„æŸ¥è¯¢</li><li>å¯ç§»æ¤ï¼šSQLAlchemyå°è£…äº†åº•å±‚çš„æ•°æ®åº“å®ç°ï¼Œæ”¯æŒå¤šä¸ªå…³ç³»æ•°æ®åº“å¼•æ“ï¼Œå¯ä»¥éå¸¸è½»æ¾çš„åˆ‡æ¢æ•°æ®åº“</li></ul><h2 id="SQLAlchemyæ“ä½œæ•°æ®åº“"><a href="#SQLAlchemyæ“ä½œæ•°æ®åº“" class="headerlink" title="SQLAlchemyæ“ä½œæ•°æ®åº“"></a><strong>SQLAlchemyæ“ä½œæ•°æ®åº“</strong></h2><blockquote><p>æ“ä½œå‰ï¼Œå¿…é¡»è¦å…ˆæ„å»ºsessionå¯¹è±¡ï¼ï¼</p></blockquote><h3 id="å®šä¹‰ROMæ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­"><a href="#å®šä¹‰ROMæ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­" class="headerlink" title="å®šä¹‰ROMæ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­"></a><strong>å®šä¹‰ROMæ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­</strong></h3><h3 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a><strong>æ­¥éª¤ï¼š</strong></h3><ol><li>ç”¨<strong>declarative_base</strong>æ ¹æ®<strong>engine</strong>åˆ›å»ºä¸€ä¸ª<strong>ORMåŸºç±»</strong>ã€‚</li><li>ç”¨è¿™ä¸ª<strong>Base</strong>ç±»ä½œä¸ºåŸºç±»æ¥å†™è‡ªå·±çš„ORMç±»ã€‚è¦å®šä¹‰<code>__tablename__</code>ç±»å±æ€§ï¼Œæ¥æŒ‡å®šè¿™ä¸ªæ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„è¡¨åã€‚</li><li>åˆ›å»ºå±æ€§æ¥æ˜ å°„åˆ°è¡¨ä¸­çš„å­—æ®µï¼Œæ‰€æœ‰éœ€è¦æ˜ å°„åˆ°è¡¨ä¸­çš„å±æ€§éƒ½åº”è¯¥ä¸º<strong>Columnç±»å‹</strong></li><li>ä½¿ç”¨<code>Base.metadata.create_all()</code>æ¥å°†æ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­ã€‚</li></ol><h3 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a><strong>æ³¨æ„ï¼š</strong></h3><p>ä½¿ç”¨create_allå‡½æ•°åˆ›å»ºçš„è¡¨æ˜ å°„åˆ°æ•°æ®åº“ä¹‹åï¼Œå³ä½¿æ”¹å˜äº†æ¨¡å‹çš„å­—æ®µï¼Œä¹Ÿä¸ä¼šé‡æ–°æ˜ å°„äº†ã€‚</p><p>ä½“ç°ä¸ºä»£ç ä¸­ï¼ŒååŠ çš„<strong>nick</strong>é¡¹ï¼Œæ²¡æœ‰åŠæ³•å®ç°ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šæ¯æ¬¡è¿è¡Œæ—¶ï¼Œå…ˆæŠŠä¹‹å‰çš„è¡¨å…¨éƒ¨åˆ é™¤ä¹‹åï¼Œåœ¨åˆ›å»ºæ–°çš„è¡¨ã€‚</p><h3 id="ä»£ç å®ç°ï¼š"><a href="#ä»£ç å®ç°ï¼š" class="headerlink" title="ä»£ç å®ç°ï¼š"></a><strong>ä»£ç å®ç°ï¼š</strong></h3><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-meta"># éœ€æ±‚ï¼šåˆ›å»ºå¥½ä¸€ä¸ªORMç±»æ¨¡å‹,å¹¶ä¸”æ˜ å°„åˆ°æŒ‡å®šçš„æ•°æ®åº“ä¸­æˆä¸ºè¡¨</span><br>â€‹<br><span class="hljs-meta"># 1ã€ç”¨`declarative_base`æ ¹æ®`engine`åˆ›å»ºä¸€ä¸ªORMåŸºç±»Baseã€‚</span><br>â€‹<br><span class="hljs-type">Base</span> = declarative_base(engine)<br>â€‹<br><span class="hljs-meta"># 2ã€ç”¨è¿™ä¸ª`Base`ç±»ä½œä¸ºåŸºç±»æ¥å†™è‡ªå·±çš„ORMç±»ã€‚è¦å®šä¹‰`__tablename__`ç±»å±æ€§ï¼Œæ¥æŒ‡å®šè¿™ä¸ªæ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„è¡¨åã€‚</span><br>â€‹<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Person</span>(<span class="hljs-type">Base</span>):</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class">    __tablename__ = &#x27;t_person&#x27;</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class"># 3ã€åœ¨è¿™ä¸ª<span class="hljs-type">ORM</span>æ¨¡å‹ä¸­åˆ›å»ºä¸€äº›å±æ€§ï¼Œæ¥è·Ÿè¡¨ä¸­çš„å­—æ®µè¿›è¡Œ ä¸€ä¸€ æ˜ å°„ã€‚è¿™äº›å±æ€§å¿…é¡»æ˜¯sqlalchemyç»™æˆ‘ä»¬æä¾›å¥½çš„æ•°æ®ç±»å‹</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class">    id = <span class="hljs-type">Column</span>(<span class="hljs-type">Integer</span>,<span class="hljs-title">primary_key</span>=<span class="hljs-type">True</span>,<span class="hljs-title">autoincrement</span>= <span class="hljs-type">True</span>)</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class">    # nullable = <span class="hljs-type">True</span>  å¯ä»¥ä¸ºç©º</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class">    name = <span class="hljs-type">Column</span>(<span class="hljs-type">String(50)</span>,<span class="hljs-title">nullable</span>=<span class="hljs-type">False</span>)</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class">    age = <span class="hljs-type">Column</span>(<span class="hljs-type">Integer</span>)</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class">    country = <span class="hljs-type">Column</span>(<span class="hljs-type">String(50)</span>)</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class">    # ååŠ å…¥çš„nické¡¹</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class">    nick = <span class="hljs-type">Column</span>(<span class="hljs-type">String(20)</span>)</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class"># 4ã€ä½¿ç”¨`<span class="hljs-type">Base</span>.metadata.create_all()`æ¥å°†æ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class"># <span class="hljs-type">Base</span>.metadata.create_all()</span><br><span class="hljs-class">â€‹</span><br><span class="hljs-class"># æ³¨æ„ç‚¹ï¼šä¸€æ—¦ä½¿ç”¨`<span class="hljs-type">Base</span>.metadata.create_all()`å°†æ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­åï¼Œå³ä½¿æ”¹å˜äº†æ¨¡å‹çš„å­—æ®µï¼Œä¹Ÿä¸ä¼šé‡æ–°æ˜ å°„äº†ã€‚</span><br><span class="hljs-class"># è§£å†³æ–¹æ³•ï¼šå…ˆå°†è¡¨å…¨éƒ¨åˆ é™¤ä¹‹åå†åˆ›å»ºæ–°çš„è¡¨</span><br><span class="hljs-class"># å°†<span class="hljs-type">Base</span>ä¸Šçš„<span class="hljs-type">ORM</span>ç±»æ¨¡å‹å¯¹åº”çš„æ•°æ®è¡¨éƒ½åˆ é™¤</span><br><span class="hljs-class"><span class="hljs-type">Base</span>.metadata.drop_all()</span><br><span class="hljs-class"># åˆ›å»º<span class="hljs-type">Base</span>ä¸Šçš„<span class="hljs-type">ORM</span>ç±»åˆ°æ•°æ®åº“ä¸­æˆä¸ºè¡¨</span><br><span class="hljs-class"><span class="hljs-type">Base</span>.metadata.create_all()</span><br></code></pre></td></tr></table></figure><h3 id="å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼ˆcrudâ†’å¢åˆ æ”¹æŸ¥ï¼‰"><a href="#å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼ˆcrudâ†’å¢åˆ æ”¹æŸ¥ï¼‰" class="headerlink" title="å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼ˆcrudâ†’å¢åˆ æ”¹æŸ¥ï¼‰"></a><strong>å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼ˆcrudâ†’å¢åˆ æ”¹æŸ¥ï¼‰</strong></h3><blockquote><p>crudåŠŸèƒ½æŒ‡çš„å°±æ˜¯å¢åˆ æ”¹æŸ¥ã€‚</p></blockquote><h3 id="æ­¥éª¤ï¼š-1"><a href="#æ­¥éª¤ï¼š-1" class="headerlink" title="æ­¥éª¤ï¼š"></a><strong>æ­¥éª¤ï¼š</strong></h3><ol><li><p>æ„å»ºsessionå¯¹è±¡ï¼Œæ‰€æœ‰çš„æ‰€æœ‰å’Œæ•°æ®åº“çš„ORMæ“ä½œéƒ½å¿…é¡»é€šè¿‡ä¸€ä¸ªå«åš<code>session</code>çš„ä¼šè¯å¯¹è±¡æ¥å®ç°</p></li><li><p>å¯¹è¡¨æ·»åŠ æ•°æ®<strong>{add(),add_all([])}</strong></p></li><li><p>æŸ¥è¯¢è¡¨ä¸­æ•°æ®</p><ol><li>å…¨è¡¨æŸ¥è¯¢ æŸ¥æ‰¾æŸä¸ªæ¨¡å‹å¯¹åº”çš„é‚£ä¸ªè¡¨ä¸­æ‰€æœ‰çš„æ•°æ®<br> all_person &#x3D; session.query(Person).all()</li><li>æ¡ä»¶æŸ¥è¯¢ filter_by<br> all_person &#x3D; session.query(Person).filter_by(name&#x3D;â€™momo1â€™).all()</li><li>æ¡ä»¶æŸ¥è¯¢ filter<br> all_person &#x3D; session.query(Person).filter(Person.name&#x3D;&#x3D;â€™momo1â€™).all()</li><li>æ¡ä»¶æŸ¥è¯¢ getæ–¹æ³•æ˜¯æ ¹æ®idæ¥æŸ¥æ‰¾çš„ï¼Œåªä¼šè¿”å›ä¸€æ¡æ•°æ®æˆ–è€…None<br> person &#x3D; session.query(Person).get(primary_key)</li><li>æ¡ä»¶æŸ¥è¯¢ ä½¿ç”¨firstæ–¹æ³•è·å–ç»“æœé›†ä¸­çš„ç¬¬ä¸€æ¡æ•°æ®<br> person &#x3D; session.query(Person).first()</li></ol></li><li><p>ä¿®æ”¹å¯¹è±¡<br>é¦–å…ˆä»æ•°æ®åº“ä¸­<strong>æŸ¥æ‰¾å¯¹è±¡</strong>ï¼Œç„¶åå°†è¿™æ¡æ•°æ®<strong>ä¿®æ”¹</strong>ä¸ºä½ æƒ³è¦çš„æ•°æ®ï¼Œæœ€ååš<strong>commit</strong>æ“ä½œå°±å¯ä»¥ä¿®æ”¹æ•°æ®äº†</p></li><li><p>åˆ é™¤å¯¹è±¡<br>å°†éœ€è¦åˆ é™¤çš„æ•°æ®ä»æ•°æ®åº“ä¸­<strong>æŸ¥æ‰¾å‡ºæ¥</strong>ï¼Œç„¶åä½¿ç”¨<strong>session.delete</strong>æ–¹æ³•å°†è¿™æ¡æ•°æ®ä»sessionä¸­åˆ é™¤ï¼Œæœ€ååš<strong>commit</strong>æ“ä½œå°±å¯ä»¥äº†ã€‚</p></li></ol><h3 id="ä»£ç å®ç°ï¼š-1"><a href="#ä»£ç å®ç°ï¼š-1" class="headerlink" title="ä»£ç å®ç°ï¼š"></a><strong>ä»£ç å®ç°ï¼š</strong></h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">    éœ€æ±‚2ï¼šcrudçš„æ“ä½œ</span><br><span class="hljs-string">        0ã€å‰æï¼šè·å–åˆ°æ ¹æ•°æ®åº“ï¼Œè¿›è¡Œä¼šè¯çš„å¯¹è±¡ </span><br><span class="hljs-string">        1ã€å¯¹è¡¨ï¼Œæ·»åŠ æ•°æ®</span><br><span class="hljs-string">        2ã€æŸ¥è¯¢è¡¨æ•°æ®</span><br><span class="hljs-string">        3ã€ä¿®æ”¹è¡¨ï¼ŒæŒ‡å®šè¡Œæ•°æ®</span><br><span class="hljs-string">        4ã€åˆ é™¤è¡¨æ•°æ®</span><br><span class="hljs-string">&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment"># è·å–åˆ°æ ¹æ•°æ®åº“ï¼Œè¿›è¡Œä¼šè¯çš„å¯¹è±¡ ï¼Œæ„å»ºsessionå¯¹è±¡ï¼Œæ‰€æœ‰çš„æ‰€æœ‰å’Œæ•°æ®åº“çš„ORMæ“ä½œéƒ½å¿…é¡»é€šè¿‡ä¸€ä¸ªå«åš`session`çš„ä¼šè¯å¯¹è±¡æ¥å®ç°</span><br><span class="hljs-comment"># Session = sessionmaker(engine)</span><br><span class="hljs-comment"># session = Session()</span><br><span class="hljs-comment">#  ä¸‹ä¸€è¡Œä»£ç ç›¸å½“äºä¸Šä¸¤è¡Œ</span><br>session = sessionmaker(engine)()<br>â€‹<br><span class="hljs-comment"># 1ã€å¯¹è¡¨ï¼Œæ·»åŠ æ•°æ®  session.add() session.add_all([])</span><br>p = Person(<span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;MGorz&#x27;</span>,age =18,country =<span class="hljs-string">&#x27;China&#x27;</span>,<span class="hljs-attribute">nick</span>=<span class="hljs-string">&#x27;è¯šå“¥&#x27;</span>)<br>session.<span class="hljs-built_in">add</span>(p) # ä¸€æ¬¡åªèƒ½æ’å…¥ä¸€æ¡æ•°æ®<br>session.commit()<br><span class="hljs-comment"># æ·»åŠ å¤šæ¡æ•°æ® </span><br>p2 = Person(<span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;Mrz&#x27;</span>,age =18,country =<span class="hljs-string">&#x27;China&#x27;</span>,<span class="hljs-attribute">nick</span>=<span class="hljs-string">&#x27;ha&#x27;</span>)<br>p3 = Person(<span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;MGz&#x27;</span>,age =18,country =<span class="hljs-string">&#x27;China&#x27;</span>,<span class="hljs-attribute">nick</span>=<span class="hljs-string">&#x27;e&#x27;</span>)<br>session.add_all([p2,p3])<br>session.commit()<br>â€‹<br><span class="hljs-comment"># 2ã€æŸ¥è¯¢è¡¨ä¸­æ•°æ®</span><br><span class="hljs-comment"># 2.1   å…¨è¡¨æŸ¥è¯¢  ()ä¸­å¡«ç±»å,</span><br>ps = session.query(Person).all()<br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> ps :<br>    <span class="hljs-built_in">print</span>(p)<br><span class="hljs-comment"># 2.2   æ¡ä»¶æŸ¥è¯¢    filter_by</span><br><span class="hljs-comment"># filter_by(),æ‹¬å·ä¸­å¡«å…¥æƒ³æŸ¥è¯¢çš„ã€‚</span><br>ps = session.query(Person).filter_by(name = <span class="hljs-string">&quot;MGorz&quot;</span>).all()<br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> ps :<br>    <span class="hljs-built_in">print</span>(p)<br><span class="hljs-comment"># 2.3   æ¡ä»¶æŸ¥è¯¢    filter</span><br><span class="hljs-comment"># æ³¨æ„å’Œfilter_byçš„åŒºåˆ«</span><br>ps = session.query(Person).filter(Person.name == <span class="hljs-string">&quot;MGorz&quot;</span>).all()<br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> ps :<br>    <span class="hljs-built_in">print</span>(p)<br><span class="hljs-comment"># 2.4   æ¡ä»¶æŸ¥è¯¢    get</span><br>ps = session.query(Person).<span class="hljs-built_in">get</span>(2)<br><span class="hljs-built_in">print</span>(ps)<br><span class="hljs-comment"># 2.5   æ¡ä»¶æŸ¥è¯¢    first</span><br>ps = session.query(Person).first()<br><span class="hljs-built_in">print</span>(ps)<br>â€‹<br><span class="hljs-comment"># 3ã€ä¿®æ”¹åˆ¶å®šè¡Œæ•°æ®</span><br>person = session.query(Person).first()<br><span class="hljs-built_in">print</span>(person)<br><span class="hljs-comment"># ä¿®æ”¹è¡¨æ•°æ®ï¼Œå¯¹è±¡.å±æ€§ = &#x27;   &#x27;</span><br>person.name = <span class="hljs-string">&#x27;hahaha&#x27;</span><br><span class="hljs-comment"># åˆ«å¿˜è®°è¦æäº¤å“¦~</span><br>session.commit()<br>â€‹<br><span class="hljs-comment"># 4ã€åˆ é™¤è¡¨æ•°æ®</span><br>person = session.query(Person).<span class="hljs-built_in">get</span>(3)<br><span class="hljs-built_in">print</span>(person)<br>session.delete(person)<br>session.commit()<br></code></pre></td></tr></table></figure><h3 id="Columnå¸¸ç”¨æ•°æ®ç±»å‹"><a href="#Columnå¸¸ç”¨æ•°æ®ç±»å‹" class="headerlink" title="Columnå¸¸ç”¨æ•°æ®ç±»å‹"></a><strong>Columnå¸¸ç”¨æ•°æ®ç±»å‹</strong></h3><p>å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼Œä¸€å…±æ˜¯æœ‰11ä¸ªã€‚</p><blockquote><p>æ³¨ï¼šåœ¨SQLAlchemyä¸­ä¸å­˜åœ¨doubleæ•°æ®ç±»å‹ï¼Œä½¿ç”¨ <strong>DECIMAL</strong>ç±»å‹æ›¿ä»£</p></blockquote><p>è®©æˆ‘ä»¬æ¥åˆ†åˆ«çœ‹ä¸‹è¿™11ä¸ªæ•°æ®ç±»å‹éƒ½æœ‰å“ªäº›ï¼Ÿ</p><ol><li><strong>Integer</strong>ï¼šæ•´å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯<strong>int</strong>ç±»å‹ã€‚</li><li><strong>Float</strong>ï¼šæµ®ç‚¹ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯<strong>float</strong>ç±»å‹ã€‚ä»–å æ®çš„32ä½ã€‚<br>æµ®ç‚¹ç±»å‹ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆç²¾åº¦ä¸¢å¤±ï¼Œç‰¹åˆ«æ˜¯åœ¨moneyæ–¹é¢ï¼Œä¸å¯åŸè°…ã€‚</li><li>Doubleï¼ˆ<strong>SQLAlchemyä¸­æ²¡æœ‰ï¼Œä»£æ›¿å“ä¸ºDECIMAL</strong>ï¼‰ï¼šåŒç²¾åº¦æµ®ç‚¹ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯doubleç±»å‹ï¼Œå æ®64ä½</li><li><strong>String</strong>ï¼šå¯å˜å­—ç¬¦ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯<strong>varchar</strong>ç±»å‹.</li><li><strong>Boolean</strong>ï¼šå¸ƒå°”ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„æ˜¯<strong>tinyint</strong>ç±»å‹ã€‚</li><li><strong>DECIMAL</strong>ï¼šå®šç‚¹ç±»å‹ã€‚æ˜¯ä¸“é—¨ä¸ºäº†<strong>è§£å†³æµ®ç‚¹ç±»å‹ç²¾åº¦ä¸¢å¤±</strong>çš„é—®é¢˜çš„ã€‚åœ¨å­˜å‚¨moneyç›¸å…³çš„å­—æ®µçš„æ—¶å€™å»ºè®®å¤§å®¶éƒ½ä½¿ç”¨è¿™ä¸ªæ•°æ®ç±»å‹ã€‚å¹¶ä¸”è¿™ä¸ªç±»å‹ä½¿ç”¨çš„æ—¶å€™éœ€è¦ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œ<strong>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æ ‡è®°è¿™ä¸ªå­—æ®µæ€»èƒ½èƒ½å­˜å‚¨å¤šå°‘ä¸ªæ•°å­—</strong>ï¼Œ<strong>ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå°æ•°ç‚¹åæœ‰å¤šå°‘ä½</strong>ã€‚</li><li><strong>Enum</strong>ï¼šæšä¸¾ç±»å‹ã€‚æŒ‡å®šæŸä¸ªå­—æ®µåªèƒ½æ˜¯æšä¸¾ä¸­æŒ‡å®šçš„å‡ ä¸ªå€¼ï¼Œä¸èƒ½ä¸ºå…¶ä»–å€¼ã€‚åœ¨ORMæ¨¡å‹ä¸­ï¼Œä½¿ç”¨<strong>Enum</strong>æ¥ä½œä¸ºæšä¸¾ã€‚</li><li><strong>Date</strong>ï¼šå­˜å‚¨æ—¶é—´ï¼Œåªèƒ½<strong>å­˜å‚¨å¹´æœˆæ—¥</strong>ã€‚æ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯dateç±»å‹ã€‚åœ¨Pythonä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>datetime.date</code>æ¥æŒ‡å®šã€‚</li><li><strong>DateTime</strong>ï¼šå­˜å‚¨æ—¶é—´ï¼Œå¯ä»¥<strong>å­˜å‚¨å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¯«ç§’ç­‰</strong>ã€‚æ˜ å°„åˆ°æ•°æ®åº“ä¸­ä¹Ÿæ˜¯datetimeç±»å‹ã€‚åœ¨Pythonä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>datetime.datetime</code>æ¥æŒ‡å®šã€‚</li><li><strong>Time</strong>ï¼šå­˜å‚¨æ—¶é—´ï¼Œå¯ä»¥<strong>å­˜å‚¨æ—¶åˆ†ç§’</strong>ã€‚æ˜ å°„åˆ°æ•°æ®åº“ä¸­ä¹Ÿæ˜¯timeç±»å‹ã€‚åœ¨Pythonä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>datetime.time</code>æ¥æŒ‡å®š<br>psï¼šæ³¨æ„åŒºåˆ†Date&#x2F;DateTime&#x2F;Timeçš„å‚¨å­˜ä¿¡æ¯ï¼ï¼ï¼</li><li><strong>Text</strong>ï¼šå­˜å‚¨é•¿å­—ç¬¦ä¸²ã€‚ä¸€èˆ¬å¯ä»¥å­˜å‚¨<strong>6W</strong>å¤šä¸ªå­—ç¬¦</li><li><strong>LONGTEXT</strong>ï¼šé•¿æ–‡æœ¬ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯longtextç±»å‹ï¼ˆ<strong>ä¸è¿‡è¿™ä¸ªåªæœ‰mysqlæœ‰ï¼Œorcaleæ²¡æœ‰</strong>ï¼‰</li></ol><p>ä¸Šè¿°å°±æ˜¯<strong>11ä¸ª</strong>æ•°æ®ç±»å‹ï¼Œå› ä¸ºè¿™é‡ŒæŠŠä¸å­˜åœ¨çš„doubleä¹Ÿæ·»åŠ ä¸Šäº†ï¼Œæ‰€ä»¥çœ‹èµ·æ¥æ˜¯12ä¸ªã€‚</p><p>ä¸‹é¢å°±è®©å’±ä»¬ä¸€èµ·æ¥è¿›è¡ŒéªŒè¯ã€‚</p><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a><strong>ä»£ç å®ç°</strong></h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># ä¾æ¬¡å¯¼å…¥å¸¸ç”¨çš„æ•°æ®ç±»å‹<br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine, <span class="hljs-keyword">Column</span>, <span class="hljs-type">Integer</span>, String,<span class="hljs-type">Float</span>,<span class="hljs-type">DECIMAL</span>,<span class="hljs-type">Boolean</span>,<span class="hljs-type">Date</span>,DateTime,<span class="hljs-type">Time</span>,<span class="hljs-type">Text</span>,Enum<br>â€‹<br># ä»sqlalchemyçš„æ–¹è¨€æ¨¡å—dialectså¯¼å…¥mysqlä¸“æœ‰çš„LONGTEXT,é•¿æ–‡æœ¬ç±»å‹<br><span class="hljs-keyword">from</span> sqlalchemy.dialects.mysql <span class="hljs-keyword">import</span> LONGTEXT<br>â€‹<br># åœ¨python3.xä¸­æœ‰enumæ¨¡å—<br><span class="hljs-keyword">import</span> enum<br>â€‹<br>#å¯¼å…¥æ—¶é—´äº†<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime,<span class="hljs-type">date</span>,<span class="hljs-type">time</span><br>â€‹<br>â€‹<br># ç”¨`declarative_base`æ ¹æ®`engine`åˆ›å»ºä¸€ä¸ªORMåŸºç±»ã€‚<br><span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base<br>â€‹<br># å¼•å…¥åˆ›å»ºpyå’Œæ•°æ®åº“è¿æ¥çš„sessionmakerå‡½æ•°<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker<br>â€‹<br>â€‹<br>â€‹<br># å‡†å¤‡è¿æ¥æ•°æ®åº“åŸºæœ¬ä¿¡æ¯<br>HOSTNAME = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span><br>PORT = <span class="hljs-string">&#x27;3306&#x27;</span><br><span class="hljs-keyword">DATABASE</span> = <span class="hljs-string">&#x27;first_sqlalchemy&#x27;</span><br>USERNAME = <span class="hljs-string">&#x27;root&#x27;</span><br><span class="hljs-keyword">PASSWORD</span> = <span class="hljs-string">&#x27;root&#x27;</span><br>DB_URI = <span class="hljs-string">&#x27;mysql+pymysql://&#123;username&#125;:&#123;pwd&#125;@&#123;host&#125;:&#123;port&#125;/&#123;db&#125;?charset=utf8&#x27;</span> \<br>    .format(username=USERNAME, pwd=<span class="hljs-keyword">PASSWORD</span>, host=HOSTNAME, port=PORT, db=<span class="hljs-keyword">DATABASE</span>)<br>â€‹<br>â€‹<br>â€‹<br># åˆ›å»ºæ•°æ®åº“å¼•æ“<br>engine = create_engine(DB_URI)<br>â€‹<br>Base = declarative_base(engine)<br>â€‹<br>â€‹<br>â€‹<br># éœ€æ±‚ï¼šå¸¸ç”¨çš„æ•°æ®ç±»å‹<br>â€‹<br># æšä¸¾å¦å¤–ä¸€ç§å†™æ³•ï¼Œå¯¼å…¥enumæ¨¡å—ï¼Œå®šä¹‰æšä¸¾ç±»<br><span class="hljs-keyword">class</span> TagEnum(enum.Enum):<br>    python = &quot;PYTHON&quot;<br>    flask = <span class="hljs-string">&#x27;FLASK&#x27;</span><br>    django = <span class="hljs-string">&#x27;DJANGO&#x27;</span><br>â€‹<br>â€‹<br>â€‹<br><span class="hljs-keyword">class</span> News(Base):<br>    __tablename__ = <span class="hljs-string">&#x27;news&#x27;</span><br>    id = <span class="hljs-keyword">Column</span>(<span class="hljs-type">Integer</span>,primary_key=<span class="hljs-keyword">True</span>,autoincrement=<span class="hljs-keyword">True</span>)<br>    price1 = <span class="hljs-keyword">Column</span>(<span class="hljs-type">Float</span>)   # ä¸è¿‡å­˜å‚¨æ•°æ®æ—¶å­˜åœ¨ç²¾åº¦ä¸¢å¤±çš„é—®é¢˜<br>    price2 = <span class="hljs-keyword">Column</span>(<span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">4</span>))<br>    title = <span class="hljs-keyword">Column</span>(String(<span class="hljs-number">50</span>))<br>    is_delete = <span class="hljs-keyword">Column</span>(<span class="hljs-type">Boolean</span>)<br>    tag1 = <span class="hljs-keyword">Column</span>(Enum(<span class="hljs-string">&#x27;PYTHON&#x27;</span>,<span class="hljs-string">&#x27;FLASK&#x27;</span>,<span class="hljs-string">&#x27;DJANGO&#x27;</span>))  # æšä¸¾çš„å¸¸è§„å†™æ³•ï¼ˆæ¨èï¼‰<br>    tag2 = <span class="hljs-keyword">Column</span>(Enum(TagEnum))  # å¦ä¸€ç§å†™æ³•<br>    create_time1 = <span class="hljs-keyword">Column</span>(<span class="hljs-type">Date</span>)<br>    create_time2 = <span class="hljs-keyword">Column</span>(DateTime)<br>    create_time3 = <span class="hljs-keyword">Column</span>(<span class="hljs-type">Time</span>)<br>    content1 = <span class="hljs-keyword">Column</span>(<span class="hljs-type">Text</span>)<br>    content2 = <span class="hljs-keyword">Column</span>(LONGTEXT)<br>â€‹<br>â€‹<br>â€‹<br>â€‹<br># å°†Baseä¸Šçš„ORMç±»æ¨¡å‹å¯¹åº”çš„æ•°æ®è¡¨éƒ½åˆ é™¤<br># Base.metadata.drop_all()<br># åˆ›å»ºBaseä¸Šçš„ORMç±»åˆ°æ•°æ®åº“ä¸­æˆä¸ºè¡¨<br># Base.metadata.create_all()<br>â€‹<br>â€‹<br># æ–°å¢æ•°æ®åˆ°è¡¨newsä¸­<br><span class="hljs-keyword">session</span> = sessionmaker(engine)()<br># æ³¨æ„<span class="hljs-type">float</span>å‡ºç°çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜      is_delete,å¸ƒå°”ç±»å‹<span class="hljs-keyword">true</span>ï¼š<span class="hljs-number">1</span>ï¼Œ<span class="hljs-keyword">false</span>:<span class="hljs-number">0</span><br>news1 = News(price1=<span class="hljs-number">1000.0078</span>,price2=<span class="hljs-number">1000.0078</span>,title=<span class="hljs-string">&#x27;æµ‹è¯•æ•°æ®&#x27;</span>,is_delete=<span class="hljs-keyword">True</span>,tag1=&quot;PYTHON&quot;,tag2=TagEnum.flask,    create_time1=<span class="hljs-type">date</span>(<span class="hljs-number">2018</span>,<span class="hljs-number">12</span>,<span class="hljs-number">12</span>),create_time2=datetime(<span class="hljs-number">2019</span>,<span class="hljs-number">2</span>,<span class="hljs-number">20</span>,<span class="hljs-number">12</span>,<span class="hljs-number">12</span>,<span class="hljs-number">30</span>),create_time3=<span class="hljs-type">time</span>(hour=<span class="hljs-number">11</span>,minute=<span class="hljs-number">12</span>,second=<span class="hljs-number">13</span>),content1=&quot;hello&quot;,content2 =&quot;hello   hi   nihao&quot;)<br>â€‹<br>â€‹<br><span class="hljs-keyword">session</span>.<span class="hljs-keyword">add</span>(news1)<br><span class="hljs-keyword">session</span>.<span class="hljs-keyword">commit</span>()<br></code></pre></td></tr></table></figure><h3 id="Columnå¸¸ç”¨çº¦æŸå‚æ•°"><a href="#Columnå¸¸ç”¨çº¦æŸå‚æ•°" class="headerlink" title="Columnå¸¸ç”¨çº¦æŸå‚æ•°"></a><strong>Columnå¸¸ç”¨çº¦æŸå‚æ•°</strong></h3><p>åœ¨ç»™æ•°æ®åº“è¡¨æŒ‡å®škeyçš„æ—¶å€™ï¼Œå¿…ç„¶è¦ç»™å®ƒä»¬æ·»åŠ ï¼Œä¾‹å¦‚ï¼šä¸å¯ç©ºï¼Œå­—èŠ‚é•¿åº¦ç­‰ç­‰çš„é™åˆ¶ï¼Œè¿™å°±éœ€è¦çº¦æŸå‚æ•°çš„å‡ºåœºäº†ã€‚å¸¸ç”¨çš„çº¦æŸå‚æ•°ä¸€å…±æœ‰<strong>7</strong>ç§</p><h3 id="å¸¸è§çº¦æŸå‚æ•°"><a href="#å¸¸è§çº¦æŸå‚æ•°" class="headerlink" title="å¸¸è§çº¦æŸå‚æ•°"></a><strong>å¸¸è§çº¦æŸå‚æ•°</strong></h3><p><strong>çº¦æŸå‚æ•°æè¿°ï¼ŒåŠŸèƒ½</strong>primary_keyTrueè®¾ç½®æŸä¸ªå­—æ®µä¸ºä¸»é”®autoincrementTrueè®¾ç½®è¿™ä¸ªå­—æ®µä¸ºè‡ªåŠ¨å¢é•¿çš„defaultè®¾ç½®æŸä¸ªå­—æ®µçš„é»˜è®¤å€¼ã€‚åœ¨å‘è¡¨æ—¶é—´è¿™äº›å­—æ®µä¸Šé¢ç»å¸¸ç”¨nullableæŒ‡å®šæŸä¸ªå­—æ®µæ˜¯å¦ä¸ºç©ºã€‚é»˜è®¤å€¼æ˜¯Trueï¼Œå°±æ˜¯å¯ä»¥ä¸ºç©ºuniqueæŒ‡å®šæŸä¸ªå­—æ®µçš„å€¼æ˜¯å¦å”¯ä¸€ã€‚é»˜è®¤æ˜¯Falseã€‚onupdateåœ¨<strong>æ•°æ®æ›´æ–°</strong>çš„æ—¶å€™ä¼š<strong>è°ƒç”¨</strong>è¿™ä¸ªå‚æ•°æŒ‡å®šçš„<strong>å€¼æˆ–è€…å‡½æ•°</strong>ã€‚åœ¨_ç¬¬ä¸€æ¬¡æ’å…¥è¿™æ¡æ•°æ®çš„æ—¶å€™ï¼Œä¸ä¼šç”¨onupdateçš„å€¼ï¼Œåªä¼šä½¿ç”¨defaultçš„å€¼_ã€‚å¸¸ç”¨äºæ˜¯<code>update_time</code>å­—æ®µï¼ˆæ¯æ¬¡æ›´æ–°æ•°æ®çš„æ—¶å€™éƒ½è¦æ›´æ–°è¯¥å­—æ®µå€¼ï¼‰ã€‚nameæŒ‡å®šORMæ¨¡å‹ä¸­æŸä¸ªå±æ€§æ˜ å°„åˆ°è¡¨ä¸­çš„å­—æ®µåã€‚å¦‚æœ<strong>ä¸æŒ‡å®š</strong>ï¼Œé‚£ä¹ˆä¼š<strong>ä½¿ç”¨è¿™ä¸ªå±æ€§çš„åå­—æ¥ä½œä¸ºå­—æ®µå</strong>ã€‚è¿™ä¸ªå‚æ•°ä¹Ÿå¯ä»¥å½“ä½œä½ç½®å‚æ•°ï¼Œåœ¨ç¬¬1ä¸ªå‚æ•°æ¥æŒ‡å®šã€‚</p><h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a><strong>ä»£ç å®ç°</strong></h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># æ³¨æ„åƒä¸‡ä¸èƒ½å¿˜è®°è¦å…ˆåˆ›å»º<span class="hljs-keyword">session</span>å¯¹è±¡å•Šï¼ï¼<br># éœ€æ±‚ï¼šsqlalchemyä¸­<span class="hljs-keyword">Column</span>å¸¸ç”¨çš„çº¦æŸå‚æ•°<br><span class="hljs-keyword">class</span> News(Base):<br>    __tablename__ = <span class="hljs-string">&#x27;news&#x27;</span><br>    id = <span class="hljs-keyword">Column</span>(<span class="hljs-type">Integer</span>,primary_key=<span class="hljs-keyword">True</span>,autoincrement=<span class="hljs-keyword">True</span>)<br>    # è¿™ä¸ªDatetimeæ˜¯sqlalchemyä¸­çš„<br>    create_time = <span class="hljs-keyword">Column</span>(DateTime,default=datetime.now)<br>    read_count = <span class="hljs-keyword">Column</span>(<span class="hljs-type">Integer</span>,default=<span class="hljs-number">11</span>)<br>    title1 = <span class="hljs-keyword">Column</span>(String(<span class="hljs-number">50</span>),<span class="hljs-type">name</span>=<span class="hljs-string">&#x27;my_title&#x27;</span>,nullable=<span class="hljs-keyword">False</span>)<br>    title2 = <span class="hljs-keyword">Column</span>(<span class="hljs-string">&#x27;my_title22&#x27;</span>,String(<span class="hljs-number">50</span>), nullable=<span class="hljs-keyword">False</span>)# <span class="hljs-type">name</span> å±æ€§çš„ä¸¤ç§æ–¹å¼<br>    telephone = <span class="hljs-keyword">Column</span>(String(<span class="hljs-number">11</span>),<span class="hljs-keyword">unique</span>=<span class="hljs-keyword">True</span>)<br>    update_time = <span class="hljs-keyword">Column</span>(DateTime,onupdate=datetime.now,default=datetime.now)#onupdateæ˜¯åœ¨æ•°æ®æ›´æ–°çš„æ—¶å€™æ‰ä¼šèµ·ä½œç”¨ï¼Œæ’å…¥æ•°æ®æ—¶å€™ä¸èµ·ä½œç”¨<br>â€‹<br># Base.metadata.drop_all()<br># Base.metadata.create_all()<br>â€‹<br>news1 = News(title1 =<span class="hljs-string">&#x27;hahah&#x27;</span>,title2 = <span class="hljs-string">&#x27;womingsad&#x27;</span>)<br><span class="hljs-keyword">session</span>.<span class="hljs-keyword">add</span>(news1)<br>#ç»“æŸä¹‹åï¼Œå¿…é¡»è¦æäº¤<br><span class="hljs-keyword">session</span>.<span class="hljs-keyword">commit</span>()<br></code></pre></td></tr></table></figure><h3 id="QueryæŸ¥è¯¢å‡½æ•°ï¼Œå¯ä»¥ä¼ é€’çš„å‚æ•°æœ‰å“ªäº›ï¼Ÿ"><a href="#QueryæŸ¥è¯¢å‡½æ•°ï¼Œå¯ä»¥ä¼ é€’çš„å‚æ•°æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="QueryæŸ¥è¯¢å‡½æ•°ï¼Œå¯ä»¥ä¼ é€’çš„å‚æ•°æœ‰å“ªäº›ï¼Ÿ"></a><strong>QueryæŸ¥è¯¢å‡½æ•°ï¼Œå¯ä»¥ä¼ é€’çš„å‚æ•°æœ‰å“ªäº›ï¼Ÿ</strong></h3><p>QueryæŸ¥è¯¢å‡½æ•°ä¼ é€’çš„å‚æ•°æ— éå°±æ˜¯åˆ†ä¸º<strong>ä¸‰ç±»</strong>ï¼Œåˆ†åˆ«æ˜¯<strong>æ¨¡å‹åã€æ¨¡å‹ä¸­çš„å±æ€§ã€èšåˆå‡½æ•°</strong>ï¼Œé‚£ä¸‹é¢å°±ç®€å•çš„è¯´æ˜ï¼Œ</p><h3 id="æ¨¡å‹å"><a href="#æ¨¡å‹å" class="headerlink" title="æ¨¡å‹å"></a><strong>æ¨¡å‹å</strong></h3><blockquote><p>æŒ‡å®šæŸ¥æ‰¾è¯¥æ¨¡å‹ä¸­æ‰€æœ‰å±æ€§ï¼ˆå¯¹åº”æŸ¥è¯¢ä¸ºå…¨è¡¨æŸ¥è¯¢ï¼‰</p></blockquote><h3 id="æ¨¡å‹ä¸­çš„å±æ€§"><a href="#æ¨¡å‹ä¸­çš„å±æ€§" class="headerlink" title="æ¨¡å‹ä¸­çš„å±æ€§"></a><strong>æ¨¡å‹ä¸­çš„å±æ€§</strong></h3><blockquote><p>å¯ä»¥æŒ‡å®šåªæŸ¥æ‰¾æŸä¸ªæ¨¡å‹çš„å…¶ä¸­å‡ ä¸ªå±æ€§</p></blockquote><h3 id="èšåˆå‡½æ•°"><a href="#èšåˆå‡½æ•°" class="headerlink" title="èšåˆå‡½æ•°"></a><strong>èšåˆå‡½æ•°</strong></h3><blockquote><p>èšåˆå‡½æ•°ä¸€å…±æœ‰äº”ä¸ªï¼Œéƒ½è¢«æ”¾åˆ°äº†sqlalchemyçš„funcæ¨¡å—ä¸­ã€‚</p></blockquote><ol><li>func.countï¼šç»Ÿè®¡è¡Œçš„æ•°é‡</li><li>func.avgï¼šæ±‚å¹³å‡å€¼</li><li>func.maxï¼šæ±‚æœ€å¤§å€¼</li><li>func.minï¼šæ±‚æœ€å°å€¼</li><li>func.sumï¼šæ±‚å’Œ</li></ol><h3 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a><strong>ä»£ç å®ç°</strong></h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs css"># æ–°å¢æµ‹è¯•æ•°æ®<br>â€‹<br>for x in range(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>):<br>â€‹<br>    a = <span class="hljs-built_in">News</span>(title = <span class="hljs-string">&quot;æ ‡é¢˜%s&quot;</span>%x,price = random.<span class="hljs-built_in">randint</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>))<br>â€‹<br>    session.<span class="hljs-built_in">add</span>(a)<br># æäº¤<br>session.<span class="hljs-built_in">commit</span>()<br>â€‹<br>â€‹<br>â€‹<br># ä¸‰ç§å‚æ•°<br># æ¨¡å‹å<br>result = session.<span class="hljs-built_in">query</span>(News).<span class="hljs-built_in">all</span>()  #å…¨è¡¨æŸ¥è¯¢<br><span class="hljs-built_in">print</span>(result)<br>â€‹<br># æ¨¡å‹åçš„å±æ€§å,è¿”å›çš„åˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯å…ƒç»„ç±»å‹æ•°æ®<br>result = session.<span class="hljs-built_in">query</span>(News.title,News.price).<span class="hljs-built_in">all</span>()<br><span class="hljs-built_in">print</span>(result)<br>â€‹<br># èšåˆå‡½æ•°<br># ç»Ÿè®¡è¡Œçš„æ•°é‡<br>r = session.<span class="hljs-built_in">query</span>(func.<span class="hljs-built_in">count</span>(News.id)).<span class="hljs-built_in">first</span>()<br><span class="hljs-built_in">print</span>(r)<br>#æœ€å¤§å€¼<br>r = session.<span class="hljs-built_in">query</span>(func.<span class="hljs-built_in">max</span>(News.price)).<span class="hljs-built_in">first</span>()<br><span class="hljs-built_in">print</span>(r)<br>#æœ€å°å€¼<br>r = session.<span class="hljs-built_in">query</span>(func.<span class="hljs-built_in">min</span>(News.price)).<span class="hljs-built_in">first</span>()<br><span class="hljs-built_in">print</span>(r)<br>#å¹³å‡å€¼<br>r = session.<span class="hljs-built_in">query</span>(func.<span class="hljs-built_in">avg</span>(News.price)).<span class="hljs-built_in">first</span>()<br><span class="hljs-built_in">print</span>(r)<br>#æ±‚å’Œ<br>r = session.<span class="hljs-built_in">query</span>(func.<span class="hljs-built_in">sum</span>(News.price)).<span class="hljs-built_in">first</span>()<br><span class="hljs-built_in">print</span>(r)<br></code></pre></td></tr></table></figure><p>Â è½¬è‡ªï¼š<a href="https://zhuanlan.zhihu.com/p/71134861">https://zhuanlan.zhihu.com/p/71134861</a></p>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python mysql orm æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pip install å®‰è£…é€Ÿåº¦å¾ˆæ…¢é—®é¢˜è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2020/03/11/pip%20install%20%E5%AE%89%E8%A3%85%E9%80%9F%E5%BA%A6%E5%BE%88%E6%85%A2%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2020/03/11/pip%20install%20%E5%AE%89%E8%A3%85%E9%80%9F%E5%BA%A6%E5%BE%88%E6%85%A2%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="ä¸´æ—¶æ–¹æ¡ˆï¼š"><a href="#ä¸´æ—¶æ–¹æ¡ˆï¼š" class="headerlink" title="ä¸´æ—¶æ–¹æ¡ˆï¼š"></a>ä¸´æ—¶æ–¹æ¡ˆï¼š</h4><ul><li>æ¸…åï¼š<a href="https://pypi.tuna.tsinghua.edu.cn/simple">https://pypi.tuna.tsinghua.edu.cn/simple</a></li><li>é˜¿é‡Œäº‘ï¼š<a href="http://mirrors.aliyun.com/pypi/simple/">http://mirrors.aliyun.com/pypi/simple/</a></li><li>ä¸­å›½ç§‘æŠ€å¤§å­¦ <a href="https://pypi.mirrors.ustc.edu.cn/simple/">https://pypi.mirrors.ustc.edu.cn/simple/</a></li><li>åä¸­ç†å·¥å¤§å­¦ï¼š<a href="http://pypi.hustunique.com/">http://pypi.hustunique.com/</a></li><li>å±±ä¸œç†å·¥å¤§å­¦ï¼š<a href="http://pypi.sdutlinux.org/">http://pypi.sdutlinux.org/</a></li><li>è±†ç“£ï¼š<a href="http://pypi.douban.com/simple/">http://pypi.douban.com/simple/</a><br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>æŠŠä¸Šè¾¹çš„åœ°å€æ›¿æ¢æˆ -i åé¢å³å¯ï¼Œä¸ªäººæ„Ÿè§‰è±†ç“£æºæ¯”è¾ƒå¿«<br>pip install Flask -i <a href="https://pypi.douban.com/simple/">https://pypi.douban.com/simple/</a></li></ul><h4 id="æ°¸ä¹…æ–¹æ¡ˆï¼š"><a href="#æ°¸ä¹…æ–¹æ¡ˆï¼š" class="headerlink" title="æ°¸ä¹…æ–¹æ¡ˆï¼š"></a>æ°¸ä¹…æ–¹æ¡ˆï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> ~/.pip<br>vim ~/.pip/pip.conf<br></code></pre></td></tr></table></figure><p><strong>æ·»åŠ ä»¥ä¸‹å†…å®¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[global]<br>index-url = https://mirrors.cloud.tencent.com/pypi/simple<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pip python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå®šæ—¶ä»»åŠ¡ æ¯éš”ä¸€å®šæ—¶é—´è¿è¡Œä¸€æ¬¡å‡½æ•°/ä»»åŠ¡ pythonçš„å®šæ—¶ä»»åŠ¡</title>
    <link href="/2020/03/06/Python%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%20%E6%AF%8F%E9%9A%94%E4%B8%80%E5%AE%9A%E6%97%B6%E9%97%B4%E8%BF%90%E8%A1%8C%E4%B8%80%E6%AC%A1%E5%87%BD%E6%95%B0!%E4%BB%BB%E5%8A%A1%20python%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    <url>/2020/03/06/Python%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%20%E6%AF%8F%E9%9A%94%E4%B8%80%E5%AE%9A%E6%97%B6%E9%97%B4%E8%BF%90%E8%A1%8C%E4%B8%80%E6%AC%A1%E5%87%BD%E6%95%B0!%E4%BB%BB%E5%8A%A1%20python%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="æ¯éš”ä¸€å®šæ—¶é—´è¿è¡Œä¸€æ¬¡å‡½æ•°-x2F-ä»»åŠ¡-ä¾‹å­ä¸­æ¯10ç§’æ‰§è¡Œä¸€æ¬¡â€¦"><a href="#æ¯éš”ä¸€å®šæ—¶é—´è¿è¡Œä¸€æ¬¡å‡½æ•°-x2F-ä»»åŠ¡-ä¾‹å­ä¸­æ¯10ç§’æ‰§è¡Œä¸€æ¬¡â€¦" class="headerlink" title="æ¯éš”ä¸€å®šæ—¶é—´è¿è¡Œä¸€æ¬¡å‡½æ•°&#x2F;ä»»åŠ¡ ä¾‹å­ä¸­æ¯10ç§’æ‰§è¡Œä¸€æ¬¡â€¦"></a>æ¯éš”ä¸€å®šæ—¶é—´è¿è¡Œä¸€æ¬¡å‡½æ•°&#x2F;ä»»åŠ¡ ä¾‹å­ä¸­æ¯10ç§’æ‰§è¡Œä¸€æ¬¡â€¦</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">func_task</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ‰§è¡Œä»»åŠ¡ä¸­...&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func_timer</span>():<br><br>    func_task()<br>    <span class="hljs-keyword">global</span> timer  <span class="hljs-comment"># å®šä¹‰å…¨å±€å˜é‡</span><br>    <span class="hljs-comment"># å®šæ—¶å™¨æ„é€ å‡½æ•°ä¸»è¦æœ‰2ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå‡½æ•°å</span><br>    timer = threading.Timer(<span class="hljs-number">10</span>, func_timer)   <span class="hljs-comment"># 10ç§’è°ƒç”¨ä¸€æ¬¡å‡½æ•°</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çº¿ç¨‹åç§°=&#123;&#125;,\næ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹åˆ—è¡¨:&#123;&#125;,\næ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡=&#123;&#125;,\nå½“å‰æ¿€æ´»çº¿ç¨‹=&#123;&#125;\n&quot;</span>.<span class="hljs-built_in">format</span>(<br>        timer.getName(), threading.<span class="hljs-built_in">enumerate</span>(), threading.active_count(), timer.isAlive)<br>    )<br><br>    timer.start()    <span class="hljs-comment">#å¯ç”¨å®šæ—¶å™¨</span><br><br>timer = threading.Timer(<span class="hljs-number">1</span>, func_timer)<br>timer.start()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å®šæ—¶å™¨å¯åŠ¨æˆåŠŸ-----&#x27;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå®ç°é€šç”¨è£…é¥°å™¨</title>
    <link href="/2020/03/02/Python%E5%AE%9E%E7%8E%B0%E9%80%9A%E7%94%A8%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
    <url>/2020/03/02/Python%E5%AE%9E%E7%8E%B0%E9%80%9A%E7%94%A8%E8%A3%85%E9%A5%B0%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">func</span>):<br><span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params">*args, **kwargs</span>):<br><br><span class="hljs-comment"># è¿™é‡Œå¯ä»¥å†™ä½ é¢å¤–å¸Œæœ›å¢åŠ åŠŸèƒ½çš„ä»£ç </span><br>            <br>        <span class="hljs-keyword">return</span> func(*args, **kwargs)<br>    <span class="hljs-keyword">return</span> inner<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonä¸­å¼€å¯å¤šçº¿ç¨‹çš„è£…é¥°å™¨</title>
    <link href="/2020/03/02/Python%E4%B8%AD%E5%BC%80%E5%90%AF%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
    <url>/2020/03/02/Python%E4%B8%AD%E5%BC%80%E5%90%AF%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="Pythonä¸­å¼€å¯å¤šçº¿ç¨‹çš„è£…é¥°å™¨"><a href="#Pythonä¸­å¼€å¯å¤šçº¿ç¨‹çš„è£…é¥°å™¨" class="headerlink" title="Pythonä¸­å¼€å¯å¤šçº¿ç¨‹çš„è£…é¥°å™¨"></a>Pythonä¸­å¼€å¯å¤šçº¿ç¨‹çš„è£…é¥°å™¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_async</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        thr = threading.Thread(target = func, args = args, kwargs = kwargs)<br>        thr.start()<br>        thr.setName(<span class="hljs-string">&quot;func-&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(func.__name__))<br>        <span class="hljs-comment"># thr.join()</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çº¿ç¨‹id=&#123;&#125;,\nçº¿ç¨‹åç§°=&#123;&#125;,\næ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹åˆ—è¡¨:&#123;&#125;,\næ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡=&#123;&#125;,\nå½“å‰æ¿€æ´»çº¿ç¨‹=&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<br>            thr.ident,thr.getName(),threading.<span class="hljs-built_in">enumerate</span>(),threading.active_count(),thr.isAlive)<br>        )<br>    <span class="hljs-keyword">return</span> wrapper<br><br><br><br><span class="hljs-meta">@run_async</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">param</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        time.sleep(<span class="hljs-number">3</span>)<br>        t = random.randint(<span class="hljs-number">1</span>,param)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;/test:&quot;</span> + <span class="hljs-built_in">str</span>(t))<br><br><br><span class="hljs-meta">@run_async</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test2</span>(<span class="hljs-params">param</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        time.sleep(<span class="hljs-number">2</span>)<br>        t = random.randint(<span class="hljs-number">1</span>,param)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;/test2:&quot;</span> + <span class="hljs-built_in">str</span>(t))<br><br><br><br><span class="hljs-comment"># test(10)</span><br><span class="hljs-comment"># test2(1000)</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python thread å¤šè¿›ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python  ç”¨flask_socketsæ¨¡å—å®ç°websocket  è‡ªå®šä¹‰è·¯ç”±å®ç°websocketæœåŠ¡ç«¯</title>
    <link href="/2020/03/02/Python%20%20%E7%94%A8flask_sockets%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0websocket%20%20%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0websocket%E6%9C%8D%E5%8A%A1%E7%AB%AF/"/>
    <url>/2020/03/02/Python%20%20%E7%94%A8flask_sockets%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0websocket%20%20%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0websocket%E6%9C%8D%E5%8A%A1%E7%AB%AF/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="flask-socketsæ¨¡å—çš„ä½¿ç”¨"><a href="#flask-socketsæ¨¡å—çš„ä½¿ç”¨" class="headerlink" title="flask_socketsæ¨¡å—çš„ä½¿ç”¨"></a>flask_socketsæ¨¡å—çš„ä½¿ç”¨</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">å¯ä»¥è‡ªå®šä¹‰è·¯ç”±<br>socketè·¯ç”±çš„è®¿é—®åœ°å€ä¸ºws:<span class="hljs-regexp">//</span>localhost:ç«¯å£/è‡ªå®šä¹‰çš„åœ°å€<br>å¦‚ws:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">5000</span>/echo<br></code></pre></td></tr></table></figure><h3 id="å½“åˆ›å»ºä¸€ä¸ªwsçš„æ—¶å€™ï¼Œæ¥æ”¶åˆ°äº†æ•°æ®ï¼Œä½†æ˜¯å´æƒ³è¿”å›-send-åˆ°å¦å¤–ä¸€ä¸ªwsï¼Œè¿™æ€ä¹ˆåŠå‘¢"><a href="#å½“åˆ›å»ºä¸€ä¸ªwsçš„æ—¶å€™ï¼Œæ¥æ”¶åˆ°äº†æ•°æ®ï¼Œä½†æ˜¯å´æƒ³è¿”å›-send-åˆ°å¦å¤–ä¸€ä¸ªwsï¼Œè¿™æ€ä¹ˆåŠå‘¢" class="headerlink" title="å½“åˆ›å»ºä¸€ä¸ªwsçš„æ—¶å€™ï¼Œæ¥æ”¶åˆ°äº†æ•°æ®ï¼Œä½†æ˜¯å´æƒ³è¿”å›(send)åˆ°å¦å¤–ä¸€ä¸ªwsï¼Œè¿™æ€ä¹ˆåŠå‘¢"></a>å½“åˆ›å»ºä¸€ä¸ªwsçš„æ—¶å€™ï¼Œæ¥æ”¶åˆ°äº†æ•°æ®ï¼Œä½†æ˜¯å´æƒ³è¿”å›(send)åˆ°å¦å¤–ä¸€ä¸ªwsï¼Œè¿™æ€ä¹ˆåŠå‘¢</h3><p><em>åç«¯ä»£ç </em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> threading<br><br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template<br><span class="hljs-keyword">from</span> flask_sockets <span class="hljs-keyword">import</span> Sockets<br><span class="hljs-keyword">from</span> gevent <span class="hljs-keyword">import</span> pywsgi<br><span class="hljs-keyword">from</span> geventwebsocket.handler <span class="hljs-keyword">import</span> WebSocketHandler<br><br><br><br>app = Flask(__name__)<br>sockets = Sockets(app)<br><br><span class="hljs-comment"># å¤šçº¿ç¨‹è£…é¥°å™¨ æ²¡æœ‰ç”¨åˆ° </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_async</span>(<span class="hljs-params">f</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        thr = threading.Thread(target = f, args = args, kwargs = kwargs)<br>        thr.start()<br>        thr.setName(<span class="hljs-string">&quot;func-&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(f.__name__))<br>        <span class="hljs-comment"># thr.join()</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çº¿ç¨‹id=&#123;&#125;,\nçº¿ç¨‹åç§°=&#123;&#125;,\næ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹åˆ—è¡¨:&#123;&#125;,\næ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡=&#123;&#125;,\nå½“å‰æ¿€æ´»çº¿ç¨‹=&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<br>            thr.ident,thr.getName(),threading.<span class="hljs-built_in">enumerate</span>(),threading.active_count(),thr.isAlive)<br>        )<br>    <span class="hljs-keyword">return</span> wrapper<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/test&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;test2.html&#x27;</span>)<br><br><br>WS = &#123;&#125;<br><br><span class="hljs-comment"># socket è·¯ç”±ï¼Œè®¿é—®urlæ˜¯ï¼š ws://localhost:7070/echo</span><br><span class="hljs-meta">@sockets.route(<span class="hljs-params"><span class="hljs-string">&#x27;/echo&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">echo_socket</span>(<span class="hljs-params">ws</span>):<br>    <span class="hljs-keyword">global</span> WS<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;/echo:&#x27;</span>, ws)<br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> ws.closed:<br>        <span class="hljs-keyword">try</span>:<br>            WS[<span class="hljs-string">&#x27;echo&#x27;</span>] = ws<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;WS&#x27;</span>, WS)<br>            <span class="hljs-comment"># args = ws.origin</span><br>            str_time = datetime.datetime.now().strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)<br>            <span class="hljs-comment"># msg = &#x27;pid:%s,fileno:%s,str_time:%s&#x27; % (pid, fileno, str_time)</span><br>            message = ws.receive()<br>            <span class="hljs-comment"># print(&#x27;args:&#x27;,args)</span><br>            <span class="hljs-comment"># print(&#x27;message:&#x27;, str_time, message)</span><br>            ws.send(<span class="hljs-string">&quot;time:%s,msg: %s&quot;</span>%(str_time,<span class="hljs-built_in">str</span>(message)))<br><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;error:&#x27;</span>,e)<br><br><br><span class="hljs-meta">@sockets.route(<span class="hljs-params"><span class="hljs-string">&#x27;/poll&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test2_socket</span>(<span class="hljs-params">ws</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;/poll:&#x27;</span>, ws)<br>        <span class="hljs-comment"># while True:</span><br>        n = ws.receive()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;n-----&#x27;</span>, n)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;WS-----&#x27;</span>, WS)<br><br>        WS[<span class="hljs-string">&#x27;echo&#x27;</span>].send(<span class="hljs-string">&quot;receive for poll: &quot;</span> + n)<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;error:&#x27;</span>,e)<br><br><span class="hljs-meta">@sockets.route(<span class="hljs-params"><span class="hljs-string">&#x27;/test3&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test3_socket</span>(<span class="hljs-params">ws</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;/test3:&#x27;</span>, ws)<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            time.sleep(<span class="hljs-number">3</span>)<br>            t = random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>)<br>            ws.send(<span class="hljs-string">&quot;while True number: &quot;</span> + <span class="hljs-built_in">str</span>(t))<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;error:&#x27;</span>,e)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">try</span>:<br>        server = pywsgi.WSGIServer((<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-number">7070</span>), application=app, handler_class=WebSocketHandler)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;web server start ... &quot;</span>)<br>        server.serve_forever()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;error:&#x27;</span>,e)<br></code></pre></td></tr></table></figure><p><em>å‰ç«¯ä»£ç </em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>    &lt;head&gt;<br>        &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>        &lt;title&gt;WebSocket&lt;/title&gt;<br>        &lt;script <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;//cdn.bootcss.com/jquery/3.1.1/jquery.min.js&quot;</span>&gt;&lt;/script&gt;<br>        &lt;script <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br><br>            var socket;<br><br>            function connect() &#123;<br>                var host = <span class="hljs-string">&quot;ws://&quot;</span> + $(<span class="hljs-string">&quot;#serverIP&quot;</span>).val() + <span class="hljs-string">&quot;:&quot;</span> + $(<span class="hljs-string">&quot;#serverPort&quot;</span>).val() + <span class="hljs-string">&quot;/&quot;</span> + $(<span class="hljs-string">&quot;#serverRoute&quot;</span>).val();<br>                socket = new WebSocket(host);<br>                <span class="hljs-keyword">try</span> &#123;<br><br>                    socket.onopen = function (msg) &#123;<br>                        console.log(msg);<br>                        var m = $(<span class="hljs-string">&quot;#sendText&quot;</span>).val();<br>                        socket.send(m);<br>                        // alert(<span class="hljs-string">&quot;è¿æ¥æˆåŠŸï¼&quot;</span>);<br>                    &#125;;<br><br>                    socket.onmessage = function (msg) &#123;<br>                        <span class="hljs-keyword">if</span> (typeof msg.data == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>                            $(<span class="hljs-string">&quot;#t&quot;</span>).html(msg.data)<br>                        &#125;<br>                        <span class="hljs-keyword">else</span> &#123;<br>                            alert(<span class="hljs-string">&quot;éæ–‡æœ¬æ¶ˆæ¯&quot;</span>);<br>                        &#125;<br>                    &#125;;<br><br>                    socket.onclose = function (msg) &#123;<br>                        alert(<span class="hljs-string">&quot;socket closed!&quot;</span>)<br>                    &#125;;<br>                &#125;<br>                catch (ex) &#123;<br>                    log(ex);<br>                &#125;<br>            &#125;<br><br>            function sendMsg() &#123;<br>                var msg = $(<span class="hljs-string">&quot;#sendText&quot;</span>).val();<br>                socket.send(msg);<br>            &#125;<br><br>            function butClose() &#123;<br>                socket.close();<br>                socket = null;<br>            &#125;<br><br>            window.onbeforeunload = function () &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    socket.close();<br>                    socket = null;<br>                &#125;<br>                catch (ex) &#123;<br>                &#125;<br>            &#125;;<br><br>        &lt;/script&gt;<br>    &lt;/head&gt;<br>    &lt;body&gt;<br>        &lt;h3&gt;WebSocketTest&lt;/h3&gt;<br>        &lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;login&quot;</span>&gt;<br>            &lt;div&gt;<br>                &lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;serverIP&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text&quot;</span> placeholder=<span class="hljs-string">&quot;æœåŠ¡å™¨IP&quot;</span> value=<span class="hljs-string">&quot;127.0.0.1&quot;</span> autofocus=<span class="hljs-string">&quot;autofocus&quot;</span> /&gt;<br>                &lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;serverPort&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text&quot;</span> placeholder=<span class="hljs-string">&quot;æœåŠ¡å™¨ç«¯å£&quot;</span> value=<span class="hljs-string">&quot;7070&quot;</span> /&gt;<br>                &lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;serverRoute&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text&quot;</span> placeholder=<span class="hljs-string">&quot;æœåŠ¡å™¨è·¯ç”±&quot;</span> value=<span class="hljs-string">&quot;echo&quot;</span> /&gt;<br>                &lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;btnConnect&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;button&quot;</span> onclick=<span class="hljs-string">&quot;connect()&quot;</span> value=<span class="hljs-string">&quot;è¿æ¥&quot;</span> /&gt;<br>            &lt;/div&gt;<br>            &lt;div&gt;<br>                &lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;btnClose&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;button&quot;</span> onclick=<span class="hljs-string">&quot;butClose()&quot;</span> value=<span class="hljs-string">&quot;å…³é—­è¿æ¥&quot;</span> /&gt;<br>            &lt;/div&gt;<br>            &lt;div&gt;<br>                &lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;sendText&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text&quot;</span> placeholder=<span class="hljs-string">&quot;å‘é€æ–‡æœ¬&quot;</span> value=<span class="hljs-string">&quot;24&quot;</span> /&gt;<br>                &lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;btnSend&quot;</span> onclick=<span class="hljs-string">&quot;sendMsg()&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;button&quot;</span> value=<span class="hljs-string">&quot;å‘é€&quot;</span> /&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>        &lt;h2 <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;t&quot;</span>&gt;&lt;/h2&gt;<br>    &lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python websocket socket flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python ç®€å•çš„éŸ³ä¹æ’­æ”¾å™¨(é¢å‘å¯¹è±¡æ€æƒ³å†™çš„)</title>
    <link href="/2019/03/08/python%20%E7%AE%80%E5%8D%95%E7%9A%84%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8(%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%80%9D%E6%83%B3%E5%86%99%E7%9A%84)/"/>
    <url>/2019/03/08/python%20%E7%AE%80%E5%8D%95%E7%9A%84%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8(%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%80%9D%E6%83%B3%E5%86%99%E7%9A%84)/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="éŸ³ä¹æ’­æ”¾å™¨"><a href="#éŸ³ä¹æ’­æ”¾å™¨" class="headerlink" title="éŸ³ä¹æ’­æ”¾å™¨"></a>éŸ³ä¹æ’­æ”¾å™¨</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pygame<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MusicPlayer</span>():<br>    musicList = []<br>    volume = <span class="hljs-number">0.5</span><br>    path = <span class="hljs-string">r&quot;C:\Users\Administrator\Desktop\music&quot;</span><br>    index = <span class="hljs-number">0</span><br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">getMusicPath</span>(<span class="hljs-params">cls</span>):<br>        fileList = os.listdir(cls.path)<br>        <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> fileList:<br>            absPath = os.path.join(cls.path,filename)<br>            cls.musicList.append(absPath)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.getMusicPath()<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">weclome</span>():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        **********************</span><br><span class="hljs-string">        * æ¬¢è¿æ¥åˆ°é…·æˆ‘éŸ³ä¹æ’­æ”¾å™¨*</span><br><span class="hljs-string">        **********************</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">choice</span>():<br>        time.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        ************************</span><br><span class="hljs-string">        * 1.æ’­æ”¾       2.åœæ­¢   *</span><br><span class="hljs-string">        * 3.ä¸‹ä¸€æ›²     4.ä¸Šä¸€æ›²  *</span><br><span class="hljs-string">        * 5.å¢å¤§éŸ³é‡   6.å‡å°‘éŸ³é‡ *</span><br><span class="hljs-string">        *       t é€€å‡º          *</span><br><span class="hljs-string">        *************************</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span>)<br>        num = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·é€‰æ‹©è¦æ“ä½œçš„åŠŸèƒ½ï¼š&quot;</span>)<br>        <span class="hljs-keyword">return</span> num<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">playMusic</span>(<span class="hljs-params">self</span>):<br>        pygame.mixer.init()<br>        pygame.mixer.music.load(self.musicList[self.index])<br>        pygame.mixer.music.play()<br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">stopMusic</span>(<span class="hljs-params">self</span>):<br>        pygame.mixer.music.stop()<br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">prevMusic</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.index == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å·²ç»æ˜¯ç¬¬ä¸€é¦–äº†&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">else</span>:<br>            self.index -= <span class="hljs-number">1</span><br>            self.playMusic()<br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">nextMusic</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.index == <span class="hljs-built_in">len</span>(self.musicList)-<span class="hljs-number">1</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å·²ç»æ˜¯æœ€åä¸€é¦–äº†ã€‚ã€‚ã€‚&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">else</span>:<br>            self.index += <span class="hljs-number">1</span><br>            self.playMusic()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    player = MusicPlayer()<br>    player.weclome()<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        num = player.choice()<br>        <span class="hljs-keyword">if</span> num == <span class="hljs-string">&quot;1&quot;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ’­æ”¾&quot;</span>)<br>            player.playMusic()<br>        <span class="hljs-keyword">elif</span> num == <span class="hljs-string">&quot;2&quot;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åœæ­¢&quot;</span>)<br>            player.stopMusic()<br>        <span class="hljs-keyword">elif</span> num == <span class="hljs-string">&quot;3&quot;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸‹ä¸€æ›²&quot;</span>)<br>            player.nextMusic()<br>        <span class="hljs-keyword">elif</span> num == <span class="hljs-string">&quot;4&quot;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸Šä¸€æ›²&quot;</span>)<br>            player.prevMusic()<br>        <span class="hljs-keyword">elif</span> num == <span class="hljs-string">&quot;5&quot;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¢å¤§éŸ³é‡&quot;</span>)<br><br>        <span class="hljs-keyword">elif</span> num == <span class="hljs-string">&quot;6&quot;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å‡å°‘éŸ³é‡&quot;</span>)<br><br>        <span class="hljs-keyword">elif</span> num == <span class="hljs-string">&quot;t&quot;</span>:<br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é€‰æ‹©æœ‰è¯¯ï¼Œè¯·é‡æ–°é€‰æ‹©&quot;</span>)<br>            <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python ç»ƒä¹  é¢å‘å¯¹è±¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonå°é¡¹ç›® ç”¨å‡½æ•°å†™ä¸€ä¸ªç®€å•çš„ATMç³»ç»Ÿï¼ˆæ»¡è¶³ç™»é™†æ³¨å†ŒæŸ¥è¯¢è½¬è´¦æ”¹å¯†å†»ç»“è§£é”çš„åŠŸèƒ½ï¼‰</title>
    <link href="/2019/03/02/python%E5%B0%8F%E9%A1%B9%E7%9B%AE%20%E7%94%A8%E5%87%BD%E6%95%B0%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84ATM%E7%B3%BB%E7%BB%9F%EF%BC%88%E6%BB%A1%E8%B6%B3%E7%99%BB%E9%99%86%E6%B3%A8%E5%86%8C%E6%9F%A5%E8%AF%A2%E8%BD%AC%E8%B4%A6%E6%94%B9%E5%AF%86%E5%86%BB%E7%BB%93%E8%A7%A3%E9%94%81%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%89/"/>
    <url>/2019/03/02/python%E5%B0%8F%E9%A1%B9%E7%9B%AE%20%E7%94%A8%E5%87%BD%E6%95%B0%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84ATM%E7%B3%BB%E7%BB%9F%EF%BC%88%E6%BB%A1%E8%B6%B3%E7%99%BB%E9%99%86%E6%B3%A8%E5%86%8C%E6%9F%A5%E8%AF%A2%E8%BD%AC%E8%B4%A6%E6%94%B9%E5%AF%86%E5%86%BB%E7%BB%93%E8%A7%A3%E9%94%81%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="ç®€å•çš„ATMç³»ç»Ÿ"><a href="#ç®€å•çš„ATMç³»ç»Ÿ" class="headerlink" title="ç®€å•çš„ATMç³»ç»Ÿ"></a>ç®€å•çš„ATMç³»ç»Ÿ</h1><p>ä½¿ç”¨å‡½æ•°è°ƒç”¨çš„æ–¹æ³•ï¼Œé€‚åˆåˆå­¦è€…å­¦ä¹ å‚è€ƒ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import random<br><br><span class="hljs-attribute">display</span>=<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">**********************</span><br><span class="hljs-string">*                    *</span><br><span class="hljs-string">*  welcome to bank   *</span><br><span class="hljs-string">*                    *</span><br><span class="hljs-string">**********************</span><br><span class="hljs-string">&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-attribute">display2</span>=<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">**********************</span><br><span class="hljs-string">*  1.ç™»é™†   2.å¼€æˆ·    *</span><br><span class="hljs-string">*  3.æŸ¥è¯¢   4.å–æ¬¾    *</span><br><span class="hljs-string">*  5.å­˜æ¬¾   6.é€€å‡º    *</span><br><span class="hljs-string">*  7.è½¬è´¦   8.æ”¹å¯†    *</span><br><span class="hljs-string">*  9.é”å¡   0.è§£é”   *</span><br><span class="hljs-string">**********************</span><br><span class="hljs-string">&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>def getkamun(userdict):<br>    userlist = list(userdict)<br>    kanum = userdict.keys()<br>    <span class="hljs-keyword">while</span> 1:<br>        kalist =[]<br>        <span class="hljs-keyword">while</span> len(kalist)&lt;3:<br>            i = random.randrange(10)<br>            <span class="hljs-keyword">if</span> str(i) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> kalist:<br>                kalist.append(str(i))<br>        <span class="hljs-attribute">kanum</span>=<span class="hljs-string">&quot;&quot;</span>.join(kalist)<br>        <span class="hljs-keyword">if</span> kanum <span class="hljs-keyword">in</span> userlist:<br>            continue<br>        <span class="hljs-keyword">else</span>:<br>            break<br>    return kanum<br><br>def register(userdict):<br>    idcard =input(<span class="hljs-string">&quot;èº«ä»½è¯å·ï¼š&quot;</span>)<br>    name = input(<span class="hljs-string">&quot;ç”¨æˆ·åï¼š&quot;</span>)<br>    phone =input(<span class="hljs-string">&quot;ç”µè¯å·ç ï¼š&quot;</span>)<br>    <span class="hljs-attribute">money</span>=int(input(&quot;é¢„å­˜æ¬¾ï¼š&quot;))<br>    <span class="hljs-keyword">while</span> 1:<br>        psd1 =input(<span class="hljs-string">&quot;å¯†ç ï¼š&quot;</span>)<br>        psd2 =input(<span class="hljs-string">&quot;ç¡®è®¤å¯†ç ï¼š&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-attribute">psd1</span>==psd2:<br>            <span class="hljs-attribute">psd</span>=psd2<br>            break<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¯†ç ä¸ä¸€è‡´ï¼Œé‡æ–°è¾“å…¥&quot;</span>)<br>    <span class="hljs-attribute">kanum</span>=getkamun(userdict)<br>   <span class="hljs-built_in"> user </span>=&#123;<span class="hljs-string">&#x27;idcard&#x27;</span>:idcard,<span class="hljs-string">&#x27;name&#x27;</span>:name,<span class="hljs-string">&#x27;phone&#x27;</span>:phone,<span class="hljs-string">&#x27;money&#x27;</span>:money,<span class="hljs-string">&#x27;psd&#x27;</span>:psd,<span class="hljs-string">&#x27;kanum&#x27;</span>:kanum,<span class="hljs-string">&#x27;suo&#x27;</span>:False&#125;<br>    return<span class="hljs-built_in"> user</span><br><span class="hljs-built_in"></span><br>def login(userdict):<br>    usernum = input(<span class="hljs-string">&quot;è¯·è¾“å…¥å¡å·ï¼š&quot;</span>)<br>   <span class="hljs-built_in"> user </span>=userdict.<span class="hljs-built_in">get</span>(usernum)<br>    <span class="hljs-keyword">if</span> <span class="hljs-attribute">user</span>==None:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¡å·ä¸å­˜åœ¨&quot;</span>)<br>        return<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> user[<span class="hljs-string">&#x27;suo&#x27;</span>]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å·²é”å®šï¼Œè¯·è§£é”åç™»é™†&quot;</span>)<br>            return<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(4):<br>            psd = input(<span class="hljs-string">&quot;è¯·è¾“å…¥å¯†ç ï¼š&quot;</span>)<br>            <span class="hljs-keyword">if</span> usernum ==user.<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;kanum&#x27;</span>) <span class="hljs-keyword">and</span> psd ==user.<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;psd&#x27;</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç™»é™†æˆåŠŸ&quot;</span>)<br>                return user.<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;kanum&#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç™»é™†å¤±è´¥,è¿˜æœ‰%dæ¬¡æœºä¼š&quot;</span>%i)<br>                continue<br>        <span class="hljs-keyword">else</span>:<br>            user[<span class="hljs-string">&#x27;suo&#x27;</span>]=<span class="hljs-literal">True</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç™»é™†æ¬¡æ•°è¶…è¿‡ä¸‰æ¬¡,å·²é”å®š&quot;</span>)<br><br>def refer(kanum):<br>   <span class="hljs-built_in"> user </span>= userdict.<span class="hljs-built_in">get</span>(kanum)<br>    money = user[<span class="hljs-string">&#x27;money&#x27;</span>]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å½“å‰ä½™é¢ä¸º%d&quot;</span>%money)<br>    return None<br><br>def fund(kanum):<br>   <span class="hljs-built_in"> user </span>= userdict.<span class="hljs-built_in">get</span>(kanum)<br>    <span class="hljs-attribute">money</span>=user[<span class="hljs-string">&#x27;money&#x27;</span>]<br>    money += eval(input(<span class="hljs-string">&quot;è¾“å…¥é‡‘é¢&quot;</span>))<br>    user[<span class="hljs-string">&#x27;money&#x27;</span>]=money<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æˆåŠŸï¼å½“å‰ä½™é¢ä¸º%d&quot;</span> % money)<br>    return None<br><br>def draw(kanum):<br>   <span class="hljs-built_in"> user </span>= userdict.<span class="hljs-built_in">get</span>(kanum)<br>    <span class="hljs-attribute">money</span>=user[<span class="hljs-string">&#x27;money&#x27;</span>]<br>    <span class="hljs-keyword">while</span> 1:<br>        money -= eval(input(<span class="hljs-string">&quot;è¾“å…¥é‡‘é¢&quot;</span>))<br>        <span class="hljs-keyword">if</span> money&gt;=0:<br>            user[<span class="hljs-string">&#x27;money&#x27;</span>]=money<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æˆåŠŸï¼å½“å‰ä½™é¢ä¸º%d&quot;</span>%money)<br>            break<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¾“å…¥å¤§äºä½™é¢ï¼Œé‡æ–°è¾“å…¥&quot;</span>)<br>            break<br>    return None<br><br>def tran(kanum,userdict):<br>   <span class="hljs-built_in"> user </span>= userdict[kanum]<br>    <span class="hljs-built_in">print</span>(user)<br>    obj = input(<span class="hljs-string">&quot;è¯·è¾“å…¥å¡å·ï¼š&quot;</span>)<br>    <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> userdict:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¡å·ä¸å­˜åœ¨&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        money2 = int(input(<span class="hljs-string">&quot;è¯·è¾“å…¥è½¬è´¦é‡‘é¢ï¼š&quot;</span>))<br>        <span class="hljs-keyword">if</span> money2&lt;user[<span class="hljs-string">&#x27;money&#x27;</span>]:<br>            user[<span class="hljs-string">&#x27;money&#x27;</span>] -= money2<br>            userdict.<span class="hljs-built_in">get</span>(obj)[<span class="hljs-string">&#x27;money&#x27;</span>] +=money2<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è½¬è´¦æˆåŠŸï¼Œä½™é¢ä¸º%d&quot;</span>%user[<span class="hljs-string">&#x27;money&#x27;</span>])<br>            return<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä½™é¢ä¸è¶³&quot;</span>)<br><br>def changepsd(kanum,userdict):<br>   <span class="hljs-built_in"> user </span>= userdict[kanum]<br>    oldpsd = input(<span class="hljs-string">&quot;è¯·è¾“å…¥å½“å‰å¯†ç ï¼š&quot;</span>)<br>    <span class="hljs-keyword">if</span> oldpsd == user[<span class="hljs-string">&#x27;psd&#x27;</span>]:<br>        newpsd = input(<span class="hljs-string">&quot;è¯·è¾“å…¥æ–°å¯†ç ï¼š&quot;</span>)<br>        user[<span class="hljs-string">&#x27;psd&#x27;</span>] = newpsd<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¯†ç é”™è¯¯&quot;</span>)<br><br>def lock(kanum,userdict):<br>    kanum = input(<span class="hljs-string">&quot;è¯·è¾“å…¥æ‚¨çš„å¡å·ï¼š&quot;</span>)<br>    <span class="hljs-keyword">if</span> kanum <span class="hljs-keyword">in</span> userdict:<br>        idcard = input(<span class="hljs-string">&quot;è¯·è¾“å…¥èº«ä»½è¯å·ç ï¼š&quot;</span>)<br>        name = input(<span class="hljs-string">&quot;è¯·è¾“å…¥å§“åï¼š&quot;</span>)<br>        phone = input(<span class="hljs-string">&quot;è¯·è¾“å…¥ç”µè¯ï¼š&quot;</span>)<br>       <span class="hljs-built_in"> user </span>= userdict[kanum]<br>        <span class="hljs-keyword">if</span> <span class="hljs-attribute">idcard</span>==user[<span class="hljs-string">&#x27;idcard&#x27;</span>] <span class="hljs-keyword">and</span> <span class="hljs-attribute">name</span>==user[<span class="hljs-string">&#x27;name&#x27;</span>] <span class="hljs-keyword">and</span> <span class="hljs-attribute">phone</span>==user[<span class="hljs-string">&#x27;phone&#x27;</span>]:<br>            user[<span class="hljs-string">&#x27;suo&#x27;</span>]=<span class="hljs-literal">True</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é”å®šæˆåŠŸ&quot;</span>)<br>            return<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¿¡æ¯æœ‰è¯¯&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¡å·ä¸å­˜åœ¨&quot;</span>)<br>        return<br><br>def unlock(userdict):<br>    kanum = input(<span class="hljs-string">&quot;è¯·è¾“å…¥å¡å·ï¼š&quot;</span>)<br>    <span class="hljs-keyword">if</span> kanum <span class="hljs-keyword">in</span> userdict:<br>        idcard = input(<span class="hljs-string">&quot;è¯·è¾“å…¥èº«ä»½è¯ï¼š&quot;</span>)<br>        name = input(<span class="hljs-string">&quot;è¯·è¾“å…¥å§“åï¼š&quot;</span>)<br>        phone = input(<span class="hljs-string">&quot;è¯·è¾“å…¥ç”µè¯ï¼š&quot;</span>)<br>       <span class="hljs-built_in"> user </span>= userdict[kanum]<br>        <span class="hljs-keyword">if</span> <span class="hljs-attribute">idcard</span>==user[<span class="hljs-string">&#x27;idcard&#x27;</span>] <span class="hljs-keyword">and</span> <span class="hljs-attribute">name</span>==user[<span class="hljs-string">&#x27;name&#x27;</span>] <span class="hljs-keyword">and</span> <span class="hljs-attribute">phone</span>==user[<span class="hljs-string">&#x27;phone&#x27;</span>]:<br>            user[<span class="hljs-string">&#x27;suo&#x27;</span>]=<span class="hljs-literal">False</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è§£é”æˆåŠŸ&quot;</span>)<br>            return<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¿¡æ¯æœ‰è¯¯&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¡å·ä¸å­˜åœ¨&quot;</span>)<br>        return<br><br>def welcome():<br>    <span class="hljs-built_in">print</span>(display)<br><br>welcome()<br>userdict=&#123;&#125;<br>login_state = None<br>money =0<br>n = 0<br><span class="hljs-keyword">while</span> 1:<br>    <span class="hljs-built_in">print</span>(display2)<br>    n =input(<span class="hljs-string">&quot;ç”¨æˆ·é€‰æ‹©è¦æ“ä½œï¼š&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-attribute">n</span>==&#x27;1&#x27;:<br>        login_state = login(userdict)<br>        <span class="hljs-built_in">print</span>(userdict)<br>    elif <span class="hljs-attribute">n</span>==&#x27;2&#x27;:<br>        <span class="hljs-attribute">user</span>=register(userdict)<br>        <span class="hljs-attribute">kanum</span>=user.get(&#x27;kanum&#x27;)<br>        userdict[kanum]=user<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å¡å·ä¸ºï¼š%s&#x27;</span>%kanum)<br>    elif <span class="hljs-attribute">n</span>==&#x27;3&#x27;:<br>        <span class="hljs-built_in">print</span>(userdict)<br>        <span class="hljs-keyword">if</span> login_state:<br>            refer(login_state)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·å…ˆç™»é™†&quot;</span>)<br>    elif <span class="hljs-attribute">n</span>==&#x27;4&#x27;:<br>        <span class="hljs-keyword">if</span> login_state:<br>            draw(login_state)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·å…ˆç™»é™†&quot;</span>)<br>    elif <span class="hljs-attribute">n</span>==&#x27;5&#x27;:<br>        <span class="hljs-keyword">if</span> login_state:<br>            fund(login_state)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·å…ˆç™»é™†&quot;</span>)<br>    elif <span class="hljs-attribute">n</span>==&#x27;6&#x27;:<br>        login_state = None<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;é€€å‡ºç™»é™†&#x27;</span>)<br>    elif <span class="hljs-attribute">n</span>==&#x27;7&#x27;:<br>        <span class="hljs-keyword">if</span> login_state:<br>            tran(login_state, userdict)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·å…ˆç™»é™†&quot;</span>)<br>    elif <span class="hljs-attribute">n</span>==&#x27;8&#x27;:<br>        <span class="hljs-keyword">if</span> login_state:<br>            changepsd(login_state, userdict)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·å…ˆç™»é™†&quot;</span>)<br>    elif <span class="hljs-attribute">n</span>==&#x27;9&#x27;:<br>        <span class="hljs-attribute">n</span>=lock(login_state, userdict)<br>    elif <span class="hljs-attribute">n</span>==&#x27;0&#x27;:<br>        unlock(userdict)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¾“å…¥æœ‰è¯¯ï¼Œé€€å‡ºç³»ç»Ÿ&quot;</span>)<br>        break<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pythonå‡½æ•° pythonåŸºç¡€ pythonå°ç»ƒä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç”¨python è·å–å½“å‰æ—¶é—´(å¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’)ï¼Œå¹¶ä¸”è¿”å›å½“å‰æ—¶é—´çš„ä¸‹ä¸€ç§’</title>
    <link href="/2019/03/02/%E7%94%A8python%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4(%E5%B9%B4-%E6%9C%88-%E6%97%A5%20%E6%97%B6!%E5%88%86!%E7%A7%92)%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%BF%94%E5%9B%9E%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%E7%9A%84%E4%B8%8B%E4%B8%80%E7%A7%92/"/>
    <url>/2019/03/02/%E7%94%A8python%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4(%E5%B9%B4-%E6%9C%88-%E6%97%A5%20%E6%97%B6!%E5%88%86!%E7%A7%92)%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%BF%94%E5%9B%9E%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%E7%9A%84%E4%B8%8B%E4%B8%80%E7%A7%92/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="è·å–å½“å‰æ—¶é—´ï¼Œå¹¶ä¸”è¿”å›å½“å‰æ—¶é—´çš„ä¸‹ä¸€ç§’"><a href="#è·å–å½“å‰æ—¶é—´ï¼Œå¹¶ä¸”è¿”å›å½“å‰æ—¶é—´çš„ä¸‹ä¸€ç§’" class="headerlink" title="è·å–å½“å‰æ—¶é—´ï¼Œå¹¶ä¸”è¿”å›å½“å‰æ—¶é—´çš„ä¸‹ä¸€ç§’"></a>è·å–å½“å‰æ—¶é—´ï¼Œå¹¶ä¸”è¿”å›å½“å‰æ—¶é—´çš„ä¸‹ä¸€ç§’</h1><p>å› ä¸ºå­˜åœ¨å¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’<br>è€ƒè™‘åˆ°ç”¨splitçš„æ–¹æ³•åšçš„è¯éå¸¸éº»çƒ¦<br>æ‰€ä»¥å¼•å…¥timeå’Œdatetimeæ¨¡å—<br>å½“ç„¶ ä¹Ÿå¯ä»¥æ”¹å†™æˆè¾“å…¥ä¸€ä¸ªæ—¶é—´</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datetime,time<br><span class="hljs-comment"># è·å–å½“å‰æ—¶é—´</span><br>now_time = datetime.datetime.now()<br><span class="hljs-comment"># æ ¼å¼åŒ–æ—¶é—´å­—ç¬¦ä¸²</span><br>str_time = now_time.strftime(<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)<br>tup_time = time.strptime(str_time,<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)<br>time_sec = time.mktime(tup_time)<br><span class="hljs-comment"># è½¬æ¢æˆæ—¶é—´æˆ³ è¿›è¡Œè®¡ç®—</span><br>time_sec += <span class="hljs-number">1</span><br>tup_time2 = time.localtime(time_sec)<br>str_time2 = time.strftime(<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>,tup_time2)<br><span class="hljs-built_in">print</span>(str_time)<br><span class="hljs-built_in">print</span>(str_time2)<br></code></pre></td></tr></table></figure><h3 id="å…³äºæ ¼å¼é—®é¢˜"><a href="#å…³äºæ ¼å¼é—®é¢˜" class="headerlink" title="å…³äºæ ¼å¼é—®é¢˜"></a>å…³äºæ ¼å¼é—®é¢˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python">%a æ˜ŸæœŸçš„ç®€å†™ã€‚å¦‚ æ˜ŸæœŸä¸‰ä¸ºWeb<br>%A æ˜ŸæœŸçš„å…¨å†™ã€‚å¦‚ æ˜ŸæœŸä¸‰ä¸ºWednesday<br>%b æœˆä»½çš„ç®€å†™ã€‚å¦‚<span class="hljs-number">4</span>æœˆä»½ä¸ºApr<br>%B æœˆä»½çš„å…¨å†™ã€‚å¦‚<span class="hljs-number">4</span>æœˆä»½ä¸ºApril<br>%c:  æ—¥æœŸæ—¶é—´çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ï¼ˆå¦‚ï¼š 04/07/<span class="hljs-number">10</span> <span class="hljs-number">10</span>:<span class="hljs-number">43</span>:<span class="hljs-number">39</span>ï¼‰<br>%d:  æ—¥åœ¨è¿™ä¸ªæœˆä¸­çš„å¤©æ•°ï¼ˆæ˜¯è¿™ä¸ªæœˆçš„ç¬¬å‡ å¤©ï¼‰<br>%f:  å¾®ç§’ï¼ˆèŒƒå›´[<span class="hljs-number">0</span>,<span class="hljs-number">999999</span>]ï¼‰<br>%H:  å°æ—¶ï¼ˆ<span class="hljs-number">24</span>å°æ—¶åˆ¶ï¼Œ[<span class="hljs-number">0</span>, <span class="hljs-number">23</span>]ï¼‰<br>%I:  å°æ—¶ï¼ˆ<span class="hljs-number">12</span>å°æ—¶åˆ¶ï¼Œ[<span class="hljs-number">0</span>, <span class="hljs-number">11</span>]ï¼‰<br>%j:  æ—¥åœ¨å¹´ä¸­çš„å¤©æ•° [001,<span class="hljs-number">366</span>]ï¼ˆæ˜¯å½“å¹´çš„ç¬¬å‡ å¤©ï¼‰<br>%m:  æœˆä»½ï¼ˆ[01,<span class="hljs-number">12</span>]ï¼‰<br>%M:  åˆ†é’Ÿï¼ˆ[<span class="hljs-number">00</span>,<span class="hljs-number">59</span>]ï¼‰<br>%p:  AMæˆ–è€…PM<br>%S:  ç§’<br>%U:  å‘¨åœ¨å½“å¹´çš„å‘¨æ•°å½“å¹´çš„ç¬¬å‡ å‘¨ï¼‰ï¼Œæ˜ŸæœŸå¤©ä½œä¸ºå‘¨çš„ç¬¬ä¸€å¤©<br>%w:  ä»Šå¤©åœ¨è¿™å‘¨çš„å¤©æ•°ï¼ŒèŒƒå›´ä¸º[<span class="hljs-number">0</span>, <span class="hljs-number">6</span>]ï¼Œ<span class="hljs-number">6</span>è¡¨ç¤ºæ˜ŸæœŸå¤©<br>%W:  å‘¨åœ¨å½“å¹´çš„å‘¨æ•°ï¼ˆæ˜¯å½“å¹´çš„ç¬¬å‡ å‘¨ï¼‰ï¼Œæ˜ŸæœŸä¸€ä½œä¸ºå‘¨çš„ç¬¬ä¸€å¤©<br>%x:  æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆå¦‚ï¼š04/07/<span class="hljs-number">10</span>ï¼‰<br>%X:  æ—¶é—´å­—ç¬¦ä¸²ï¼ˆå¦‚ï¼š<span class="hljs-number">10</span>:<span class="hljs-number">43</span>:<span class="hljs-number">39</span>ï¼‰<br>%y:  <span class="hljs-number">2</span>ä¸ªæ•°å­—è¡¨ç¤ºçš„å¹´ä»½<br>%Y:  <span class="hljs-number">4</span>ä¸ªæ•°å­—è¡¨ç¤ºçš„å¹´ä»½<br>%z:  ä¸utcæ—¶é—´çš„é—´éš” ï¼ˆå¦‚æœæ˜¯æœ¬åœ°æ—¶é—´ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ï¼‰<br>%Z:  æ—¶åŒºåç§°ï¼ˆå¦‚æœæ˜¯æœ¬åœ°æ—¶é—´ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ï¼‰<br>%%:  %% =&gt; %<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pythonåŸºç¡€ datetimeæ¨¡å—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å€’è¿‡æ¥çš„ä¹ä¹ä¹˜æ³•è¡¨ä»¥åŠç™¾é’±ä¹°ç™¾é¸¡çš„é—®é¢˜</title>
    <link href="/2019/02/21/%E5%80%92%E8%BF%87%E6%9D%A5%E7%9A%84%E4%B9%9D%E4%B9%9D%E4%B9%98%E6%B3%95%E8%A1%A8%E4%BB%A5%E5%8F%8A%E7%99%BE%E9%92%B1%E4%B9%B0%E7%99%BE%E9%B8%A1%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2019/02/21/%E5%80%92%E8%BF%87%E6%9D%A5%E7%9A%84%E4%B9%9D%E4%B9%9D%E4%B9%98%E6%B3%95%E8%A1%A8%E4%BB%A5%E5%8F%8A%E7%99%BE%E9%92%B1%E4%B9%B0%E7%99%BE%E9%B8%A1%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="ä½¿ç”¨forå¾ªç¯æ‰“å°ä¹ä¹ä¹˜æ³•è¡¨ï¼Œå€’è¿‡æ¥"><a href="#ä½¿ç”¨forå¾ªç¯æ‰“å°ä¹ä¹ä¹˜æ³•è¡¨ï¼Œå€’è¿‡æ¥" class="headerlink" title="ä½¿ç”¨forå¾ªç¯æ‰“å°ä¹ä¹ä¹˜æ³•è¡¨ï¼Œå€’è¿‡æ¥"></a>ä½¿ç”¨forå¾ªç¯æ‰“å°ä¹ä¹ä¹˜æ³•è¡¨ï¼Œå€’è¿‡æ¥</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(9,0,-1):</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(i,0,-1):</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;%dx%d=%d&quot;</span>%(j,i,j*i),end=<span class="hljs-string">&quot;\t&quot;</span>)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>,end=<span class="hljs-string">&quot;\t&quot;</span>*(10-i)*2)</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20190221204227338.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQ3NDU0MA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="5-ç™¾é’±ä¹°ç™¾é¸¡ï¼Œç°æœ‰100æ–‡é’±ï¼Œå…¬é¸¡5æ–‡é’±ä¸€åªï¼Œæ¯é¸¡3æ–‡é’±ä¸€åªï¼Œå°é¸¡ä¸€æ–‡é’±3åªï¼Œ"><a href="#5-ç™¾é’±ä¹°ç™¾é¸¡ï¼Œç°æœ‰100æ–‡é’±ï¼Œå…¬é¸¡5æ–‡é’±ä¸€åªï¼Œæ¯é¸¡3æ–‡é’±ä¸€åªï¼Œå°é¸¡ä¸€æ–‡é’±3åªï¼Œ" class="headerlink" title="5.ç™¾é’±ä¹°ç™¾é¸¡ï¼Œç°æœ‰100æ–‡é’±ï¼Œå…¬é¸¡5æ–‡é’±ä¸€åªï¼Œæ¯é¸¡3æ–‡é’±ä¸€åªï¼Œå°é¸¡ä¸€æ–‡é’±3åªï¼Œ"></a>5.ç™¾é’±ä¹°ç™¾é¸¡ï¼Œç°æœ‰100æ–‡é’±ï¼Œå…¬é¸¡5æ–‡é’±ä¸€åªï¼Œæ¯é¸¡3æ–‡é’±ä¸€åªï¼Œå°é¸¡ä¸€æ–‡é’±3åªï¼Œ</h1><h1 id="è¦æ±‚ï¼šå…¬é¸¡ï¼Œæ¯é¸¡ï¼Œå°é¸¡éƒ½è¦æœ‰ï¼ŒæŠŠ100æ–‡é’±ä¹°100åªé¸¡ï¼Œä¹°çš„é¸¡æ˜¯æ•´æ•°ã€‚"><a href="#è¦æ±‚ï¼šå…¬é¸¡ï¼Œæ¯é¸¡ï¼Œå°é¸¡éƒ½è¦æœ‰ï¼ŒæŠŠ100æ–‡é’±ä¹°100åªé¸¡ï¼Œä¹°çš„é¸¡æ˜¯æ•´æ•°ã€‚" class="headerlink" title="è¦æ±‚ï¼šå…¬é¸¡ï¼Œæ¯é¸¡ï¼Œå°é¸¡éƒ½è¦æœ‰ï¼ŒæŠŠ100æ–‡é’±ä¹°100åªé¸¡ï¼Œä¹°çš„é¸¡æ˜¯æ•´æ•°ã€‚"></a>è¦æ±‚ï¼šå…¬é¸¡ï¼Œæ¯é¸¡ï¼Œå°é¸¡éƒ½è¦æœ‰ï¼ŒæŠŠ100æ–‡é’±ä¹°100åªé¸¡ï¼Œä¹°çš„é¸¡æ˜¯æ•´æ•°ã€‚</h1><h1 id="å¯ä»¥ä¹°å¤šå°‘åªå…¬é¸¡å¤šå°‘åªæ¯é¸¡å¤šå°‘åªå°é¸¡ï¼Ÿ"><a href="#å¯ä»¥ä¹°å¤šå°‘åªå…¬é¸¡å¤šå°‘åªæ¯é¸¡å¤šå°‘åªå°é¸¡ï¼Ÿ" class="headerlink" title="å¯ä»¥ä¹°å¤šå°‘åªå…¬é¸¡å¤šå°‘åªæ¯é¸¡å¤šå°‘åªå°é¸¡ï¼Ÿ"></a>å¯ä»¥ä¹°å¤šå°‘åªå…¬é¸¡å¤šå°‘åªæ¯é¸¡å¤šå°‘åªå°é¸¡ï¼Ÿ</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">for</span> g <span class="hljs-keyword">in</span> range(1,21):</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> range(1,34):</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">        x = 100 - g - m</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">        <span class="hljs-keyword">if</span> g*5 + m*3 + x/3 == 100:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å…¬é¸¡%dåªï¼Œæ¯é¸¡%dåªï¼Œå°é¸¡%dåª&quot;</span>%(g,m,x))</span><br></code></pre></td></tr></table></figure><h1 id="æŠ¼å®æ¸¸æˆ"><a href="#æŠ¼å®æ¸¸æˆ" class="headerlink" title="æŠ¼å®æ¸¸æˆ"></a>æŠ¼å®æ¸¸æˆ</h1><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">import</span> <span class="hljs-built_in">random</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¸¸æˆå¼€å§‹&quot;</span>)<br>money = <span class="hljs-built_in">int</span>(<span class="hljs-title function_">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥é‡‘é¢ï¼š&quot;</span>))<br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span> :<br>    money = money - <span class="hljs-number">5</span><br>    jiang = <span class="hljs-built_in">random</span>.<span class="hljs-property">choice</span>([<span class="hljs-string">&#x27;ä¸­å¥–&#x27;</span>,<span class="hljs-string">&#x27;æœªä¸­å¥–&#x27;</span>])<br>    <span class="hljs-built_in">print</span>(jiang)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä½™é¢ä¸º%d&quot;</span> % money)<br>    <span class="hljs-keyword">if</span> money&lt;=<span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¸¸æˆç»“æŸ&quot;</span>)<br>        <span class="hljs-keyword">break</span><br>    s = <span class="hljs-title function_">input</span>(<span class="hljs-string">&quot;æ˜¯å¦ç»§ç»­ï¼Ÿæ˜¯/å¦&quot;</span>)<br>    <span class="hljs-keyword">if</span> s == <span class="hljs-string">&quot;å¦&quot;</span>:<br>        <span class="hljs-built_in">print</span>(money)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pythonå¸¸è§åŸºç¡€å°ç»ƒä¹ </title>
    <link href="/2019/02/20/python%E5%B8%B8%E8%A7%81%E5%9F%BA%E7%A1%80%E5%B0%8F%E7%BB%83%E4%B9%A0/"/>
    <url>/2019/02/20/python%E5%B8%B8%E8%A7%81%E5%9F%BA%E7%A1%80%E5%B0%8F%E7%BB%83%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="pythonå¸¸è§åŸºç¡€å°ç»ƒä¹ ï¼ˆæ–°æ‰‹å­¦ä¹ ï¼Œæœ‰é”™è¯·è°…è§£ï¼‰"><a href="#pythonå¸¸è§åŸºç¡€å°ç»ƒä¹ ï¼ˆæ–°æ‰‹å­¦ä¹ ï¼Œæœ‰é”™è¯·è°…è§£ï¼‰" class="headerlink" title="pythonå¸¸è§åŸºç¡€å°ç»ƒä¹ ï¼ˆæ–°æ‰‹å­¦ä¹ ï¼Œæœ‰é”™è¯·è°…è§£ï¼‰"></a>pythonå¸¸è§åŸºç¡€å°ç»ƒä¹ ï¼ˆæ–°æ‰‹å­¦ä¹ ï¼Œæœ‰é”™è¯·è°…è§£ï¼‰</h2><p>1.è¾“å…¥ä¸€ä¸ªå¹´ä»½ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºé—°å¹´ã€‚</p><p>æ¡ä»¶1ï¼šä¸èƒ½è¢«100æ•´é™¤ä¸”èƒ½è¢«4æ•´é™¤</p><p>æ¡ä»¶2ï¼šè¢«400æ•´é™¤ã€ä¸–çºªå¹´ã€‘</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs perl">year = <span class="hljs-keyword">int</span>(input(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªå¹´ä»½:&quot;</span>))<br><span class="hljs-keyword">if</span> year %4 == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> year %100 != <span class="hljs-number">0</span>:<br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;%då¹´æ˜¯é—°å¹´&quot;</span>%year)<br>elif year %400 == <span class="hljs-number">0</span>:<br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;%då¹´æ˜¯é—°å¹´&quot;</span> % year)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;%då¹´ä¸æ˜¯é—°å¹´&quot;</span>%year)<br></code></pre></td></tr></table></figure><p>2.è¾“å…¥ä¸€ä½ä¸‰ä½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºæ°´ä»™èŠ±æ•°153<br>153 &#x3D; 13+53+3^3</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">num</span> = <span class="hljs-built_in">int</span>(input(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªä¸‰ä½æ•°:\n&quot;</span>))<br>bai = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">num</span>/<span class="hljs-number">100</span>)<br>shi = <span class="hljs-built_in">int</span>((<span class="hljs-built_in">num</span>-bai*<span class="hljs-number">100</span>)/<span class="hljs-number">10</span>)<br>ge = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">num</span> - bai*<span class="hljs-number">100</span> - shi*<span class="hljs-number">10</span>)<br><span class="hljs-built_in">print</span>(bai,shi,ge)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">num</span> == pow(bai,<span class="hljs-number">3</span>) + pow(shi,<span class="hljs-number">3</span>) +pow(ge,<span class="hljs-number">3</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;%dæ˜¯ä¸€ä¸ªæ°´ä»™èŠ±æ•°&quot;</span>%<span class="hljs-built_in">num</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;%dä¸æ˜¯ä¸€ä¸ªæ°´ä»™èŠ±æ•°&quot;</span>%<span class="hljs-built_in">num</span>)<br></code></pre></td></tr></table></figure><p>4.æ‘‡è‰²å­ï¼Œ</p><p>æç¤º:æŠ¼å¤§è¿˜æŠ¼å° ï¼š å¤§ æˆ–è€… å°</p><p>å¼€å§‹æ‘‡è‰²å­ï¼Œ</p><p>ã€1~6ã€‘å–å€¼ã€1ï¼Œ 2ï¼Œ 3ã€‘ å°</p><p>å–å€¼ã€4ï¼Œ 5ï¼Œ 6ã€‘å¤§</p><p>è‹¥æŠ¼ä¸­ï¼Œåˆ™æ‰“å°â€œâ€åº„å®¶å–é…’ã€‚ã€‚ã€‚ã€‚â€œ</p><p>è‹¥æ²¡æŠ¼ä¸­ï¼Œåˆ™æ‰“å°â€å…ˆå¹²ä¸ºæ•¬ã€‚ã€‚ã€‚â€œ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import random<br>guess = <span class="hljs-selector-tag">input</span>(<span class="hljs-string">&quot;è¯·æŠ¼æ³¨ï¼šå¤§orå° \n&quot;</span>)<br>num = random<span class="hljs-selector-class">.choice</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>))<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(num)</span></span><br><span class="hljs-keyword">if</span> num &lt;=<span class="hljs-number">3</span>:<br>    guess1 = <span class="hljs-string">&#x27;å°&#x27;</span><br><span class="hljs-keyword">else</span>:<br>    guess1 =<span class="hljs-string">&#x27;å¤§&#x27;</span><br><span class="hljs-keyword">if</span> guess1 == guess:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åº„å®¶å–é…’ï¼&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å…ˆå¹²ä¸ºæ•¬ï¼&quot;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ–°æ‰‹å­¦ä¹ pythonåŸºç¡€ï¼šå¸¸ç”¨æ•°å­¦å‡½æ•°</title>
    <link href="/2019/02/20/%E6%96%B0%E6%89%8B%E5%AD%A6%E4%B9%A0python%E5%9F%BA%E7%A1%80%EF%BC%9A%E5%B8%B8%E7%94%A8%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0/"/>
    <url>/2019/02/20/%E6%96%B0%E6%89%8B%E5%AD%A6%E4%B9%A0python%E5%9F%BA%E7%A1%80%EF%BC%9A%E5%B8%B8%E7%94%A8%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><p>æ–°æ‰‹å­¦ä¹ pythonåŸºç¡€ï¼šå¸¸ç”¨æ•°å­¦å‡½æ•°</p><p>import math,random<br>print()<br>â€˜â€™â€™<br>1.æ•°å­—ç±»å‹ä¹‹é—´çš„è½¬æ¢ int() float() str()<br>2.å¸¸ç”¨çš„æ•°å­¦å‡½æ•°<br>abs() è¿”å›ç»å¯¹å€¼<br>max() è¿”å›æœ€å¤§å€¼<br>min() è¿”å›æœ€å°å€¼<br>pow(x,y) æ±‚xçš„yæ¬¡æ–¹çš„å€¼<br>round(x,[n]) è¿”å›æµ®ç‚¹æ•°çš„å››èˆäº”å…¥å€¼ï¼Œnä»£è¡¨å°æ•°ç‚¹åçš„ä½æ•°ï¼Œpython3ä¸­å‘å¶æ•°é æ‹¢</p><p>â€˜â€™â€™</p><p>â€˜â€™â€™<br>å¯¼å…¥mathæ¨¡å— import math</p><p>math.ceil(x):è¿”å›xçš„å‘ä¸Šå–æ•´æ•°å€¼</p><p>math.floor(x):è¿”å›xçš„å‘ä¸‹å–æ•´çš„æ•°å€¼</p><p>math.modf(x):è¿”å›xçš„æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†ï¼Œä¸¤éƒ¨åˆ†çš„æ•°å€¼ç¬¦å·ä¸xç›¸åŒï¼Œæ•´æ•°éƒ¨åˆ†ä»¥æµ®ç‚¹æ•°è¡¨ç¤ºã€‚</p><p>math.sqrt(x):åå›æ•°å­—çš„xçš„å¼€å¹³æ–¹æ ¹ï¼Œè¿”å›ç±»å‹ä¸ºæ­£æ•°ã€æµ®ç‚¹å‹ã€‘<br>â€˜â€™â€™</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs lisp"># print(<span class="hljs-name">round</span>(<span class="hljs-number">2.555</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">2.5</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">3.555</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">3.5</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">2.555555</span>, <span class="hljs-number">5</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">3.555555</span>, <span class="hljs-number">5</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">2.55574</span>, <span class="hljs-number">4</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">3.55555</span>, <span class="hljs-number">4</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">2.5555</span>, <span class="hljs-number">3</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">3.5555</span>, <span class="hljs-number">3</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">2.555</span>, <span class="hljs-number">2</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">3.555</span>, <span class="hljs-number">2</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">2.55</span>, <span class="hljs-number">1</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">3.55</span>, <span class="hljs-number">1</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">2.5</span>))<br># print(<span class="hljs-name">round</span>(<span class="hljs-number">3.5</span>))<br></code></pre></td></tr></table></figure><p>â€˜â€™â€™<br>å¯¼å…¥randomæ¨¡å—</p><p>random.choice([1,2,3,4]) ï¼šéšæœºè¿”å›ä¸€ä¸ªå…ƒç´ ã€ä»æŒ‡å®šåºåˆ—ä¸­æŒ‘é€‰ä¸€ä¸ªå…ƒç´ ã€‘</p><p>random.randrange(n):ä»0~n-1ä¹‹é—´é€‰æ‹©ä¸€ä¸ªéšæœºæ•°</p><p>random.random() :éšæœºäº§ç”Ÿ[0,1)ä¹‹é—´çš„æ•°ï¼Œç»“æœä¸ºæµ®ç‚¹æ•°</p><p>l1 &#x3D; [1, 2, 4, 5]</p><p>random.shuffle(l1) :å°†åºåˆ—ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œéšæœºæ’åˆ—</p><p>random.uniform(m, n) :éšæœºäº§ç”Ÿä¸€ä¸ª[m, n]ä¹‹é—´çš„æµ®ç‚¹æ•°<br>â€˜â€™â€™</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(random.choice([<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;f&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])</span></span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(random.choice(range(<span class="hljs-number">100</span>)</span></span>))<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(random.random()</span></span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(int(random.random()</span></span>*<span class="hljs-number">100</span>+<span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonåŠ æ²¹é¸­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
